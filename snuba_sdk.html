<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 14.1.0"/>
    <title>snuba_sdk API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .pdoc-alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:1rem center;margin-bottom:1rem;}.pdoc .pdoc-alert > *:last-child{margin-bottom:0;}.pdoc .pdoc-alert-note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>
            <img src="https://sentry-brand.storage.googleapis.com/sentry-wordmark-dark-280x84.png" class="logo" alt="project logo"/>


            <h2>Contents</h2>
            <ul>
  <li><a href="#status">Status</a></li>
  <li><a href="#examples">Examples</a></li>
  <li><a href="#mql-examples">MQL Examples</a></li>
  <li><a href="#contributing-to-the-sdk">Contributing to the SDK</a></li>
  <li><a href="#license">License</a></li>
</ul>



            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="class" href="#AliasedExpression">AliasedExpression</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#AliasedExpression.__init__">AliasedExpression</a>
                        </li>
                        <li>
                                <a class="variable" href="#AliasedExpression.exp">exp</a>
                        </li>
                        <li>
                                <a class="variable" href="#AliasedExpression.alias">alias</a>
                        </li>
                        <li>
                                <a class="function" href="#AliasedExpression.validate">validate</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#And">And</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#And.__init__">And</a>
                        </li>
                        <li>
                                <a class="variable" href="#And.op">op</a>
                        </li>
                        <li>
                                <a class="variable" href="#And.conditions">conditions</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#ArithmeticOperator">ArithmeticOperator</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#ArithmeticOperator.PLUS">PLUS</a>
                        </li>
                        <li>
                                <a class="variable" href="#ArithmeticOperator.MINUS">MINUS</a>
                        </li>
                        <li>
                                <a class="variable" href="#ArithmeticOperator.MULTIPLY">MULTIPLY</a>
                        </li>
                        <li>
                                <a class="variable" href="#ArithmeticOperator.DIVIDE">DIVIDE</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#BooleanCondition">BooleanCondition</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#BooleanCondition.__init__">BooleanCondition</a>
                        </li>
                        <li>
                                <a class="variable" href="#BooleanCondition.op">op</a>
                        </li>
                        <li>
                                <a class="variable" href="#BooleanCondition.conditions">conditions</a>
                        </li>
                        <li>
                                <a class="function" href="#BooleanCondition.validate">validate</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#BooleanOp">BooleanOp</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#BooleanOp.AND">AND</a>
                        </li>
                        <li>
                                <a class="variable" href="#BooleanOp.OR">OR</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#Column">Column</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Column.__init__">Column</a>
                        </li>
                        <li>
                                <a class="variable" href="#Column.name">name</a>
                        </li>
                        <li>
                                <a class="variable" href="#Column.entity">entity</a>
                        </li>
                        <li>
                                <a class="variable" href="#Column.subscriptable">subscriptable</a>
                        </li>
                        <li>
                                <a class="variable" href="#Column.key">key</a>
                        </li>
                        <li>
                                <a class="function" href="#Column.validate">validate</a>
                        </li>
                        <li>
                                <a class="function" href="#Column.validate_data_model">validate_data_model</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#Condition">Condition</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Condition.__init__">Condition</a>
                        </li>
                        <li>
                                <a class="variable" href="#Condition.lhs">lhs</a>
                        </li>
                        <li>
                                <a class="variable" href="#Condition.op">op</a>
                        </li>
                        <li>
                                <a class="variable" href="#Condition.rhs">rhs</a>
                        </li>
                        <li>
                                <a class="function" href="#Condition.validate">validate</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#CurriedFunction">CurriedFunction</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#CurriedFunction.__init__">CurriedFunction</a>
                        </li>
                        <li>
                                <a class="variable" href="#CurriedFunction.function">function</a>
                        </li>
                        <li>
                                <a class="variable" href="#CurriedFunction.initializers">initializers</a>
                        </li>
                        <li>
                                <a class="variable" href="#CurriedFunction.parameters">parameters</a>
                        </li>
                        <li>
                                <a class="variable" href="#CurriedFunction.alias">alias</a>
                        </li>
                        <li>
                                <a class="function" href="#CurriedFunction.validate">validate</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#Direction">Direction</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#Direction.ASC">ASC</a>
                        </li>
                        <li>
                                <a class="variable" href="#Direction.DESC">DESC</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#Entity">Entity</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Entity.__init__">Entity</a>
                        </li>
                        <li>
                                <a class="variable" href="#Entity.name">name</a>
                        </li>
                        <li>
                                <a class="variable" href="#Entity.alias">alias</a>
                        </li>
                        <li>
                                <a class="variable" href="#Entity.sample">sample</a>
                        </li>
                        <li>
                                <a class="variable" href="#Entity.data_model">data_model</a>
                        </li>
                        <li>
                                <a class="function" href="#Entity.validate">validate</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#Extrapolate">Extrapolate</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Extrapolate.__init__">Extrapolate</a>
                        </li>
                        <li>
                                <a class="variable" href="#Extrapolate.extrapolate">extrapolate</a>
                        </li>
                        <li>
                                <a class="function" href="#Extrapolate.validate">validate</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#Flags">Flags</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Flags.__init__">Flags</a>
                        </li>
                        <li>
                                <a class="variable" href="#Flags.totals">totals</a>
                        </li>
                        <li>
                                <a class="variable" href="#Flags.consistent">consistent</a>
                        </li>
                        <li>
                                <a class="variable" href="#Flags.turbo">turbo</a>
                        </li>
                        <li>
                                <a class="variable" href="#Flags.debug">debug</a>
                        </li>
                        <li>
                                <a class="variable" href="#Flags.dry_run">dry_run</a>
                        </li>
                        <li>
                                <a class="variable" href="#Flags.legacy">legacy</a>
                        </li>
                        <li>
                                <a class="function" href="#Flags.validate">validate</a>
                        </li>
                        <li>
                                <a class="function" href="#Flags.to_dict">to_dict</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#Formula">Formula</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Formula.__init__">Formula</a>
                        </li>
                        <li>
                                <a class="variable" href="#Formula.function_name">function_name</a>
                        </li>
                        <li>
                                <a class="variable" href="#Formula.parameters">parameters</a>
                        </li>
                        <li>
                                <a class="variable" href="#Formula.aggregate_params">aggregate_params</a>
                        </li>
                        <li>
                                <a class="variable" href="#Formula.filters">filters</a>
                        </li>
                        <li>
                                <a class="variable" href="#Formula.groupby">groupby</a>
                        </li>
                        <li>
                                <a class="function" href="#Formula.validate">validate</a>
                        </li>
                        <li>
                                <a class="function" href="#Formula.set_parameters">set_parameters</a>
                        </li>
                        <li>
                                <a class="function" href="#Formula.set_filters">set_filters</a>
                        </li>
                        <li>
                                <a class="function" href="#Formula.set_groupby">set_groupby</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#Function">Function</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Function.__init__">Function</a>
                        </li>
                        <li>
                                <a class="variable" href="#Function.initializers">initializers</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#Granularity">Granularity</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Granularity.__init__">Granularity</a>
                        </li>
                        <li>
                                <a class="variable" href="#Granularity.granularity">granularity</a>
                        </li>
                        <li>
                                <a class="function" href="#Granularity.validate">validate</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#Identifier">Identifier</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Identifier.__init__">Identifier</a>
                        </li>
                        <li>
                                <a class="variable" href="#Identifier.name">name</a>
                        </li>
                        <li>
                                <a class="function" href="#Identifier.validate">validate</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#Join">Join</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Join.__init__">Join</a>
                        </li>
                        <li>
                                <a class="variable" href="#Join.relationships">relationships</a>
                        </li>
                        <li>
                                <a class="function" href="#Join.get_alias_mappings">get_alias_mappings</a>
                        </li>
                        <li>
                                <a class="function" href="#Join.get_entities">get_entities</a>
                        </li>
                        <li>
                                <a class="function" href="#Join.validate">validate</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#Lambda">Lambda</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Lambda.__init__">Lambda</a>
                        </li>
                        <li>
                                <a class="variable" href="#Lambda.identifiers">identifiers</a>
                        </li>
                        <li>
                                <a class="variable" href="#Lambda.transformation">transformation</a>
                        </li>
                        <li>
                                <a class="function" href="#Lambda.validate">validate</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#Limit">Limit</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Limit.__init__">Limit</a>
                        </li>
                        <li>
                                <a class="variable" href="#Limit.limit">limit</a>
                        </li>
                        <li>
                                <a class="function" href="#Limit.validate">validate</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#LimitBy">LimitBy</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#LimitBy.__init__">LimitBy</a>
                        </li>
                        <li>
                                <a class="variable" href="#LimitBy.columns">columns</a>
                        </li>
                        <li>
                                <a class="variable" href="#LimitBy.count">count</a>
                        </li>
                        <li>
                                <a class="function" href="#LimitBy.validate">validate</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#Metric">Metric</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Metric.__init__">Metric</a>
                        </li>
                        <li>
                                <a class="variable" href="#Metric.public_name">public_name</a>
                        </li>
                        <li>
                                <a class="variable" href="#Metric.mri">mri</a>
                        </li>
                        <li>
                                <a class="variable" href="#Metric.id">id</a>
                        </li>
                        <li>
                                <a class="function" href="#Metric.get_fields">get_fields</a>
                        </li>
                        <li>
                                <a class="function" href="#Metric.validate">validate</a>
                        </li>
                        <li>
                                <a class="function" href="#Metric.set_mri">set_mri</a>
                        </li>
                        <li>
                                <a class="function" href="#Metric.set_public_name">set_public_name</a>
                        </li>
                        <li>
                                <a class="function" href="#Metric.set_id">set_id</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#MetricsQuery">MetricsQuery</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#MetricsQuery.__init__">MetricsQuery</a>
                        </li>
                        <li>
                                <a class="variable" href="#MetricsQuery.query">query</a>
                        </li>
                        <li>
                                <a class="variable" href="#MetricsQuery.start">start</a>
                        </li>
                        <li>
                                <a class="variable" href="#MetricsQuery.end">end</a>
                        </li>
                        <li>
                                <a class="variable" href="#MetricsQuery.rollup">rollup</a>
                        </li>
                        <li>
                                <a class="variable" href="#MetricsQuery.scope">scope</a>
                        </li>
                        <li>
                                <a class="variable" href="#MetricsQuery.limit">limit</a>
                        </li>
                        <li>
                                <a class="variable" href="#MetricsQuery.offset">offset</a>
                        </li>
                        <li>
                                <a class="variable" href="#MetricsQuery.extrapolate">extrapolate</a>
                        </li>
                        <li>
                                <a class="variable" href="#MetricsQuery.indexer_mappings">indexer_mappings</a>
                        </li>
                        <li>
                                <a class="function" href="#MetricsQuery.set_query">set_query</a>
                        </li>
                        <li>
                                <a class="function" href="#MetricsQuery.set_start">set_start</a>
                        </li>
                        <li>
                                <a class="function" href="#MetricsQuery.set_end">set_end</a>
                        </li>
                        <li>
                                <a class="function" href="#MetricsQuery.set_rollup">set_rollup</a>
                        </li>
                        <li>
                                <a class="function" href="#MetricsQuery.set_scope">set_scope</a>
                        </li>
                        <li>
                                <a class="function" href="#MetricsQuery.set_limit">set_limit</a>
                        </li>
                        <li>
                                <a class="function" href="#MetricsQuery.set_offset">set_offset</a>
                        </li>
                        <li>
                                <a class="function" href="#MetricsQuery.set_extrapolate">set_extrapolate</a>
                        </li>
                        <li>
                                <a class="function" href="#MetricsQuery.set_indexer_mappings">set_indexer_mappings</a>
                        </li>
                        <li>
                                <a class="function" href="#MetricsQuery.validate">validate</a>
                        </li>
                        <li>
                                <a class="function" href="#MetricsQuery.print">print</a>
                        </li>
                        <li>
                                <a class="function" href="#MetricsQuery.serialize">serialize</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#MetricsScope">MetricsScope</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#MetricsScope.__init__">MetricsScope</a>
                        </li>
                        <li>
                                <a class="variable" href="#MetricsScope.org_ids">org_ids</a>
                        </li>
                        <li>
                                <a class="variable" href="#MetricsScope.project_ids">project_ids</a>
                        </li>
                        <li>
                                <a class="variable" href="#MetricsScope.use_case_id">use_case_id</a>
                        </li>
                        <li>
                                <a class="function" href="#MetricsScope.validate">validate</a>
                        </li>
                        <li>
                                <a class="function" href="#MetricsScope.set_use_case_id">set_use_case_id</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#MQLContext">MQLContext</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#MQLContext.__init__">MQLContext</a>
                        </li>
                        <li>
                                <a class="variable" href="#MQLContext.start">start</a>
                        </li>
                        <li>
                                <a class="variable" href="#MQLContext.end">end</a>
                        </li>
                        <li>
                                <a class="variable" href="#MQLContext.rollup">rollup</a>
                        </li>
                        <li>
                                <a class="variable" href="#MQLContext.scope">scope</a>
                        </li>
                        <li>
                                <a class="variable" href="#MQLContext.indexer_mappings">indexer_mappings</a>
                        </li>
                        <li>
                                <a class="variable" href="#MQLContext.limit">limit</a>
                        </li>
                        <li>
                                <a class="variable" href="#MQLContext.offset">offset</a>
                        </li>
                        <li>
                                <a class="variable" href="#MQLContext.extrapolate">extrapolate</a>
                        </li>
                        <li>
                                <a class="function" href="#MQLContext.validate">validate</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#Offset">Offset</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Offset.__init__">Offset</a>
                        </li>
                        <li>
                                <a class="variable" href="#Offset.offset">offset</a>
                        </li>
                        <li>
                                <a class="function" href="#Offset.validate">validate</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#Op">Op</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#Op.GT">GT</a>
                        </li>
                        <li>
                                <a class="variable" href="#Op.LT">LT</a>
                        </li>
                        <li>
                                <a class="variable" href="#Op.GTE">GTE</a>
                        </li>
                        <li>
                                <a class="variable" href="#Op.LTE">LTE</a>
                        </li>
                        <li>
                                <a class="variable" href="#Op.EQ">EQ</a>
                        </li>
                        <li>
                                <a class="variable" href="#Op.NEQ">NEQ</a>
                        </li>
                        <li>
                                <a class="variable" href="#Op.IN">IN</a>
                        </li>
                        <li>
                                <a class="variable" href="#Op.NOT_IN">NOT_IN</a>
                        </li>
                        <li>
                                <a class="variable" href="#Op.LIKE">LIKE</a>
                        </li>
                        <li>
                                <a class="variable" href="#Op.NOT_LIKE">NOT_LIKE</a>
                        </li>
                        <li>
                                <a class="variable" href="#Op.IS_NULL">IS_NULL</a>
                        </li>
                        <li>
                                <a class="variable" href="#Op.IS_NOT_NULL">IS_NOT_NULL</a>
                        </li>
                        <li>
                                <a class="variable" href="#Op.NOT">NOT</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#Or">Or</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Or.__init__">Or</a>
                        </li>
                        <li>
                                <a class="variable" href="#Or.op">op</a>
                        </li>
                        <li>
                                <a class="variable" href="#Or.conditions">conditions</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#OrderBy">OrderBy</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#OrderBy.__init__">OrderBy</a>
                        </li>
                        <li>
                                <a class="variable" href="#OrderBy.exp">exp</a>
                        </li>
                        <li>
                                <a class="variable" href="#OrderBy.direction">direction</a>
                        </li>
                        <li>
                                <a class="function" href="#OrderBy.validate">validate</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#Query">Query</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Query.__init__">Query</a>
                        </li>
                        <li>
                                <a class="variable" href="#Query.match">match</a>
                        </li>
                        <li>
                                <a class="variable" href="#Query.select">select</a>
                        </li>
                        <li>
                                <a class="variable" href="#Query.groupby">groupby</a>
                        </li>
                        <li>
                                <a class="variable" href="#Query.array_join">array_join</a>
                        </li>
                        <li>
                                <a class="variable" href="#Query.where">where</a>
                        </li>
                        <li>
                                <a class="variable" href="#Query.having">having</a>
                        </li>
                        <li>
                                <a class="variable" href="#Query.orderby">orderby</a>
                        </li>
                        <li>
                                <a class="variable" href="#Query.limitby">limitby</a>
                        </li>
                        <li>
                                <a class="variable" href="#Query.limit">limit</a>
                        </li>
                        <li>
                                <a class="variable" href="#Query.offset">offset</a>
                        </li>
                        <li>
                                <a class="variable" href="#Query.granularity">granularity</a>
                        </li>
                        <li>
                                <a class="variable" href="#Query.totals">totals</a>
                        </li>
                        <li>
                                <a class="function" href="#Query.set_match">set_match</a>
                        </li>
                        <li>
                                <a class="function" href="#Query.set_select">set_select</a>
                        </li>
                        <li>
                                <a class="function" href="#Query.set_groupby">set_groupby</a>
                        </li>
                        <li>
                                <a class="function" href="#Query.set_array_join">set_array_join</a>
                        </li>
                        <li>
                                <a class="function" href="#Query.set_where">set_where</a>
                        </li>
                        <li>
                                <a class="function" href="#Query.set_having">set_having</a>
                        </li>
                        <li>
                                <a class="function" href="#Query.set_orderby">set_orderby</a>
                        </li>
                        <li>
                                <a class="function" href="#Query.set_limitby">set_limitby</a>
                        </li>
                        <li>
                                <a class="function" href="#Query.set_limit">set_limit</a>
                        </li>
                        <li>
                                <a class="function" href="#Query.set_offset">set_offset</a>
                        </li>
                        <li>
                                <a class="function" href="#Query.set_granularity">set_granularity</a>
                        </li>
                        <li>
                                <a class="function" href="#Query.set_totals">set_totals</a>
                        </li>
                        <li>
                                <a class="function" href="#Query.validate">validate</a>
                        </li>
                        <li>
                                <a class="function" href="#Query.serialize">serialize</a>
                        </li>
                        <li>
                                <a class="function" href="#Query.print">print</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#Relationship">Relationship</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Relationship.__init__">Relationship</a>
                        </li>
                        <li>
                                <a class="variable" href="#Relationship.lhs">lhs</a>
                        </li>
                        <li>
                                <a class="variable" href="#Relationship.name">name</a>
                        </li>
                        <li>
                                <a class="variable" href="#Relationship.rhs">rhs</a>
                        </li>
                        <li>
                                <a class="function" href="#Relationship.validate">validate</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#Request">Request</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Request.__init__">Request</a>
                        </li>
                        <li>
                                <a class="variable" href="#Request.dataset">dataset</a>
                        </li>
                        <li>
                                <a class="variable" href="#Request.app_id">app_id</a>
                        </li>
                        <li>
                                <a class="variable" href="#Request.query">query</a>
                        </li>
                        <li>
                                <a class="variable" href="#Request.flags">flags</a>
                        </li>
                        <li>
                                <a class="variable" href="#Request.parent_api">parent_api</a>
                        </li>
                        <li>
                                <a class="variable" href="#Request.tenant_ids">tenant_ids</a>
                        </li>
                        <li>
                                <a class="function" href="#Request.validate">validate</a>
                        </li>
                        <li>
                                <a class="function" href="#Request.to_dict">to_dict</a>
                        </li>
                        <li>
                                <a class="function" href="#Request.serialize">serialize</a>
                        </li>
                        <li>
                                <a class="function" href="#Request.serialize_mql">serialize_mql</a>
                        </li>
                        <li>
                                <a class="function" href="#Request.print">print</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#Rollup">Rollup</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Rollup.__init__">Rollup</a>
                        </li>
                        <li>
                                <a class="variable" href="#Rollup.interval">interval</a>
                        </li>
                        <li>
                                <a class="variable" href="#Rollup.totals">totals</a>
                        </li>
                        <li>
                                <a class="variable" href="#Rollup.orderby">orderby</a>
                        </li>
                        <li>
                                <a class="variable" href="#Rollup.granularity">granularity</a>
                        </li>
                        <li>
                                <a class="function" href="#Rollup.validate">validate</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#Storage">Storage</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Storage.__init__">Storage</a>
                        </li>
                        <li>
                                <a class="variable" href="#Storage.name">name</a>
                        </li>
                        <li>
                                <a class="variable" href="#Storage.sample">sample</a>
                        </li>
                        <li>
                                <a class="variable" href="#Storage.data_model">data_model</a>
                        </li>
                        <li>
                                <a class="function" href="#Storage.validate">validate</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#Timeseries">Timeseries</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Timeseries.__init__">Timeseries</a>
                        </li>
                        <li>
                                <a class="variable" href="#Timeseries.metric">metric</a>
                        </li>
                        <li>
                                <a class="variable" href="#Timeseries.aggregate">aggregate</a>
                        </li>
                        <li>
                                <a class="variable" href="#Timeseries.aggregate_params">aggregate_params</a>
                        </li>
                        <li>
                                <a class="variable" href="#Timeseries.filters">filters</a>
                        </li>
                        <li>
                                <a class="variable" href="#Timeseries.groupby">groupby</a>
                        </li>
                        <li>
                                <a class="function" href="#Timeseries.get_fields">get_fields</a>
                        </li>
                        <li>
                                <a class="function" href="#Timeseries.validate">validate</a>
                        </li>
                        <li>
                                <a class="function" href="#Timeseries.set_metric">set_metric</a>
                        </li>
                        <li>
                                <a class="function" href="#Timeseries.set_aggregate">set_aggregate</a>
                        </li>
                        <li>
                                <a class="function" href="#Timeseries.set_filters">set_filters</a>
                        </li>
                        <li>
                                <a class="function" href="#Timeseries.set_groupby">set_groupby</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#Totals">Totals</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Totals.__init__">Totals</a>
                        </li>
                        <li>
                                <a class="variable" href="#Totals.totals">totals</a>
                        </li>
                        <li>
                                <a class="function" href="#Totals.validate">validate</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#DeleteQuery">DeleteQuery</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#DeleteQuery.__init__">DeleteQuery</a>
                        </li>
                        <li>
                                <a class="variable" href="#DeleteQuery.storage_name">storage_name</a>
                        </li>
                        <li>
                                <a class="variable" href="#DeleteQuery.column_conditions">column_conditions</a>
                        </li>
                        <li>
                                <a class="function" href="#DeleteQuery.validate">validate</a>
                        </li>
                        <li>
                                <a class="function" href="#DeleteQuery.serialize">serialize</a>
                        </li>
                        <li>
                                <a class="function" href="#DeleteQuery.print">print</a>
                        </li>
                </ul>

            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
snuba_sdk    </h1>

                        <div class="docstring"><p><a href="https://sentry.io/?utm_source=github&utm_medium=logo"><img
src="https://sentry-brand.storage.googleapis.com/sentry-wordmark-dark-280x84.png"
width="280" alt="image" /></a></p>

<p>See here for the full
<a href="https://getsentry.github.io/snuba-sdk/">documentation</a>.</p>

<h1 id="status">Status</h1>

<p><a href="https://pypi.python.org/pypi/snuba-sdk"><img src="https://img.shields.io/pypi/v/snuba-sdk.svg" alt="image" /></a></p>

<p><a href="https://github.com/getsentry/snuba-sdk/actions"><img src="https://github.com/getsentry/snuba-sdk/workflows/tests/badge.svg" alt="image" /></a></p>

<p><a href="https://discord.gg/cWnMQeA"><img src="https://img.shields.io/discord/621778831602221064" alt="image" /></a></p>

<h1 id="examples">Examples</h1>

<p>Snuba SDK is a tool that allows requests to Snuba to be built
programatically. A Request consists of a Query, the dataset the Query is
targeting, the AppID of the Request, and any flags for the Request. A
Query object is a code representation of a SnQL query, and has a number
of attributes corresponding to different parts of the query.</p>

<p>Requests and Queries can be created directly:</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="n">request</span> <span class="o">=</span> <span class="n">Request</span><span class="p">(</span>
    <span class="n">dataset</span> <span class="o">=</span> <span class="s2">&quot;discover&quot;</span><span class="p">,</span>
    <span class="n">app_id</span> <span class="o">=</span> <span class="s2">&quot;myappid&quot;</span><span class="p">,</span>
    <span class="n">tenant_ids</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;referrer&quot;</span><span class="p">:</span> <span class="s2">&quot;my_referrer&quot;</span><span class="p">,</span> <span class="s2">&quot;organization_id&quot;</span><span class="p">:</span> <span class="mi">1234</span><span class="p">}</span>
    <span class="n">query</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span>
        <span class="n">match</span><span class="o">=</span><span class="n">Entity</span><span class="p">(</span><span class="s2">&quot;events&quot;</span><span class="p">),</span>
        <span class="n">select</span><span class="o">=</span><span class="p">[</span>
            <span class="n">Column</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">),</span>
            <span class="n">Function</span><span class="p">(</span><span class="s2">&quot;uniq&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">Column</span><span class="p">(</span><span class="s2">&quot;event_id&quot;</span><span class="p">)],</span> <span class="s2">&quot;uniq_events&quot;</span><span class="p">),</span>
        <span class="p">],</span>
        <span class="n">groupby</span><span class="o">=</span><span class="p">[</span><span class="n">Column</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">)],</span>
        <span class="n">where</span><span class="o">=</span><span class="p">[</span>
            <span class="n">Condition</span><span class="p">(</span><span class="n">Column</span><span class="p">(</span><span class="s2">&quot;timestamp&quot;</span><span class="p">),</span> <span class="n"><a href="#Op.GT">Op.GT</a></span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2021</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span>
            <span class="n">Condition</span><span class="p">(</span><span class="n">Column</span><span class="p">(</span><span class="s2">&quot;project_id&quot;</span><span class="p">),</span> <span class="n"><a href="#Op.IN">Op.IN</a></span><span class="p">,</span> <span class="n">Function</span><span class="p">(</span><span class="s2">&quot;tuple&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])),</span>
        <span class="p">],</span>
        <span class="n">limit</span><span class="o">=</span><span class="n">Limit</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span>
        <span class="n">offset</span><span class="o">=</span><span class="n">Offset</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
        <span class="n">granularity</span><span class="o">=</span><span class="n">Granularity</span><span class="p">(</span><span class="mi">3600</span><span class="p">),</span>
    <span class="p">),</span>
    <span class="n">flags</span> <span class="o">=</span> <span class="n">Flags</span><span class="p">(</span><span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="p">)</span>
</code></pre>
</div>

<p>Queries can also be built incrementally:</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="n">query</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">Query</span><span class="p">(</span><span class="s2">&quot;discover&quot;</span><span class="p">,</span> <span class="n">Entity</span><span class="p">(</span><span class="s2">&quot;events&quot;</span><span class="p">))</span>
    <span class="o">.</span><span class="n">set_select</span><span class="p">(</span>
        <span class="p">[</span><span class="n">Column</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">),</span> <span class="n">Function</span><span class="p">(</span><span class="s2">&quot;uniq&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">Column</span><span class="p">(</span><span class="s2">&quot;event_id&quot;</span><span class="p">)],</span> <span class="s2">&quot;uniq_events&quot;</span><span class="p">)]</span>
    <span class="p">)</span>
    <span class="o">.</span><span class="n">set_groupby</span><span class="p">([</span><span class="n">Column</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">)])</span>
    <span class="o">.</span><span class="n">set_where</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="n">Condition</span><span class="p">(</span><span class="n">Column</span><span class="p">(</span><span class="s2">&quot;timestamp&quot;</span><span class="p">),</span> <span class="n"><a href="#Op.GT">Op.GT</a></span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="p">(</span><span class="mi">2021</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span>
            <span class="n">Condition</span><span class="p">(</span><span class="n">Column</span><span class="p">(</span><span class="s2">&quot;project_id&quot;</span><span class="p">),</span> <span class="n"><a href="#Op.IN">Op.IN</a></span><span class="p">,</span> <span class="n">Function</span><span class="p">(</span><span class="s2">&quot;tuple&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])),</span>
        <span class="p">]</span>
    <span class="p">)</span>
    <span class="o">.</span><span class="n">set_limit</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
    <span class="o">.</span><span class="n">set_offset</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="o">.</span><span class="n">set_granularity</span><span class="p">(</span><span class="mi">3600</span><span class="p">)</span>
<span class="p">)</span>
</code></pre>
</div>

<h1 id="mql-examples">MQL Examples</h1>

<p>MQL queries can be built in a similar way to SnQL queries. However they use a <code><a href="#MetricsQuery">MetricsQuery</a></code> object instead of a <code><a href="#Query">Query</a></code> object. The <code>query</code> argument of a <code><a href="#MetricsQuery">MetricsQuery</a></code> is either a <code><a href="#Timeseries">Timeseries</a></code> or <code><a href="#Formula">Formula</a></code>, which is a mathemtical formula of <code><a href="#Timeseries">Timeseries</a></code>.</p>

<p>The other arguments to the <code><a href="#MetricsQuery">MetricsQuery</a></code> are meta data about how to run the query, e.g. start/end timestamps, the granularity, limits etc.</p>

<div class="pdoc-code codehilite">
<pre><span></span><code>    <span class="n">MetricsQuery</span><span class="p">(</span>
        <span class="n">query</span><span class="o">=</span><span class="n">Formula</span><span class="p">(</span>
            <span class="n">ArithmeticOperator</span><span class="o">.</span><span class="n">DIVIDE</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="p">[</span>
                <span class="n">Timeseries</span><span class="p">(</span>
                    <span class="n">metric</span><span class="o">=</span><span class="n">Metric</span><span class="p">(</span>
                        <span class="n">public_name</span><span class="o">=</span><span class="s2">&quot;transaction.duration&quot;</span><span class="p">,</span>
                    <span class="p">),</span>
                    <span class="n">aggregate</span><span class="o">=</span><span class="s2">&quot;sum&quot;</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="mi">1000</span><span class="p">,</span>
            <span class="p">],</span>
        <span class="p">),</span>
        <span class="n">start</span><span class="o">=</span><span class="n">NOW</span><span class="p">,</span>
        <span class="n">end</span><span class="o">=</span><span class="n">NOW</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">14</span><span class="p">),</span>
        <span class="n">rollup</span><span class="o">=</span><span class="n">Rollup</span><span class="p">(</span><span class="n">interval</span><span class="o">=</span><span class="mi">3600</span><span class="p">,</span> <span class="n">totals</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">granularity</span><span class="o">=</span><span class="mi">3600</span><span class="p">),</span>
        <span class="n">scope</span><span class="o">=</span><span class="n">MetricsScope</span><span class="p">(</span>
            <span class="n">org_ids</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">project_ids</span><span class="o">=</span><span class="p">[</span><span class="mi">11</span><span class="p">],</span> <span class="n">use_case_id</span><span class="o">=</span><span class="s2">&quot;transactions&quot;</span>
        <span class="p">),</span>
        <span class="n">limit</span><span class="o">=</span><span class="n">Limit</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
        <span class="n">offset</span><span class="o">=</span><span class="n">Offset</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span>
    <span class="p">)</span>
</code></pre>
</div>

<p>Once the request is built, it can be translated into a Snuba request
that can be sent to Snuba.</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="c1"># Outputs a formatted Snuba request</span>
<span class="n">request</span><span class="o">.</span><span class="n">serialize</span><span class="p">()</span>
</code></pre>
</div>

<p>It can also be printed in a more human readable format.</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="c1"># Outputs a formatted Snuba request</span>
<span class="nb">print</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">print</span><span class="p">())</span>
</code></pre>
</div>

<p>This outputs:</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;dataset&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;discover&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;app_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;myappid&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;query&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;MATCH (events) SELECT title, uniq(event_id) AS uniq_events BY title WHERE timestamp &gt; toDateTime(&#39;2021-01-01T00:00:00.000000&#39;) AND project_id IN tuple(1, 2, 3) LIMIT 10 OFFSET 0 GRANULARITY 3600&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;debug&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
<span class="p">}</span>
</code></pre>
</div>

<p>If an expression in the query is invalid (e.g. <code>Column(1)</code>) then an
<code>InvalidExpressionError</code> exception will be thrown. If there is a problem
with a query, it will throw an <code>InvalidQueryError</code> exception when
<code>.validate()</code> or <code>.translate()</code> is called. If there is a problem with
the Request or the Flags, an <code>InvalidRequestError</code> or <code>InvalidFlagError</code>
will be thrown respectively.</p>

<h1 id="contributing-to-the-sdk">Contributing to the SDK</h1>

<p>Please refer to
<a href="https://github.com/getsentry/snuba-sdk/blob/master/CONTRIBUTING.rst">CONTRIBUTING.rst</a>.</p>

<h1 id="license">License</h1>

<p>Licensed under FSL-1.0-Apache-2.0, see
<a href="https://github.com/getsentry/snuba-sdk/blob/master/LICENSE.md">LICENSE</a>.</p>
</div>

                        <input id="mod-snuba_sdk-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-snuba_sdk-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos"> 1</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos"> 2</span></a><span class="sd">.. include:: ../README.md</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos"> 3</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos"> 4</span></a>
</span><span id="L-5"><a href="#L-5"><span class="linenos"> 5</span></a><span class="kn">from</span> <span class="nn">snuba_sdk.aliased_expression</span> <span class="kn">import</span> <span class="n">AliasedExpression</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos"> 6</span></a><span class="kn">from</span> <span class="nn">snuba_sdk.column</span> <span class="kn">import</span> <span class="n">Column</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos"> 7</span></a><span class="kn">from</span> <span class="nn">snuba_sdk.conditions</span> <span class="kn">import</span> <span class="n">And</span><span class="p">,</span> <span class="n">BooleanCondition</span><span class="p">,</span> <span class="n">BooleanOp</span><span class="p">,</span> <span class="n">Condition</span><span class="p">,</span> <span class="n">Op</span><span class="p">,</span> <span class="n">Or</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos"> 8</span></a><span class="kn">from</span> <span class="nn">snuba_sdk.entity</span> <span class="kn">import</span> <span class="n">Entity</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos"> 9</span></a><span class="kn">from</span> <span class="nn">snuba_sdk.storage</span> <span class="kn">import</span> <span class="n">Storage</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos">10</span></a><span class="kn">from</span> <span class="nn">snuba_sdk.expressions</span> <span class="kn">import</span> <span class="n">Extrapolate</span><span class="p">,</span> <span class="n">Granularity</span><span class="p">,</span> <span class="n">Limit</span><span class="p">,</span> <span class="n">Offset</span><span class="p">,</span> <span class="n">Totals</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos">11</span></a><span class="kn">from</span> <span class="nn">snuba_sdk.formula</span> <span class="kn">import</span> <span class="n">ArithmeticOperator</span><span class="p">,</span> <span class="n">Formula</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos">12</span></a><span class="kn">from</span> <span class="nn">snuba_sdk.function</span> <span class="kn">import</span> <span class="n">CurriedFunction</span><span class="p">,</span> <span class="n">Function</span><span class="p">,</span> <span class="n">Identifier</span><span class="p">,</span> <span class="n">Lambda</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos">13</span></a><span class="kn">from</span> <span class="nn">snuba_sdk.metrics_query</span> <span class="kn">import</span> <span class="n">MetricsQuery</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos">14</span></a><span class="kn">from</span> <span class="nn">snuba_sdk.mql_context</span> <span class="kn">import</span> <span class="n">MQLContext</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos">15</span></a><span class="kn">from</span> <span class="nn">snuba_sdk.orderby</span> <span class="kn">import</span> <span class="n">Direction</span><span class="p">,</span> <span class="n">LimitBy</span><span class="p">,</span> <span class="n">OrderBy</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos">16</span></a><span class="kn">from</span> <span class="nn">snuba_sdk.query</span> <span class="kn">import</span> <span class="n">Query</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos">17</span></a><span class="kn">from</span> <span class="nn">snuba_sdk.relationships</span> <span class="kn">import</span> <span class="n">Join</span><span class="p">,</span> <span class="n">Relationship</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos">18</span></a><span class="kn">from</span> <span class="nn">snuba_sdk.request</span> <span class="kn">import</span> <span class="n">Flags</span><span class="p">,</span> <span class="n">Request</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos">19</span></a><span class="kn">from</span> <span class="nn">snuba_sdk.timeseries</span> <span class="kn">import</span> <span class="n">Metric</span><span class="p">,</span> <span class="n">MetricsScope</span><span class="p">,</span> <span class="n">Rollup</span><span class="p">,</span> <span class="n">Timeseries</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos">20</span></a><span class="kn">from</span> <span class="nn">snuba_sdk.delete_query</span> <span class="kn">import</span> <span class="n">DeleteQuery</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos">21</span></a>
</span><span id="L-22"><a href="#L-22"><span class="linenos">22</span></a><span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos">23</span></a>    <span class="s2">&quot;AliasedExpression&quot;</span><span class="p">,</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos">24</span></a>    <span class="s2">&quot;And&quot;</span><span class="p">,</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos">25</span></a>    <span class="s2">&quot;ArithmeticOperator&quot;</span><span class="p">,</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos">26</span></a>    <span class="s2">&quot;BooleanCondition&quot;</span><span class="p">,</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos">27</span></a>    <span class="s2">&quot;BooleanOp&quot;</span><span class="p">,</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos">28</span></a>    <span class="s2">&quot;Column&quot;</span><span class="p">,</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos">29</span></a>    <span class="s2">&quot;Condition&quot;</span><span class="p">,</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos">30</span></a>    <span class="s2">&quot;CurriedFunction&quot;</span><span class="p">,</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos">31</span></a>    <span class="s2">&quot;Direction&quot;</span><span class="p">,</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos">32</span></a>    <span class="s2">&quot;Entity&quot;</span><span class="p">,</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos">33</span></a>    <span class="s2">&quot;Extrapolate&quot;</span><span class="p">,</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos">34</span></a>    <span class="s2">&quot;Flags&quot;</span><span class="p">,</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos">35</span></a>    <span class="s2">&quot;Formula&quot;</span><span class="p">,</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos">36</span></a>    <span class="s2">&quot;Function&quot;</span><span class="p">,</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos">37</span></a>    <span class="s2">&quot;Granularity&quot;</span><span class="p">,</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos">38</span></a>    <span class="s2">&quot;Identifier&quot;</span><span class="p">,</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos">39</span></a>    <span class="s2">&quot;Join&quot;</span><span class="p">,</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos">40</span></a>    <span class="s2">&quot;Lambda&quot;</span><span class="p">,</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos">41</span></a>    <span class="s2">&quot;Limit&quot;</span><span class="p">,</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos">42</span></a>    <span class="s2">&quot;LimitBy&quot;</span><span class="p">,</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos">43</span></a>    <span class="s2">&quot;Metric&quot;</span><span class="p">,</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos">44</span></a>    <span class="s2">&quot;MetricsQuery&quot;</span><span class="p">,</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos">45</span></a>    <span class="s2">&quot;MetricsScope&quot;</span><span class="p">,</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos">46</span></a>    <span class="s2">&quot;MQLContext&quot;</span><span class="p">,</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos">47</span></a>    <span class="s2">&quot;Offset&quot;</span><span class="p">,</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos">48</span></a>    <span class="s2">&quot;Op&quot;</span><span class="p">,</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos">49</span></a>    <span class="s2">&quot;Or&quot;</span><span class="p">,</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos">50</span></a>    <span class="s2">&quot;OrderBy&quot;</span><span class="p">,</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos">51</span></a>    <span class="s2">&quot;Query&quot;</span><span class="p">,</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos">52</span></a>    <span class="s2">&quot;Relationship&quot;</span><span class="p">,</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos">53</span></a>    <span class="s2">&quot;Request&quot;</span><span class="p">,</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos">54</span></a>    <span class="s2">&quot;Rollup&quot;</span><span class="p">,</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos">55</span></a>    <span class="s2">&quot;Storage&quot;</span><span class="p">,</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos">56</span></a>    <span class="s2">&quot;Timeseries&quot;</span><span class="p">,</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos">57</span></a>    <span class="s2">&quot;Totals&quot;</span><span class="p">,</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos">58</span></a>    <span class="s2">&quot;DeleteQuery&quot;</span><span class="p">,</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos">59</span></a><span class="p">]</span>
</span></pre></div>


            </section>
                <section id="AliasedExpression">
                            <input id="AliasedExpression-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
                    <div class="decorator">@dataclass(frozen=True)</div>

    <span class="def">class</span>
    <span class="name">AliasedExpression</span><wbr>(<span class="base">snuba_sdk.expressions.Expression</span>):

                <label class="view-source-button" for="AliasedExpression-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AliasedExpression"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AliasedExpression-9"><a href="#AliasedExpression-9"><span class="linenos"> 9</span></a><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="AliasedExpression-10"><a href="#AliasedExpression-10"><span class="linenos">10</span></a><span class="k">class</span> <span class="nc">AliasedExpression</span><span class="p">(</span><span class="n">Expression</span><span class="p">):</span>
</span><span id="AliasedExpression-11"><a href="#AliasedExpression-11"><span class="linenos">11</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AliasedExpression-12"><a href="#AliasedExpression-12"><span class="linenos">12</span></a><span class="sd">    Used to alias the name of an expression in the results of a query. It is not used</span>
</span><span id="AliasedExpression-13"><a href="#AliasedExpression-13"><span class="linenos">13</span></a><span class="sd">    anywhere in Snuba except to change the names in the results set. Right now this is</span>
</span><span id="AliasedExpression-14"><a href="#AliasedExpression-14"><span class="linenos">14</span></a><span class="sd">    limited to Columns only because Functions have a separate alias. Eventually the</span>
</span><span id="AliasedExpression-15"><a href="#AliasedExpression-15"><span class="linenos">15</span></a><span class="sd">    two will be combined.</span>
</span><span id="AliasedExpression-16"><a href="#AliasedExpression-16"><span class="linenos">16</span></a>
</span><span id="AliasedExpression-17"><a href="#AliasedExpression-17"><span class="linenos">17</span></a><span class="sd">    :param Expression: The expression to alias.</span>
</span><span id="AliasedExpression-18"><a href="#AliasedExpression-18"><span class="linenos">18</span></a><span class="sd">    :type Expression: Column</span>
</span><span id="AliasedExpression-19"><a href="#AliasedExpression-19"><span class="linenos">19</span></a><span class="sd">    :raises InvalidExpressionError: If the expression or alias is invalid.</span>
</span><span id="AliasedExpression-20"><a href="#AliasedExpression-20"><span class="linenos">20</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="AliasedExpression-21"><a href="#AliasedExpression-21"><span class="linenos">21</span></a>
</span><span id="AliasedExpression-22"><a href="#AliasedExpression-22"><span class="linenos">22</span></a>    <span class="c1"># TODO: We should eventually allow Functions here as well, once we think through</span>
</span><span id="AliasedExpression-23"><a href="#AliasedExpression-23"><span class="linenos">23</span></a>    <span class="c1"># how this should work with functions that already have aliases.</span>
</span><span id="AliasedExpression-24"><a href="#AliasedExpression-24"><span class="linenos">24</span></a>    <span class="n">exp</span><span class="p">:</span> <span class="n">Column</span>
</span><span id="AliasedExpression-25"><a href="#AliasedExpression-25"><span class="linenos">25</span></a>    <span class="n">alias</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="AliasedExpression-26"><a href="#AliasedExpression-26"><span class="linenos">26</span></a>
</span><span id="AliasedExpression-27"><a href="#AliasedExpression-27"><span class="linenos">27</span></a>    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="AliasedExpression-28"><a href="#AliasedExpression-28"><span class="linenos">28</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exp</span><span class="p">,</span> <span class="n">Column</span><span class="p">):</span>
</span><span id="AliasedExpression-29"><a href="#AliasedExpression-29"><span class="linenos">29</span></a>            <span class="k">raise</span> <span class="n">InvalidExpressionError</span><span class="p">(</span>
</span><span id="AliasedExpression-30"><a href="#AliasedExpression-30"><span class="linenos">30</span></a>                <span class="s2">&quot;aliased expressions can only contain a Column&quot;</span>
</span><span id="AliasedExpression-31"><a href="#AliasedExpression-31"><span class="linenos">31</span></a>            <span class="p">)</span>
</span><span id="AliasedExpression-32"><a href="#AliasedExpression-32"><span class="linenos">32</span></a>
</span><span id="AliasedExpression-33"><a href="#AliasedExpression-33"><span class="linenos">33</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">alias</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="AliasedExpression-34"><a href="#AliasedExpression-34"><span class="linenos">34</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alias</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">alias</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
</span><span id="AliasedExpression-35"><a href="#AliasedExpression-35"><span class="linenos">35</span></a>                <span class="k">raise</span> <span class="n">InvalidExpressionError</span><span class="p">(</span>
</span><span id="AliasedExpression-36"><a href="#AliasedExpression-36"><span class="linenos">36</span></a>                    <span class="sa">f</span><span class="s2">&quot;alias &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">alias</span><span class="si">}</span><span class="s2">&#39; of expression must be None or a non-empty string&quot;</span>
</span><span id="AliasedExpression-37"><a href="#AliasedExpression-37"><span class="linenos">37</span></a>                <span class="p">)</span>
</span><span id="AliasedExpression-38"><a href="#AliasedExpression-38"><span class="linenos">38</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">ALIAS_RE</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alias</span><span class="p">):</span>
</span><span id="AliasedExpression-39"><a href="#AliasedExpression-39"><span class="linenos">39</span></a>                <span class="k">raise</span> <span class="n">InvalidExpressionError</span><span class="p">(</span>
</span><span id="AliasedExpression-40"><a href="#AliasedExpression-40"><span class="linenos">40</span></a>                    <span class="sa">f</span><span class="s2">&quot;alias &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">alias</span><span class="si">}</span><span class="s2">&#39; of expression contains invalid characters&quot;</span>
</span><span id="AliasedExpression-41"><a href="#AliasedExpression-41"><span class="linenos">41</span></a>                <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Used to alias the name of an expression in the results of a query. It is not used
anywhere in Snuba except to change the names in the results set. Right now this is
limited to Columns only because Functions have a separate alias. Eventually the
two will be combined.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>Expression</strong>:  The expression to alias.</li>
</ul>

<h6 id="raises">Raises</h6>

<ul>
<li><strong>InvalidExpressionError</strong>:  If the expression or alias is invalid.</li>
</ul>
</div>


                            <div id="AliasedExpression.__init__" class="classattr">
                                <div class="attr function">
            
        <span class="name">AliasedExpression</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">exp</span><span class="p">:</span> <span class="n"><a href="#Column">Column</a></span>, </span><span class="param"><span class="n">alias</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span>)</span>

        
    </div>
    <a class="headerlink" href="#AliasedExpression.__init__"></a>
    
    

                            </div>
                            <div id="AliasedExpression.exp" class="classattr">
                                <div class="attr variable">
            <span class="name">exp</span><span class="annotation">: <a href="#Column">Column</a></span>

        
    </div>
    <a class="headerlink" href="#AliasedExpression.exp"></a>
    
    

                            </div>
                            <div id="AliasedExpression.alias" class="classattr">
                                <div class="attr variable">
            <span class="name">alias</span><span class="annotation">: Optional[str]</span>        =
<span class="default_value">None</span>

        
    </div>
    <a class="headerlink" href="#AliasedExpression.alias"></a>
    
    

                            </div>
                            <div id="AliasedExpression.validate" class="classattr">
                                        <input id="AliasedExpression.validate-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">validate</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="AliasedExpression.validate-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AliasedExpression.validate"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AliasedExpression.validate-27"><a href="#AliasedExpression.validate-27"><span class="linenos">27</span></a>    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="AliasedExpression.validate-28"><a href="#AliasedExpression.validate-28"><span class="linenos">28</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exp</span><span class="p">,</span> <span class="n">Column</span><span class="p">):</span>
</span><span id="AliasedExpression.validate-29"><a href="#AliasedExpression.validate-29"><span class="linenos">29</span></a>            <span class="k">raise</span> <span class="n">InvalidExpressionError</span><span class="p">(</span>
</span><span id="AliasedExpression.validate-30"><a href="#AliasedExpression.validate-30"><span class="linenos">30</span></a>                <span class="s2">&quot;aliased expressions can only contain a Column&quot;</span>
</span><span id="AliasedExpression.validate-31"><a href="#AliasedExpression.validate-31"><span class="linenos">31</span></a>            <span class="p">)</span>
</span><span id="AliasedExpression.validate-32"><a href="#AliasedExpression.validate-32"><span class="linenos">32</span></a>
</span><span id="AliasedExpression.validate-33"><a href="#AliasedExpression.validate-33"><span class="linenos">33</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">alias</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="AliasedExpression.validate-34"><a href="#AliasedExpression.validate-34"><span class="linenos">34</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alias</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">alias</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
</span><span id="AliasedExpression.validate-35"><a href="#AliasedExpression.validate-35"><span class="linenos">35</span></a>                <span class="k">raise</span> <span class="n">InvalidExpressionError</span><span class="p">(</span>
</span><span id="AliasedExpression.validate-36"><a href="#AliasedExpression.validate-36"><span class="linenos">36</span></a>                    <span class="sa">f</span><span class="s2">&quot;alias &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">alias</span><span class="si">}</span><span class="s2">&#39; of expression must be None or a non-empty string&quot;</span>
</span><span id="AliasedExpression.validate-37"><a href="#AliasedExpression.validate-37"><span class="linenos">37</span></a>                <span class="p">)</span>
</span><span id="AliasedExpression.validate-38"><a href="#AliasedExpression.validate-38"><span class="linenos">38</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">ALIAS_RE</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alias</span><span class="p">):</span>
</span><span id="AliasedExpression.validate-39"><a href="#AliasedExpression.validate-39"><span class="linenos">39</span></a>                <span class="k">raise</span> <span class="n">InvalidExpressionError</span><span class="p">(</span>
</span><span id="AliasedExpression.validate-40"><a href="#AliasedExpression.validate-40"><span class="linenos">40</span></a>                    <span class="sa">f</span><span class="s2">&quot;alias &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">alias</span><span class="si">}</span><span class="s2">&#39; of expression contains invalid characters&quot;</span>
</span><span id="AliasedExpression.validate-41"><a href="#AliasedExpression.validate-41"><span class="linenos">41</span></a>                <span class="p">)</span>
</span></pre></div>


    

                            </div>
                </section>
                <section id="And">
                            <input id="And-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
                    <div class="decorator">@dataclass(frozen=True)</div>

    <span class="def">class</span>
    <span class="name">And</span><wbr>(<span class="base"><a href="#BooleanCondition">snuba_sdk.BooleanCondition</a></span>):

                <label class="view-source-button" for="And-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#And"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="And-135"><a href="#And-135"><span class="linenos">135</span></a><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="And-136"><a href="#And-136"><span class="linenos">136</span></a><span class="k">class</span> <span class="nc">And</span><span class="p">(</span><span class="n">BooleanCondition</span><span class="p">):</span>
</span><span id="And-137"><a href="#And-137"><span class="linenos">137</span></a>    <span class="n">op</span><span class="p">:</span> <span class="n">BooleanOp</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">init</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">BooleanOp</span><span class="o">.</span><span class="n">AND</span><span class="p">)</span>
</span><span id="And-138"><a href="#And-138"><span class="linenos">138</span></a>    <span class="n">conditions</span><span class="p">:</span> <span class="n">ConditionGroup</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
</span></pre></div>


    

                            <div id="And.__init__" class="classattr">
                                <div class="attr function">
            
        <span class="name">And</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">conditions</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n"><a href="#BooleanCondition">BooleanCondition</a></span><span class="p">,</span> <span class="n"><a href="#Condition">Condition</a></span><span class="p">]]</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">factory</span><span class="o">&gt;</span></span>)</span>

        
    </div>
    <a class="headerlink" href="#And.__init__"></a>
    
    

                            </div>
                            <div id="And.op" class="classattr">
                                <div class="attr variable">
            <span class="name">op</span><span class="annotation">: <a href="#BooleanOp">BooleanOp</a></span>        =
<span class="default_value">&lt;<a href="#BooleanOp.AND">BooleanOp.AND</a>: &#39;AND&#39;&gt;</span>

        
    </div>
    <a class="headerlink" href="#And.op"></a>
    
    

                            </div>
                            <div id="And.conditions" class="classattr">
                                <div class="attr variable">
            <span class="name">conditions</span><span class="annotation">: Sequence[Union[<a href="#BooleanCondition">BooleanCondition</a>, <a href="#Condition">Condition</a>]]</span>

        
    </div>
    <a class="headerlink" href="#And.conditions"></a>
    
    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#BooleanCondition">BooleanCondition</a></dt>
                                <dd id="And.validate" class="function"><a href="#BooleanCondition.validate">validate</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="ArithmeticOperator">
                            <input id="ArithmeticOperator-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">ArithmeticOperator</span><wbr>(<span class="base">enum.Enum</span>):

                <label class="view-source-button" for="ArithmeticOperator-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ArithmeticOperator"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ArithmeticOperator-23"><a href="#ArithmeticOperator-23"><span class="linenos">23</span></a><span class="k">class</span> <span class="nc">ArithmeticOperator</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
</span><span id="ArithmeticOperator-24"><a href="#ArithmeticOperator-24"><span class="linenos">24</span></a>    <span class="n">PLUS</span> <span class="o">=</span> <span class="s2">&quot;plus&quot;</span>
</span><span id="ArithmeticOperator-25"><a href="#ArithmeticOperator-25"><span class="linenos">25</span></a>    <span class="n">MINUS</span> <span class="o">=</span> <span class="s2">&quot;minus&quot;</span>
</span><span id="ArithmeticOperator-26"><a href="#ArithmeticOperator-26"><span class="linenos">26</span></a>    <span class="n">MULTIPLY</span> <span class="o">=</span> <span class="s2">&quot;multiply&quot;</span>
</span><span id="ArithmeticOperator-27"><a href="#ArithmeticOperator-27"><span class="linenos">27</span></a>    <span class="n">DIVIDE</span> <span class="o">=</span> <span class="s2">&quot;divide&quot;</span>
</span></pre></div>


            <div class="docstring"><p>Create a collection of name/value pairs.</p>

<p>Example enumeration:</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">Color</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">RED</span> <span class="o">=</span> <span class="mi">1</span>
<span class="gp">... </span>    <span class="n">BLUE</span> <span class="o">=</span> <span class="mi">2</span>
<span class="gp">... </span>    <span class="n">GREEN</span> <span class="o">=</span> <span class="mi">3</span>
</code></pre>
</div>

<p>Access them by:</p>

<ul>
<li>attribute access::</li>
</ul>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">Color</span><span class="o">.</span><span class="n">RED</span>
<span class="go">&lt;Color.RED: 1&gt;</span>
</code></pre>
</div>

<ul>
<li>value lookup:</li>
</ul>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">Color</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="go">&lt;Color.RED: 1&gt;</span>
</code></pre>
</div>

<ul>
<li>name lookup:</li>
</ul>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">Color</span><span class="p">[</span><span class="s1">&#39;RED&#39;</span><span class="p">]</span>
<span class="go">&lt;Color.RED: 1&gt;</span>
</code></pre>
</div>

<p>Enumerations can be iterated over, and know how many members they have:</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">Color</span><span class="p">)</span>
<span class="go">3</span>
</code></pre>
</div>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">Color</span><span class="p">)</span>
<span class="go">[&lt;Color.RED: 1&gt;, &lt;Color.BLUE: 2&gt;, &lt;Color.GREEN: 3&gt;]</span>
</code></pre>
</div>

<p>Methods can be added to enumerations, and members can have their own
attributes -- see the documentation for details.</p>
</div>


                            <div id="ArithmeticOperator.PLUS" class="classattr">
                                <div class="attr variable">
            <span class="name">PLUS</span>        =
<span class="default_value">&lt;<a href="#ArithmeticOperator.PLUS">ArithmeticOperator.PLUS</a>: &#39;plus&#39;&gt;</span>

        
    </div>
    <a class="headerlink" href="#ArithmeticOperator.PLUS"></a>
    
    

                            </div>
                            <div id="ArithmeticOperator.MINUS" class="classattr">
                                <div class="attr variable">
            <span class="name">MINUS</span>        =
<span class="default_value">&lt;<a href="#ArithmeticOperator.MINUS">ArithmeticOperator.MINUS</a>: &#39;minus&#39;&gt;</span>

        
    </div>
    <a class="headerlink" href="#ArithmeticOperator.MINUS"></a>
    
    

                            </div>
                            <div id="ArithmeticOperator.MULTIPLY" class="classattr">
                                <div class="attr variable">
            <span class="name">MULTIPLY</span>        =
<span class="default_value">&lt;<a href="#ArithmeticOperator.MULTIPLY">ArithmeticOperator.MULTIPLY</a>: &#39;multiply&#39;&gt;</span>

        
    </div>
    <a class="headerlink" href="#ArithmeticOperator.MULTIPLY"></a>
    
    

                            </div>
                            <div id="ArithmeticOperator.DIVIDE" class="classattr">
                                <div class="attr variable">
            <span class="name">DIVIDE</span>        =
<span class="default_value">&lt;<a href="#ArithmeticOperator.DIVIDE">ArithmeticOperator.DIVIDE</a>: &#39;divide&#39;&gt;</span>

        
    </div>
    <a class="headerlink" href="#ArithmeticOperator.DIVIDE"></a>
    
    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>enum.Enum</dt>
                                <dd id="ArithmeticOperator.name" class="variable">name</dd>
                <dd id="ArithmeticOperator.value" class="variable">value</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="BooleanCondition">
                            <input id="BooleanCondition-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
                    <div class="decorator">@dataclass(frozen=True)</div>

    <span class="def">class</span>
    <span class="name">BooleanCondition</span><wbr>(<span class="base">snuba_sdk.expressions.Expression</span>):

                <label class="view-source-button" for="BooleanCondition-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#BooleanCondition"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="BooleanCondition-108"><a href="#BooleanCondition-108"><span class="linenos">108</span></a><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="BooleanCondition-109"><a href="#BooleanCondition-109"><span class="linenos">109</span></a><span class="k">class</span> <span class="nc">BooleanCondition</span><span class="p">(</span><span class="n">Expression</span><span class="p">):</span>
</span><span id="BooleanCondition-110"><a href="#BooleanCondition-110"><span class="linenos">110</span></a>    <span class="n">op</span><span class="p">:</span> <span class="n">BooleanOp</span>
</span><span id="BooleanCondition-111"><a href="#BooleanCondition-111"><span class="linenos">111</span></a>    <span class="n">conditions</span><span class="p">:</span> <span class="n">ConditionGroup</span>
</span><span id="BooleanCondition-112"><a href="#BooleanCondition-112"><span class="linenos">112</span></a>
</span><span id="BooleanCondition-113"><a href="#BooleanCondition-113"><span class="linenos">113</span></a>    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="BooleanCondition-114"><a href="#BooleanCondition-114"><span class="linenos">114</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">op</span><span class="p">,</span> <span class="n">BooleanOp</span><span class="p">):</span>
</span><span id="BooleanCondition-115"><a href="#BooleanCondition-115"><span class="linenos">115</span></a>            <span class="k">raise</span> <span class="n">InvalidConditionError</span><span class="p">(</span>
</span><span id="BooleanCondition-116"><a href="#BooleanCondition-116"><span class="linenos">116</span></a>                <span class="s2">&quot;invalid boolean: operator of a boolean must be a BooleanOp&quot;</span>
</span><span id="BooleanCondition-117"><a href="#BooleanCondition-117"><span class="linenos">117</span></a>            <span class="p">)</span>
</span><span id="BooleanCondition-118"><a href="#BooleanCondition-118"><span class="linenos">118</span></a>
</span><span id="BooleanCondition-119"><a href="#BooleanCondition-119"><span class="linenos">119</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">conditions</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
</span><span id="BooleanCondition-120"><a href="#BooleanCondition-120"><span class="linenos">120</span></a>            <span class="k">raise</span> <span class="n">InvalidConditionError</span><span class="p">(</span>
</span><span id="BooleanCondition-121"><a href="#BooleanCondition-121"><span class="linenos">121</span></a>                <span class="s2">&quot;invalid boolean: conditions must be a list of other conditions&quot;</span>
</span><span id="BooleanCondition-122"><a href="#BooleanCondition-122"><span class="linenos">122</span></a>            <span class="p">)</span>
</span><span id="BooleanCondition-123"><a href="#BooleanCondition-123"><span class="linenos">123</span></a>        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">conditions</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="BooleanCondition-124"><a href="#BooleanCondition-124"><span class="linenos">124</span></a>            <span class="k">raise</span> <span class="n">InvalidConditionError</span><span class="p">(</span>
</span><span id="BooleanCondition-125"><a href="#BooleanCondition-125"><span class="linenos">125</span></a>                <span class="s2">&quot;invalid boolean: must supply at least two conditions&quot;</span>
</span><span id="BooleanCondition-126"><a href="#BooleanCondition-126"><span class="linenos">126</span></a>            <span class="p">)</span>
</span><span id="BooleanCondition-127"><a href="#BooleanCondition-127"><span class="linenos">127</span></a>
</span><span id="BooleanCondition-128"><a href="#BooleanCondition-128"><span class="linenos">128</span></a>        <span class="k">for</span> <span class="n">con</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">conditions</span><span class="p">:</span>
</span><span id="BooleanCondition-129"><a href="#BooleanCondition-129"><span class="linenos">129</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="p">(</span><span class="n">Condition</span><span class="p">,</span> <span class="n">BooleanCondition</span><span class="p">)):</span>
</span><span id="BooleanCondition-130"><a href="#BooleanCondition-130"><span class="linenos">130</span></a>                <span class="k">raise</span> <span class="n">InvalidConditionError</span><span class="p">(</span>
</span><span id="BooleanCondition-131"><a href="#BooleanCondition-131"><span class="linenos">131</span></a>                    <span class="sa">f</span><span class="s2">&quot;invalid boolean: </span><span class="si">{</span><span class="n">con</span><span class="si">}</span><span class="s2"> is not a valid condition&quot;</span>
</span><span id="BooleanCondition-132"><a href="#BooleanCondition-132"><span class="linenos">132</span></a>                <span class="p">)</span>
</span></pre></div>


    

                            <div id="BooleanCondition.__init__" class="classattr">
                                <div class="attr function">
            
        <span class="name">BooleanCondition</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">op</span><span class="p">:</span> <span class="n"><a href="#BooleanOp">BooleanOp</a></span>,</span><span class="param">	<span class="n">conditions</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n"><a href="#BooleanCondition">BooleanCondition</a></span><span class="p">,</span> <span class="n"><a href="#Condition">Condition</a></span><span class="p">]]</span></span>)</span>

        
    </div>
    <a class="headerlink" href="#BooleanCondition.__init__"></a>
    
    

                            </div>
                            <div id="BooleanCondition.op" class="classattr">
                                <div class="attr variable">
            <span class="name">op</span><span class="annotation">: <a href="#BooleanOp">BooleanOp</a></span>

        
    </div>
    <a class="headerlink" href="#BooleanCondition.op"></a>
    
    

                            </div>
                            <div id="BooleanCondition.conditions" class="classattr">
                                <div class="attr variable">
            <span class="name">conditions</span><span class="annotation">: Sequence[Union[<a href="#BooleanCondition">BooleanCondition</a>, <a href="#Condition">Condition</a>]]</span>

        
    </div>
    <a class="headerlink" href="#BooleanCondition.conditions"></a>
    
    

                            </div>
                            <div id="BooleanCondition.validate" class="classattr">
                                        <input id="BooleanCondition.validate-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">validate</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="BooleanCondition.validate-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#BooleanCondition.validate"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="BooleanCondition.validate-113"><a href="#BooleanCondition.validate-113"><span class="linenos">113</span></a>    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="BooleanCondition.validate-114"><a href="#BooleanCondition.validate-114"><span class="linenos">114</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">op</span><span class="p">,</span> <span class="n">BooleanOp</span><span class="p">):</span>
</span><span id="BooleanCondition.validate-115"><a href="#BooleanCondition.validate-115"><span class="linenos">115</span></a>            <span class="k">raise</span> <span class="n">InvalidConditionError</span><span class="p">(</span>
</span><span id="BooleanCondition.validate-116"><a href="#BooleanCondition.validate-116"><span class="linenos">116</span></a>                <span class="s2">&quot;invalid boolean: operator of a boolean must be a BooleanOp&quot;</span>
</span><span id="BooleanCondition.validate-117"><a href="#BooleanCondition.validate-117"><span class="linenos">117</span></a>            <span class="p">)</span>
</span><span id="BooleanCondition.validate-118"><a href="#BooleanCondition.validate-118"><span class="linenos">118</span></a>
</span><span id="BooleanCondition.validate-119"><a href="#BooleanCondition.validate-119"><span class="linenos">119</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">conditions</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
</span><span id="BooleanCondition.validate-120"><a href="#BooleanCondition.validate-120"><span class="linenos">120</span></a>            <span class="k">raise</span> <span class="n">InvalidConditionError</span><span class="p">(</span>
</span><span id="BooleanCondition.validate-121"><a href="#BooleanCondition.validate-121"><span class="linenos">121</span></a>                <span class="s2">&quot;invalid boolean: conditions must be a list of other conditions&quot;</span>
</span><span id="BooleanCondition.validate-122"><a href="#BooleanCondition.validate-122"><span class="linenos">122</span></a>            <span class="p">)</span>
</span><span id="BooleanCondition.validate-123"><a href="#BooleanCondition.validate-123"><span class="linenos">123</span></a>        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">conditions</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="BooleanCondition.validate-124"><a href="#BooleanCondition.validate-124"><span class="linenos">124</span></a>            <span class="k">raise</span> <span class="n">InvalidConditionError</span><span class="p">(</span>
</span><span id="BooleanCondition.validate-125"><a href="#BooleanCondition.validate-125"><span class="linenos">125</span></a>                <span class="s2">&quot;invalid boolean: must supply at least two conditions&quot;</span>
</span><span id="BooleanCondition.validate-126"><a href="#BooleanCondition.validate-126"><span class="linenos">126</span></a>            <span class="p">)</span>
</span><span id="BooleanCondition.validate-127"><a href="#BooleanCondition.validate-127"><span class="linenos">127</span></a>
</span><span id="BooleanCondition.validate-128"><a href="#BooleanCondition.validate-128"><span class="linenos">128</span></a>        <span class="k">for</span> <span class="n">con</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">conditions</span><span class="p">:</span>
</span><span id="BooleanCondition.validate-129"><a href="#BooleanCondition.validate-129"><span class="linenos">129</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="p">(</span><span class="n">Condition</span><span class="p">,</span> <span class="n">BooleanCondition</span><span class="p">)):</span>
</span><span id="BooleanCondition.validate-130"><a href="#BooleanCondition.validate-130"><span class="linenos">130</span></a>                <span class="k">raise</span> <span class="n">InvalidConditionError</span><span class="p">(</span>
</span><span id="BooleanCondition.validate-131"><a href="#BooleanCondition.validate-131"><span class="linenos">131</span></a>                    <span class="sa">f</span><span class="s2">&quot;invalid boolean: </span><span class="si">{</span><span class="n">con</span><span class="si">}</span><span class="s2"> is not a valid condition&quot;</span>
</span><span id="BooleanCondition.validate-132"><a href="#BooleanCondition.validate-132"><span class="linenos">132</span></a>                <span class="p">)</span>
</span></pre></div>


    

                            </div>
                </section>
                <section id="BooleanOp">
                            <input id="BooleanOp-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">BooleanOp</span><wbr>(<span class="base">enum.Enum</span>):

                <label class="view-source-button" for="BooleanOp-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#BooleanOp"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="BooleanOp-103"><a href="#BooleanOp-103"><span class="linenos">103</span></a><span class="k">class</span> <span class="nc">BooleanOp</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
</span><span id="BooleanOp-104"><a href="#BooleanOp-104"><span class="linenos">104</span></a>    <span class="n">AND</span> <span class="o">=</span> <span class="s2">&quot;AND&quot;</span>
</span><span id="BooleanOp-105"><a href="#BooleanOp-105"><span class="linenos">105</span></a>    <span class="n">OR</span> <span class="o">=</span> <span class="s2">&quot;OR&quot;</span>
</span></pre></div>


            <div class="docstring"><p>Create a collection of name/value pairs.</p>

<p>Example enumeration:</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">Color</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">RED</span> <span class="o">=</span> <span class="mi">1</span>
<span class="gp">... </span>    <span class="n">BLUE</span> <span class="o">=</span> <span class="mi">2</span>
<span class="gp">... </span>    <span class="n">GREEN</span> <span class="o">=</span> <span class="mi">3</span>
</code></pre>
</div>

<p>Access them by:</p>

<ul>
<li>attribute access::</li>
</ul>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">Color</span><span class="o">.</span><span class="n">RED</span>
<span class="go">&lt;Color.RED: 1&gt;</span>
</code></pre>
</div>

<ul>
<li>value lookup:</li>
</ul>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">Color</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="go">&lt;Color.RED: 1&gt;</span>
</code></pre>
</div>

<ul>
<li>name lookup:</li>
</ul>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">Color</span><span class="p">[</span><span class="s1">&#39;RED&#39;</span><span class="p">]</span>
<span class="go">&lt;Color.RED: 1&gt;</span>
</code></pre>
</div>

<p>Enumerations can be iterated over, and know how many members they have:</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">Color</span><span class="p">)</span>
<span class="go">3</span>
</code></pre>
</div>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">Color</span><span class="p">)</span>
<span class="go">[&lt;Color.RED: 1&gt;, &lt;Color.BLUE: 2&gt;, &lt;Color.GREEN: 3&gt;]</span>
</code></pre>
</div>

<p>Methods can be added to enumerations, and members can have their own
attributes -- see the documentation for details.</p>
</div>


                            <div id="BooleanOp.AND" class="classattr">
                                <div class="attr variable">
            <span class="name">AND</span>        =
<span class="default_value">&lt;<a href="#BooleanOp.AND">BooleanOp.AND</a>: &#39;AND&#39;&gt;</span>

        
    </div>
    <a class="headerlink" href="#BooleanOp.AND"></a>
    
    

                            </div>
                            <div id="BooleanOp.OR" class="classattr">
                                <div class="attr variable">
            <span class="name">OR</span>        =
<span class="default_value">&lt;<a href="#BooleanOp.OR">BooleanOp.OR</a>: &#39;OR&#39;&gt;</span>

        
    </div>
    <a class="headerlink" href="#BooleanOp.OR"></a>
    
    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>enum.Enum</dt>
                                <dd id="BooleanOp.name" class="variable">name</dd>
                <dd id="BooleanOp.value" class="variable">value</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="Column">
                            <input id="Column-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
                    <div class="decorator">@dataclass(frozen=True)</div>

    <span class="def">class</span>
    <span class="name">Column</span><wbr>(<span class="base">snuba_sdk.expressions.Expression</span>):

                <label class="view-source-button" for="Column-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Column"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Column-18"><a href="#Column-18"><span class="linenos">18</span></a><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Column-19"><a href="#Column-19"><span class="linenos">19</span></a><span class="k">class</span> <span class="nc">Column</span><span class="p">(</span><span class="n">Expression</span><span class="p">):</span>
</span><span id="Column-20"><a href="#Column-20"><span class="linenos">20</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Column-21"><a href="#Column-21"><span class="linenos">21</span></a><span class="sd">    A representation of a single column in the database. Columns are</span>
</span><span id="Column-22"><a href="#Column-22"><span class="linenos">22</span></a><span class="sd">    expected to be alpha-numeric, with &#39;.&#39;, &#39;_`, and `:` allowed as well.</span>
</span><span id="Column-23"><a href="#Column-23"><span class="linenos">23</span></a><span class="sd">    If the column is subscriptable then you can specify the column in the</span>
</span><span id="Column-24"><a href="#Column-24"><span class="linenos">24</span></a><span class="sd">    form `subscriptable[key]`. The `subscriptable` attribute will contain the outer</span>
</span><span id="Column-25"><a href="#Column-25"><span class="linenos">25</span></a><span class="sd">    column and `key` will contain the inner key.</span>
</span><span id="Column-26"><a href="#Column-26"><span class="linenos">26</span></a>
</span><span id="Column-27"><a href="#Column-27"><span class="linenos">27</span></a><span class="sd">    :param name: The column name.</span>
</span><span id="Column-28"><a href="#Column-28"><span class="linenos">28</span></a><span class="sd">    :type name: str</span>
</span><span id="Column-29"><a href="#Column-29"><span class="linenos">29</span></a><span class="sd">    :param entity: The entity for that column</span>
</span><span id="Column-30"><a href="#Column-30"><span class="linenos">30</span></a><span class="sd">    :type name: Optional[Entity]</span>
</span><span id="Column-31"><a href="#Column-31"><span class="linenos">31</span></a>
</span><span id="Column-32"><a href="#Column-32"><span class="linenos">32</span></a><span class="sd">    :raises InvalidColumnError: If the column name is not a string or has an</span>
</span><span id="Column-33"><a href="#Column-33"><span class="linenos">33</span></a><span class="sd">        invalid format.</span>
</span><span id="Column-34"><a href="#Column-34"><span class="linenos">34</span></a>
</span><span id="Column-35"><a href="#Column-35"><span class="linenos">35</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="Column-36"><a href="#Column-36"><span class="linenos">36</span></a>
</span><span id="Column-37"><a href="#Column-37"><span class="linenos">37</span></a>    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="Column-38"><a href="#Column-38"><span class="linenos">38</span></a>    <span class="n">entity</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Entity</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Column-39"><a href="#Column-39"><span class="linenos">39</span></a>    <span class="n">subscriptable</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">init</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</span><span id="Column-40"><a href="#Column-40"><span class="linenos">40</span></a>    <span class="n">key</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">init</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</span><span id="Column-41"><a href="#Column-41"><span class="linenos">41</span></a>
</span><span id="Column-42"><a href="#Column-42"><span class="linenos">42</span></a>    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Column-43"><a href="#Column-43"><span class="linenos">43</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="Column-44"><a href="#Column-44"><span class="linenos">44</span></a>            <span class="k">raise</span> <span class="n">InvalidColumnError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;column &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; must be a string&quot;</span><span class="p">)</span>
</span><span id="Column-45"><a href="#Column-45"><span class="linenos">45</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">column_name_re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">):</span>
</span><span id="Column-46"><a href="#Column-46"><span class="linenos">46</span></a>            <span class="k">raise</span> <span class="n">InvalidColumnError</span><span class="p">(</span>
</span><span id="Column-47"><a href="#Column-47"><span class="linenos">47</span></a>                <span class="sa">f</span><span class="s2">&quot;column &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; is empty or contains invalid characters&quot;</span>
</span><span id="Column-48"><a href="#Column-48"><span class="linenos">48</span></a>            <span class="p">)</span>
</span><span id="Column-49"><a href="#Column-49"><span class="linenos">49</span></a>
</span><span id="Column-50"><a href="#Column-50"><span class="linenos">50</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">entity</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Column-51"><a href="#Column-51"><span class="linenos">51</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">entity</span><span class="p">,</span> <span class="n">Entity</span><span class="p">):</span>
</span><span id="Column-52"><a href="#Column-52"><span class="linenos">52</span></a>                <span class="k">raise</span> <span class="n">InvalidColumnError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;column &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; expects an Entity&quot;</span><span class="p">)</span>
</span><span id="Column-53"><a href="#Column-53"><span class="linenos">53</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">entity</span><span class="o">.</span><span class="n">alias</span><span class="p">:</span>
</span><span id="Column-54"><a href="#Column-54"><span class="linenos">54</span></a>                <span class="k">raise</span> <span class="n">InvalidColumnError</span><span class="p">(</span>
</span><span id="Column-55"><a href="#Column-55"><span class="linenos">55</span></a>                    <span class="sa">f</span><span class="s2">&quot;column &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; expects an Entity with an alias&quot;</span>
</span><span id="Column-56"><a href="#Column-56"><span class="linenos">56</span></a>                <span class="p">)</span>
</span><span id="Column-57"><a href="#Column-57"><span class="linenos">57</span></a>
</span><span id="Column-58"><a href="#Column-58"><span class="linenos">58</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">validate_data_model</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">entity</span><span class="p">)</span>
</span><span id="Column-59"><a href="#Column-59"><span class="linenos">59</span></a>
</span><span id="Column-60"><a href="#Column-60"><span class="linenos">60</span></a>        <span class="c1"># If this is a subscriptable set these values to help with debugging etc.</span>
</span><span id="Column-61"><a href="#Column-61"><span class="linenos">61</span></a>        <span class="c1"># Because this is frozen we can&#39;t set the value directly.</span>
</span><span id="Column-62"><a href="#Column-62"><span class="linenos">62</span></a>        <span class="k">if</span> <span class="s2">&quot;[&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
</span><span id="Column-63"><a href="#Column-63"><span class="linenos">63</span></a>            <span class="n">subscriptable</span><span class="p">,</span> <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;[&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="Column-64"><a href="#Column-64"><span class="linenos">64</span></a>            <span class="n">key</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;]&quot;</span><span class="p">)</span>
</span><span id="Column-65"><a href="#Column-65"><span class="linenos">65</span></a>            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="s2">&quot;subscriptable&quot;</span><span class="p">,</span> <span class="n">subscriptable</span><span class="p">)</span>
</span><span id="Column-66"><a href="#Column-66"><span class="linenos">66</span></a>            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="s2">&quot;key&quot;</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
</span><span id="Column-67"><a href="#Column-67"><span class="linenos">67</span></a>
</span><span id="Column-68"><a href="#Column-68"><span class="linenos">68</span></a>    <span class="k">def</span> <span class="nf">validate_data_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">match</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Entity</span><span class="p">,</span> <span class="n">Storage</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Column-69"><a href="#Column-69"><span class="linenos">69</span></a>        <span class="k">if</span> <span class="n">match</span><span class="o">.</span><span class="n">data_model</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Column-70"><a href="#Column-70"><span class="linenos">70</span></a>            <span class="k">return</span>
</span><span id="Column-71"><a href="#Column-71"><span class="linenos">71</span></a>
</span><span id="Column-72"><a href="#Column-72"><span class="linenos">72</span></a>        <span class="n">to_check</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subscriptable</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">subscriptable</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
</span><span id="Column-73"><a href="#Column-73"><span class="linenos">73</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">match</span><span class="o">.</span><span class="n">data_model</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">to_check</span><span class="p">):</span>
</span><span id="Column-74"><a href="#Column-74"><span class="linenos">74</span></a>            <span class="k">raise</span> <span class="n">InvalidColumnError</span><span class="p">(</span>
</span><span id="Column-75"><a href="#Column-75"><span class="linenos">75</span></a>                <span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">match</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; does not support the column &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
</span><span id="Column-76"><a href="#Column-76"><span class="linenos">76</span></a>            <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>A representation of a single column in the database. Columns are
expected to be alpha-numeric, with '.', '_<code>, and</code>:<code>allowed as well.
If the column is subscriptable then you can specify the column in the
form</code>subscriptable[key]<code>. The</code>subscriptable<code>attribute will contain the outer
column and</code>key` will contain the inner key.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>name</strong>:  The column name.</li>
<li><strong>entity</strong>:  The entity for that column</li>
</ul>

<h6 id="raises">Raises</h6>

<ul>
<li><strong>InvalidColumnError</strong>:  If the column name is not a string or has an
invalid format.</li>
</ul>
</div>


                            <div id="Column.__init__" class="classattr">
                                <div class="attr function">
            
        <span class="name">Column</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">name</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">entity</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n"><a href="#Entity">Entity</a></span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span>)</span>

        
    </div>
    <a class="headerlink" href="#Column.__init__"></a>
    
    

                            </div>
                            <div id="Column.name" class="classattr">
                                <div class="attr variable">
            <span class="name">name</span><span class="annotation">: str</span>

        
    </div>
    <a class="headerlink" href="#Column.name"></a>
    
    

                            </div>
                            <div id="Column.entity" class="classattr">
                                <div class="attr variable">
            <span class="name">entity</span><span class="annotation">: Optional[<a href="#Entity">Entity</a>]</span>        =
<span class="default_value">None</span>

        
    </div>
    <a class="headerlink" href="#Column.entity"></a>
    
    

                            </div>
                            <div id="Column.subscriptable" class="classattr">
                                <div class="attr variable">
            <span class="name">subscriptable</span><span class="annotation">: Optional[str]</span>        =
<span class="default_value">None</span>

        
    </div>
    <a class="headerlink" href="#Column.subscriptable"></a>
    
    

                            </div>
                            <div id="Column.key" class="classattr">
                                <div class="attr variable">
            <span class="name">key</span><span class="annotation">: Optional[str]</span>        =
<span class="default_value">None</span>

        
    </div>
    <a class="headerlink" href="#Column.key"></a>
    
    

                            </div>
                            <div id="Column.validate" class="classattr">
                                        <input id="Column.validate-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">validate</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="Column.validate-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Column.validate"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Column.validate-42"><a href="#Column.validate-42"><span class="linenos">42</span></a>    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Column.validate-43"><a href="#Column.validate-43"><span class="linenos">43</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="Column.validate-44"><a href="#Column.validate-44"><span class="linenos">44</span></a>            <span class="k">raise</span> <span class="n">InvalidColumnError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;column &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; must be a string&quot;</span><span class="p">)</span>
</span><span id="Column.validate-45"><a href="#Column.validate-45"><span class="linenos">45</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">column_name_re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">):</span>
</span><span id="Column.validate-46"><a href="#Column.validate-46"><span class="linenos">46</span></a>            <span class="k">raise</span> <span class="n">InvalidColumnError</span><span class="p">(</span>
</span><span id="Column.validate-47"><a href="#Column.validate-47"><span class="linenos">47</span></a>                <span class="sa">f</span><span class="s2">&quot;column &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; is empty or contains invalid characters&quot;</span>
</span><span id="Column.validate-48"><a href="#Column.validate-48"><span class="linenos">48</span></a>            <span class="p">)</span>
</span><span id="Column.validate-49"><a href="#Column.validate-49"><span class="linenos">49</span></a>
</span><span id="Column.validate-50"><a href="#Column.validate-50"><span class="linenos">50</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">entity</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Column.validate-51"><a href="#Column.validate-51"><span class="linenos">51</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">entity</span><span class="p">,</span> <span class="n">Entity</span><span class="p">):</span>
</span><span id="Column.validate-52"><a href="#Column.validate-52"><span class="linenos">52</span></a>                <span class="k">raise</span> <span class="n">InvalidColumnError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;column &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; expects an Entity&quot;</span><span class="p">)</span>
</span><span id="Column.validate-53"><a href="#Column.validate-53"><span class="linenos">53</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">entity</span><span class="o">.</span><span class="n">alias</span><span class="p">:</span>
</span><span id="Column.validate-54"><a href="#Column.validate-54"><span class="linenos">54</span></a>                <span class="k">raise</span> <span class="n">InvalidColumnError</span><span class="p">(</span>
</span><span id="Column.validate-55"><a href="#Column.validate-55"><span class="linenos">55</span></a>                    <span class="sa">f</span><span class="s2">&quot;column &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; expects an Entity with an alias&quot;</span>
</span><span id="Column.validate-56"><a href="#Column.validate-56"><span class="linenos">56</span></a>                <span class="p">)</span>
</span><span id="Column.validate-57"><a href="#Column.validate-57"><span class="linenos">57</span></a>
</span><span id="Column.validate-58"><a href="#Column.validate-58"><span class="linenos">58</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">validate_data_model</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">entity</span><span class="p">)</span>
</span><span id="Column.validate-59"><a href="#Column.validate-59"><span class="linenos">59</span></a>
</span><span id="Column.validate-60"><a href="#Column.validate-60"><span class="linenos">60</span></a>        <span class="c1"># If this is a subscriptable set these values to help with debugging etc.</span>
</span><span id="Column.validate-61"><a href="#Column.validate-61"><span class="linenos">61</span></a>        <span class="c1"># Because this is frozen we can&#39;t set the value directly.</span>
</span><span id="Column.validate-62"><a href="#Column.validate-62"><span class="linenos">62</span></a>        <span class="k">if</span> <span class="s2">&quot;[&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
</span><span id="Column.validate-63"><a href="#Column.validate-63"><span class="linenos">63</span></a>            <span class="n">subscriptable</span><span class="p">,</span> <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;[&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="Column.validate-64"><a href="#Column.validate-64"><span class="linenos">64</span></a>            <span class="n">key</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;]&quot;</span><span class="p">)</span>
</span><span id="Column.validate-65"><a href="#Column.validate-65"><span class="linenos">65</span></a>            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="s2">&quot;subscriptable&quot;</span><span class="p">,</span> <span class="n">subscriptable</span><span class="p">)</span>
</span><span id="Column.validate-66"><a href="#Column.validate-66"><span class="linenos">66</span></a>            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="s2">&quot;key&quot;</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="Column.validate_data_model" class="classattr">
                                        <input id="Column.validate_data_model-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">validate_data_model</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">match</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#Entity">Entity</a></span><span class="p">,</span> <span class="n"><a href="#Storage">Storage</a></span><span class="p">]</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="Column.validate_data_model-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Column.validate_data_model"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Column.validate_data_model-68"><a href="#Column.validate_data_model-68"><span class="linenos">68</span></a>    <span class="k">def</span> <span class="nf">validate_data_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">match</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Entity</span><span class="p">,</span> <span class="n">Storage</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Column.validate_data_model-69"><a href="#Column.validate_data_model-69"><span class="linenos">69</span></a>        <span class="k">if</span> <span class="n">match</span><span class="o">.</span><span class="n">data_model</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Column.validate_data_model-70"><a href="#Column.validate_data_model-70"><span class="linenos">70</span></a>            <span class="k">return</span>
</span><span id="Column.validate_data_model-71"><a href="#Column.validate_data_model-71"><span class="linenos">71</span></a>
</span><span id="Column.validate_data_model-72"><a href="#Column.validate_data_model-72"><span class="linenos">72</span></a>        <span class="n">to_check</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subscriptable</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">subscriptable</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
</span><span id="Column.validate_data_model-73"><a href="#Column.validate_data_model-73"><span class="linenos">73</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">match</span><span class="o">.</span><span class="n">data_model</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">to_check</span><span class="p">):</span>
</span><span id="Column.validate_data_model-74"><a href="#Column.validate_data_model-74"><span class="linenos">74</span></a>            <span class="k">raise</span> <span class="n">InvalidColumnError</span><span class="p">(</span>
</span><span id="Column.validate_data_model-75"><a href="#Column.validate_data_model-75"><span class="linenos">75</span></a>                <span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">match</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; does not support the column &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
</span><span id="Column.validate_data_model-76"><a href="#Column.validate_data_model-76"><span class="linenos">76</span></a>            <span class="p">)</span>
</span></pre></div>


    

                            </div>
                </section>
                <section id="Condition">
                            <input id="Condition-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
                    <div class="decorator">@dataclass(frozen=True)</div>

    <span class="def">class</span>
    <span class="name">Condition</span><wbr>(<span class="base">snuba_sdk.expressions.Expression</span>):

                <label class="view-source-button" for="Condition-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Condition"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Condition-73"><a href="#Condition-73"><span class="linenos"> 73</span></a><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Condition-74"><a href="#Condition-74"><span class="linenos"> 74</span></a><span class="k">class</span> <span class="nc">Condition</span><span class="p">(</span><span class="n">Expression</span><span class="p">):</span>
</span><span id="Condition-75"><a href="#Condition-75"><span class="linenos"> 75</span></a>    <span class="n">lhs</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Column</span><span class="p">,</span> <span class="n">CurriedFunction</span><span class="p">,</span> <span class="n">Function</span><span class="p">]</span>
</span><span id="Condition-76"><a href="#Condition-76"><span class="linenos"> 76</span></a>    <span class="n">op</span><span class="p">:</span> <span class="n">Op</span>
</span><span id="Condition-77"><a href="#Condition-77"><span class="linenos"> 77</span></a>    <span class="n">rhs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Column</span><span class="p">,</span> <span class="n">CurriedFunction</span><span class="p">,</span> <span class="n">Function</span><span class="p">,</span> <span class="n">ScalarType</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Condition-78"><a href="#Condition-78"><span class="linenos"> 78</span></a>
</span><span id="Condition-79"><a href="#Condition-79"><span class="linenos"> 79</span></a>    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Condition-80"><a href="#Condition-80"><span class="linenos"> 80</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lhs</span><span class="p">,</span> <span class="p">(</span><span class="n">Column</span><span class="p">,</span> <span class="n">CurriedFunction</span><span class="p">,</span> <span class="n">Function</span><span class="p">)):</span>
</span><span id="Condition-81"><a href="#Condition-81"><span class="linenos"> 81</span></a>            <span class="k">raise</span> <span class="n">InvalidConditionError</span><span class="p">(</span>
</span><span id="Condition-82"><a href="#Condition-82"><span class="linenos"> 82</span></a>                <span class="sa">f</span><span class="s2">&quot;invalid condition: LHS of a condition must be a Column, CurriedFunction or Function, not </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lhs</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Condition-83"><a href="#Condition-83"><span class="linenos"> 83</span></a>            <span class="p">)</span>
</span><span id="Condition-84"><a href="#Condition-84"><span class="linenos"> 84</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">op</span><span class="p">,</span> <span class="n">Op</span><span class="p">):</span>
</span><span id="Condition-85"><a href="#Condition-85"><span class="linenos"> 85</span></a>            <span class="k">raise</span> <span class="n">InvalidConditionError</span><span class="p">(</span>
</span><span id="Condition-86"><a href="#Condition-86"><span class="linenos"> 86</span></a>                <span class="s2">&quot;invalid condition: operator of a condition must be an Op&quot;</span>
</span><span id="Condition-87"><a href="#Condition-87"><span class="linenos"> 87</span></a>            <span class="p">)</span>
</span><span id="Condition-88"><a href="#Condition-88"><span class="linenos"> 88</span></a>
</span><span id="Condition-89"><a href="#Condition-89"><span class="linenos"> 89</span></a>        <span class="k">if</span> <span class="n">is_unary</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">op</span><span class="p">):</span>
</span><span id="Condition-90"><a href="#Condition-90"><span class="linenos"> 90</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rhs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Condition-91"><a href="#Condition-91"><span class="linenos"> 91</span></a>                <span class="k">raise</span> <span class="n">InvalidConditionError</span><span class="p">(</span>
</span><span id="Condition-92"><a href="#Condition-92"><span class="linenos"> 92</span></a>                    <span class="s2">&quot;invalid condition: unary operators don&#39;t have rhs conditions&quot;</span>
</span><span id="Condition-93"><a href="#Condition-93"><span class="linenos"> 93</span></a>                <span class="p">)</span>
</span><span id="Condition-94"><a href="#Condition-94"><span class="linenos"> 94</span></a>
</span><span id="Condition-95"><a href="#Condition-95"><span class="linenos"> 95</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span>
</span><span id="Condition-96"><a href="#Condition-96"><span class="linenos"> 96</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">rhs</span><span class="p">,</span> <span class="p">(</span><span class="n">Column</span><span class="p">,</span> <span class="n">CurriedFunction</span><span class="p">,</span> <span class="n">Function</span><span class="p">)</span>
</span><span id="Condition-97"><a href="#Condition-97"><span class="linenos"> 97</span></a>        <span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">is_scalar</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rhs</span><span class="p">):</span>
</span><span id="Condition-98"><a href="#Condition-98"><span class="linenos"> 98</span></a>            <span class="k">raise</span> <span class="n">InvalidConditionError</span><span class="p">(</span>
</span><span id="Condition-99"><a href="#Condition-99"><span class="linenos"> 99</span></a>                <span class="sa">f</span><span class="s2">&quot;invalid condition: RHS of a condition must be a Column, CurriedFunction, Function or Scalar not </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rhs</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Condition-100"><a href="#Condition-100"><span class="linenos">100</span></a>            <span class="p">)</span>
</span></pre></div>


    

                            <div id="Condition.__init__" class="classattr">
                                <div class="attr function">
            
        <span class="name">Condition</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">lhs</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#Column">Column</a></span><span class="p">,</span> <span class="n"><a href="#CurriedFunction">CurriedFunction</a></span><span class="p">,</span> <span class="n"><a href="#Function">Function</a></span><span class="p">]</span>,</span><span class="param">	<span class="n">op</span><span class="p">:</span> <span class="n"><a href="#Op">Op</a></span>,</span><span class="param">	<span class="n">rhs</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#Column">Column</a></span><span class="p">,</span> <span class="n"><a href="#CurriedFunction">CurriedFunction</a></span><span class="p">,</span> <span class="n"><a href="#Function">Function</a></span><span class="p">,</span> <span class="n">NoneType</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">snuba_sdk</span><span class="o">.</span><span class="n">expressions</span><span class="o">.</span><span class="n">Expression</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span></span>)</span>

        
    </div>
    <a class="headerlink" href="#Condition.__init__"></a>
    
    

                            </div>
                            <div id="Condition.lhs" class="classattr">
                                <div class="attr variable">
            <span class="name">lhs</span><span class="annotation">: Union[<a href="#Column">Column</a>, <a href="#CurriedFunction">CurriedFunction</a>, <a href="#Function">Function</a>]</span>

        
    </div>
    <a class="headerlink" href="#Condition.lhs"></a>
    
    

                            </div>
                            <div id="Condition.op" class="classattr">
                                <div class="attr variable">
            <span class="name">op</span><span class="annotation">: <a href="#Op">Op</a></span>

        
    </div>
    <a class="headerlink" href="#Condition.op"></a>
    
    

                            </div>
                            <div id="Condition.rhs" class="classattr">
                                <div class="attr variable">
            <span class="name">rhs</span><span class="annotation">: Union[<a href="#Column">Column</a>, <a href="#CurriedFunction">CurriedFunction</a>, <a href="#Function">Function</a>, NoneType, bool, str, bytes, float, int, datetime.date, datetime.datetime, Sequence[Union[snuba_sdk.expressions.Expression, NoneType, bool, str, bytes, float, int, datetime.date, datetime.datetime]]]</span>        =
<span class="default_value">None</span>

        
    </div>
    <a class="headerlink" href="#Condition.rhs"></a>
    
    

                            </div>
                            <div id="Condition.validate" class="classattr">
                                        <input id="Condition.validate-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">validate</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="Condition.validate-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Condition.validate"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Condition.validate-79"><a href="#Condition.validate-79"><span class="linenos"> 79</span></a>    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Condition.validate-80"><a href="#Condition.validate-80"><span class="linenos"> 80</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lhs</span><span class="p">,</span> <span class="p">(</span><span class="n">Column</span><span class="p">,</span> <span class="n">CurriedFunction</span><span class="p">,</span> <span class="n">Function</span><span class="p">)):</span>
</span><span id="Condition.validate-81"><a href="#Condition.validate-81"><span class="linenos"> 81</span></a>            <span class="k">raise</span> <span class="n">InvalidConditionError</span><span class="p">(</span>
</span><span id="Condition.validate-82"><a href="#Condition.validate-82"><span class="linenos"> 82</span></a>                <span class="sa">f</span><span class="s2">&quot;invalid condition: LHS of a condition must be a Column, CurriedFunction or Function, not </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lhs</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Condition.validate-83"><a href="#Condition.validate-83"><span class="linenos"> 83</span></a>            <span class="p">)</span>
</span><span id="Condition.validate-84"><a href="#Condition.validate-84"><span class="linenos"> 84</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">op</span><span class="p">,</span> <span class="n">Op</span><span class="p">):</span>
</span><span id="Condition.validate-85"><a href="#Condition.validate-85"><span class="linenos"> 85</span></a>            <span class="k">raise</span> <span class="n">InvalidConditionError</span><span class="p">(</span>
</span><span id="Condition.validate-86"><a href="#Condition.validate-86"><span class="linenos"> 86</span></a>                <span class="s2">&quot;invalid condition: operator of a condition must be an Op&quot;</span>
</span><span id="Condition.validate-87"><a href="#Condition.validate-87"><span class="linenos"> 87</span></a>            <span class="p">)</span>
</span><span id="Condition.validate-88"><a href="#Condition.validate-88"><span class="linenos"> 88</span></a>
</span><span id="Condition.validate-89"><a href="#Condition.validate-89"><span class="linenos"> 89</span></a>        <span class="k">if</span> <span class="n">is_unary</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">op</span><span class="p">):</span>
</span><span id="Condition.validate-90"><a href="#Condition.validate-90"><span class="linenos"> 90</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rhs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Condition.validate-91"><a href="#Condition.validate-91"><span class="linenos"> 91</span></a>                <span class="k">raise</span> <span class="n">InvalidConditionError</span><span class="p">(</span>
</span><span id="Condition.validate-92"><a href="#Condition.validate-92"><span class="linenos"> 92</span></a>                    <span class="s2">&quot;invalid condition: unary operators don&#39;t have rhs conditions&quot;</span>
</span><span id="Condition.validate-93"><a href="#Condition.validate-93"><span class="linenos"> 93</span></a>                <span class="p">)</span>
</span><span id="Condition.validate-94"><a href="#Condition.validate-94"><span class="linenos"> 94</span></a>
</span><span id="Condition.validate-95"><a href="#Condition.validate-95"><span class="linenos"> 95</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span>
</span><span id="Condition.validate-96"><a href="#Condition.validate-96"><span class="linenos"> 96</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">rhs</span><span class="p">,</span> <span class="p">(</span><span class="n">Column</span><span class="p">,</span> <span class="n">CurriedFunction</span><span class="p">,</span> <span class="n">Function</span><span class="p">)</span>
</span><span id="Condition.validate-97"><a href="#Condition.validate-97"><span class="linenos"> 97</span></a>        <span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">is_scalar</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rhs</span><span class="p">):</span>
</span><span id="Condition.validate-98"><a href="#Condition.validate-98"><span class="linenos"> 98</span></a>            <span class="k">raise</span> <span class="n">InvalidConditionError</span><span class="p">(</span>
</span><span id="Condition.validate-99"><a href="#Condition.validate-99"><span class="linenos"> 99</span></a>                <span class="sa">f</span><span class="s2">&quot;invalid condition: RHS of a condition must be a Column, CurriedFunction, Function or Scalar not </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rhs</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Condition.validate-100"><a href="#Condition.validate-100"><span class="linenos">100</span></a>            <span class="p">)</span>
</span></pre></div>


    

                            </div>
                </section>
                <section id="CurriedFunction">
                            <input id="CurriedFunction-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
                    <div class="decorator">@dataclass(frozen=True)</div>

    <span class="def">class</span>
    <span class="name">CurriedFunction</span><wbr>(<span class="base">snuba_sdk.expressions.Expression</span>):

                <label class="view-source-button" for="CurriedFunction-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#CurriedFunction"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CurriedFunction-32"><a href="#CurriedFunction-32"><span class="linenos"> 32</span></a><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="CurriedFunction-33"><a href="#CurriedFunction-33"><span class="linenos"> 33</span></a><span class="k">class</span> <span class="nc">CurriedFunction</span><span class="p">(</span><span class="n">Expression</span><span class="p">):</span>
</span><span id="CurriedFunction-34"><a href="#CurriedFunction-34"><span class="linenos"> 34</span></a>    <span class="n">function</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="CurriedFunction-35"><a href="#CurriedFunction-35"><span class="linenos"> 35</span></a>    <span class="n">initializers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">ScalarLiteralType</span><span class="p">,</span> <span class="n">Column</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="CurriedFunction-36"><a href="#CurriedFunction-36"><span class="linenos"> 36</span></a>    <span class="n">parameters</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span>
</span><span id="CurriedFunction-37"><a href="#CurriedFunction-37"><span class="linenos"> 37</span></a>        <span class="n">Sequence</span><span class="p">[</span>
</span><span id="CurriedFunction-38"><a href="#CurriedFunction-38"><span class="linenos"> 38</span></a>            <span class="n">Union</span><span class="p">[</span>
</span><span id="CurriedFunction-39"><a href="#CurriedFunction-39"><span class="linenos"> 39</span></a>                <span class="n">ScalarType</span><span class="p">,</span>
</span><span id="CurriedFunction-40"><a href="#CurriedFunction-40"><span class="linenos"> 40</span></a>                <span class="n">Column</span><span class="p">,</span>
</span><span id="CurriedFunction-41"><a href="#CurriedFunction-41"><span class="linenos"> 41</span></a>                <span class="n">CurriedFunction</span><span class="p">,</span>
</span><span id="CurriedFunction-42"><a href="#CurriedFunction-42"><span class="linenos"> 42</span></a>                <span class="n">Function</span><span class="p">,</span>
</span><span id="CurriedFunction-43"><a href="#CurriedFunction-43"><span class="linenos"> 43</span></a>                <span class="n">Identifier</span><span class="p">,</span>
</span><span id="CurriedFunction-44"><a href="#CurriedFunction-44"><span class="linenos"> 44</span></a>                <span class="n">Lambda</span><span class="p">,</span>
</span><span id="CurriedFunction-45"><a href="#CurriedFunction-45"><span class="linenos"> 45</span></a>            <span class="p">]</span>
</span><span id="CurriedFunction-46"><a href="#CurriedFunction-46"><span class="linenos"> 46</span></a>        <span class="p">]</span>
</span><span id="CurriedFunction-47"><a href="#CurriedFunction-47"><span class="linenos"> 47</span></a>    <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="CurriedFunction-48"><a href="#CurriedFunction-48"><span class="linenos"> 48</span></a>    <span class="n">alias</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="CurriedFunction-49"><a href="#CurriedFunction-49"><span class="linenos"> 49</span></a>
</span><span id="CurriedFunction-50"><a href="#CurriedFunction-50"><span class="linenos"> 50</span></a>    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="CurriedFunction-51"><a href="#CurriedFunction-51"><span class="linenos"> 51</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">function</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="CurriedFunction-52"><a href="#CurriedFunction-52"><span class="linenos"> 52</span></a>            <span class="k">raise</span> <span class="n">InvalidFunctionError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;function &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">function</span><span class="si">}</span><span class="s2">&#39; must be a string&quot;</span><span class="p">)</span>
</span><span id="CurriedFunction-53"><a href="#CurriedFunction-53"><span class="linenos"> 53</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">function</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
</span><span id="CurriedFunction-54"><a href="#CurriedFunction-54"><span class="linenos"> 54</span></a>            <span class="c1"># TODO: Have a whitelist of valid functions to check, maybe even with more</span>
</span><span id="CurriedFunction-55"><a href="#CurriedFunction-55"><span class="linenos"> 55</span></a>            <span class="c1"># specific parameter type checking</span>
</span><span id="CurriedFunction-56"><a href="#CurriedFunction-56"><span class="linenos"> 56</span></a>            <span class="k">raise</span> <span class="n">InvalidFunctionError</span><span class="p">(</span><span class="s2">&quot;function cannot be empty&quot;</span><span class="p">)</span>
</span><span id="CurriedFunction-57"><a href="#CurriedFunction-57"><span class="linenos"> 57</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">function_name_re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">function</span><span class="p">):</span>
</span><span id="CurriedFunction-58"><a href="#CurriedFunction-58"><span class="linenos"> 58</span></a>            <span class="k">raise</span> <span class="n">InvalidFunctionError</span><span class="p">(</span>
</span><span id="CurriedFunction-59"><a href="#CurriedFunction-59"><span class="linenos"> 59</span></a>                <span class="sa">f</span><span class="s2">&quot;function &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">function</span><span class="si">}</span><span class="s2">&#39; contains invalid characters&quot;</span>
</span><span id="CurriedFunction-60"><a href="#CurriedFunction-60"><span class="linenos"> 60</span></a>            <span class="p">)</span>
</span><span id="CurriedFunction-61"><a href="#CurriedFunction-61"><span class="linenos"> 61</span></a>
</span><span id="CurriedFunction-62"><a href="#CurriedFunction-62"><span class="linenos"> 62</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">initializers</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="CurriedFunction-63"><a href="#CurriedFunction-63"><span class="linenos"> 63</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">initializers</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">):</span>
</span><span id="CurriedFunction-64"><a href="#CurriedFunction-64"><span class="linenos"> 64</span></a>                <span class="k">raise</span> <span class="n">InvalidFunctionError</span><span class="p">(</span>
</span><span id="CurriedFunction-65"><a href="#CurriedFunction-65"><span class="linenos"> 65</span></a>                    <span class="sa">f</span><span class="s2">&quot;initializers of function </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">function</span><span class="si">}</span><span class="s2"> must be a Sequence&quot;</span>
</span><span id="CurriedFunction-66"><a href="#CurriedFunction-66"><span class="linenos"> 66</span></a>                <span class="p">)</span>
</span><span id="CurriedFunction-67"><a href="#CurriedFunction-67"><span class="linenos"> 67</span></a>            <span class="k">elif</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span>
</span><span id="CurriedFunction-68"><a href="#CurriedFunction-68"><span class="linenos"> 68</span></a>                <span class="nb">isinstance</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="n">Column</span><span class="p">)</span> <span class="ow">or</span> <span class="n">is_literal</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>
</span><span id="CurriedFunction-69"><a href="#CurriedFunction-69"><span class="linenos"> 69</span></a>                <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">initializers</span>
</span><span id="CurriedFunction-70"><a href="#CurriedFunction-70"><span class="linenos"> 70</span></a>            <span class="p">):</span>
</span><span id="CurriedFunction-71"><a href="#CurriedFunction-71"><span class="linenos"> 71</span></a>                <span class="k">raise</span> <span class="n">InvalidFunctionError</span><span class="p">(</span>
</span><span id="CurriedFunction-72"><a href="#CurriedFunction-72"><span class="linenos"> 72</span></a>                    <span class="sa">f</span><span class="s2">&quot;initializers to function </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">function</span><span class="si">}</span><span class="s2"> must be a scalar or column&quot;</span>
</span><span id="CurriedFunction-73"><a href="#CurriedFunction-73"><span class="linenos"> 73</span></a>                <span class="p">)</span>
</span><span id="CurriedFunction-74"><a href="#CurriedFunction-74"><span class="linenos"> 74</span></a>
</span><span id="CurriedFunction-75"><a href="#CurriedFunction-75"><span class="linenos"> 75</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">alias</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="CurriedFunction-76"><a href="#CurriedFunction-76"><span class="linenos"> 76</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alias</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">alias</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
</span><span id="CurriedFunction-77"><a href="#CurriedFunction-77"><span class="linenos"> 77</span></a>                <span class="k">raise</span> <span class="n">InvalidFunctionError</span><span class="p">(</span>
</span><span id="CurriedFunction-78"><a href="#CurriedFunction-78"><span class="linenos"> 78</span></a>                    <span class="sa">f</span><span class="s2">&quot;alias &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">alias</span><span class="si">}</span><span class="s2">&#39; of function </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">function</span><span class="si">}</span><span class="s2"> must be None or a non-empty string&quot;</span>
</span><span id="CurriedFunction-79"><a href="#CurriedFunction-79"><span class="linenos"> 79</span></a>                <span class="p">)</span>
</span><span id="CurriedFunction-80"><a href="#CurriedFunction-80"><span class="linenos"> 80</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">ALIAS_RE</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alias</span><span class="p">):</span>
</span><span id="CurriedFunction-81"><a href="#CurriedFunction-81"><span class="linenos"> 81</span></a>                <span class="k">raise</span> <span class="n">InvalidFunctionError</span><span class="p">(</span>
</span><span id="CurriedFunction-82"><a href="#CurriedFunction-82"><span class="linenos"> 82</span></a>                    <span class="sa">f</span><span class="s2">&quot;alias &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">alias</span><span class="si">}</span><span class="s2">&#39; of function </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">function</span><span class="si">}</span><span class="s2"> contains invalid characters&quot;</span>
</span><span id="CurriedFunction-83"><a href="#CurriedFunction-83"><span class="linenos"> 83</span></a>                <span class="p">)</span>
</span><span id="CurriedFunction-84"><a href="#CurriedFunction-84"><span class="linenos"> 84</span></a>
</span><span id="CurriedFunction-85"><a href="#CurriedFunction-85"><span class="linenos"> 85</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="CurriedFunction-86"><a href="#CurriedFunction-86"><span class="linenos"> 86</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">):</span>
</span><span id="CurriedFunction-87"><a href="#CurriedFunction-87"><span class="linenos"> 87</span></a>                <span class="k">raise</span> <span class="n">InvalidFunctionError</span><span class="p">(</span>
</span><span id="CurriedFunction-88"><a href="#CurriedFunction-88"><span class="linenos"> 88</span></a>                    <span class="sa">f</span><span class="s2">&quot;parameters of function </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">function</span><span class="si">}</span><span class="s2"> must be a Sequence&quot;</span>
</span><span id="CurriedFunction-89"><a href="#CurriedFunction-89"><span class="linenos"> 89</span></a>                <span class="p">)</span>
</span><span id="CurriedFunction-90"><a href="#CurriedFunction-90"><span class="linenos"> 90</span></a>            <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">:</span>
</span><span id="CurriedFunction-91"><a href="#CurriedFunction-91"><span class="linenos"> 91</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span>
</span><span id="CurriedFunction-92"><a href="#CurriedFunction-92"><span class="linenos"> 92</span></a>                    <span class="n">param</span><span class="p">,</span>
</span><span id="CurriedFunction-93"><a href="#CurriedFunction-93"><span class="linenos"> 93</span></a>                    <span class="p">(</span><span class="n">Column</span><span class="p">,</span> <span class="n">CurriedFunction</span><span class="p">,</span> <span class="n">Function</span><span class="p">,</span> <span class="n">Identifier</span><span class="p">,</span> <span class="n">Lambda</span><span class="p">),</span>
</span><span id="CurriedFunction-94"><a href="#CurriedFunction-94"><span class="linenos"> 94</span></a>                <span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">is_scalar</span><span class="p">(</span><span class="n">param</span><span class="p">):</span>
</span><span id="CurriedFunction-95"><a href="#CurriedFunction-95"><span class="linenos"> 95</span></a>                    <span class="k">assert</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">)</span>  <span class="c1"># mypy</span>
</span><span id="CurriedFunction-96"><a href="#CurriedFunction-96"><span class="linenos"> 96</span></a>                    <span class="k">raise</span> <span class="n">InvalidFunctionError</span><span class="p">(</span>
</span><span id="CurriedFunction-97"><a href="#CurriedFunction-97"><span class="linenos"> 97</span></a>                        <span class="sa">f</span><span class="s2">&quot;parameter &#39;</span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s2">&#39; of function </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">function</span><span class="si">}</span><span class="s2"> is an invalid type&quot;</span>
</span><span id="CurriedFunction-98"><a href="#CurriedFunction-98"><span class="linenos"> 98</span></a>                    <span class="p">)</span>
</span><span id="CurriedFunction-99"><a href="#CurriedFunction-99"><span class="linenos"> 99</span></a>
</span><span id="CurriedFunction-100"><a href="#CurriedFunction-100"><span class="linenos">100</span></a>    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="CurriedFunction-101"><a href="#CurriedFunction-101"><span class="linenos">101</span></a>        <span class="c1"># Don&#39;t use the alias to compare equality</span>
</span><span id="CurriedFunction-102"><a href="#CurriedFunction-102"><span class="linenos">102</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">CurriedFunction</span><span class="p">):</span>
</span><span id="CurriedFunction-103"><a href="#CurriedFunction-103"><span class="linenos">103</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="CurriedFunction-104"><a href="#CurriedFunction-104"><span class="linenos">104</span></a>
</span><span id="CurriedFunction-105"><a href="#CurriedFunction-105"><span class="linenos">105</span></a>        <span class="k">return</span> <span class="p">(</span>
</span><span id="CurriedFunction-106"><a href="#CurriedFunction-106"><span class="linenos">106</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">function</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">function</span>
</span><span id="CurriedFunction-107"><a href="#CurriedFunction-107"><span class="linenos">107</span></a>            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">initializers</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">initializers</span>
</span><span id="CurriedFunction-108"><a href="#CurriedFunction-108"><span class="linenos">108</span></a>            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">parameters</span>
</span><span id="CurriedFunction-109"><a href="#CurriedFunction-109"><span class="linenos">109</span></a>        <span class="p">)</span>
</span></pre></div>


    

                            <div id="CurriedFunction.__init__" class="classattr">
                                <div class="attr function">
            
        <span class="name">CurriedFunction</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">function</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">initializers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">NoneType</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="n"><a href="#Column">Column</a></span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">parameters</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">NoneType</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">snuba_sdk</span><span class="o">.</span><span class="n">expressions</span><span class="o">.</span><span class="n">Expression</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">]],</span> <span class="n"><a href="#Column">Column</a></span><span class="p">,</span> <span class="n"><a href="#CurriedFunction">CurriedFunction</a></span><span class="p">,</span> <span class="n"><a href="#Function">Function</a></span><span class="p">,</span> <span class="n"><a href="#Identifier">Identifier</a></span><span class="p">,</span> <span class="n"><a href="#Lambda">Lambda</a></span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">alias</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span>)</span>

        
    </div>
    <a class="headerlink" href="#CurriedFunction.__init__"></a>
    
    

                            </div>
                            <div id="CurriedFunction.function" class="classattr">
                                <div class="attr variable">
            <span class="name">function</span><span class="annotation">: str</span>

        
    </div>
    <a class="headerlink" href="#CurriedFunction.function"></a>
    
    

                            </div>
                            <div id="CurriedFunction.initializers" class="classattr">
                                <div class="attr variable">
            <span class="name">initializers</span><span class="annotation">: Optional[Sequence[Union[NoneType, bool, str, bytes, float, int, datetime.date, datetime.datetime, <a href="#Column">Column</a>]]]</span>        =
<span class="default_value">None</span>

        
    </div>
    <a class="headerlink" href="#CurriedFunction.initializers"></a>
    
    

                            </div>
                            <div id="CurriedFunction.parameters" class="classattr">
                                <div class="attr variable">
            <span class="name">parameters</span><span class="annotation">: Optional[Sequence[Union[NoneType, bool, str, bytes, float, int, datetime.date, datetime.datetime, Sequence[Union[snuba_sdk.expressions.Expression, NoneType, bool, str, bytes, float, int, datetime.date, datetime.datetime]], <a href="#Column">Column</a>, <a href="#CurriedFunction">CurriedFunction</a>, <a href="#Function">Function</a>, <a href="#Identifier">Identifier</a>, <a href="#Lambda">Lambda</a>]]]</span>        =
<span class="default_value">None</span>

        
    </div>
    <a class="headerlink" href="#CurriedFunction.parameters"></a>
    
    

                            </div>
                            <div id="CurriedFunction.alias" class="classattr">
                                <div class="attr variable">
            <span class="name">alias</span><span class="annotation">: Optional[str]</span>        =
<span class="default_value">None</span>

        
    </div>
    <a class="headerlink" href="#CurriedFunction.alias"></a>
    
    

                            </div>
                            <div id="CurriedFunction.validate" class="classattr">
                                        <input id="CurriedFunction.validate-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">validate</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="CurriedFunction.validate-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#CurriedFunction.validate"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CurriedFunction.validate-50"><a href="#CurriedFunction.validate-50"><span class="linenos">50</span></a>    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="CurriedFunction.validate-51"><a href="#CurriedFunction.validate-51"><span class="linenos">51</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">function</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="CurriedFunction.validate-52"><a href="#CurriedFunction.validate-52"><span class="linenos">52</span></a>            <span class="k">raise</span> <span class="n">InvalidFunctionError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;function &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">function</span><span class="si">}</span><span class="s2">&#39; must be a string&quot;</span><span class="p">)</span>
</span><span id="CurriedFunction.validate-53"><a href="#CurriedFunction.validate-53"><span class="linenos">53</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">function</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
</span><span id="CurriedFunction.validate-54"><a href="#CurriedFunction.validate-54"><span class="linenos">54</span></a>            <span class="c1"># TODO: Have a whitelist of valid functions to check, maybe even with more</span>
</span><span id="CurriedFunction.validate-55"><a href="#CurriedFunction.validate-55"><span class="linenos">55</span></a>            <span class="c1"># specific parameter type checking</span>
</span><span id="CurriedFunction.validate-56"><a href="#CurriedFunction.validate-56"><span class="linenos">56</span></a>            <span class="k">raise</span> <span class="n">InvalidFunctionError</span><span class="p">(</span><span class="s2">&quot;function cannot be empty&quot;</span><span class="p">)</span>
</span><span id="CurriedFunction.validate-57"><a href="#CurriedFunction.validate-57"><span class="linenos">57</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">function_name_re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">function</span><span class="p">):</span>
</span><span id="CurriedFunction.validate-58"><a href="#CurriedFunction.validate-58"><span class="linenos">58</span></a>            <span class="k">raise</span> <span class="n">InvalidFunctionError</span><span class="p">(</span>
</span><span id="CurriedFunction.validate-59"><a href="#CurriedFunction.validate-59"><span class="linenos">59</span></a>                <span class="sa">f</span><span class="s2">&quot;function &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">function</span><span class="si">}</span><span class="s2">&#39; contains invalid characters&quot;</span>
</span><span id="CurriedFunction.validate-60"><a href="#CurriedFunction.validate-60"><span class="linenos">60</span></a>            <span class="p">)</span>
</span><span id="CurriedFunction.validate-61"><a href="#CurriedFunction.validate-61"><span class="linenos">61</span></a>
</span><span id="CurriedFunction.validate-62"><a href="#CurriedFunction.validate-62"><span class="linenos">62</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">initializers</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="CurriedFunction.validate-63"><a href="#CurriedFunction.validate-63"><span class="linenos">63</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">initializers</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">):</span>
</span><span id="CurriedFunction.validate-64"><a href="#CurriedFunction.validate-64"><span class="linenos">64</span></a>                <span class="k">raise</span> <span class="n">InvalidFunctionError</span><span class="p">(</span>
</span><span id="CurriedFunction.validate-65"><a href="#CurriedFunction.validate-65"><span class="linenos">65</span></a>                    <span class="sa">f</span><span class="s2">&quot;initializers of function </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">function</span><span class="si">}</span><span class="s2"> must be a Sequence&quot;</span>
</span><span id="CurriedFunction.validate-66"><a href="#CurriedFunction.validate-66"><span class="linenos">66</span></a>                <span class="p">)</span>
</span><span id="CurriedFunction.validate-67"><a href="#CurriedFunction.validate-67"><span class="linenos">67</span></a>            <span class="k">elif</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span>
</span><span id="CurriedFunction.validate-68"><a href="#CurriedFunction.validate-68"><span class="linenos">68</span></a>                <span class="nb">isinstance</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="n">Column</span><span class="p">)</span> <span class="ow">or</span> <span class="n">is_literal</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>
</span><span id="CurriedFunction.validate-69"><a href="#CurriedFunction.validate-69"><span class="linenos">69</span></a>                <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">initializers</span>
</span><span id="CurriedFunction.validate-70"><a href="#CurriedFunction.validate-70"><span class="linenos">70</span></a>            <span class="p">):</span>
</span><span id="CurriedFunction.validate-71"><a href="#CurriedFunction.validate-71"><span class="linenos">71</span></a>                <span class="k">raise</span> <span class="n">InvalidFunctionError</span><span class="p">(</span>
</span><span id="CurriedFunction.validate-72"><a href="#CurriedFunction.validate-72"><span class="linenos">72</span></a>                    <span class="sa">f</span><span class="s2">&quot;initializers to function </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">function</span><span class="si">}</span><span class="s2"> must be a scalar or column&quot;</span>
</span><span id="CurriedFunction.validate-73"><a href="#CurriedFunction.validate-73"><span class="linenos">73</span></a>                <span class="p">)</span>
</span><span id="CurriedFunction.validate-74"><a href="#CurriedFunction.validate-74"><span class="linenos">74</span></a>
</span><span id="CurriedFunction.validate-75"><a href="#CurriedFunction.validate-75"><span class="linenos">75</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">alias</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="CurriedFunction.validate-76"><a href="#CurriedFunction.validate-76"><span class="linenos">76</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alias</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">alias</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
</span><span id="CurriedFunction.validate-77"><a href="#CurriedFunction.validate-77"><span class="linenos">77</span></a>                <span class="k">raise</span> <span class="n">InvalidFunctionError</span><span class="p">(</span>
</span><span id="CurriedFunction.validate-78"><a href="#CurriedFunction.validate-78"><span class="linenos">78</span></a>                    <span class="sa">f</span><span class="s2">&quot;alias &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">alias</span><span class="si">}</span><span class="s2">&#39; of function </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">function</span><span class="si">}</span><span class="s2"> must be None or a non-empty string&quot;</span>
</span><span id="CurriedFunction.validate-79"><a href="#CurriedFunction.validate-79"><span class="linenos">79</span></a>                <span class="p">)</span>
</span><span id="CurriedFunction.validate-80"><a href="#CurriedFunction.validate-80"><span class="linenos">80</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">ALIAS_RE</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alias</span><span class="p">):</span>
</span><span id="CurriedFunction.validate-81"><a href="#CurriedFunction.validate-81"><span class="linenos">81</span></a>                <span class="k">raise</span> <span class="n">InvalidFunctionError</span><span class="p">(</span>
</span><span id="CurriedFunction.validate-82"><a href="#CurriedFunction.validate-82"><span class="linenos">82</span></a>                    <span class="sa">f</span><span class="s2">&quot;alias &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">alias</span><span class="si">}</span><span class="s2">&#39; of function </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">function</span><span class="si">}</span><span class="s2"> contains invalid characters&quot;</span>
</span><span id="CurriedFunction.validate-83"><a href="#CurriedFunction.validate-83"><span class="linenos">83</span></a>                <span class="p">)</span>
</span><span id="CurriedFunction.validate-84"><a href="#CurriedFunction.validate-84"><span class="linenos">84</span></a>
</span><span id="CurriedFunction.validate-85"><a href="#CurriedFunction.validate-85"><span class="linenos">85</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="CurriedFunction.validate-86"><a href="#CurriedFunction.validate-86"><span class="linenos">86</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">):</span>
</span><span id="CurriedFunction.validate-87"><a href="#CurriedFunction.validate-87"><span class="linenos">87</span></a>                <span class="k">raise</span> <span class="n">InvalidFunctionError</span><span class="p">(</span>
</span><span id="CurriedFunction.validate-88"><a href="#CurriedFunction.validate-88"><span class="linenos">88</span></a>                    <span class="sa">f</span><span class="s2">&quot;parameters of function </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">function</span><span class="si">}</span><span class="s2"> must be a Sequence&quot;</span>
</span><span id="CurriedFunction.validate-89"><a href="#CurriedFunction.validate-89"><span class="linenos">89</span></a>                <span class="p">)</span>
</span><span id="CurriedFunction.validate-90"><a href="#CurriedFunction.validate-90"><span class="linenos">90</span></a>            <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">:</span>
</span><span id="CurriedFunction.validate-91"><a href="#CurriedFunction.validate-91"><span class="linenos">91</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span>
</span><span id="CurriedFunction.validate-92"><a href="#CurriedFunction.validate-92"><span class="linenos">92</span></a>                    <span class="n">param</span><span class="p">,</span>
</span><span id="CurriedFunction.validate-93"><a href="#CurriedFunction.validate-93"><span class="linenos">93</span></a>                    <span class="p">(</span><span class="n">Column</span><span class="p">,</span> <span class="n">CurriedFunction</span><span class="p">,</span> <span class="n">Function</span><span class="p">,</span> <span class="n">Identifier</span><span class="p">,</span> <span class="n">Lambda</span><span class="p">),</span>
</span><span id="CurriedFunction.validate-94"><a href="#CurriedFunction.validate-94"><span class="linenos">94</span></a>                <span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">is_scalar</span><span class="p">(</span><span class="n">param</span><span class="p">):</span>
</span><span id="CurriedFunction.validate-95"><a href="#CurriedFunction.validate-95"><span class="linenos">95</span></a>                    <span class="k">assert</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">)</span>  <span class="c1"># mypy</span>
</span><span id="CurriedFunction.validate-96"><a href="#CurriedFunction.validate-96"><span class="linenos">96</span></a>                    <span class="k">raise</span> <span class="n">InvalidFunctionError</span><span class="p">(</span>
</span><span id="CurriedFunction.validate-97"><a href="#CurriedFunction.validate-97"><span class="linenos">97</span></a>                        <span class="sa">f</span><span class="s2">&quot;parameter &#39;</span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s2">&#39; of function </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">function</span><span class="si">}</span><span class="s2"> is an invalid type&quot;</span>
</span><span id="CurriedFunction.validate-98"><a href="#CurriedFunction.validate-98"><span class="linenos">98</span></a>                    <span class="p">)</span>
</span></pre></div>


    

                            </div>
                </section>
                <section id="Direction">
                            <input id="Direction-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Direction</span><wbr>(<span class="base">enum.Enum</span>):

                <label class="view-source-button" for="Direction-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Direction"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Direction-11"><a href="#Direction-11"><span class="linenos">11</span></a><span class="k">class</span> <span class="nc">Direction</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
</span><span id="Direction-12"><a href="#Direction-12"><span class="linenos">12</span></a>    <span class="n">ASC</span> <span class="o">=</span> <span class="s2">&quot;ASC&quot;</span>
</span><span id="Direction-13"><a href="#Direction-13"><span class="linenos">13</span></a>    <span class="n">DESC</span> <span class="o">=</span> <span class="s2">&quot;DESC&quot;</span>
</span></pre></div>


            <div class="docstring"><p>Create a collection of name/value pairs.</p>

<p>Example enumeration:</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">Color</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">RED</span> <span class="o">=</span> <span class="mi">1</span>
<span class="gp">... </span>    <span class="n">BLUE</span> <span class="o">=</span> <span class="mi">2</span>
<span class="gp">... </span>    <span class="n">GREEN</span> <span class="o">=</span> <span class="mi">3</span>
</code></pre>
</div>

<p>Access them by:</p>

<ul>
<li>attribute access::</li>
</ul>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">Color</span><span class="o">.</span><span class="n">RED</span>
<span class="go">&lt;Color.RED: 1&gt;</span>
</code></pre>
</div>

<ul>
<li>value lookup:</li>
</ul>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">Color</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="go">&lt;Color.RED: 1&gt;</span>
</code></pre>
</div>

<ul>
<li>name lookup:</li>
</ul>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">Color</span><span class="p">[</span><span class="s1">&#39;RED&#39;</span><span class="p">]</span>
<span class="go">&lt;Color.RED: 1&gt;</span>
</code></pre>
</div>

<p>Enumerations can be iterated over, and know how many members they have:</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">Color</span><span class="p">)</span>
<span class="go">3</span>
</code></pre>
</div>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">Color</span><span class="p">)</span>
<span class="go">[&lt;Color.RED: 1&gt;, &lt;Color.BLUE: 2&gt;, &lt;Color.GREEN: 3&gt;]</span>
</code></pre>
</div>

<p>Methods can be added to enumerations, and members can have their own
attributes -- see the documentation for details.</p>
</div>


                            <div id="Direction.ASC" class="classattr">
                                <div class="attr variable">
            <span class="name">ASC</span>        =
<span class="default_value">&lt;<a href="#Direction.ASC">Direction.ASC</a>: &#39;ASC&#39;&gt;</span>

        
    </div>
    <a class="headerlink" href="#Direction.ASC"></a>
    
    

                            </div>
                            <div id="Direction.DESC" class="classattr">
                                <div class="attr variable">
            <span class="name">DESC</span>        =
<span class="default_value">&lt;<a href="#Direction.DESC">Direction.DESC</a>: &#39;DESC&#39;&gt;</span>

        
    </div>
    <a class="headerlink" href="#Direction.DESC"></a>
    
    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>enum.Enum</dt>
                                <dd id="Direction.name" class="variable">name</dd>
                <dd id="Direction.value" class="variable">value</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="Entity">
                            <input id="Entity-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
                    <div class="decorator">@dataclass(frozen=True, repr=False)</div>

    <span class="def">class</span>
    <span class="name">Entity</span><wbr>(<span class="base">snuba_sdk.expressions.Expression</span>):

                <label class="view-source-button" for="Entity-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Entity"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Entity-16"><a href="#Entity-16"><span class="linenos">16</span></a><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="nb">repr</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="Entity-17"><a href="#Entity-17"><span class="linenos">17</span></a><span class="k">class</span> <span class="nc">Entity</span><span class="p">(</span><span class="n">Expression</span><span class="p">):</span>
</span><span id="Entity-18"><a href="#Entity-18"><span class="linenos">18</span></a>    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="Entity-19"><a href="#Entity-19"><span class="linenos">19</span></a>    <span class="n">alias</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Entity-20"><a href="#Entity-20"><span class="linenos">20</span></a>    <span class="n">sample</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Entity-21"><a href="#Entity-21"><span class="linenos">21</span></a>    <span class="n">data_model</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">DataModel</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="nb">hash</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</span><span id="Entity-22"><a href="#Entity-22"><span class="linenos">22</span></a>
</span><span id="Entity-23"><a href="#Entity-23"><span class="linenos">23</span></a>    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Entity-24"><a href="#Entity-24"><span class="linenos">24</span></a>        <span class="c1"># TODO: There should be a whitelist of entity names at some point</span>
</span><span id="Entity-25"><a href="#Entity-25"><span class="linenos">25</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">entity_name_re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">):</span>
</span><span id="Entity-26"><a href="#Entity-26"><span class="linenos">26</span></a>            <span class="k">raise</span> <span class="n">InvalidEntityError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; is not a valid entity name&quot;</span><span class="p">)</span>
</span><span id="Entity-27"><a href="#Entity-27"><span class="linenos">27</span></a>
</span><span id="Entity-28"><a href="#Entity-28"><span class="linenos">28</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Entity-29"><a href="#Entity-29"><span class="linenos">29</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sample</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
</span><span id="Entity-30"><a href="#Entity-30"><span class="linenos">30</span></a>                <span class="k">raise</span> <span class="n">InvalidEntityError</span><span class="p">(</span><span class="s2">&quot;sample must be a float&quot;</span><span class="p">)</span>
</span><span id="Entity-31"><a href="#Entity-31"><span class="linenos">31</span></a>            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">:</span>
</span><span id="Entity-32"><a href="#Entity-32"><span class="linenos">32</span></a>                <span class="k">raise</span> <span class="n">InvalidEntityError</span><span class="p">(</span><span class="s2">&quot;samples must be greater than 0.0&quot;</span><span class="p">)</span>
</span><span id="Entity-33"><a href="#Entity-33"><span class="linenos">33</span></a>
</span><span id="Entity-34"><a href="#Entity-34"><span class="linenos">34</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">alias</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Entity-35"><a href="#Entity-35"><span class="linenos">35</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alias</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">alias</span><span class="p">:</span>
</span><span id="Entity-36"><a href="#Entity-36"><span class="linenos">36</span></a>                <span class="k">raise</span> <span class="n">InvalidEntityError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">alias</span><span class="si">}</span><span class="s2">&#39; is not a valid alias&quot;</span><span class="p">)</span>
</span><span id="Entity-37"><a href="#Entity-37"><span class="linenos">37</span></a>
</span><span id="Entity-38"><a href="#Entity-38"><span class="linenos">38</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_model</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Entity-39"><a href="#Entity-39"><span class="linenos">39</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_model</span><span class="p">,</span> <span class="n">DataModel</span><span class="p">):</span>
</span><span id="Entity-40"><a href="#Entity-40"><span class="linenos">40</span></a>                <span class="k">raise</span> <span class="n">InvalidEntityError</span><span class="p">(</span><span class="s2">&quot;data_model must be an instance of DataModel&quot;</span><span class="p">)</span>
</span><span id="Entity-41"><a href="#Entity-41"><span class="linenos">41</span></a>
</span><span id="Entity-42"><a href="#Entity-42"><span class="linenos">42</span></a>    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="Entity-43"><a href="#Entity-43"><span class="linenos">43</span></a>        <span class="n">alias</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;, alias=&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">alias</span><span class="si">}</span><span class="s2">&#39;&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">alias</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
</span><span id="Entity-44"><a href="#Entity-44"><span class="linenos">44</span></a>        <span class="n">sample</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;, sample=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">sample</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
</span><span id="Entity-45"><a href="#Entity-45"><span class="linenos">45</span></a>        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Entity(&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39;</span><span class="si">{</span><span class="n">alias</span><span class="si">}{</span><span class="n">sample</span><span class="si">}</span><span class="s2">)&quot;</span>
</span></pre></div>


    

                            <div id="Entity.__init__" class="classattr">
                                <div class="attr function">
            
        <span class="name">Entity</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">name</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">alias</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">sample</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">data_model</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">snuba_sdk</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">DataModel</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span>)</span>

        
    </div>
    <a class="headerlink" href="#Entity.__init__"></a>
    
    

                            </div>
                            <div id="Entity.name" class="classattr">
                                <div class="attr variable">
            <span class="name">name</span><span class="annotation">: str</span>

        
    </div>
    <a class="headerlink" href="#Entity.name"></a>
    
    

                            </div>
                            <div id="Entity.alias" class="classattr">
                                <div class="attr variable">
            <span class="name">alias</span><span class="annotation">: Optional[str]</span>        =
<span class="default_value">None</span>

        
    </div>
    <a class="headerlink" href="#Entity.alias"></a>
    
    

                            </div>
                            <div id="Entity.sample" class="classattr">
                                <div class="attr variable">
            <span class="name">sample</span><span class="annotation">: Optional[float]</span>        =
<span class="default_value">None</span>

        
    </div>
    <a class="headerlink" href="#Entity.sample"></a>
    
    

                            </div>
                            <div id="Entity.data_model" class="classattr">
                                <div class="attr variable">
            <span class="name">data_model</span><span class="annotation">: Optional[snuba_sdk.schema.DataModel]</span>        =
<span class="default_value">None</span>

        
    </div>
    <a class="headerlink" href="#Entity.data_model"></a>
    
    

                            </div>
                            <div id="Entity.validate" class="classattr">
                                        <input id="Entity.validate-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">validate</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="Entity.validate-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Entity.validate"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Entity.validate-23"><a href="#Entity.validate-23"><span class="linenos">23</span></a>    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Entity.validate-24"><a href="#Entity.validate-24"><span class="linenos">24</span></a>        <span class="c1"># TODO: There should be a whitelist of entity names at some point</span>
</span><span id="Entity.validate-25"><a href="#Entity.validate-25"><span class="linenos">25</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">entity_name_re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">):</span>
</span><span id="Entity.validate-26"><a href="#Entity.validate-26"><span class="linenos">26</span></a>            <span class="k">raise</span> <span class="n">InvalidEntityError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; is not a valid entity name&quot;</span><span class="p">)</span>
</span><span id="Entity.validate-27"><a href="#Entity.validate-27"><span class="linenos">27</span></a>
</span><span id="Entity.validate-28"><a href="#Entity.validate-28"><span class="linenos">28</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Entity.validate-29"><a href="#Entity.validate-29"><span class="linenos">29</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sample</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
</span><span id="Entity.validate-30"><a href="#Entity.validate-30"><span class="linenos">30</span></a>                <span class="k">raise</span> <span class="n">InvalidEntityError</span><span class="p">(</span><span class="s2">&quot;sample must be a float&quot;</span><span class="p">)</span>
</span><span id="Entity.validate-31"><a href="#Entity.validate-31"><span class="linenos">31</span></a>            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">:</span>
</span><span id="Entity.validate-32"><a href="#Entity.validate-32"><span class="linenos">32</span></a>                <span class="k">raise</span> <span class="n">InvalidEntityError</span><span class="p">(</span><span class="s2">&quot;samples must be greater than 0.0&quot;</span><span class="p">)</span>
</span><span id="Entity.validate-33"><a href="#Entity.validate-33"><span class="linenos">33</span></a>
</span><span id="Entity.validate-34"><a href="#Entity.validate-34"><span class="linenos">34</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">alias</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Entity.validate-35"><a href="#Entity.validate-35"><span class="linenos">35</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alias</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">alias</span><span class="p">:</span>
</span><span id="Entity.validate-36"><a href="#Entity.validate-36"><span class="linenos">36</span></a>                <span class="k">raise</span> <span class="n">InvalidEntityError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">alias</span><span class="si">}</span><span class="s2">&#39; is not a valid alias&quot;</span><span class="p">)</span>
</span><span id="Entity.validate-37"><a href="#Entity.validate-37"><span class="linenos">37</span></a>
</span><span id="Entity.validate-38"><a href="#Entity.validate-38"><span class="linenos">38</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_model</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Entity.validate-39"><a href="#Entity.validate-39"><span class="linenos">39</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_model</span><span class="p">,</span> <span class="n">DataModel</span><span class="p">):</span>
</span><span id="Entity.validate-40"><a href="#Entity.validate-40"><span class="linenos">40</span></a>                <span class="k">raise</span> <span class="n">InvalidEntityError</span><span class="p">(</span><span class="s2">&quot;data_model must be an instance of DataModel&quot;</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                </section>
                <section id="Extrapolate">
                            <input id="Extrapolate-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
                    <div class="decorator">@dataclass(frozen=True)</div>

    <span class="def">class</span>
    <span class="name">Extrapolate</span><wbr>(<span class="base">snuba_sdk.expressions.Expression</span>):

                <label class="view-source-button" for="Extrapolate-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Extrapolate"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Extrapolate-124"><a href="#Extrapolate-124"><span class="linenos">124</span></a><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Extrapolate-125"><a href="#Extrapolate-125"><span class="linenos">125</span></a><span class="k">class</span> <span class="nc">Extrapolate</span><span class="p">(</span><span class="n">Expression</span><span class="p">):</span>
</span><span id="Extrapolate-126"><a href="#Extrapolate-126"><span class="linenos">126</span></a>    <span class="n">extrapolate</span><span class="p">:</span> <span class="nb">bool</span>
</span><span id="Extrapolate-127"><a href="#Extrapolate-127"><span class="linenos">127</span></a>
</span><span id="Extrapolate-128"><a href="#Extrapolate-128"><span class="linenos">128</span></a>    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Extrapolate-129"><a href="#Extrapolate-129"><span class="linenos">129</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">extrapolate</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
</span><span id="Extrapolate-130"><a href="#Extrapolate-130"><span class="linenos">130</span></a>            <span class="k">raise</span> <span class="n">InvalidExpressionError</span><span class="p">(</span><span class="s2">&quot;extrapolate must be a boolean&quot;</span><span class="p">)</span>
</span></pre></div>


    

                            <div id="Extrapolate.__init__" class="classattr">
                                <div class="attr function">
            
        <span class="name">Extrapolate</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">extrapolate</span><span class="p">:</span> <span class="nb">bool</span></span>)</span>

        
    </div>
    <a class="headerlink" href="#Extrapolate.__init__"></a>
    
    

                            </div>
                            <div id="Extrapolate.extrapolate" class="classattr">
                                <div class="attr variable">
            <span class="name">extrapolate</span><span class="annotation">: bool</span>

        
    </div>
    <a class="headerlink" href="#Extrapolate.extrapolate"></a>
    
    

                            </div>
                            <div id="Extrapolate.validate" class="classattr">
                                        <input id="Extrapolate.validate-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">validate</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="Extrapolate.validate-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Extrapolate.validate"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Extrapolate.validate-128"><a href="#Extrapolate.validate-128"><span class="linenos">128</span></a>    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Extrapolate.validate-129"><a href="#Extrapolate.validate-129"><span class="linenos">129</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">extrapolate</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
</span><span id="Extrapolate.validate-130"><a href="#Extrapolate.validate-130"><span class="linenos">130</span></a>            <span class="k">raise</span> <span class="n">InvalidExpressionError</span><span class="p">(</span><span class="s2">&quot;extrapolate must be a boolean&quot;</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                </section>
                <section id="Flags">
                            <input id="Flags-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
                    <div class="decorator">@dataclass</div>

    <span class="def">class</span>
    <span class="name">Flags</span>:

                <label class="view-source-button" for="Flags-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Flags"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Flags-22"><a href="#Flags-22"><span class="linenos">22</span></a><span class="nd">@dataclass</span>
</span><span id="Flags-23"><a href="#Flags-23"><span class="linenos">23</span></a><span class="k">class</span> <span class="nc">Flags</span><span class="p">:</span>
</span><span id="Flags-24"><a href="#Flags-24"><span class="linenos">24</span></a>    <span class="n">totals</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Flags-25"><a href="#Flags-25"><span class="linenos">25</span></a>    <span class="n">consistent</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Flags-26"><a href="#Flags-26"><span class="linenos">26</span></a>    <span class="n">turbo</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Flags-27"><a href="#Flags-27"><span class="linenos">27</span></a>    <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Flags-28"><a href="#Flags-28"><span class="linenos">28</span></a>    <span class="n">dry_run</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Flags-29"><a href="#Flags-29"><span class="linenos">29</span></a>    <span class="n">legacy</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Flags-30"><a href="#Flags-30"><span class="linenos">30</span></a>
</span><span id="Flags-31"><a href="#Flags-31"><span class="linenos">31</span></a>    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Flags-32"><a href="#Flags-32"><span class="linenos">32</span></a>        <span class="n">flags_fields</span> <span class="o">=</span> <span class="n">fields</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="Flags-33"><a href="#Flags-33"><span class="linenos">33</span></a>        <span class="k">for</span> <span class="n">ff</span> <span class="ow">in</span> <span class="n">flags_fields</span><span class="p">:</span>
</span><span id="Flags-34"><a href="#Flags-34"><span class="linenos">34</span></a>            <span class="n">flag</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ff</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="Flags-35"><a href="#Flags-35"><span class="linenos">35</span></a>            <span class="k">if</span> <span class="n">flag</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">flag</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
</span><span id="Flags-36"><a href="#Flags-36"><span class="linenos">36</span></a>                <span class="k">raise</span> <span class="n">InvalidFlagError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ff</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> must be a boolean&quot;</span><span class="p">)</span>
</span><span id="Flags-37"><a href="#Flags-37"><span class="linenos">37</span></a>
</span><span id="Flags-38"><a href="#Flags-38"><span class="linenos">38</span></a>    <span class="k">def</span> <span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]:</span>
</span><span id="Flags-39"><a href="#Flags-39"><span class="linenos">39</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">validate</span><span class="p">()</span>
</span><span id="Flags-40"><a href="#Flags-40"><span class="linenos">40</span></a>        <span class="n">values</span> <span class="o">=</span> <span class="n">asdict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="Flags-41"><a href="#Flags-41"><span class="linenos">41</span></a>        <span class="k">return</span> <span class="p">{</span><span class="n">f</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">f</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">values</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">}</span>
</span></pre></div>


    

                            <div id="Flags.__init__" class="classattr">
                                <div class="attr function">
            
        <span class="name">Flags</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">totals</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">consistent</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">turbo</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">dry_run</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">legacy</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></span>)</span>

        
    </div>
    <a class="headerlink" href="#Flags.__init__"></a>
    
    

                            </div>
                            <div id="Flags.totals" class="classattr">
                                <div class="attr variable">
            <span class="name">totals</span><span class="annotation">: bool | None</span>        =
<span class="default_value">None</span>

        
    </div>
    <a class="headerlink" href="#Flags.totals"></a>
    
    

                            </div>
                            <div id="Flags.consistent" class="classattr">
                                <div class="attr variable">
            <span class="name">consistent</span><span class="annotation">: bool | None</span>        =
<span class="default_value">None</span>

        
    </div>
    <a class="headerlink" href="#Flags.consistent"></a>
    
    

                            </div>
                            <div id="Flags.turbo" class="classattr">
                                <div class="attr variable">
            <span class="name">turbo</span><span class="annotation">: bool | None</span>        =
<span class="default_value">None</span>

        
    </div>
    <a class="headerlink" href="#Flags.turbo"></a>
    
    

                            </div>
                            <div id="Flags.debug" class="classattr">
                                <div class="attr variable">
            <span class="name">debug</span><span class="annotation">: bool | None</span>        =
<span class="default_value">None</span>

        
    </div>
    <a class="headerlink" href="#Flags.debug"></a>
    
    

                            </div>
                            <div id="Flags.dry_run" class="classattr">
                                <div class="attr variable">
            <span class="name">dry_run</span><span class="annotation">: bool | None</span>        =
<span class="default_value">None</span>

        
    </div>
    <a class="headerlink" href="#Flags.dry_run"></a>
    
    

                            </div>
                            <div id="Flags.legacy" class="classattr">
                                <div class="attr variable">
            <span class="name">legacy</span><span class="annotation">: bool | None</span>        =
<span class="default_value">None</span>

        
    </div>
    <a class="headerlink" href="#Flags.legacy"></a>
    
    

                            </div>
                            <div id="Flags.validate" class="classattr">
                                        <input id="Flags.validate-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">validate</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="Flags.validate-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Flags.validate"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Flags.validate-31"><a href="#Flags.validate-31"><span class="linenos">31</span></a>    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Flags.validate-32"><a href="#Flags.validate-32"><span class="linenos">32</span></a>        <span class="n">flags_fields</span> <span class="o">=</span> <span class="n">fields</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="Flags.validate-33"><a href="#Flags.validate-33"><span class="linenos">33</span></a>        <span class="k">for</span> <span class="n">ff</span> <span class="ow">in</span> <span class="n">flags_fields</span><span class="p">:</span>
</span><span id="Flags.validate-34"><a href="#Flags.validate-34"><span class="linenos">34</span></a>            <span class="n">flag</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ff</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="Flags.validate-35"><a href="#Flags.validate-35"><span class="linenos">35</span></a>            <span class="k">if</span> <span class="n">flag</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">flag</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
</span><span id="Flags.validate-36"><a href="#Flags.validate-36"><span class="linenos">36</span></a>                <span class="k">raise</span> <span class="n">InvalidFlagError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ff</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> must be a boolean&quot;</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="Flags.to_dict" class="classattr">
                                        <input id="Flags.to_dict-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">to_dict</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="Flags.to_dict-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Flags.to_dict"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Flags.to_dict-38"><a href="#Flags.to_dict-38"><span class="linenos">38</span></a>    <span class="k">def</span> <span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]:</span>
</span><span id="Flags.to_dict-39"><a href="#Flags.to_dict-39"><span class="linenos">39</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">validate</span><span class="p">()</span>
</span><span id="Flags.to_dict-40"><a href="#Flags.to_dict-40"><span class="linenos">40</span></a>        <span class="n">values</span> <span class="o">=</span> <span class="n">asdict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="Flags.to_dict-41"><a href="#Flags.to_dict-41"><span class="linenos">41</span></a>        <span class="k">return</span> <span class="p">{</span><span class="n">f</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">f</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">values</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">}</span>
</span></pre></div>


    

                            </div>
                </section>
                <section id="Formula">
                            <input id="Formula-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
                    <div class="decorator">@dataclass(frozen=True)</div>

    <span class="def">class</span>
    <span class="name">Formula</span>:

                <label class="view-source-button" for="Formula-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Formula"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Formula-40"><a href="#Formula-40"><span class="linenos"> 40</span></a><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Formula-41"><a href="#Formula-41"><span class="linenos"> 41</span></a><span class="k">class</span> <span class="nc">Formula</span><span class="p">:</span>
</span><span id="Formula-42"><a href="#Formula-42"><span class="linenos"> 42</span></a>    <span class="n">function_name</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="Formula-43"><a href="#Formula-43"><span class="linenos"> 43</span></a>    <span class="n">parameters</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="n">FormulaParameterGroup</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Formula-44"><a href="#Formula-44"><span class="linenos"> 44</span></a>    <span class="n">aggregate_params</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Formula-45"><a href="#Formula-45"><span class="linenos"> 45</span></a>    <span class="n">filters</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ConditionGroup</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Formula-46"><a href="#Formula-46"><span class="linenos"> 46</span></a>    <span class="n">groupby</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="n">Column</span> <span class="o">|</span> <span class="n">AliasedExpression</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Formula-47"><a href="#Formula-47"><span class="linenos"> 47</span></a>
</span><span id="Formula-48"><a href="#Formula-48"><span class="linenos"> 48</span></a>    <span class="k">def</span> <span class="nf">__validate_consistency</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Formula-49"><a href="#Formula-49"><span class="linenos"> 49</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Formula-50"><a href="#Formula-50"><span class="linenos"> 50</span></a><span class="sd">        Ensure that the groupby columns are consistent across all Timeseries</span>
</span><span id="Formula-51"><a href="#Formula-51"><span class="linenos"> 51</span></a><span class="sd">        and Formulas within this Formula.&quot;&quot;&quot;</span>
</span><span id="Formula-52"><a href="#Formula-52"><span class="linenos"> 52</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Formula-53"><a href="#Formula-53"><span class="linenos"> 53</span></a>            <span class="k">raise</span> <span class="n">InvalidFormulaError</span><span class="p">(</span><span class="s2">&quot;Formula must have parameters&quot;</span><span class="p">)</span>
</span><span id="Formula-54"><a href="#Formula-54"><span class="linenos"> 54</span></a>
</span><span id="Formula-55"><a href="#Formula-55"><span class="linenos"> 55</span></a>        <span class="n">groupbys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="Formula-56"><a href="#Formula-56"><span class="linenos"> 56</span></a>        <span class="n">has_timeseries</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Formula-57"><a href="#Formula-57"><span class="linenos"> 57</span></a>
</span><span id="Formula-58"><a href="#Formula-58"><span class="linenos"> 58</span></a>        <span class="n">stack</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">FormulaParameterGroup</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="p">]</span>
</span><span id="Formula-59"><a href="#Formula-59"><span class="linenos"> 59</span></a>        <span class="k">while</span> <span class="n">stack</span><span class="p">:</span>
</span><span id="Formula-60"><a href="#Formula-60"><span class="linenos"> 60</span></a>            <span class="n">param</span> <span class="o">=</span> <span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
</span><span id="Formula-61"><a href="#Formula-61"><span class="linenos"> 61</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="n">Formula</span><span class="p">):</span>
</span><span id="Formula-62"><a href="#Formula-62"><span class="linenos"> 62</span></a>                <span class="k">if</span> <span class="n">param</span><span class="o">.</span><span class="n">groupby</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Formula-63"><a href="#Formula-63"><span class="linenos"> 63</span></a>                    <span class="n">groupbys</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">param</span><span class="o">.</span><span class="n">groupby</span><span class="p">))</span>
</span><span id="Formula-64"><a href="#Formula-64"><span class="linenos"> 64</span></a>
</span><span id="Formula-65"><a href="#Formula-65"><span class="linenos"> 65</span></a>                <span class="k">if</span> <span class="n">param</span><span class="o">.</span><span class="n">parameters</span><span class="p">:</span>
</span><span id="Formula-66"><a href="#Formula-66"><span class="linenos"> 66</span></a>                    <span class="n">stack</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">param</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span>
</span><span id="Formula-67"><a href="#Formula-67"><span class="linenos"> 67</span></a>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="n">Timeseries</span><span class="p">):</span>
</span><span id="Formula-68"><a href="#Formula-68"><span class="linenos"> 68</span></a>                <span class="n">has_timeseries</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Formula-69"><a href="#Formula-69"><span class="linenos"> 69</span></a>                <span class="k">if</span> <span class="n">param</span><span class="o">.</span><span class="n">groupby</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Formula-70"><a href="#Formula-70"><span class="linenos"> 70</span></a>                    <span class="n">groupbys</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">param</span><span class="o">.</span><span class="n">groupby</span><span class="p">))</span>
</span><span id="Formula-71"><a href="#Formula-71"><span class="linenos"> 71</span></a>
</span><span id="Formula-72"><a href="#Formula-72"><span class="linenos"> 72</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">has_timeseries</span><span class="p">:</span>
</span><span id="Formula-73"><a href="#Formula-73"><span class="linenos"> 73</span></a>            <span class="k">raise</span> <span class="n">InvalidFormulaError</span><span class="p">(</span>
</span><span id="Formula-74"><a href="#Formula-74"><span class="linenos"> 74</span></a>                <span class="s2">&quot;Formulas must operate on at least one Timeseries&quot;</span>
</span><span id="Formula-75"><a href="#Formula-75"><span class="linenos"> 75</span></a>            <span class="p">)</span>
</span><span id="Formula-76"><a href="#Formula-76"><span class="linenos"> 76</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">groupbys</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Formula-77"><a href="#Formula-77"><span class="linenos"> 77</span></a>            <span class="k">raise</span> <span class="n">InvalidFormulaError</span><span class="p">(</span>
</span><span id="Formula-78"><a href="#Formula-78"><span class="linenos"> 78</span></a>                <span class="s2">&quot;Formula parameters must group by the same columns&quot;</span>
</span><span id="Formula-79"><a href="#Formula-79"><span class="linenos"> 79</span></a>            <span class="p">)</span>
</span><span id="Formula-80"><a href="#Formula-80"><span class="linenos"> 80</span></a>
</span><span id="Formula-81"><a href="#Formula-81"><span class="linenos"> 81</span></a>    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Formula-82"><a href="#Formula-82"><span class="linenos"> 82</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">function_name</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="Formula-83"><a href="#Formula-83"><span class="linenos"> 83</span></a>            <span class="k">raise</span> <span class="n">InvalidFormulaError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;formula &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">function_name</span><span class="si">}</span><span class="s2">&#39; must be a str&quot;</span><span class="p">)</span>
</span><span id="Formula-84"><a href="#Formula-84"><span class="linenos"> 84</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Formula-85"><a href="#Formula-85"><span class="linenos"> 85</span></a>            <span class="k">raise</span> <span class="n">InvalidFormulaError</span><span class="p">(</span><span class="s2">&quot;Formula must have parameters&quot;</span><span class="p">)</span>
</span><span id="Formula-86"><a href="#Formula-86"><span class="linenos"> 86</span></a>        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">):</span>
</span><span id="Formula-87"><a href="#Formula-87"><span class="linenos"> 87</span></a>            <span class="k">raise</span> <span class="n">InvalidFormulaError</span><span class="p">(</span>
</span><span id="Formula-88"><a href="#Formula-88"><span class="linenos"> 88</span></a>                <span class="sa">f</span><span class="s2">&quot;parameters of formula </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">function_name</span><span class="si">}</span><span class="s2"> must be a Sequence&quot;</span>
</span><span id="Formula-89"><a href="#Formula-89"><span class="linenos"> 89</span></a>            <span class="p">)</span>
</span><span id="Formula-90"><a href="#Formula-90"><span class="linenos"> 90</span></a>
</span><span id="Formula-91"><a href="#Formula-91"><span class="linenos"> 91</span></a>        <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">:</span>
</span><span id="Formula-92"><a href="#Formula-92"><span class="linenos"> 92</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">FormulaParameter</span><span class="p">)):</span>
</span><span id="Formula-93"><a href="#Formula-93"><span class="linenos"> 93</span></a>                <span class="k">raise</span> <span class="n">InvalidFormulaError</span><span class="p">(</span>
</span><span id="Formula-94"><a href="#Formula-94"><span class="linenos"> 94</span></a>                    <span class="sa">f</span><span class="s2">&quot;parameter &#39;</span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s2">&#39; of formula </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">function_name</span><span class="si">}</span><span class="s2"> is an invalid type&quot;</span>
</span><span id="Formula-95"><a href="#Formula-95"><span class="linenos"> 95</span></a>                <span class="p">)</span>
</span><span id="Formula-96"><a href="#Formula-96"><span class="linenos"> 96</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">__validate_consistency</span><span class="p">()</span>
</span><span id="Formula-97"><a href="#Formula-97"><span class="linenos"> 97</span></a>
</span><span id="Formula-98"><a href="#Formula-98"><span class="linenos"> 98</span></a>    <span class="k">def</span> <span class="nf">_replace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Formula</span><span class="p">:</span>
</span><span id="Formula-99"><a href="#Formula-99"><span class="linenos"> 99</span></a>        <span class="n">new</span> <span class="o">=</span> <span class="n">replace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="p">{</span><span class="n">field</span><span class="p">:</span> <span class="n">value</span><span class="p">})</span>
</span><span id="Formula-100"><a href="#Formula-100"><span class="linenos">100</span></a>        <span class="k">return</span> <span class="n">new</span>
</span><span id="Formula-101"><a href="#Formula-101"><span class="linenos">101</span></a>
</span><span id="Formula-102"><a href="#Formula-102"><span class="linenos">102</span></a>    <span class="k">def</span> <span class="nf">set_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameters</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">FormulaParameterGroup</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Formula</span><span class="p">:</span>
</span><span id="Formula-103"><a href="#Formula-103"><span class="linenos">103</span></a>        <span class="k">if</span> <span class="n">parameters</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">list_type</span><span class="p">(</span>
</span><span id="Formula-104"><a href="#Formula-104"><span class="linenos">104</span></a>            <span class="n">parameters</span><span class="p">,</span> <span class="p">(</span><span class="n">Formula</span><span class="p">,</span> <span class="n">Timeseries</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>
</span><span id="Formula-105"><a href="#Formula-105"><span class="linenos">105</span></a>        <span class="p">):</span>
</span><span id="Formula-106"><a href="#Formula-106"><span class="linenos">106</span></a>            <span class="k">raise</span> <span class="n">InvalidFormulaError</span><span class="p">(</span>
</span><span id="Formula-107"><a href="#Formula-107"><span class="linenos">107</span></a>                <span class="s2">&quot;parameters must be a list of either Timeseries, floats, or ints&quot;</span>
</span><span id="Formula-108"><a href="#Formula-108"><span class="linenos">108</span></a>            <span class="p">)</span>
</span><span id="Formula-109"><a href="#Formula-109"><span class="linenos">109</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="s2">&quot;parameters&quot;</span><span class="p">,</span> <span class="n">parameters</span><span class="p">)</span>
</span><span id="Formula-110"><a href="#Formula-110"><span class="linenos">110</span></a>
</span><span id="Formula-111"><a href="#Formula-111"><span class="linenos">111</span></a>    <span class="k">def</span> <span class="nf">set_filters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filters</span><span class="p">:</span> <span class="n">ConditionGroup</span> <span class="o">|</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Formula</span><span class="p">:</span>
</span><span id="Formula-112"><a href="#Formula-112"><span class="linenos">112</span></a>        <span class="k">if</span> <span class="n">filters</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">list_type</span><span class="p">(</span>
</span><span id="Formula-113"><a href="#Formula-113"><span class="linenos">113</span></a>            <span class="n">filters</span><span class="p">,</span> <span class="p">(</span><span class="n">BooleanCondition</span><span class="p">,</span> <span class="n">Condition</span><span class="p">)</span>
</span><span id="Formula-114"><a href="#Formula-114"><span class="linenos">114</span></a>        <span class="p">):</span>
</span><span id="Formula-115"><a href="#Formula-115"><span class="linenos">115</span></a>            <span class="k">raise</span> <span class="n">InvalidFormulaError</span><span class="p">(</span><span class="s2">&quot;filters must be a list of Conditions&quot;</span><span class="p">)</span>
</span><span id="Formula-116"><a href="#Formula-116"><span class="linenos">116</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="s2">&quot;filters&quot;</span><span class="p">,</span> <span class="n">filters</span><span class="p">)</span>
</span><span id="Formula-117"><a href="#Formula-117"><span class="linenos">117</span></a>
</span><span id="Formula-118"><a href="#Formula-118"><span class="linenos">118</span></a>    <span class="k">def</span> <span class="nf">set_groupby</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">groupby</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Column</span> <span class="o">|</span> <span class="n">AliasedExpression</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Formula</span><span class="p">:</span>
</span><span id="Formula-119"><a href="#Formula-119"><span class="linenos">119</span></a>        <span class="k">if</span> <span class="n">groupby</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">list_type</span><span class="p">(</span><span class="n">groupby</span><span class="p">,</span> <span class="p">(</span><span class="n">Column</span><span class="p">,</span> <span class="n">AliasedExpression</span><span class="p">)):</span>
</span><span id="Formula-120"><a href="#Formula-120"><span class="linenos">120</span></a>            <span class="k">raise</span> <span class="n">InvalidFormulaError</span><span class="p">(</span><span class="s2">&quot;groupby must be a list of Columns&quot;</span><span class="p">)</span>
</span><span id="Formula-121"><a href="#Formula-121"><span class="linenos">121</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="s2">&quot;groupby&quot;</span><span class="p">,</span> <span class="n">groupby</span><span class="p">)</span>
</span></pre></div>


    

                            <div id="Formula.__init__" class="classattr">
                                <div class="attr function">
            
        <span class="name">Formula</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">function_name</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">parameters</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n"><a href="#Formula">Formula</a></span><span class="p">,</span> <span class="n"><a href="#Timeseries">Timeseries</a></span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">aggregate_params</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">filters</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n"><a href="#BooleanCondition">BooleanCondition</a></span><span class="p">,</span> <span class="n"><a href="#Condition">Condition</a></span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">groupby</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="n"><a href="#Column">Column</a></span> <span class="o">|</span> <span class="n"><a href="#AliasedExpression">AliasedExpression</a></span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span></span>)</span>

        
    </div>
    <a class="headerlink" href="#Formula.__init__"></a>
    
    

                            </div>
                            <div id="Formula.function_name" class="classattr">
                                <div class="attr variable">
            <span class="name">function_name</span><span class="annotation">: str</span>

        
    </div>
    <a class="headerlink" href="#Formula.function_name"></a>
    
    

                            </div>
                            <div id="Formula.parameters" class="classattr">
                                <div class="attr variable">
            <span class="name">parameters</span><span class="annotation">: Optional[Sequence[Union[<a href="#Formula">Formula</a>, <a href="#Timeseries">Timeseries</a>, float, int, str]]]</span>        =
<span class="default_value">None</span>

        
    </div>
    <a class="headerlink" href="#Formula.parameters"></a>
    
    

                            </div>
                            <div id="Formula.aggregate_params" class="classattr">
                                <div class="attr variable">
            <span class="name">aggregate_params</span><span class="annotation">: list[typing.Any] | None</span>        =
<span class="default_value">None</span>

        
    </div>
    <a class="headerlink" href="#Formula.aggregate_params"></a>
    
    

                            </div>
                            <div id="Formula.filters" class="classattr">
                                <div class="attr variable">
            <span class="name">filters</span><span class="annotation">: Optional[Sequence[Union[<a href="#BooleanCondition">BooleanCondition</a>, <a href="#Condition">Condition</a>]]]</span>        =
<span class="default_value">None</span>

        
    </div>
    <a class="headerlink" href="#Formula.filters"></a>
    
    

                            </div>
                            <div id="Formula.groupby" class="classattr">
                                <div class="attr variable">
            <span class="name">groupby</span><span class="annotation">: Optional[list[<a href="#Column">Column</a> | <a href="#AliasedExpression">AliasedExpression</a>]]</span>        =
<span class="default_value">None</span>

        
    </div>
    <a class="headerlink" href="#Formula.groupby"></a>
    
    

                            </div>
                            <div id="Formula.validate" class="classattr">
                                        <input id="Formula.validate-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">validate</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="Formula.validate-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Formula.validate"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Formula.validate-81"><a href="#Formula.validate-81"><span class="linenos">81</span></a>    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Formula.validate-82"><a href="#Formula.validate-82"><span class="linenos">82</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">function_name</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="Formula.validate-83"><a href="#Formula.validate-83"><span class="linenos">83</span></a>            <span class="k">raise</span> <span class="n">InvalidFormulaError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;formula &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">function_name</span><span class="si">}</span><span class="s2">&#39; must be a str&quot;</span><span class="p">)</span>
</span><span id="Formula.validate-84"><a href="#Formula.validate-84"><span class="linenos">84</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Formula.validate-85"><a href="#Formula.validate-85"><span class="linenos">85</span></a>            <span class="k">raise</span> <span class="n">InvalidFormulaError</span><span class="p">(</span><span class="s2">&quot;Formula must have parameters&quot;</span><span class="p">)</span>
</span><span id="Formula.validate-86"><a href="#Formula.validate-86"><span class="linenos">86</span></a>        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">):</span>
</span><span id="Formula.validate-87"><a href="#Formula.validate-87"><span class="linenos">87</span></a>            <span class="k">raise</span> <span class="n">InvalidFormulaError</span><span class="p">(</span>
</span><span id="Formula.validate-88"><a href="#Formula.validate-88"><span class="linenos">88</span></a>                <span class="sa">f</span><span class="s2">&quot;parameters of formula </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">function_name</span><span class="si">}</span><span class="s2"> must be a Sequence&quot;</span>
</span><span id="Formula.validate-89"><a href="#Formula.validate-89"><span class="linenos">89</span></a>            <span class="p">)</span>
</span><span id="Formula.validate-90"><a href="#Formula.validate-90"><span class="linenos">90</span></a>
</span><span id="Formula.validate-91"><a href="#Formula.validate-91"><span class="linenos">91</span></a>        <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">:</span>
</span><span id="Formula.validate-92"><a href="#Formula.validate-92"><span class="linenos">92</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">FormulaParameter</span><span class="p">)):</span>
</span><span id="Formula.validate-93"><a href="#Formula.validate-93"><span class="linenos">93</span></a>                <span class="k">raise</span> <span class="n">InvalidFormulaError</span><span class="p">(</span>
</span><span id="Formula.validate-94"><a href="#Formula.validate-94"><span class="linenos">94</span></a>                    <span class="sa">f</span><span class="s2">&quot;parameter &#39;</span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s2">&#39; of formula </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">function_name</span><span class="si">}</span><span class="s2"> is an invalid type&quot;</span>
</span><span id="Formula.validate-95"><a href="#Formula.validate-95"><span class="linenos">95</span></a>                <span class="p">)</span>
</span><span id="Formula.validate-96"><a href="#Formula.validate-96"><span class="linenos">96</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">__validate_consistency</span><span class="p">()</span>
</span></pre></div>


    

                            </div>
                            <div id="Formula.set_parameters" class="classattr">
                                        <input id="Formula.set_parameters-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_parameters</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">parameters</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n"><a href="#Formula">Formula</a></span><span class="p">,</span> <span class="n"><a href="#Timeseries">Timeseries</a></span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span></span><span class="return-annotation">) -> <span class="n"><a href="#Formula">Formula</a></span>:</span></span>

                <label class="view-source-button" for="Formula.set_parameters-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Formula.set_parameters"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Formula.set_parameters-102"><a href="#Formula.set_parameters-102"><span class="linenos">102</span></a>    <span class="k">def</span> <span class="nf">set_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameters</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">FormulaParameterGroup</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Formula</span><span class="p">:</span>
</span><span id="Formula.set_parameters-103"><a href="#Formula.set_parameters-103"><span class="linenos">103</span></a>        <span class="k">if</span> <span class="n">parameters</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">list_type</span><span class="p">(</span>
</span><span id="Formula.set_parameters-104"><a href="#Formula.set_parameters-104"><span class="linenos">104</span></a>            <span class="n">parameters</span><span class="p">,</span> <span class="p">(</span><span class="n">Formula</span><span class="p">,</span> <span class="n">Timeseries</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>
</span><span id="Formula.set_parameters-105"><a href="#Formula.set_parameters-105"><span class="linenos">105</span></a>        <span class="p">):</span>
</span><span id="Formula.set_parameters-106"><a href="#Formula.set_parameters-106"><span class="linenos">106</span></a>            <span class="k">raise</span> <span class="n">InvalidFormulaError</span><span class="p">(</span>
</span><span id="Formula.set_parameters-107"><a href="#Formula.set_parameters-107"><span class="linenos">107</span></a>                <span class="s2">&quot;parameters must be a list of either Timeseries, floats, or ints&quot;</span>
</span><span id="Formula.set_parameters-108"><a href="#Formula.set_parameters-108"><span class="linenos">108</span></a>            <span class="p">)</span>
</span><span id="Formula.set_parameters-109"><a href="#Formula.set_parameters-109"><span class="linenos">109</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="s2">&quot;parameters&quot;</span><span class="p">,</span> <span class="n">parameters</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="Formula.set_filters" class="classattr">
                                        <input id="Formula.set_filters-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_filters</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">filters</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n"><a href="#BooleanCondition">BooleanCondition</a></span><span class="p">,</span> <span class="n"><a href="#Condition">Condition</a></span><span class="p">]]]</span></span><span class="return-annotation">) -> <span class="n"><a href="#Formula">Formula</a></span>:</span></span>

                <label class="view-source-button" for="Formula.set_filters-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Formula.set_filters"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Formula.set_filters-111"><a href="#Formula.set_filters-111"><span class="linenos">111</span></a>    <span class="k">def</span> <span class="nf">set_filters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filters</span><span class="p">:</span> <span class="n">ConditionGroup</span> <span class="o">|</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Formula</span><span class="p">:</span>
</span><span id="Formula.set_filters-112"><a href="#Formula.set_filters-112"><span class="linenos">112</span></a>        <span class="k">if</span> <span class="n">filters</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">list_type</span><span class="p">(</span>
</span><span id="Formula.set_filters-113"><a href="#Formula.set_filters-113"><span class="linenos">113</span></a>            <span class="n">filters</span><span class="p">,</span> <span class="p">(</span><span class="n">BooleanCondition</span><span class="p">,</span> <span class="n">Condition</span><span class="p">)</span>
</span><span id="Formula.set_filters-114"><a href="#Formula.set_filters-114"><span class="linenos">114</span></a>        <span class="p">):</span>
</span><span id="Formula.set_filters-115"><a href="#Formula.set_filters-115"><span class="linenos">115</span></a>            <span class="k">raise</span> <span class="n">InvalidFormulaError</span><span class="p">(</span><span class="s2">&quot;filters must be a list of Conditions&quot;</span><span class="p">)</span>
</span><span id="Formula.set_filters-116"><a href="#Formula.set_filters-116"><span class="linenos">116</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="s2">&quot;filters&quot;</span><span class="p">,</span> <span class="n">filters</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="Formula.set_groupby" class="classattr">
                                        <input id="Formula.set_groupby-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_groupby</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">groupby</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n"><a href="#Column">Column</a></span> <span class="o">|</span> <span class="n"><a href="#AliasedExpression">AliasedExpression</a></span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n"><a href="#Formula">Formula</a></span>:</span></span>

                <label class="view-source-button" for="Formula.set_groupby-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Formula.set_groupby"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Formula.set_groupby-118"><a href="#Formula.set_groupby-118"><span class="linenos">118</span></a>    <span class="k">def</span> <span class="nf">set_groupby</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">groupby</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Column</span> <span class="o">|</span> <span class="n">AliasedExpression</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Formula</span><span class="p">:</span>
</span><span id="Formula.set_groupby-119"><a href="#Formula.set_groupby-119"><span class="linenos">119</span></a>        <span class="k">if</span> <span class="n">groupby</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">list_type</span><span class="p">(</span><span class="n">groupby</span><span class="p">,</span> <span class="p">(</span><span class="n">Column</span><span class="p">,</span> <span class="n">AliasedExpression</span><span class="p">)):</span>
</span><span id="Formula.set_groupby-120"><a href="#Formula.set_groupby-120"><span class="linenos">120</span></a>            <span class="k">raise</span> <span class="n">InvalidFormulaError</span><span class="p">(</span><span class="s2">&quot;groupby must be a list of Columns&quot;</span><span class="p">)</span>
</span><span id="Formula.set_groupby-121"><a href="#Formula.set_groupby-121"><span class="linenos">121</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="s2">&quot;groupby&quot;</span><span class="p">,</span> <span class="n">groupby</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                </section>
                <section id="Function">
                            <input id="Function-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
                    <div class="decorator">@dataclass(frozen=True)</div>

    <span class="def">class</span>
    <span class="name">Function</span><wbr>(<span class="base"><a href="#CurriedFunction">snuba_sdk.CurriedFunction</a></span>):

                <label class="view-source-button" for="Function-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Function"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Function-112"><a href="#Function-112"><span class="linenos">112</span></a><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Function-113"><a href="#Function-113"><span class="linenos">113</span></a><span class="k">class</span> <span class="nc">Function</span><span class="p">(</span><span class="n">CurriedFunction</span><span class="p">):</span>
</span><span id="Function-114"><a href="#Function-114"><span class="linenos">114</span></a>    <span class="n">initializers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">ScalarLiteralType</span><span class="p">,</span> <span class="n">Column</span><span class="p">]]]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span>
</span><span id="Function-115"><a href="#Function-115"><span class="linenos">115</span></a>        <span class="n">init</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span>
</span><span id="Function-116"><a href="#Function-116"><span class="linenos">116</span></a>    <span class="p">)</span>
</span></pre></div>


    

                            <div id="Function.__init__" class="classattr">
                                <div class="attr function">
            
        <span class="name">Function</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">function</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">parameters</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">NoneType</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">snuba_sdk</span><span class="o">.</span><span class="n">expressions</span><span class="o">.</span><span class="n">Expression</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">]],</span> <span class="n"><a href="#Column">Column</a></span><span class="p">,</span> <span class="n"><a href="#CurriedFunction">CurriedFunction</a></span><span class="p">,</span> <span class="n"><a href="#Function">Function</a></span><span class="p">,</span> <span class="n"><a href="#Identifier">Identifier</a></span><span class="p">,</span> <span class="n"><a href="#Lambda">Lambda</a></span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">alias</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span>)</span>

        
    </div>
    <a class="headerlink" href="#Function.__init__"></a>
    
    

                            </div>
                            <div id="Function.initializers" class="classattr">
                                <div class="attr variable">
            <span class="name">initializers</span><span class="annotation">: Optional[Sequence[Union[NoneType, bool, str, bytes, float, int, datetime.date, datetime.datetime, <a href="#Column">Column</a>]]]</span>        =
<span class="default_value">None</span>

        
    </div>
    <a class="headerlink" href="#Function.initializers"></a>
    
    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#CurriedFunction">CurriedFunction</a></dt>
                                <dd id="Function.function" class="variable"><a href="#CurriedFunction.function">function</a></dd>
                <dd id="Function.parameters" class="variable"><a href="#CurriedFunction.parameters">parameters</a></dd>
                <dd id="Function.alias" class="variable"><a href="#CurriedFunction.alias">alias</a></dd>
                <dd id="Function.validate" class="function"><a href="#CurriedFunction.validate">validate</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="Granularity">
                            <input id="Granularity-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
                    <div class="decorator">@dataclass(frozen=True)</div>

    <span class="def">class</span>
    <span class="name">Granularity</span><wbr>(<span class="base">snuba_sdk.expressions.Expression</span>):

                <label class="view-source-button" for="Granularity-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Granularity"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Granularity-107"><a href="#Granularity-107"><span class="linenos">107</span></a><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Granularity-108"><a href="#Granularity-108"><span class="linenos">108</span></a><span class="k">class</span> <span class="nc">Granularity</span><span class="p">(</span><span class="n">Expression</span><span class="p">):</span>
</span><span id="Granularity-109"><a href="#Granularity-109"><span class="linenos">109</span></a>    <span class="n">granularity</span><span class="p">:</span> <span class="nb">int</span>
</span><span id="Granularity-110"><a href="#Granularity-110"><span class="linenos">110</span></a>
</span><span id="Granularity-111"><a href="#Granularity-111"><span class="linenos">111</span></a>    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Granularity-112"><a href="#Granularity-112"><span class="linenos">112</span></a>        <span class="n">_validate_int_literal</span><span class="p">(</span><span class="s2">&quot;granularity&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">granularity</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span></pre></div>


    

                            <div id="Granularity.__init__" class="classattr">
                                <div class="attr function">
            
        <span class="name">Granularity</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">granularity</span><span class="p">:</span> <span class="nb">int</span></span>)</span>

        
    </div>
    <a class="headerlink" href="#Granularity.__init__"></a>
    
    

                            </div>
                            <div id="Granularity.granularity" class="classattr">
                                <div class="attr variable">
            <span class="name">granularity</span><span class="annotation">: int</span>

        
    </div>
    <a class="headerlink" href="#Granularity.granularity"></a>
    
    

                            </div>
                            <div id="Granularity.validate" class="classattr">
                                        <input id="Granularity.validate-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">validate</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="Granularity.validate-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Granularity.validate"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Granularity.validate-111"><a href="#Granularity.validate-111"><span class="linenos">111</span></a>    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Granularity.validate-112"><a href="#Granularity.validate-112"><span class="linenos">112</span></a>        <span class="n">_validate_int_literal</span><span class="p">(</span><span class="s2">&quot;granularity&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">granularity</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                </section>
                <section id="Identifier">
                            <input id="Identifier-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
                    <div class="decorator">@dataclass(frozen=True)</div>

    <span class="def">class</span>
    <span class="name">Identifier</span><wbr>(<span class="base">snuba_sdk.expressions.Expression</span>):

                <label class="view-source-button" for="Identifier-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Identifier"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Identifier-126"><a href="#Identifier-126"><span class="linenos">126</span></a><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Identifier-127"><a href="#Identifier-127"><span class="linenos">127</span></a><span class="k">class</span> <span class="nc">Identifier</span><span class="p">(</span><span class="n">Expression</span><span class="p">):</span>
</span><span id="Identifier-128"><a href="#Identifier-128"><span class="linenos">128</span></a>    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="Identifier-129"><a href="#Identifier-129"><span class="linenos">129</span></a>
</span><span id="Identifier-130"><a href="#Identifier-130"><span class="linenos">130</span></a>    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Identifier-131"><a href="#Identifier-131"><span class="linenos">131</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">identifier_re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">):</span>
</span><span id="Identifier-132"><a href="#Identifier-132"><span class="linenos">132</span></a>            <span class="k">raise</span> <span class="n">InvalidLambdaError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;`</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">` is not a valid identifier&quot;</span><span class="p">)</span>
</span></pre></div>


    

                            <div id="Identifier.__init__" class="classattr">
                                <div class="attr function">
            
        <span class="name">Identifier</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">name</span><span class="p">:</span> <span class="nb">str</span></span>)</span>

        
    </div>
    <a class="headerlink" href="#Identifier.__init__"></a>
    
    

                            </div>
                            <div id="Identifier.name" class="classattr">
                                <div class="attr variable">
            <span class="name">name</span><span class="annotation">: str</span>

        
    </div>
    <a class="headerlink" href="#Identifier.name"></a>
    
    

                            </div>
                            <div id="Identifier.validate" class="classattr">
                                        <input id="Identifier.validate-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">validate</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="Identifier.validate-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Identifier.validate"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Identifier.validate-130"><a href="#Identifier.validate-130"><span class="linenos">130</span></a>    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Identifier.validate-131"><a href="#Identifier.validate-131"><span class="linenos">131</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">identifier_re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">):</span>
</span><span id="Identifier.validate-132"><a href="#Identifier.validate-132"><span class="linenos">132</span></a>            <span class="k">raise</span> <span class="n">InvalidLambdaError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;`</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">` is not a valid identifier&quot;</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                </section>
                <section id="Join">
                            <input id="Join-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
                    <div class="decorator">@dataclass(frozen=True)</div>

    <span class="def">class</span>
    <span class="name">Join</span><wbr>(<span class="base">snuba_sdk.expressions.Expression</span>):

                <label class="view-source-button" for="Join-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Join"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Join-51"><a href="#Join-51"><span class="linenos">51</span></a><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Join-52"><a href="#Join-52"><span class="linenos">52</span></a><span class="k">class</span> <span class="nc">Join</span><span class="p">(</span><span class="n">Expression</span><span class="p">):</span>
</span><span id="Join-53"><a href="#Join-53"><span class="linenos">53</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Join-54"><a href="#Join-54"><span class="linenos">54</span></a><span class="sd">    A collection of relationships that is used in the MATCH section of</span>
</span><span id="Join-55"><a href="#Join-55"><span class="linenos">55</span></a><span class="sd">    the SnQL query. Must contain at least one Relationship, and will make</span>
</span><span id="Join-56"><a href="#Join-56"><span class="linenos">56</span></a><span class="sd">    sure that Entity aliases are not used by different Entities.</span>
</span><span id="Join-57"><a href="#Join-57"><span class="linenos">57</span></a>
</span><span id="Join-58"><a href="#Join-58"><span class="linenos">58</span></a><span class="sd">    :param relationships: The relationships in the join.</span>
</span><span id="Join-59"><a href="#Join-59"><span class="linenos">59</span></a><span class="sd">    :type name: Sequence[Relationship]</span>
</span><span id="Join-60"><a href="#Join-60"><span class="linenos">60</span></a>
</span><span id="Join-61"><a href="#Join-61"><span class="linenos">61</span></a><span class="sd">    :raises InvalidExpressionError: If two different Entities are using</span>
</span><span id="Join-62"><a href="#Join-62"><span class="linenos">62</span></a><span class="sd">        the same alias, this will be raised.</span>
</span><span id="Join-63"><a href="#Join-63"><span class="linenos">63</span></a>
</span><span id="Join-64"><a href="#Join-64"><span class="linenos">64</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="Join-65"><a href="#Join-65"><span class="linenos">65</span></a>
</span><span id="Join-66"><a href="#Join-66"><span class="linenos">66</span></a>    <span class="n">relationships</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Relationship</span><span class="p">]</span>
</span><span id="Join-67"><a href="#Join-67"><span class="linenos">67</span></a>
</span><span id="Join-68"><a href="#Join-68"><span class="linenos">68</span></a>    <span class="k">def</span> <span class="nf">get_alias_mappings</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">set</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]:</span>
</span><span id="Join-69"><a href="#Join-69"><span class="linenos">69</span></a>        <span class="n">aliases</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="Join-70"><a href="#Join-70"><span class="linenos">70</span></a>        <span class="k">for</span> <span class="n">rel</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">relationships</span><span class="p">:</span>
</span><span id="Join-71"><a href="#Join-71"><span class="linenos">71</span></a>            <span class="k">if</span> <span class="n">rel</span><span class="o">.</span><span class="n">lhs</span><span class="o">.</span><span class="n">alias</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Join-72"><a href="#Join-72"><span class="linenos">72</span></a>                <span class="n">aliases</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">rel</span><span class="o">.</span><span class="n">lhs</span><span class="o">.</span><span class="n">alias</span><span class="p">,</span> <span class="n">rel</span><span class="o">.</span><span class="n">lhs</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
</span><span id="Join-73"><a href="#Join-73"><span class="linenos">73</span></a>            <span class="k">if</span> <span class="n">rel</span><span class="o">.</span><span class="n">rhs</span><span class="o">.</span><span class="n">alias</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Join-74"><a href="#Join-74"><span class="linenos">74</span></a>                <span class="n">aliases</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">rel</span><span class="o">.</span><span class="n">rhs</span><span class="o">.</span><span class="n">alias</span><span class="p">,</span> <span class="n">rel</span><span class="o">.</span><span class="n">rhs</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
</span><span id="Join-75"><a href="#Join-75"><span class="linenos">75</span></a>
</span><span id="Join-76"><a href="#Join-76"><span class="linenos">76</span></a>        <span class="k">return</span> <span class="n">aliases</span>
</span><span id="Join-77"><a href="#Join-77"><span class="linenos">77</span></a>
</span><span id="Join-78"><a href="#Join-78"><span class="linenos">78</span></a>    <span class="k">def</span> <span class="nf">get_entities</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">set</span><span class="p">[</span><span class="n">Entity</span><span class="p">]:</span>
</span><span id="Join-79"><a href="#Join-79"><span class="linenos">79</span></a>        <span class="n">entities</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="Join-80"><a href="#Join-80"><span class="linenos">80</span></a>        <span class="k">for</span> <span class="n">rel</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">relationships</span><span class="p">:</span>
</span><span id="Join-81"><a href="#Join-81"><span class="linenos">81</span></a>            <span class="n">entities</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">rel</span><span class="o">.</span><span class="n">lhs</span><span class="p">)</span>
</span><span id="Join-82"><a href="#Join-82"><span class="linenos">82</span></a>            <span class="n">entities</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">rel</span><span class="o">.</span><span class="n">rhs</span><span class="p">)</span>
</span><span id="Join-83"><a href="#Join-83"><span class="linenos">83</span></a>        <span class="k">return</span> <span class="n">entities</span>
</span><span id="Join-84"><a href="#Join-84"><span class="linenos">84</span></a>
</span><span id="Join-85"><a href="#Join-85"><span class="linenos">85</span></a>    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Join-86"><a href="#Join-86"><span class="linenos">86</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">relationships</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">))</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">relationships</span><span class="p">:</span>
</span><span id="Join-87"><a href="#Join-87"><span class="linenos">87</span></a>            <span class="k">raise</span> <span class="n">InvalidExpressionError</span><span class="p">(</span><span class="s2">&quot;Join must have at least one Relationship&quot;</span><span class="p">)</span>
</span><span id="Join-88"><a href="#Join-88"><span class="linenos">88</span></a>        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">Relationship</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">relationships</span><span class="p">):</span>
</span><span id="Join-89"><a href="#Join-89"><span class="linenos">89</span></a>            <span class="k">raise</span> <span class="n">InvalidExpressionError</span><span class="p">(</span><span class="s2">&quot;Join expects a list of Relationship objects&quot;</span><span class="p">)</span>
</span><span id="Join-90"><a href="#Join-90"><span class="linenos">90</span></a>
</span><span id="Join-91"><a href="#Join-91"><span class="linenos">91</span></a>        <span class="n">seen</span><span class="p">:</span> <span class="n">MutableMapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Join-92"><a href="#Join-92"><span class="linenos">92</span></a>        <span class="k">for</span> <span class="n">alias</span><span class="p">,</span> <span class="n">entity</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_alias_mappings</span><span class="p">():</span>
</span><span id="Join-93"><a href="#Join-93"><span class="linenos">93</span></a>            <span class="k">if</span> <span class="n">alias</span> <span class="ow">in</span> <span class="n">seen</span> <span class="ow">and</span> <span class="n">seen</span><span class="p">[</span><span class="n">alias</span><span class="p">]</span> <span class="o">!=</span> <span class="n">entity</span><span class="p">:</span>
</span><span id="Join-94"><a href="#Join-94"><span class="linenos">94</span></a>                <span class="n">entities</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">([</span><span class="n">entity</span><span class="p">,</span> <span class="n">seen</span><span class="p">[</span><span class="n">alias</span><span class="p">]])</span>
</span><span id="Join-95"><a href="#Join-95"><span class="linenos">95</span></a>                <span class="k">raise</span> <span class="n">InvalidExpressionError</span><span class="p">(</span>
</span><span id="Join-96"><a href="#Join-96"><span class="linenos">96</span></a>                    <span class="sa">f</span><span class="s2">&quot;alias &#39;</span><span class="si">{</span><span class="n">alias</span><span class="si">}</span><span class="s2">&#39; is duplicated for entities </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">entities</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Join-97"><a href="#Join-97"><span class="linenos">97</span></a>                <span class="p">)</span>
</span><span id="Join-98"><a href="#Join-98"><span class="linenos">98</span></a>            <span class="n">seen</span><span class="p">[</span><span class="n">alias</span><span class="p">]</span> <span class="o">=</span> <span class="n">entity</span>
</span></pre></div>


            <div class="docstring"><p>A collection of relationships that is used in the MATCH section of
the SnQL query. Must contain at least one Relationship, and will make
sure that Entity aliases are not used by different Entities.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>relationships</strong>:  The relationships in the join.</li>
</ul>

<h6 id="raises">Raises</h6>

<ul>
<li><strong>InvalidExpressionError</strong>:  If two different Entities are using
the same alias, this will be raised.</li>
</ul>
</div>


                            <div id="Join.__init__" class="classattr">
                                <div class="attr function">
            
        <span class="name">Join</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">relationships</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n"><a href="#Relationship">Relationship</a></span><span class="p">]</span></span>)</span>

        
    </div>
    <a class="headerlink" href="#Join.__init__"></a>
    
    

                            </div>
                            <div id="Join.relationships" class="classattr">
                                <div class="attr variable">
            <span class="name">relationships</span><span class="annotation">: Sequence[<a href="#Relationship">Relationship</a>]</span>

        
    </div>
    <a class="headerlink" href="#Join.relationships"></a>
    
    

                            </div>
                            <div id="Join.get_alias_mappings" class="classattr">
                                        <input id="Join.get_alias_mappings-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_alias_mappings</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">set</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span>:</span></span>

                <label class="view-source-button" for="Join.get_alias_mappings-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Join.get_alias_mappings"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Join.get_alias_mappings-68"><a href="#Join.get_alias_mappings-68"><span class="linenos">68</span></a>    <span class="k">def</span> <span class="nf">get_alias_mappings</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">set</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]:</span>
</span><span id="Join.get_alias_mappings-69"><a href="#Join.get_alias_mappings-69"><span class="linenos">69</span></a>        <span class="n">aliases</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="Join.get_alias_mappings-70"><a href="#Join.get_alias_mappings-70"><span class="linenos">70</span></a>        <span class="k">for</span> <span class="n">rel</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">relationships</span><span class="p">:</span>
</span><span id="Join.get_alias_mappings-71"><a href="#Join.get_alias_mappings-71"><span class="linenos">71</span></a>            <span class="k">if</span> <span class="n">rel</span><span class="o">.</span><span class="n">lhs</span><span class="o">.</span><span class="n">alias</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Join.get_alias_mappings-72"><a href="#Join.get_alias_mappings-72"><span class="linenos">72</span></a>                <span class="n">aliases</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">rel</span><span class="o">.</span><span class="n">lhs</span><span class="o">.</span><span class="n">alias</span><span class="p">,</span> <span class="n">rel</span><span class="o">.</span><span class="n">lhs</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
</span><span id="Join.get_alias_mappings-73"><a href="#Join.get_alias_mappings-73"><span class="linenos">73</span></a>            <span class="k">if</span> <span class="n">rel</span><span class="o">.</span><span class="n">rhs</span><span class="o">.</span><span class="n">alias</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Join.get_alias_mappings-74"><a href="#Join.get_alias_mappings-74"><span class="linenos">74</span></a>                <span class="n">aliases</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">rel</span><span class="o">.</span><span class="n">rhs</span><span class="o">.</span><span class="n">alias</span><span class="p">,</span> <span class="n">rel</span><span class="o">.</span><span class="n">rhs</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
</span><span id="Join.get_alias_mappings-75"><a href="#Join.get_alias_mappings-75"><span class="linenos">75</span></a>
</span><span id="Join.get_alias_mappings-76"><a href="#Join.get_alias_mappings-76"><span class="linenos">76</span></a>        <span class="k">return</span> <span class="n">aliases</span>
</span></pre></div>


    

                            </div>
                            <div id="Join.get_entities" class="classattr">
                                        <input id="Join.get_entities-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_entities</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">set</span><span class="p">[</span><span class="n"><a href="#Entity">Entity</a></span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="Join.get_entities-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Join.get_entities"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Join.get_entities-78"><a href="#Join.get_entities-78"><span class="linenos">78</span></a>    <span class="k">def</span> <span class="nf">get_entities</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">set</span><span class="p">[</span><span class="n">Entity</span><span class="p">]:</span>
</span><span id="Join.get_entities-79"><a href="#Join.get_entities-79"><span class="linenos">79</span></a>        <span class="n">entities</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="Join.get_entities-80"><a href="#Join.get_entities-80"><span class="linenos">80</span></a>        <span class="k">for</span> <span class="n">rel</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">relationships</span><span class="p">:</span>
</span><span id="Join.get_entities-81"><a href="#Join.get_entities-81"><span class="linenos">81</span></a>            <span class="n">entities</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">rel</span><span class="o">.</span><span class="n">lhs</span><span class="p">)</span>
</span><span id="Join.get_entities-82"><a href="#Join.get_entities-82"><span class="linenos">82</span></a>            <span class="n">entities</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">rel</span><span class="o">.</span><span class="n">rhs</span><span class="p">)</span>
</span><span id="Join.get_entities-83"><a href="#Join.get_entities-83"><span class="linenos">83</span></a>        <span class="k">return</span> <span class="n">entities</span>
</span></pre></div>


    

                            </div>
                            <div id="Join.validate" class="classattr">
                                        <input id="Join.validate-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">validate</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="Join.validate-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Join.validate"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Join.validate-85"><a href="#Join.validate-85"><span class="linenos">85</span></a>    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Join.validate-86"><a href="#Join.validate-86"><span class="linenos">86</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">relationships</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">))</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">relationships</span><span class="p">:</span>
</span><span id="Join.validate-87"><a href="#Join.validate-87"><span class="linenos">87</span></a>            <span class="k">raise</span> <span class="n">InvalidExpressionError</span><span class="p">(</span><span class="s2">&quot;Join must have at least one Relationship&quot;</span><span class="p">)</span>
</span><span id="Join.validate-88"><a href="#Join.validate-88"><span class="linenos">88</span></a>        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">Relationship</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">relationships</span><span class="p">):</span>
</span><span id="Join.validate-89"><a href="#Join.validate-89"><span class="linenos">89</span></a>            <span class="k">raise</span> <span class="n">InvalidExpressionError</span><span class="p">(</span><span class="s2">&quot;Join expects a list of Relationship objects&quot;</span><span class="p">)</span>
</span><span id="Join.validate-90"><a href="#Join.validate-90"><span class="linenos">90</span></a>
</span><span id="Join.validate-91"><a href="#Join.validate-91"><span class="linenos">91</span></a>        <span class="n">seen</span><span class="p">:</span> <span class="n">MutableMapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Join.validate-92"><a href="#Join.validate-92"><span class="linenos">92</span></a>        <span class="k">for</span> <span class="n">alias</span><span class="p">,</span> <span class="n">entity</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_alias_mappings</span><span class="p">():</span>
</span><span id="Join.validate-93"><a href="#Join.validate-93"><span class="linenos">93</span></a>            <span class="k">if</span> <span class="n">alias</span> <span class="ow">in</span> <span class="n">seen</span> <span class="ow">and</span> <span class="n">seen</span><span class="p">[</span><span class="n">alias</span><span class="p">]</span> <span class="o">!=</span> <span class="n">entity</span><span class="p">:</span>
</span><span id="Join.validate-94"><a href="#Join.validate-94"><span class="linenos">94</span></a>                <span class="n">entities</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">([</span><span class="n">entity</span><span class="p">,</span> <span class="n">seen</span><span class="p">[</span><span class="n">alias</span><span class="p">]])</span>
</span><span id="Join.validate-95"><a href="#Join.validate-95"><span class="linenos">95</span></a>                <span class="k">raise</span> <span class="n">InvalidExpressionError</span><span class="p">(</span>
</span><span id="Join.validate-96"><a href="#Join.validate-96"><span class="linenos">96</span></a>                    <span class="sa">f</span><span class="s2">&quot;alias &#39;</span><span class="si">{</span><span class="n">alias</span><span class="si">}</span><span class="s2">&#39; is duplicated for entities </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">entities</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Join.validate-97"><a href="#Join.validate-97"><span class="linenos">97</span></a>                <span class="p">)</span>
</span><span id="Join.validate-98"><a href="#Join.validate-98"><span class="linenos">98</span></a>            <span class="n">seen</span><span class="p">[</span><span class="n">alias</span><span class="p">]</span> <span class="o">=</span> <span class="n">entity</span>
</span></pre></div>


    

                            </div>
                </section>
                <section id="Lambda">
                            <input id="Lambda-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
                    <div class="decorator">@dataclass(frozen=True)</div>

    <span class="def">class</span>
    <span class="name">Lambda</span><wbr>(<span class="base">snuba_sdk.expressions.Expression</span>):

                <label class="view-source-button" for="Lambda-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Lambda"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Lambda-135"><a href="#Lambda-135"><span class="linenos">135</span></a><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Lambda-136"><a href="#Lambda-136"><span class="linenos">136</span></a><span class="k">class</span> <span class="nc">Lambda</span><span class="p">(</span><span class="n">Expression</span><span class="p">):</span>
</span><span id="Lambda-137"><a href="#Lambda-137"><span class="linenos">137</span></a>    <span class="n">identifiers</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
</span><span id="Lambda-138"><a href="#Lambda-138"><span class="linenos">138</span></a>    <span class="n">transformation</span><span class="p">:</span> <span class="n">CurriedFunction</span>
</span><span id="Lambda-139"><a href="#Lambda-139"><span class="linenos">139</span></a>
</span><span id="Lambda-140"><a href="#Lambda-140"><span class="linenos">140</span></a>    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Lambda-141"><a href="#Lambda-141"><span class="linenos">141</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">identifiers</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
</span><span id="Lambda-142"><a href="#Lambda-142"><span class="linenos">142</span></a>            <span class="k">raise</span> <span class="n">InvalidLambdaError</span><span class="p">(</span><span class="s2">&quot;identifiers must be a sequence&quot;</span><span class="p">)</span>
</span><span id="Lambda-143"><a href="#Lambda-143"><span class="linenos">143</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">identifiers</span><span class="p">:</span>
</span><span id="Lambda-144"><a href="#Lambda-144"><span class="linenos">144</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">identifier_re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
</span><span id="Lambda-145"><a href="#Lambda-145"><span class="linenos">145</span></a>                <span class="k">raise</span> <span class="n">InvalidLambdaError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2"> is not a valid identifier&quot;</span><span class="p">)</span>
</span><span id="Lambda-146"><a href="#Lambda-146"><span class="linenos">146</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">transformation</span><span class="p">,</span> <span class="n">CurriedFunction</span><span class="p">):</span>
</span><span id="Lambda-147"><a href="#Lambda-147"><span class="linenos">147</span></a>            <span class="k">raise</span> <span class="n">InvalidLambdaError</span><span class="p">(</span><span class="s2">&quot;transformation must be a function&quot;</span><span class="p">)</span>
</span></pre></div>


    

                            <div id="Lambda.__init__" class="classattr">
                                <div class="attr function">
            
        <span class="name">Lambda</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">identifiers</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>,</span><span class="param">	<span class="n">transformation</span><span class="p">:</span> <span class="n"><a href="#CurriedFunction">CurriedFunction</a></span></span>)</span>

        
    </div>
    <a class="headerlink" href="#Lambda.__init__"></a>
    
    

                            </div>
                            <div id="Lambda.identifiers" class="classattr">
                                <div class="attr variable">
            <span class="name">identifiers</span><span class="annotation">: Sequence[str]</span>

        
    </div>
    <a class="headerlink" href="#Lambda.identifiers"></a>
    
    

                            </div>
                            <div id="Lambda.transformation" class="classattr">
                                <div class="attr variable">
            <span class="name">transformation</span><span class="annotation">: <a href="#CurriedFunction">CurriedFunction</a></span>

        
    </div>
    <a class="headerlink" href="#Lambda.transformation"></a>
    
    

                            </div>
                            <div id="Lambda.validate" class="classattr">
                                        <input id="Lambda.validate-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">validate</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="Lambda.validate-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Lambda.validate"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Lambda.validate-140"><a href="#Lambda.validate-140"><span class="linenos">140</span></a>    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Lambda.validate-141"><a href="#Lambda.validate-141"><span class="linenos">141</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">identifiers</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
</span><span id="Lambda.validate-142"><a href="#Lambda.validate-142"><span class="linenos">142</span></a>            <span class="k">raise</span> <span class="n">InvalidLambdaError</span><span class="p">(</span><span class="s2">&quot;identifiers must be a sequence&quot;</span><span class="p">)</span>
</span><span id="Lambda.validate-143"><a href="#Lambda.validate-143"><span class="linenos">143</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">identifiers</span><span class="p">:</span>
</span><span id="Lambda.validate-144"><a href="#Lambda.validate-144"><span class="linenos">144</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">identifier_re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
</span><span id="Lambda.validate-145"><a href="#Lambda.validate-145"><span class="linenos">145</span></a>                <span class="k">raise</span> <span class="n">InvalidLambdaError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2"> is not a valid identifier&quot;</span><span class="p">)</span>
</span><span id="Lambda.validate-146"><a href="#Lambda.validate-146"><span class="linenos">146</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">transformation</span><span class="p">,</span> <span class="n">CurriedFunction</span><span class="p">):</span>
</span><span id="Lambda.validate-147"><a href="#Lambda.validate-147"><span class="linenos">147</span></a>            <span class="k">raise</span> <span class="n">InvalidLambdaError</span><span class="p">(</span><span class="s2">&quot;transformation must be a function&quot;</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                </section>
                <section id="Limit">
                            <input id="Limit-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
                    <div class="decorator">@dataclass(frozen=True)</div>

    <span class="def">class</span>
    <span class="name">Limit</span><wbr>(<span class="base">snuba_sdk.expressions.Expression</span>):

                <label class="view-source-button" for="Limit-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Limit"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Limit-91"><a href="#Limit-91"><span class="linenos">91</span></a><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Limit-92"><a href="#Limit-92"><span class="linenos">92</span></a><span class="k">class</span> <span class="nc">Limit</span><span class="p">(</span><span class="n">Expression</span><span class="p">):</span>
</span><span id="Limit-93"><a href="#Limit-93"><span class="linenos">93</span></a>    <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span>
</span><span id="Limit-94"><a href="#Limit-94"><span class="linenos">94</span></a>
</span><span id="Limit-95"><a href="#Limit-95"><span class="linenos">95</span></a>    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Limit-96"><a href="#Limit-96"><span class="linenos">96</span></a>        <span class="n">_validate_int_literal</span><span class="p">(</span><span class="s2">&quot;limit&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">limit</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10000</span><span class="p">)</span>
</span></pre></div>


    

                            <div id="Limit.__init__" class="classattr">
                                <div class="attr function">
            
        <span class="name">Limit</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">limit</span><span class="p">:</span> <span class="nb">int</span></span>)</span>

        
    </div>
    <a class="headerlink" href="#Limit.__init__"></a>
    
    

                            </div>
                            <div id="Limit.limit" class="classattr">
                                <div class="attr variable">
            <span class="name">limit</span><span class="annotation">: int</span>

        
    </div>
    <a class="headerlink" href="#Limit.limit"></a>
    
    

                            </div>
                            <div id="Limit.validate" class="classattr">
                                        <input id="Limit.validate-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">validate</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="Limit.validate-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Limit.validate"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Limit.validate-95"><a href="#Limit.validate-95"><span class="linenos">95</span></a>    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Limit.validate-96"><a href="#Limit.validate-96"><span class="linenos">96</span></a>        <span class="n">_validate_int_literal</span><span class="p">(</span><span class="s2">&quot;limit&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">limit</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10000</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                </section>
                <section id="LimitBy">
                            <input id="LimitBy-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
                    <div class="decorator">@dataclass(frozen=True)</div>

    <span class="def">class</span>
    <span class="name">LimitBy</span><wbr>(<span class="base">snuba_sdk.expressions.Expression</span>):

                <label class="view-source-button" for="LimitBy-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LimitBy"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LimitBy-46"><a href="#LimitBy-46"><span class="linenos">46</span></a><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="LimitBy-47"><a href="#LimitBy-47"><span class="linenos">47</span></a><span class="k">class</span> <span class="nc">LimitBy</span><span class="p">(</span><span class="n">Expression</span><span class="p">):</span>
</span><span id="LimitBy-48"><a href="#LimitBy-48"><span class="linenos">48</span></a>    <span class="n">columns</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Column</span><span class="p">]</span>
</span><span id="LimitBy-49"><a href="#LimitBy-49"><span class="linenos">49</span></a>    <span class="n">count</span><span class="p">:</span> <span class="nb">int</span>
</span><span id="LimitBy-50"><a href="#LimitBy-50"><span class="linenos">50</span></a>
</span><span id="LimitBy-51"><a href="#LimitBy-51"><span class="linenos">51</span></a>    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LimitBy-52"><a href="#LimitBy-52"><span class="linenos">52</span></a>        <span class="n">validate_sequence_of_type</span><span class="p">(</span><span class="s2">&quot;LimitBy columns&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">Column</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="LimitBy-53"><a href="#LimitBy-53"><span class="linenos">53</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">count</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">&gt;</span> <span class="mi">10000</span><span class="p">:</span>
</span><span id="LimitBy-54"><a href="#LimitBy-54"><span class="linenos">54</span></a>            <span class="k">raise</span> <span class="n">InvalidExpressionError</span><span class="p">(</span>
</span><span id="LimitBy-55"><a href="#LimitBy-55"><span class="linenos">55</span></a>                <span class="s2">&quot;LimitBy count must be a positive integer (max 10,000)&quot;</span>
</span><span id="LimitBy-56"><a href="#LimitBy-56"><span class="linenos">56</span></a>            <span class="p">)</span>
</span></pre></div>


    

                            <div id="LimitBy.__init__" class="classattr">
                                <div class="attr function">
            
        <span class="name">LimitBy</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">columns</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n"><a href="#Column">Column</a></span><span class="p">]</span>, </span><span class="param"><span class="n">count</span><span class="p">:</span> <span class="nb">int</span></span>)</span>

        
    </div>
    <a class="headerlink" href="#LimitBy.__init__"></a>
    
    

                            </div>
                            <div id="LimitBy.columns" class="classattr">
                                <div class="attr variable">
            <span class="name">columns</span><span class="annotation">: Sequence[<a href="#Column">Column</a>]</span>

        
    </div>
    <a class="headerlink" href="#LimitBy.columns"></a>
    
    

                            </div>
                            <div id="LimitBy.count" class="classattr">
                                <div class="attr variable">
            <span class="name">count</span><span class="annotation">: int</span>

        
    </div>
    <a class="headerlink" href="#LimitBy.count"></a>
    
    

                            </div>
                            <div id="LimitBy.validate" class="classattr">
                                        <input id="LimitBy.validate-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">validate</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="LimitBy.validate-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LimitBy.validate"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LimitBy.validate-51"><a href="#LimitBy.validate-51"><span class="linenos">51</span></a>    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LimitBy.validate-52"><a href="#LimitBy.validate-52"><span class="linenos">52</span></a>        <span class="n">validate_sequence_of_type</span><span class="p">(</span><span class="s2">&quot;LimitBy columns&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">Column</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="LimitBy.validate-53"><a href="#LimitBy.validate-53"><span class="linenos">53</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">count</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">&gt;</span> <span class="mi">10000</span><span class="p">:</span>
</span><span id="LimitBy.validate-54"><a href="#LimitBy.validate-54"><span class="linenos">54</span></a>            <span class="k">raise</span> <span class="n">InvalidExpressionError</span><span class="p">(</span>
</span><span id="LimitBy.validate-55"><a href="#LimitBy.validate-55"><span class="linenos">55</span></a>                <span class="s2">&quot;LimitBy count must be a positive integer (max 10,000)&quot;</span>
</span><span id="LimitBy.validate-56"><a href="#LimitBy.validate-56"><span class="linenos">56</span></a>            <span class="p">)</span>
</span></pre></div>


    

                            </div>
                </section>
                <section id="Metric">
                            <input id="Metric-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
                    <div class="decorator">@dataclass(frozen=True)</div>

    <span class="def">class</span>
    <span class="name">Metric</span>:

                <label class="view-source-button" for="Metric-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Metric"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Metric-23"><a href="#Metric-23"><span class="linenos">23</span></a><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Metric-24"><a href="#Metric-24"><span class="linenos">24</span></a><span class="k">class</span> <span class="nc">Metric</span><span class="p">:</span>
</span><span id="Metric-25"><a href="#Metric-25"><span class="linenos">25</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Metric-26"><a href="#Metric-26"><span class="linenos">26</span></a><span class="sd">    Metric represents a raw metric that is being populated. It can be created with</span>
</span><span id="Metric-27"><a href="#Metric-27"><span class="linenos">27</span></a><span class="sd">    one of public name, mri or raw ID.</span>
</span><span id="Metric-28"><a href="#Metric-28"><span class="linenos">28</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="Metric-29"><a href="#Metric-29"><span class="linenos">29</span></a>
</span><span id="Metric-30"><a href="#Metric-30"><span class="linenos">30</span></a>    <span class="n">public_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Metric-31"><a href="#Metric-31"><span class="linenos">31</span></a>    <span class="n">mri</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Metric-32"><a href="#Metric-32"><span class="linenos">32</span></a>    <span class="nb">id</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Metric-33"><a href="#Metric-33"><span class="linenos">33</span></a>
</span><span id="Metric-34"><a href="#Metric-34"><span class="linenos">34</span></a>    <span class="k">def</span> <span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Metric-35"><a href="#Metric-35"><span class="linenos">35</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">validate</span><span class="p">()</span>
</span><span id="Metric-36"><a href="#Metric-36"><span class="linenos">36</span></a>
</span><span id="Metric-37"><a href="#Metric-37"><span class="linenos">37</span></a>    <span class="k">def</span> <span class="nf">get_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="Metric-38"><a href="#Metric-38"><span class="linenos">38</span></a>        <span class="n">self_fields</span> <span class="o">=</span> <span class="n">fields</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>  <span class="c1"># Verified the order in the Python source</span>
</span><span id="Metric-39"><a href="#Metric-39"><span class="linenos">39</span></a>        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">self_fields</span><span class="p">)</span>
</span><span id="Metric-40"><a href="#Metric-40"><span class="linenos">40</span></a>
</span><span id="Metric-41"><a href="#Metric-41"><span class="linenos">41</span></a>    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Metric-42"><a href="#Metric-42"><span class="linenos">42</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">public_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">public_name</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="Metric-43"><a href="#Metric-43"><span class="linenos">43</span></a>            <span class="k">raise</span> <span class="n">InvalidTimeseriesError</span><span class="p">(</span><span class="s2">&quot;public_name must be a string&quot;</span><span class="p">)</span>
</span><span id="Metric-44"><a href="#Metric-44"><span class="linenos">44</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mri</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mri</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="Metric-45"><a href="#Metric-45"><span class="linenos">45</span></a>            <span class="k">raise</span> <span class="n">InvalidTimeseriesError</span><span class="p">(</span><span class="s2">&quot;mri must be a string&quot;</span><span class="p">)</span>
</span><span id="Metric-46"><a href="#Metric-46"><span class="linenos">46</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="Metric-47"><a href="#Metric-47"><span class="linenos">47</span></a>            <span class="k">raise</span> <span class="n">InvalidTimeseriesError</span><span class="p">(</span><span class="s2">&quot;id must be an integer&quot;</span><span class="p">)</span>
</span><span id="Metric-48"><a href="#Metric-48"><span class="linenos">48</span></a>
</span><span id="Metric-49"><a href="#Metric-49"><span class="linenos">49</span></a>        <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">v</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">public_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mri</span><span class="p">)):</span>
</span><span id="Metric-50"><a href="#Metric-50"><span class="linenos">50</span></a>            <span class="k">raise</span> <span class="n">InvalidTimeseriesError</span><span class="p">(</span>
</span><span id="Metric-51"><a href="#Metric-51"><span class="linenos">51</span></a>                <span class="s2">&quot;Metric must have at least one of public_name or mri&quot;</span>
</span><span id="Metric-52"><a href="#Metric-52"><span class="linenos">52</span></a>            <span class="p">)</span>
</span><span id="Metric-53"><a href="#Metric-53"><span class="linenos">53</span></a>
</span><span id="Metric-54"><a href="#Metric-54"><span class="linenos">54</span></a>    <span class="k">def</span> <span class="nf">set_mri</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mri</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Metric</span><span class="p">:</span>
</span><span id="Metric-55"><a href="#Metric-55"><span class="linenos">55</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mri</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="Metric-56"><a href="#Metric-56"><span class="linenos">56</span></a>            <span class="k">raise</span> <span class="n">InvalidExpressionError</span><span class="p">(</span><span class="s2">&quot;mri must be an str&quot;</span><span class="p">)</span>
</span><span id="Metric-57"><a href="#Metric-57"><span class="linenos">57</span></a>        <span class="k">return</span> <span class="n">replace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mri</span><span class="o">=</span><span class="n">mri</span><span class="p">)</span>
</span><span id="Metric-58"><a href="#Metric-58"><span class="linenos">58</span></a>
</span><span id="Metric-59"><a href="#Metric-59"><span class="linenos">59</span></a>    <span class="k">def</span> <span class="nf">set_public_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">public_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Metric</span><span class="p">:</span>
</span><span id="Metric-60"><a href="#Metric-60"><span class="linenos">60</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">public_name</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="Metric-61"><a href="#Metric-61"><span class="linenos">61</span></a>            <span class="k">raise</span> <span class="n">InvalidExpressionError</span><span class="p">(</span><span class="s2">&quot;public_name must be an str&quot;</span><span class="p">)</span>
</span><span id="Metric-62"><a href="#Metric-62"><span class="linenos">62</span></a>        <span class="k">return</span> <span class="n">replace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">public_name</span><span class="o">=</span><span class="n">public_name</span><span class="p">)</span>
</span><span id="Metric-63"><a href="#Metric-63"><span class="linenos">63</span></a>
</span><span id="Metric-64"><a href="#Metric-64"><span class="linenos">64</span></a>    <span class="k">def</span> <span class="nf">set_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Metric</span><span class="p">:</span>
</span><span id="Metric-65"><a href="#Metric-65"><span class="linenos">65</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="Metric-66"><a href="#Metric-66"><span class="linenos">66</span></a>            <span class="k">raise</span> <span class="n">InvalidExpressionError</span><span class="p">(</span><span class="s2">&quot;id must be an int&quot;</span><span class="p">)</span>
</span><span id="Metric-67"><a href="#Metric-67"><span class="linenos">67</span></a>        <span class="k">return</span> <span class="n">replace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="nb">id</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Metric represents a raw metric that is being populated. It can be created with
one of public name, mri or raw ID.</p>
</div>


                            <div id="Metric.__init__" class="classattr">
                                <div class="attr function">
            
        <span class="name">Metric</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">public_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">mri</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="nb">id</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></span>)</span>

        
    </div>
    <a class="headerlink" href="#Metric.__init__"></a>
    
    

                            </div>
                            <div id="Metric.public_name" class="classattr">
                                <div class="attr variable">
            <span class="name">public_name</span><span class="annotation">: str | None</span>        =
<span class="default_value">None</span>

        
    </div>
    <a class="headerlink" href="#Metric.public_name"></a>
    
    

                            </div>
                            <div id="Metric.mri" class="classattr">
                                <div class="attr variable">
            <span class="name">mri</span><span class="annotation">: str | None</span>        =
<span class="default_value">None</span>

        
    </div>
    <a class="headerlink" href="#Metric.mri"></a>
    
    

                            </div>
                            <div id="Metric.id" class="classattr">
                                <div class="attr variable">
            <span class="name">id</span><span class="annotation">: int | None</span>        =
<span class="default_value">None</span>

        
    </div>
    <a class="headerlink" href="#Metric.id"></a>
    
    

                            </div>
                            <div id="Metric.get_fields" class="classattr">
                                        <input id="Metric.get_fields-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_fields</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="Metric.get_fields-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Metric.get_fields"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Metric.get_fields-37"><a href="#Metric.get_fields-37"><span class="linenos">37</span></a>    <span class="k">def</span> <span class="nf">get_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="Metric.get_fields-38"><a href="#Metric.get_fields-38"><span class="linenos">38</span></a>        <span class="n">self_fields</span> <span class="o">=</span> <span class="n">fields</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>  <span class="c1"># Verified the order in the Python source</span>
</span><span id="Metric.get_fields-39"><a href="#Metric.get_fields-39"><span class="linenos">39</span></a>        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">self_fields</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="Metric.validate" class="classattr">
                                        <input id="Metric.validate-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">validate</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="Metric.validate-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Metric.validate"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Metric.validate-41"><a href="#Metric.validate-41"><span class="linenos">41</span></a>    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Metric.validate-42"><a href="#Metric.validate-42"><span class="linenos">42</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">public_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">public_name</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="Metric.validate-43"><a href="#Metric.validate-43"><span class="linenos">43</span></a>            <span class="k">raise</span> <span class="n">InvalidTimeseriesError</span><span class="p">(</span><span class="s2">&quot;public_name must be a string&quot;</span><span class="p">)</span>
</span><span id="Metric.validate-44"><a href="#Metric.validate-44"><span class="linenos">44</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mri</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mri</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="Metric.validate-45"><a href="#Metric.validate-45"><span class="linenos">45</span></a>            <span class="k">raise</span> <span class="n">InvalidTimeseriesError</span><span class="p">(</span><span class="s2">&quot;mri must be a string&quot;</span><span class="p">)</span>
</span><span id="Metric.validate-46"><a href="#Metric.validate-46"><span class="linenos">46</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="Metric.validate-47"><a href="#Metric.validate-47"><span class="linenos">47</span></a>            <span class="k">raise</span> <span class="n">InvalidTimeseriesError</span><span class="p">(</span><span class="s2">&quot;id must be an integer&quot;</span><span class="p">)</span>
</span><span id="Metric.validate-48"><a href="#Metric.validate-48"><span class="linenos">48</span></a>
</span><span id="Metric.validate-49"><a href="#Metric.validate-49"><span class="linenos">49</span></a>        <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">v</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">public_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mri</span><span class="p">)):</span>
</span><span id="Metric.validate-50"><a href="#Metric.validate-50"><span class="linenos">50</span></a>            <span class="k">raise</span> <span class="n">InvalidTimeseriesError</span><span class="p">(</span>
</span><span id="Metric.validate-51"><a href="#Metric.validate-51"><span class="linenos">51</span></a>                <span class="s2">&quot;Metric must have at least one of public_name or mri&quot;</span>
</span><span id="Metric.validate-52"><a href="#Metric.validate-52"><span class="linenos">52</span></a>            <span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="Metric.set_mri" class="classattr">
                                        <input id="Metric.set_mri-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_mri</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">mri</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="n"><a href="#Metric">Metric</a></span>:</span></span>

                <label class="view-source-button" for="Metric.set_mri-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Metric.set_mri"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Metric.set_mri-54"><a href="#Metric.set_mri-54"><span class="linenos">54</span></a>    <span class="k">def</span> <span class="nf">set_mri</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mri</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Metric</span><span class="p">:</span>
</span><span id="Metric.set_mri-55"><a href="#Metric.set_mri-55"><span class="linenos">55</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mri</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="Metric.set_mri-56"><a href="#Metric.set_mri-56"><span class="linenos">56</span></a>            <span class="k">raise</span> <span class="n">InvalidExpressionError</span><span class="p">(</span><span class="s2">&quot;mri must be an str&quot;</span><span class="p">)</span>
</span><span id="Metric.set_mri-57"><a href="#Metric.set_mri-57"><span class="linenos">57</span></a>        <span class="k">return</span> <span class="n">replace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mri</span><span class="o">=</span><span class="n">mri</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="Metric.set_public_name" class="classattr">
                                        <input id="Metric.set_public_name-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_public_name</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">public_name</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="n"><a href="#Metric">Metric</a></span>:</span></span>

                <label class="view-source-button" for="Metric.set_public_name-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Metric.set_public_name"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Metric.set_public_name-59"><a href="#Metric.set_public_name-59"><span class="linenos">59</span></a>    <span class="k">def</span> <span class="nf">set_public_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">public_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Metric</span><span class="p">:</span>
</span><span id="Metric.set_public_name-60"><a href="#Metric.set_public_name-60"><span class="linenos">60</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">public_name</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="Metric.set_public_name-61"><a href="#Metric.set_public_name-61"><span class="linenos">61</span></a>            <span class="k">raise</span> <span class="n">InvalidExpressionError</span><span class="p">(</span><span class="s2">&quot;public_name must be an str&quot;</span><span class="p">)</span>
</span><span id="Metric.set_public_name-62"><a href="#Metric.set_public_name-62"><span class="linenos">62</span></a>        <span class="k">return</span> <span class="n">replace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">public_name</span><span class="o">=</span><span class="n">public_name</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="Metric.set_id" class="classattr">
                                        <input id="Metric.set_id-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_id</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="nb">id</span><span class="p">:</span> <span class="nb">int</span></span><span class="return-annotation">) -> <span class="n"><a href="#Metric">Metric</a></span>:</span></span>

                <label class="view-source-button" for="Metric.set_id-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Metric.set_id"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Metric.set_id-64"><a href="#Metric.set_id-64"><span class="linenos">64</span></a>    <span class="k">def</span> <span class="nf">set_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Metric</span><span class="p">:</span>
</span><span id="Metric.set_id-65"><a href="#Metric.set_id-65"><span class="linenos">65</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="Metric.set_id-66"><a href="#Metric.set_id-66"><span class="linenos">66</span></a>            <span class="k">raise</span> <span class="n">InvalidExpressionError</span><span class="p">(</span><span class="s2">&quot;id must be an int&quot;</span><span class="p">)</span>
</span><span id="Metric.set_id-67"><a href="#Metric.set_id-67"><span class="linenos">67</span></a>        <span class="k">return</span> <span class="n">replace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="nb">id</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                </section>
                <section id="MetricsQuery">
                            <input id="MetricsQuery-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
                    <div class="decorator">@dataclass</div>

    <span class="def">class</span>
    <span class="name">MetricsQuery</span><wbr>(<span class="base">snuba_sdk.query.BaseQuery</span>):

                <label class="view-source-button" for="MetricsQuery-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MetricsQuery"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MetricsQuery-19"><a href="#MetricsQuery-19"><span class="linenos"> 19</span></a><span class="nd">@dataclass</span>
</span><span id="MetricsQuery-20"><a href="#MetricsQuery-20"><span class="linenos"> 20</span></a><span class="k">class</span> <span class="nc">MetricsQuery</span><span class="p">(</span><span class="n">BaseQuery</span><span class="p">):</span>
</span><span id="MetricsQuery-21"><a href="#MetricsQuery-21"><span class="linenos"> 21</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MetricsQuery-22"><a href="#MetricsQuery-22"><span class="linenos"> 22</span></a><span class="sd">    A query on a set of timeseries. This class gets translated into a Snuba request string</span>
</span><span id="MetricsQuery-23"><a href="#MetricsQuery-23"><span class="linenos"> 23</span></a><span class="sd">    that returns a list of timeseries data. In order to allow this class to be built incrementally,</span>
</span><span id="MetricsQuery-24"><a href="#MetricsQuery-24"><span class="linenos"> 24</span></a><span class="sd">    it is not validated until it is serialized. Any specified filters or groupby fields are pushed</span>
</span><span id="MetricsQuery-25"><a href="#MetricsQuery-25"><span class="linenos"> 25</span></a><span class="sd">    down to each of the Timeseries in the query field. It is immutable, so any set functions return</span>
</span><span id="MetricsQuery-26"><a href="#MetricsQuery-26"><span class="linenos"> 26</span></a><span class="sd">    a new copy of the query, which also allows chaining calls.</span>
</span><span id="MetricsQuery-27"><a href="#MetricsQuery-27"><span class="linenos"> 27</span></a>
</span><span id="MetricsQuery-28"><a href="#MetricsQuery-28"><span class="linenos"> 28</span></a><span class="sd">    This class is distinct from the Query class to allow for more specific validation and to provide</span>
</span><span id="MetricsQuery-29"><a href="#MetricsQuery-29"><span class="linenos"> 29</span></a><span class="sd">    a simpler syntax for writing timeseries queries, which have fewer available features.</span>
</span><span id="MetricsQuery-30"><a href="#MetricsQuery-30"><span class="linenos"> 30</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="MetricsQuery-31"><a href="#MetricsQuery-31"><span class="linenos"> 31</span></a>
</span><span id="MetricsQuery-32"><a href="#MetricsQuery-32"><span class="linenos"> 32</span></a>    <span class="n">query</span><span class="p">:</span> <span class="n">Timeseries</span> <span class="o">|</span> <span class="n">Formula</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="MetricsQuery-33"><a href="#MetricsQuery-33"><span class="linenos"> 33</span></a>    <span class="n">start</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="MetricsQuery-34"><a href="#MetricsQuery-34"><span class="linenos"> 34</span></a>    <span class="n">end</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="MetricsQuery-35"><a href="#MetricsQuery-35"><span class="linenos"> 35</span></a>    <span class="n">rollup</span><span class="p">:</span> <span class="n">Rollup</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="MetricsQuery-36"><a href="#MetricsQuery-36"><span class="linenos"> 36</span></a>    <span class="n">scope</span><span class="p">:</span> <span class="n">MetricsScope</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="MetricsQuery-37"><a href="#MetricsQuery-37"><span class="linenos"> 37</span></a>    <span class="n">limit</span><span class="p">:</span> <span class="n">Limit</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="MetricsQuery-38"><a href="#MetricsQuery-38"><span class="linenos"> 38</span></a>    <span class="n">offset</span><span class="p">:</span> <span class="n">Offset</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="MetricsQuery-39"><a href="#MetricsQuery-39"><span class="linenos"> 39</span></a>    <span class="n">extrapolate</span><span class="p">:</span> <span class="n">Extrapolate</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="MetricsQuery-40"><a href="#MetricsQuery-40"><span class="linenos"> 40</span></a>    <span class="n">indexer_mappings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="MetricsQuery-41"><a href="#MetricsQuery-41"><span class="linenos"> 41</span></a>
</span><span id="MetricsQuery-42"><a href="#MetricsQuery-42"><span class="linenos"> 42</span></a>    <span class="k">def</span> <span class="nf">_replace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MetricsQuery</span><span class="p">:</span>
</span><span id="MetricsQuery-43"><a href="#MetricsQuery-43"><span class="linenos"> 43</span></a>        <span class="n">new</span> <span class="o">=</span> <span class="n">replace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="p">{</span><span class="n">field</span><span class="p">:</span> <span class="n">value</span><span class="p">})</span>
</span><span id="MetricsQuery-44"><a href="#MetricsQuery-44"><span class="linenos"> 44</span></a>        <span class="k">return</span> <span class="n">new</span>
</span><span id="MetricsQuery-45"><a href="#MetricsQuery-45"><span class="linenos"> 45</span></a>
</span><span id="MetricsQuery-46"><a href="#MetricsQuery-46"><span class="linenos"> 46</span></a>    <span class="k">def</span> <span class="nf">set_query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="n">Formula</span> <span class="o">|</span> <span class="n">Timeseries</span> <span class="o">|</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MetricsQuery</span><span class="p">:</span>
</span><span id="MetricsQuery-47"><a href="#MetricsQuery-47"><span class="linenos"> 47</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="p">(</span><span class="n">Formula</span><span class="p">,</span> <span class="n">Timeseries</span><span class="p">,</span> <span class="nb">str</span><span class="p">)):</span>
</span><span id="MetricsQuery-48"><a href="#MetricsQuery-48"><span class="linenos"> 48</span></a>            <span class="k">raise</span> <span class="n">InvalidQueryError</span><span class="p">(</span>
</span><span id="MetricsQuery-49"><a href="#MetricsQuery-49"><span class="linenos"> 49</span></a>                <span class="s2">&quot;query must be a Formula or Timeseries or MQL string&quot;</span>
</span><span id="MetricsQuery-50"><a href="#MetricsQuery-50"><span class="linenos"> 50</span></a>            <span class="p">)</span>
</span><span id="MetricsQuery-51"><a href="#MetricsQuery-51"><span class="linenos"> 51</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="s2">&quot;query&quot;</span><span class="p">,</span> <span class="n">query</span><span class="p">)</span>
</span><span id="MetricsQuery-52"><a href="#MetricsQuery-52"><span class="linenos"> 52</span></a>
</span><span id="MetricsQuery-53"><a href="#MetricsQuery-53"><span class="linenos"> 53</span></a>    <span class="k">def</span> <span class="nf">set_start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span> <span class="n">datetime</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MetricsQuery</span><span class="p">:</span>
</span><span id="MetricsQuery-54"><a href="#MetricsQuery-54"><span class="linenos"> 54</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">datetime</span><span class="p">):</span>
</span><span id="MetricsQuery-55"><a href="#MetricsQuery-55"><span class="linenos"> 55</span></a>            <span class="k">raise</span> <span class="n">InvalidQueryError</span><span class="p">(</span><span class="s2">&quot;start must be a datetime&quot;</span><span class="p">)</span>
</span><span id="MetricsQuery-56"><a href="#MetricsQuery-56"><span class="linenos"> 56</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="s2">&quot;start&quot;</span><span class="p">,</span> <span class="n">start</span><span class="p">)</span>
</span><span id="MetricsQuery-57"><a href="#MetricsQuery-57"><span class="linenos"> 57</span></a>
</span><span id="MetricsQuery-58"><a href="#MetricsQuery-58"><span class="linenos"> 58</span></a>    <span class="k">def</span> <span class="nf">set_end</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">end</span><span class="p">:</span> <span class="n">datetime</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MetricsQuery</span><span class="p">:</span>
</span><span id="MetricsQuery-59"><a href="#MetricsQuery-59"><span class="linenos"> 59</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">end</span><span class="p">,</span> <span class="n">datetime</span><span class="p">):</span>
</span><span id="MetricsQuery-60"><a href="#MetricsQuery-60"><span class="linenos"> 60</span></a>            <span class="k">raise</span> <span class="n">InvalidQueryError</span><span class="p">(</span><span class="s2">&quot;end must be a datetime&quot;</span><span class="p">)</span>
</span><span id="MetricsQuery-61"><a href="#MetricsQuery-61"><span class="linenos"> 61</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="s2">&quot;end&quot;</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>
</span><span id="MetricsQuery-62"><a href="#MetricsQuery-62"><span class="linenos"> 62</span></a>
</span><span id="MetricsQuery-63"><a href="#MetricsQuery-63"><span class="linenos"> 63</span></a>    <span class="k">def</span> <span class="nf">set_rollup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rollup</span><span class="p">:</span> <span class="n">Rollup</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MetricsQuery</span><span class="p">:</span>
</span><span id="MetricsQuery-64"><a href="#MetricsQuery-64"><span class="linenos"> 64</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rollup</span><span class="p">,</span> <span class="n">Rollup</span><span class="p">):</span>
</span><span id="MetricsQuery-65"><a href="#MetricsQuery-65"><span class="linenos"> 65</span></a>            <span class="k">raise</span> <span class="n">InvalidQueryError</span><span class="p">(</span><span class="s2">&quot;rollup must be a Rollup&quot;</span><span class="p">)</span>
</span><span id="MetricsQuery-66"><a href="#MetricsQuery-66"><span class="linenos"> 66</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="s2">&quot;rollup&quot;</span><span class="p">,</span> <span class="n">rollup</span><span class="p">)</span>
</span><span id="MetricsQuery-67"><a href="#MetricsQuery-67"><span class="linenos"> 67</span></a>
</span><span id="MetricsQuery-68"><a href="#MetricsQuery-68"><span class="linenos"> 68</span></a>    <span class="k">def</span> <span class="nf">set_scope</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scope</span><span class="p">:</span> <span class="n">MetricsScope</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MetricsQuery</span><span class="p">:</span>
</span><span id="MetricsQuery-69"><a href="#MetricsQuery-69"><span class="linenos"> 69</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">scope</span><span class="p">,</span> <span class="n">MetricsScope</span><span class="p">):</span>
</span><span id="MetricsQuery-70"><a href="#MetricsQuery-70"><span class="linenos"> 70</span></a>            <span class="k">raise</span> <span class="n">InvalidQueryError</span><span class="p">(</span><span class="s2">&quot;scope must be a MetricsScope&quot;</span><span class="p">)</span>
</span><span id="MetricsQuery-71"><a href="#MetricsQuery-71"><span class="linenos"> 71</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="s2">&quot;scope&quot;</span><span class="p">,</span> <span class="n">scope</span><span class="p">)</span>
</span><span id="MetricsQuery-72"><a href="#MetricsQuery-72"><span class="linenos"> 72</span></a>
</span><span id="MetricsQuery-73"><a href="#MetricsQuery-73"><span class="linenos"> 73</span></a>    <span class="k">def</span> <span class="nf">set_limit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MetricsQuery</span><span class="p">:</span>
</span><span id="MetricsQuery-74"><a href="#MetricsQuery-74"><span class="linenos"> 74</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="s2">&quot;limit&quot;</span><span class="p">,</span> <span class="n">Limit</span><span class="p">(</span><span class="n">limit</span><span class="p">))</span>
</span><span id="MetricsQuery-75"><a href="#MetricsQuery-75"><span class="linenos"> 75</span></a>
</span><span id="MetricsQuery-76"><a href="#MetricsQuery-76"><span class="linenos"> 76</span></a>    <span class="k">def</span> <span class="nf">set_offset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">offset</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MetricsQuery</span><span class="p">:</span>
</span><span id="MetricsQuery-77"><a href="#MetricsQuery-77"><span class="linenos"> 77</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="s2">&quot;offset&quot;</span><span class="p">,</span> <span class="n">Offset</span><span class="p">(</span><span class="n">offset</span><span class="p">))</span>
</span><span id="MetricsQuery-78"><a href="#MetricsQuery-78"><span class="linenos"> 78</span></a>
</span><span id="MetricsQuery-79"><a href="#MetricsQuery-79"><span class="linenos"> 79</span></a>    <span class="k">def</span> <span class="nf">set_extrapolate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">extrapolate</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MetricsQuery</span><span class="p">:</span>
</span><span id="MetricsQuery-80"><a href="#MetricsQuery-80"><span class="linenos"> 80</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="s2">&quot;extrapolate&quot;</span><span class="p">,</span> <span class="n">Extrapolate</span><span class="p">(</span><span class="n">extrapolate</span><span class="p">))</span>
</span><span id="MetricsQuery-81"><a href="#MetricsQuery-81"><span class="linenos"> 81</span></a>
</span><span id="MetricsQuery-82"><a href="#MetricsQuery-82"><span class="linenos"> 82</span></a>    <span class="k">def</span> <span class="nf">set_indexer_mappings</span><span class="p">(</span>
</span><span id="MetricsQuery-83"><a href="#MetricsQuery-83"><span class="linenos"> 83</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">indexer_mappings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">int</span><span class="p">]</span>
</span><span id="MetricsQuery-84"><a href="#MetricsQuery-84"><span class="linenos"> 84</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MetricsQuery</span><span class="p">:</span>
</span><span id="MetricsQuery-85"><a href="#MetricsQuery-85"><span class="linenos"> 85</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="s2">&quot;indexer_mappings&quot;</span><span class="p">,</span> <span class="n">indexer_mappings</span><span class="p">)</span>
</span><span id="MetricsQuery-86"><a href="#MetricsQuery-86"><span class="linenos"> 86</span></a>
</span><span id="MetricsQuery-87"><a href="#MetricsQuery-87"><span class="linenos"> 87</span></a>    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MetricsQuery-88"><a href="#MetricsQuery-88"><span class="linenos"> 88</span></a>        <span class="n">Validator</span><span class="p">()</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="MetricsQuery-89"><a href="#MetricsQuery-89"><span class="linenos"> 89</span></a>
</span><span id="MetricsQuery-90"><a href="#MetricsQuery-90"><span class="linenos"> 90</span></a>    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="MetricsQuery-91"><a href="#MetricsQuery-91"><span class="linenos"> 91</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">MQL_PRINTER</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="MetricsQuery-92"><a href="#MetricsQuery-92"><span class="linenos"> 92</span></a>        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</span><span id="MetricsQuery-93"><a href="#MetricsQuery-93"><span class="linenos"> 93</span></a>
</span><span id="MetricsQuery-94"><a href="#MetricsQuery-94"><span class="linenos"> 94</span></a>    <span class="k">def</span> <span class="nf">print</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="MetricsQuery-95"><a href="#MetricsQuery-95"><span class="linenos"> 95</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">validate</span><span class="p">()</span>
</span><span id="MetricsQuery-96"><a href="#MetricsQuery-96"><span class="linenos"> 96</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">MQL_PRINTER</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="MetricsQuery-97"><a href="#MetricsQuery-97"><span class="linenos"> 97</span></a>        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</span><span id="MetricsQuery-98"><a href="#MetricsQuery-98"><span class="linenos"> 98</span></a>
</span><span id="MetricsQuery-99"><a href="#MetricsQuery-99"><span class="linenos"> 99</span></a>    <span class="k">def</span> <span class="nf">serialize</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="MetricsQuery-100"><a href="#MetricsQuery-100"><span class="linenos">100</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">validate</span><span class="p">()</span>
</span><span id="MetricsQuery-101"><a href="#MetricsQuery-101"><span class="linenos">101</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_optimize</span><span class="p">()</span>
</span><span id="MetricsQuery-102"><a href="#MetricsQuery-102"><span class="linenos">102</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">MQL_PRINTER</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="MetricsQuery-103"><a href="#MetricsQuery-103"><span class="linenos">103</span></a>        <span class="k">return</span> <span class="n">result</span>
</span><span id="MetricsQuery-104"><a href="#MetricsQuery-104"><span class="linenos">104</span></a>
</span><span id="MetricsQuery-105"><a href="#MetricsQuery-105"><span class="linenos">105</span></a>    <span class="k">def</span> <span class="nf">_optimize</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MetricsQuery-106"><a href="#MetricsQuery-106"><span class="linenos">106</span></a>        <span class="k">if</span> <span class="p">(</span>
</span><span id="MetricsQuery-107"><a href="#MetricsQuery-107"><span class="linenos">107</span></a>            <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">,</span> <span class="p">(</span><span class="n">Formula</span><span class="p">,</span> <span class="n">Timeseries</span><span class="p">))</span>
</span><span id="MetricsQuery-108"><a href="#MetricsQuery-108"><span class="linenos">108</span></a>            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filters</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="MetricsQuery-109"><a href="#MetricsQuery-109"><span class="linenos">109</span></a>        <span class="p">):</span>
</span><span id="MetricsQuery-110"><a href="#MetricsQuery-110"><span class="linenos">110</span></a>            <span class="n">new_filters</span> <span class="o">=</span> <span class="n">OrOptimizer</span><span class="p">()</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filters</span><span class="p">)</span>
</span><span id="MetricsQuery-111"><a href="#MetricsQuery-111"><span class="linenos">111</span></a>            <span class="k">if</span> <span class="n">new_filters</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MetricsQuery-112"><a href="#MetricsQuery-112"><span class="linenos">112</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">query</span> <span class="o">=</span> <span class="n">replace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">,</span> <span class="n">filters</span><span class="o">=</span><span class="n">new_filters</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>A query on a set of timeseries. This class gets translated into a Snuba request string
that returns a list of timeseries data. In order to allow this class to be built incrementally,
it is not validated until it is serialized. Any specified filters or groupby fields are pushed
down to each of the Timeseries in the query field. It is immutable, so any set functions return
a new copy of the query, which also allows chaining calls.</p>

<p>This class is distinct from the Query class to allow for more specific validation and to provide
a simpler syntax for writing timeseries queries, which have fewer available features.</p>
</div>


                            <div id="MetricsQuery.__init__" class="classattr">
                                <div class="attr function">
            
        <span class="name">MetricsQuery</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">query</span><span class="p">:</span> <span class="n"><a href="#Timeseries">Timeseries</a></span> <span class="o">|</span> <span class="n"><a href="#Formula">Formula</a></span> <span class="o">|</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">start</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">end</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">rollup</span><span class="p">:</span> <span class="n"><a href="#Rollup">Rollup</a></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">scope</span><span class="p">:</span> <span class="n"><a href="#MetricsScope">MetricsScope</a></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">limit</span><span class="p">:</span> <span class="n"><a href="#Limit">Limit</a></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">offset</span><span class="p">:</span> <span class="n"><a href="#Offset">Offset</a></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">extrapolate</span><span class="p">:</span> <span class="n"><a href="#Extrapolate">Extrapolate</a></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">indexer_mappings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></span>)</span>

        
    </div>
    <a class="headerlink" href="#MetricsQuery.__init__"></a>
    
    

                            </div>
                            <div id="MetricsQuery.query" class="classattr">
                                <div class="attr variable">
            <span class="name">query</span><span class="annotation">: <a href="#Timeseries">Timeseries</a> | <a href="#Formula">Formula</a> | str | None</span>        =
<span class="default_value">None</span>

        
    </div>
    <a class="headerlink" href="#MetricsQuery.query"></a>
    
    

                            </div>
                            <div id="MetricsQuery.start" class="classattr">
                                <div class="attr variable">
            <span class="name">start</span><span class="annotation">: datetime.datetime | None</span>        =
<span class="default_value">None</span>

        
    </div>
    <a class="headerlink" href="#MetricsQuery.start"></a>
    
    

                            </div>
                            <div id="MetricsQuery.end" class="classattr">
                                <div class="attr variable">
            <span class="name">end</span><span class="annotation">: datetime.datetime | None</span>        =
<span class="default_value">None</span>

        
    </div>
    <a class="headerlink" href="#MetricsQuery.end"></a>
    
    

                            </div>
                            <div id="MetricsQuery.rollup" class="classattr">
                                <div class="attr variable">
            <span class="name">rollup</span><span class="annotation">: <a href="#Rollup">Rollup</a> | None</span>        =
<span class="default_value">None</span>

        
    </div>
    <a class="headerlink" href="#MetricsQuery.rollup"></a>
    
    

                            </div>
                            <div id="MetricsQuery.scope" class="classattr">
                                <div class="attr variable">
            <span class="name">scope</span><span class="annotation">: <a href="#MetricsScope">MetricsScope</a> | None</span>        =
<span class="default_value">None</span>

        
    </div>
    <a class="headerlink" href="#MetricsQuery.scope"></a>
    
    

                            </div>
                            <div id="MetricsQuery.limit" class="classattr">
                                <div class="attr variable">
            <span class="name">limit</span><span class="annotation">: <a href="#Limit">Limit</a> | None</span>        =
<span class="default_value">None</span>

        
    </div>
    <a class="headerlink" href="#MetricsQuery.limit"></a>
    
    

                            </div>
                            <div id="MetricsQuery.offset" class="classattr">
                                <div class="attr variable">
            <span class="name">offset</span><span class="annotation">: <a href="#Offset">Offset</a> | None</span>        =
<span class="default_value">None</span>

        
    </div>
    <a class="headerlink" href="#MetricsQuery.offset"></a>
    
    

                            </div>
                            <div id="MetricsQuery.extrapolate" class="classattr">
                                <div class="attr variable">
            <span class="name">extrapolate</span><span class="annotation">: <a href="#Extrapolate">Extrapolate</a> | None</span>        =
<span class="default_value">None</span>

        
    </div>
    <a class="headerlink" href="#MetricsQuery.extrapolate"></a>
    
    

                            </div>
                            <div id="MetricsQuery.indexer_mappings" class="classattr">
                                <div class="attr variable">
            <span class="name">indexer_mappings</span><span class="annotation">: dict[str, str | int] | None</span>        =
<span class="default_value">None</span>

        
    </div>
    <a class="headerlink" href="#MetricsQuery.indexer_mappings"></a>
    
    

                            </div>
                            <div id="MetricsQuery.set_query" class="classattr">
                                        <input id="MetricsQuery.set_query-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_query</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">query</span><span class="p">:</span> <span class="n"><a href="#Formula">Formula</a></span> <span class="o">|</span> <span class="n"><a href="#Timeseries">Timeseries</a></span> <span class="o">|</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="n"><a href="#MetricsQuery">MetricsQuery</a></span>:</span></span>

                <label class="view-source-button" for="MetricsQuery.set_query-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MetricsQuery.set_query"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MetricsQuery.set_query-46"><a href="#MetricsQuery.set_query-46"><span class="linenos">46</span></a>    <span class="k">def</span> <span class="nf">set_query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="n">Formula</span> <span class="o">|</span> <span class="n">Timeseries</span> <span class="o">|</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MetricsQuery</span><span class="p">:</span>
</span><span id="MetricsQuery.set_query-47"><a href="#MetricsQuery.set_query-47"><span class="linenos">47</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="p">(</span><span class="n">Formula</span><span class="p">,</span> <span class="n">Timeseries</span><span class="p">,</span> <span class="nb">str</span><span class="p">)):</span>
</span><span id="MetricsQuery.set_query-48"><a href="#MetricsQuery.set_query-48"><span class="linenos">48</span></a>            <span class="k">raise</span> <span class="n">InvalidQueryError</span><span class="p">(</span>
</span><span id="MetricsQuery.set_query-49"><a href="#MetricsQuery.set_query-49"><span class="linenos">49</span></a>                <span class="s2">&quot;query must be a Formula or Timeseries or MQL string&quot;</span>
</span><span id="MetricsQuery.set_query-50"><a href="#MetricsQuery.set_query-50"><span class="linenos">50</span></a>            <span class="p">)</span>
</span><span id="MetricsQuery.set_query-51"><a href="#MetricsQuery.set_query-51"><span class="linenos">51</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="s2">&quot;query&quot;</span><span class="p">,</span> <span class="n">query</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="MetricsQuery.set_start" class="classattr">
                                        <input id="MetricsQuery.set_start-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_start</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">start</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span></span><span class="return-annotation">) -> <span class="n"><a href="#MetricsQuery">MetricsQuery</a></span>:</span></span>

                <label class="view-source-button" for="MetricsQuery.set_start-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MetricsQuery.set_start"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MetricsQuery.set_start-53"><a href="#MetricsQuery.set_start-53"><span class="linenos">53</span></a>    <span class="k">def</span> <span class="nf">set_start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span> <span class="n">datetime</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MetricsQuery</span><span class="p">:</span>
</span><span id="MetricsQuery.set_start-54"><a href="#MetricsQuery.set_start-54"><span class="linenos">54</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">datetime</span><span class="p">):</span>
</span><span id="MetricsQuery.set_start-55"><a href="#MetricsQuery.set_start-55"><span class="linenos">55</span></a>            <span class="k">raise</span> <span class="n">InvalidQueryError</span><span class="p">(</span><span class="s2">&quot;start must be a datetime&quot;</span><span class="p">)</span>
</span><span id="MetricsQuery.set_start-56"><a href="#MetricsQuery.set_start-56"><span class="linenos">56</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="s2">&quot;start&quot;</span><span class="p">,</span> <span class="n">start</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="MetricsQuery.set_end" class="classattr">
                                        <input id="MetricsQuery.set_end-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_end</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">end</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span></span><span class="return-annotation">) -> <span class="n"><a href="#MetricsQuery">MetricsQuery</a></span>:</span></span>

                <label class="view-source-button" for="MetricsQuery.set_end-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MetricsQuery.set_end"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MetricsQuery.set_end-58"><a href="#MetricsQuery.set_end-58"><span class="linenos">58</span></a>    <span class="k">def</span> <span class="nf">set_end</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">end</span><span class="p">:</span> <span class="n">datetime</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MetricsQuery</span><span class="p">:</span>
</span><span id="MetricsQuery.set_end-59"><a href="#MetricsQuery.set_end-59"><span class="linenos">59</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">end</span><span class="p">,</span> <span class="n">datetime</span><span class="p">):</span>
</span><span id="MetricsQuery.set_end-60"><a href="#MetricsQuery.set_end-60"><span class="linenos">60</span></a>            <span class="k">raise</span> <span class="n">InvalidQueryError</span><span class="p">(</span><span class="s2">&quot;end must be a datetime&quot;</span><span class="p">)</span>
</span><span id="MetricsQuery.set_end-61"><a href="#MetricsQuery.set_end-61"><span class="linenos">61</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="s2">&quot;end&quot;</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="MetricsQuery.set_rollup" class="classattr">
                                        <input id="MetricsQuery.set_rollup-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_rollup</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">rollup</span><span class="p">:</span> <span class="n"><a href="#Rollup">Rollup</a></span></span><span class="return-annotation">) -> <span class="n"><a href="#MetricsQuery">MetricsQuery</a></span>:</span></span>

                <label class="view-source-button" for="MetricsQuery.set_rollup-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MetricsQuery.set_rollup"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MetricsQuery.set_rollup-63"><a href="#MetricsQuery.set_rollup-63"><span class="linenos">63</span></a>    <span class="k">def</span> <span class="nf">set_rollup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rollup</span><span class="p">:</span> <span class="n">Rollup</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MetricsQuery</span><span class="p">:</span>
</span><span id="MetricsQuery.set_rollup-64"><a href="#MetricsQuery.set_rollup-64"><span class="linenos">64</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rollup</span><span class="p">,</span> <span class="n">Rollup</span><span class="p">):</span>
</span><span id="MetricsQuery.set_rollup-65"><a href="#MetricsQuery.set_rollup-65"><span class="linenos">65</span></a>            <span class="k">raise</span> <span class="n">InvalidQueryError</span><span class="p">(</span><span class="s2">&quot;rollup must be a Rollup&quot;</span><span class="p">)</span>
</span><span id="MetricsQuery.set_rollup-66"><a href="#MetricsQuery.set_rollup-66"><span class="linenos">66</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="s2">&quot;rollup&quot;</span><span class="p">,</span> <span class="n">rollup</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="MetricsQuery.set_scope" class="classattr">
                                        <input id="MetricsQuery.set_scope-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_scope</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">scope</span><span class="p">:</span> <span class="n"><a href="#MetricsScope">MetricsScope</a></span></span><span class="return-annotation">) -> <span class="n"><a href="#MetricsQuery">MetricsQuery</a></span>:</span></span>

                <label class="view-source-button" for="MetricsQuery.set_scope-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MetricsQuery.set_scope"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MetricsQuery.set_scope-68"><a href="#MetricsQuery.set_scope-68"><span class="linenos">68</span></a>    <span class="k">def</span> <span class="nf">set_scope</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scope</span><span class="p">:</span> <span class="n">MetricsScope</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MetricsQuery</span><span class="p">:</span>
</span><span id="MetricsQuery.set_scope-69"><a href="#MetricsQuery.set_scope-69"><span class="linenos">69</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">scope</span><span class="p">,</span> <span class="n">MetricsScope</span><span class="p">):</span>
</span><span id="MetricsQuery.set_scope-70"><a href="#MetricsQuery.set_scope-70"><span class="linenos">70</span></a>            <span class="k">raise</span> <span class="n">InvalidQueryError</span><span class="p">(</span><span class="s2">&quot;scope must be a MetricsScope&quot;</span><span class="p">)</span>
</span><span id="MetricsQuery.set_scope-71"><a href="#MetricsQuery.set_scope-71"><span class="linenos">71</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="s2">&quot;scope&quot;</span><span class="p">,</span> <span class="n">scope</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="MetricsQuery.set_limit" class="classattr">
                                        <input id="MetricsQuery.set_limit-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_limit</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">limit</span><span class="p">:</span> <span class="nb">int</span></span><span class="return-annotation">) -> <span class="n"><a href="#MetricsQuery">MetricsQuery</a></span>:</span></span>

                <label class="view-source-button" for="MetricsQuery.set_limit-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MetricsQuery.set_limit"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MetricsQuery.set_limit-73"><a href="#MetricsQuery.set_limit-73"><span class="linenos">73</span></a>    <span class="k">def</span> <span class="nf">set_limit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MetricsQuery</span><span class="p">:</span>
</span><span id="MetricsQuery.set_limit-74"><a href="#MetricsQuery.set_limit-74"><span class="linenos">74</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="s2">&quot;limit&quot;</span><span class="p">,</span> <span class="n">Limit</span><span class="p">(</span><span class="n">limit</span><span class="p">))</span>
</span></pre></div>


    

                            </div>
                            <div id="MetricsQuery.set_offset" class="classattr">
                                        <input id="MetricsQuery.set_offset-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_offset</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">offset</span><span class="p">:</span> <span class="nb">int</span></span><span class="return-annotation">) -> <span class="n"><a href="#MetricsQuery">MetricsQuery</a></span>:</span></span>

                <label class="view-source-button" for="MetricsQuery.set_offset-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MetricsQuery.set_offset"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MetricsQuery.set_offset-76"><a href="#MetricsQuery.set_offset-76"><span class="linenos">76</span></a>    <span class="k">def</span> <span class="nf">set_offset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">offset</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MetricsQuery</span><span class="p">:</span>
</span><span id="MetricsQuery.set_offset-77"><a href="#MetricsQuery.set_offset-77"><span class="linenos">77</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="s2">&quot;offset&quot;</span><span class="p">,</span> <span class="n">Offset</span><span class="p">(</span><span class="n">offset</span><span class="p">))</span>
</span></pre></div>


    

                            </div>
                            <div id="MetricsQuery.set_extrapolate" class="classattr">
                                        <input id="MetricsQuery.set_extrapolate-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_extrapolate</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">extrapolate</span><span class="p">:</span> <span class="nb">bool</span></span><span class="return-annotation">) -> <span class="n"><a href="#MetricsQuery">MetricsQuery</a></span>:</span></span>

                <label class="view-source-button" for="MetricsQuery.set_extrapolate-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MetricsQuery.set_extrapolate"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MetricsQuery.set_extrapolate-79"><a href="#MetricsQuery.set_extrapolate-79"><span class="linenos">79</span></a>    <span class="k">def</span> <span class="nf">set_extrapolate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">extrapolate</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MetricsQuery</span><span class="p">:</span>
</span><span id="MetricsQuery.set_extrapolate-80"><a href="#MetricsQuery.set_extrapolate-80"><span class="linenos">80</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="s2">&quot;extrapolate&quot;</span><span class="p">,</span> <span class="n">Extrapolate</span><span class="p">(</span><span class="n">extrapolate</span><span class="p">))</span>
</span></pre></div>


    

                            </div>
                            <div id="MetricsQuery.set_indexer_mappings" class="classattr">
                                        <input id="MetricsQuery.set_indexer_mappings-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_indexer_mappings</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">indexer_mappings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">int</span><span class="p">]</span></span><span class="return-annotation">) -> <span class="n"><a href="#MetricsQuery">MetricsQuery</a></span>:</span></span>

                <label class="view-source-button" for="MetricsQuery.set_indexer_mappings-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MetricsQuery.set_indexer_mappings"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MetricsQuery.set_indexer_mappings-82"><a href="#MetricsQuery.set_indexer_mappings-82"><span class="linenos">82</span></a>    <span class="k">def</span> <span class="nf">set_indexer_mappings</span><span class="p">(</span>
</span><span id="MetricsQuery.set_indexer_mappings-83"><a href="#MetricsQuery.set_indexer_mappings-83"><span class="linenos">83</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">indexer_mappings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">int</span><span class="p">]</span>
</span><span id="MetricsQuery.set_indexer_mappings-84"><a href="#MetricsQuery.set_indexer_mappings-84"><span class="linenos">84</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MetricsQuery</span><span class="p">:</span>
</span><span id="MetricsQuery.set_indexer_mappings-85"><a href="#MetricsQuery.set_indexer_mappings-85"><span class="linenos">85</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="s2">&quot;indexer_mappings&quot;</span><span class="p">,</span> <span class="n">indexer_mappings</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="MetricsQuery.validate" class="classattr">
                                        <input id="MetricsQuery.validate-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">validate</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="MetricsQuery.validate-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MetricsQuery.validate"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MetricsQuery.validate-87"><a href="#MetricsQuery.validate-87"><span class="linenos">87</span></a>    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MetricsQuery.validate-88"><a href="#MetricsQuery.validate-88"><span class="linenos">88</span></a>        <span class="n">Validator</span><span class="p">()</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="MetricsQuery.print" class="classattr">
                                        <input id="MetricsQuery.print-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">print</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="MetricsQuery.print-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MetricsQuery.print"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MetricsQuery.print-94"><a href="#MetricsQuery.print-94"><span class="linenos">94</span></a>    <span class="k">def</span> <span class="nf">print</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="MetricsQuery.print-95"><a href="#MetricsQuery.print-95"><span class="linenos">95</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">validate</span><span class="p">()</span>
</span><span id="MetricsQuery.print-96"><a href="#MetricsQuery.print-96"><span class="linenos">96</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">MQL_PRINTER</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="MetricsQuery.print-97"><a href="#MetricsQuery.print-97"><span class="linenos">97</span></a>        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="MetricsQuery.serialize" class="classattr">
                                        <input id="MetricsQuery.serialize-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">serialize</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">str</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="MetricsQuery.serialize-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MetricsQuery.serialize"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MetricsQuery.serialize-99"><a href="#MetricsQuery.serialize-99"><span class="linenos"> 99</span></a>    <span class="k">def</span> <span class="nf">serialize</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="MetricsQuery.serialize-100"><a href="#MetricsQuery.serialize-100"><span class="linenos">100</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">validate</span><span class="p">()</span>
</span><span id="MetricsQuery.serialize-101"><a href="#MetricsQuery.serialize-101"><span class="linenos">101</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_optimize</span><span class="p">()</span>
</span><span id="MetricsQuery.serialize-102"><a href="#MetricsQuery.serialize-102"><span class="linenos">102</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">MQL_PRINTER</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="MetricsQuery.serialize-103"><a href="#MetricsQuery.serialize-103"><span class="linenos">103</span></a>        <span class="k">return</span> <span class="n">result</span>
</span></pre></div>


    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>snuba_sdk.query.BaseQuery</dt>
                                <dd id="MetricsQuery.get_fields" class="function">get_fields</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="MetricsScope">
                            <input id="MetricsScope-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
                    <div class="decorator">@dataclass</div>

    <span class="def">class</span>
    <span class="name">MetricsScope</span>:

                <label class="view-source-button" for="MetricsScope-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MetricsScope"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MetricsScope-218"><a href="#MetricsScope-218"><span class="linenos">218</span></a><span class="nd">@dataclass</span>
</span><span id="MetricsScope-219"><a href="#MetricsScope-219"><span class="linenos">219</span></a><span class="k">class</span> <span class="nc">MetricsScope</span><span class="p">:</span>
</span><span id="MetricsScope-220"><a href="#MetricsScope-220"><span class="linenos">220</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MetricsScope-221"><a href="#MetricsScope-221"><span class="linenos">221</span></a><span class="sd">    This contains all the meta information necessary to resolve a metric and to safely query</span>
</span><span id="MetricsScope-222"><a href="#MetricsScope-222"><span class="linenos">222</span></a><span class="sd">    the metrics dataset. All these values get automatically added to the query conditions.</span>
</span><span id="MetricsScope-223"><a href="#MetricsScope-223"><span class="linenos">223</span></a><span class="sd">    The idea of this class is to contain all the filter values that are not represented by</span>
</span><span id="MetricsScope-224"><a href="#MetricsScope-224"><span class="linenos">224</span></a><span class="sd">    tags in the API.</span>
</span><span id="MetricsScope-225"><a href="#MetricsScope-225"><span class="linenos">225</span></a>
</span><span id="MetricsScope-226"><a href="#MetricsScope-226"><span class="linenos">226</span></a><span class="sd">    use_case_id is treated separately since it can be derived separate from the MRIs of the</span>
</span><span id="MetricsScope-227"><a href="#MetricsScope-227"><span class="linenos">227</span></a><span class="sd">    metrics in the outer query.</span>
</span><span id="MetricsScope-228"><a href="#MetricsScope-228"><span class="linenos">228</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="MetricsScope-229"><a href="#MetricsScope-229"><span class="linenos">229</span></a>
</span><span id="MetricsScope-230"><a href="#MetricsScope-230"><span class="linenos">230</span></a>    <span class="n">org_ids</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>
</span><span id="MetricsScope-231"><a href="#MetricsScope-231"><span class="linenos">231</span></a>    <span class="n">project_ids</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>
</span><span id="MetricsScope-232"><a href="#MetricsScope-232"><span class="linenos">232</span></a>    <span class="n">use_case_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="MetricsScope-233"><a href="#MetricsScope-233"><span class="linenos">233</span></a>
</span><span id="MetricsScope-234"><a href="#MetricsScope-234"><span class="linenos">234</span></a>    <span class="k">def</span> <span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MetricsScope-235"><a href="#MetricsScope-235"><span class="linenos">235</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">validate</span><span class="p">()</span>
</span><span id="MetricsScope-236"><a href="#MetricsScope-236"><span class="linenos">236</span></a>
</span><span id="MetricsScope-237"><a href="#MetricsScope-237"><span class="linenos">237</span></a>    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MetricsScope-238"><a href="#MetricsScope-238"><span class="linenos">238</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">list_type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">org_ids</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,)):</span>
</span><span id="MetricsScope-239"><a href="#MetricsScope-239"><span class="linenos">239</span></a>            <span class="k">raise</span> <span class="n">InvalidExpressionError</span><span class="p">(</span><span class="s2">&quot;org_ids must be a list of integers&quot;</span><span class="p">)</span>
</span><span id="MetricsScope-240"><a href="#MetricsScope-240"><span class="linenos">240</span></a>
</span><span id="MetricsScope-241"><a href="#MetricsScope-241"><span class="linenos">241</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">list_type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_ids</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,)):</span>
</span><span id="MetricsScope-242"><a href="#MetricsScope-242"><span class="linenos">242</span></a>            <span class="k">raise</span> <span class="n">InvalidExpressionError</span><span class="p">(</span><span class="s2">&quot;project_ids must be a list of integers&quot;</span><span class="p">)</span>
</span><span id="MetricsScope-243"><a href="#MetricsScope-243"><span class="linenos">243</span></a>
</span><span id="MetricsScope-244"><a href="#MetricsScope-244"><span class="linenos">244</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_case_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">use_case_id</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="MetricsScope-245"><a href="#MetricsScope-245"><span class="linenos">245</span></a>            <span class="k">raise</span> <span class="n">InvalidExpressionError</span><span class="p">(</span><span class="s2">&quot;use_case_id must be an str&quot;</span><span class="p">)</span>
</span><span id="MetricsScope-246"><a href="#MetricsScope-246"><span class="linenos">246</span></a>
</span><span id="MetricsScope-247"><a href="#MetricsScope-247"><span class="linenos">247</span></a>    <span class="k">def</span> <span class="nf">set_use_case_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">use_case_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MetricsScope</span><span class="p">:</span>
</span><span id="MetricsScope-248"><a href="#MetricsScope-248"><span class="linenos">248</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">use_case_id</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="MetricsScope-249"><a href="#MetricsScope-249"><span class="linenos">249</span></a>            <span class="k">raise</span> <span class="n">InvalidExpressionError</span><span class="p">(</span><span class="s2">&quot;use_case_id must be an str&quot;</span><span class="p">)</span>
</span><span id="MetricsScope-250"><a href="#MetricsScope-250"><span class="linenos">250</span></a>        <span class="k">return</span> <span class="n">replace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">use_case_id</span><span class="o">=</span><span class="n">use_case_id</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>This contains all the meta information necessary to resolve a metric and to safely query
the metrics dataset. All these values get automatically added to the query conditions.
The idea of this class is to contain all the filter values that are not represented by
tags in the API.</p>

<p>use_case_id is treated separately since it can be derived separate from the MRIs of the
metrics in the outer query.</p>
</div>


                            <div id="MetricsScope.__init__" class="classattr">
                                <div class="attr function">
            
        <span class="name">MetricsScope</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">org_ids</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>,</span><span class="param">	<span class="n">project_ids</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>,</span><span class="param">	<span class="n">use_case_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></span>)</span>

        
    </div>
    <a class="headerlink" href="#MetricsScope.__init__"></a>
    
    

                            </div>
                            <div id="MetricsScope.org_ids" class="classattr">
                                <div class="attr variable">
            <span class="name">org_ids</span><span class="annotation">: list[int]</span>

        
    </div>
    <a class="headerlink" href="#MetricsScope.org_ids"></a>
    
    

                            </div>
                            <div id="MetricsScope.project_ids" class="classattr">
                                <div class="attr variable">
            <span class="name">project_ids</span><span class="annotation">: list[int]</span>

        
    </div>
    <a class="headerlink" href="#MetricsScope.project_ids"></a>
    
    

                            </div>
                            <div id="MetricsScope.use_case_id" class="classattr">
                                <div class="attr variable">
            <span class="name">use_case_id</span><span class="annotation">: str | None</span>        =
<span class="default_value">None</span>

        
    </div>
    <a class="headerlink" href="#MetricsScope.use_case_id"></a>
    
    

                            </div>
                            <div id="MetricsScope.validate" class="classattr">
                                        <input id="MetricsScope.validate-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">validate</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="MetricsScope.validate-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MetricsScope.validate"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MetricsScope.validate-237"><a href="#MetricsScope.validate-237"><span class="linenos">237</span></a>    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MetricsScope.validate-238"><a href="#MetricsScope.validate-238"><span class="linenos">238</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">list_type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">org_ids</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,)):</span>
</span><span id="MetricsScope.validate-239"><a href="#MetricsScope.validate-239"><span class="linenos">239</span></a>            <span class="k">raise</span> <span class="n">InvalidExpressionError</span><span class="p">(</span><span class="s2">&quot;org_ids must be a list of integers&quot;</span><span class="p">)</span>
</span><span id="MetricsScope.validate-240"><a href="#MetricsScope.validate-240"><span class="linenos">240</span></a>
</span><span id="MetricsScope.validate-241"><a href="#MetricsScope.validate-241"><span class="linenos">241</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">list_type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_ids</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,)):</span>
</span><span id="MetricsScope.validate-242"><a href="#MetricsScope.validate-242"><span class="linenos">242</span></a>            <span class="k">raise</span> <span class="n">InvalidExpressionError</span><span class="p">(</span><span class="s2">&quot;project_ids must be a list of integers&quot;</span><span class="p">)</span>
</span><span id="MetricsScope.validate-243"><a href="#MetricsScope.validate-243"><span class="linenos">243</span></a>
</span><span id="MetricsScope.validate-244"><a href="#MetricsScope.validate-244"><span class="linenos">244</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_case_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">use_case_id</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="MetricsScope.validate-245"><a href="#MetricsScope.validate-245"><span class="linenos">245</span></a>            <span class="k">raise</span> <span class="n">InvalidExpressionError</span><span class="p">(</span><span class="s2">&quot;use_case_id must be an str&quot;</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="MetricsScope.set_use_case_id" class="classattr">
                                        <input id="MetricsScope.set_use_case_id-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_use_case_id</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">use_case_id</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="n"><a href="#MetricsScope">MetricsScope</a></span>:</span></span>

                <label class="view-source-button" for="MetricsScope.set_use_case_id-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MetricsScope.set_use_case_id"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MetricsScope.set_use_case_id-247"><a href="#MetricsScope.set_use_case_id-247"><span class="linenos">247</span></a>    <span class="k">def</span> <span class="nf">set_use_case_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">use_case_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MetricsScope</span><span class="p">:</span>
</span><span id="MetricsScope.set_use_case_id-248"><a href="#MetricsScope.set_use_case_id-248"><span class="linenos">248</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">use_case_id</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="MetricsScope.set_use_case_id-249"><a href="#MetricsScope.set_use_case_id-249"><span class="linenos">249</span></a>            <span class="k">raise</span> <span class="n">InvalidExpressionError</span><span class="p">(</span><span class="s2">&quot;use_case_id must be an str&quot;</span><span class="p">)</span>
</span><span id="MetricsScope.set_use_case_id-250"><a href="#MetricsScope.set_use_case_id-250"><span class="linenos">250</span></a>        <span class="k">return</span> <span class="n">replace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">use_case_id</span><span class="o">=</span><span class="n">use_case_id</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                </section>
                <section id="MQLContext">
                            <input id="MQLContext-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
                    <div class="decorator">@dataclass</div>

    <span class="def">class</span>
    <span class="name">MQLContext</span>:

                <label class="view-source-button" for="MQLContext-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MQLContext"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MQLContext-11"><a href="#MQLContext-11"><span class="linenos">11</span></a><span class="nd">@dataclass</span>
</span><span id="MQLContext-12"><a href="#MQLContext-12"><span class="linenos">12</span></a><span class="k">class</span> <span class="nc">MQLContext</span><span class="p">:</span>
</span><span id="MQLContext-13"><a href="#MQLContext-13"><span class="linenos">13</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MQLContext-14"><a href="#MQLContext-14"><span class="linenos">14</span></a><span class="sd">    The MQL string alone is not enough to fully describe a query.</span>
</span><span id="MQLContext-15"><a href="#MQLContext-15"><span class="linenos">15</span></a><span class="sd">    This class contains all of the additional information needed to</span>
</span><span id="MQLContext-16"><a href="#MQLContext-16"><span class="linenos">16</span></a><span class="sd">    execute a metrics query in snuba.</span>
</span><span id="MQLContext-17"><a href="#MQLContext-17"><span class="linenos">17</span></a>
</span><span id="MQLContext-18"><a href="#MQLContext-18"><span class="linenos">18</span></a><span class="sd">    It should be noted that this class is used as an intermediary encoding</span>
</span><span id="MQLContext-19"><a href="#MQLContext-19"><span class="linenos">19</span></a><span class="sd">    class for data in the the MetricsQuery class that can&#39;t be encoded into</span>
</span><span id="MQLContext-20"><a href="#MQLContext-20"><span class="linenos">20</span></a><span class="sd">    MQL. As such it shouldn&#39;t be used directly by users of the SDK.</span>
</span><span id="MQLContext-21"><a href="#MQLContext-21"><span class="linenos">21</span></a>
</span><span id="MQLContext-22"><a href="#MQLContext-22"><span class="linenos">22</span></a><span class="sd">    This also means that the validation here is quite loose, since this object</span>
</span><span id="MQLContext-23"><a href="#MQLContext-23"><span class="linenos">23</span></a><span class="sd">    should be created exclusively from a valid MetricsQuery object.</span>
</span><span id="MQLContext-24"><a href="#MQLContext-24"><span class="linenos">24</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="MQLContext-25"><a href="#MQLContext-25"><span class="linenos">25</span></a>
</span><span id="MQLContext-26"><a href="#MQLContext-26"><span class="linenos">26</span></a>    <span class="n">start</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="MQLContext-27"><a href="#MQLContext-27"><span class="linenos">27</span></a>    <span class="n">end</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="MQLContext-28"><a href="#MQLContext-28"><span class="linenos">28</span></a>    <span class="n">rollup</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]</span>
</span><span id="MQLContext-29"><a href="#MQLContext-29"><span class="linenos">29</span></a>    <span class="n">scope</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span>
</span><span id="MQLContext-30"><a href="#MQLContext-30"><span class="linenos">30</span></a>    <span class="n">indexer_mappings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">int</span><span class="p">]</span>
</span><span id="MQLContext-31"><a href="#MQLContext-31"><span class="linenos">31</span></a>    <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="MQLContext-32"><a href="#MQLContext-32"><span class="linenos">32</span></a>    <span class="n">offset</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="MQLContext-33"><a href="#MQLContext-33"><span class="linenos">33</span></a>    <span class="n">extrapolate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="MQLContext-34"><a href="#MQLContext-34"><span class="linenos">34</span></a>
</span><span id="MQLContext-35"><a href="#MQLContext-35"><span class="linenos">35</span></a>    <span class="k">def</span> <span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MQLContext-36"><a href="#MQLContext-36"><span class="linenos">36</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">validate</span><span class="p">()</span>
</span><span id="MQLContext-37"><a href="#MQLContext-37"><span class="linenos">37</span></a>
</span><span id="MQLContext-38"><a href="#MQLContext-38"><span class="linenos">38</span></a>    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MQLContext-39"><a href="#MQLContext-39"><span class="linenos">39</span></a>        <span class="c1"># Simple assert that all the expected fields are present</span>
</span><span id="MQLContext-40"><a href="#MQLContext-40"><span class="linenos">40</span></a>        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;start&quot;</span><span class="p">,</span> <span class="s2">&quot;end&quot;</span><span class="p">,</span> <span class="s2">&quot;rollup&quot;</span><span class="p">,</span> <span class="s2">&quot;scope&quot;</span><span class="p">,</span> <span class="s2">&quot;indexer_mappings&quot;</span><span class="p">]</span>
</span><span id="MQLContext-41"><a href="#MQLContext-41"><span class="linenos">41</span></a>        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">:</span>
</span><span id="MQLContext-42"><a href="#MQLContext-42"><span class="linenos">42</span></a>            <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MQLContext-43"><a href="#MQLContext-43"><span class="linenos">43</span></a>                <span class="k">raise</span> <span class="n">InvalidMQLContextError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;MQLContext.</span><span class="si">{</span><span class="n">field</span><span class="si">}</span><span class="s2"> is required&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>The MQL string alone is not enough to fully describe a query.
This class contains all of the additional information needed to
execute a metrics query in snuba.</p>

<p>It should be noted that this class is used as an intermediary encoding
class for data in the the MetricsQuery class that can't be encoded into
MQL. As such it shouldn't be used directly by users of the SDK.</p>

<p>This also means that the validation here is quite loose, since this object
should be created exclusively from a valid MetricsQuery object.</p>
</div>


                            <div id="MQLContext.__init__" class="classattr">
                                <div class="attr function">
            
        <span class="name">MQLContext</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">start</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">end</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">rollup</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]</span>,</span><span class="param">	<span class="n">scope</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span>,</span><span class="param">	<span class="n">indexer_mappings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">int</span><span class="p">]</span>,</span><span class="param">	<span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">offset</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">extrapolate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></span>)</span>

        
    </div>
    <a class="headerlink" href="#MQLContext.__init__"></a>
    
    

                            </div>
                            <div id="MQLContext.start" class="classattr">
                                <div class="attr variable">
            <span class="name">start</span><span class="annotation">: str</span>

        
    </div>
    <a class="headerlink" href="#MQLContext.start"></a>
    
    

                            </div>
                            <div id="MQLContext.end" class="classattr">
                                <div class="attr variable">
            <span class="name">end</span><span class="annotation">: str</span>

        
    </div>
    <a class="headerlink" href="#MQLContext.end"></a>
    
    

                            </div>
                            <div id="MQLContext.rollup" class="classattr">
                                <div class="attr variable">
            <span class="name">rollup</span><span class="annotation">: dict[str, str | int | None]</span>

        
    </div>
    <a class="headerlink" href="#MQLContext.rollup"></a>
    
    

                            </div>
                            <div id="MQLContext.scope" class="classattr">
                                <div class="attr variable">
            <span class="name">scope</span><span class="annotation">: dict[str, str | list[int]]</span>

        
    </div>
    <a class="headerlink" href="#MQLContext.scope"></a>
    
    

                            </div>
                            <div id="MQLContext.indexer_mappings" class="classattr">
                                <div class="attr variable">
            <span class="name">indexer_mappings</span><span class="annotation">: dict[str, str | int]</span>

        
    </div>
    <a class="headerlink" href="#MQLContext.indexer_mappings"></a>
    
    

                            </div>
                            <div id="MQLContext.limit" class="classattr">
                                <div class="attr variable">
            <span class="name">limit</span><span class="annotation">: int | None</span>        =
<span class="default_value">None</span>

        
    </div>
    <a class="headerlink" href="#MQLContext.limit"></a>
    
    

                            </div>
                            <div id="MQLContext.offset" class="classattr">
                                <div class="attr variable">
            <span class="name">offset</span><span class="annotation">: int | None</span>        =
<span class="default_value">None</span>

        
    </div>
    <a class="headerlink" href="#MQLContext.offset"></a>
    
    

                            </div>
                            <div id="MQLContext.extrapolate" class="classattr">
                                <div class="attr variable">
            <span class="name">extrapolate</span><span class="annotation">: bool | None</span>        =
<span class="default_value">None</span>

        
    </div>
    <a class="headerlink" href="#MQLContext.extrapolate"></a>
    
    

                            </div>
                            <div id="MQLContext.validate" class="classattr">
                                        <input id="MQLContext.validate-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">validate</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="MQLContext.validate-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MQLContext.validate"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MQLContext.validate-38"><a href="#MQLContext.validate-38"><span class="linenos">38</span></a>    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MQLContext.validate-39"><a href="#MQLContext.validate-39"><span class="linenos">39</span></a>        <span class="c1"># Simple assert that all the expected fields are present</span>
</span><span id="MQLContext.validate-40"><a href="#MQLContext.validate-40"><span class="linenos">40</span></a>        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;start&quot;</span><span class="p">,</span> <span class="s2">&quot;end&quot;</span><span class="p">,</span> <span class="s2">&quot;rollup&quot;</span><span class="p">,</span> <span class="s2">&quot;scope&quot;</span><span class="p">,</span> <span class="s2">&quot;indexer_mappings&quot;</span><span class="p">]</span>
</span><span id="MQLContext.validate-41"><a href="#MQLContext.validate-41"><span class="linenos">41</span></a>        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">:</span>
</span><span id="MQLContext.validate-42"><a href="#MQLContext.validate-42"><span class="linenos">42</span></a>            <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MQLContext.validate-43"><a href="#MQLContext.validate-43"><span class="linenos">43</span></a>                <span class="k">raise</span> <span class="n">InvalidMQLContextError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;MQLContext.</span><span class="si">{</span><span class="n">field</span><span class="si">}</span><span class="s2"> is required&quot;</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                </section>
                <section id="Offset">
                            <input id="Offset-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
                    <div class="decorator">@dataclass(frozen=True)</div>

    <span class="def">class</span>
    <span class="name">Offset</span><wbr>(<span class="base">snuba_sdk.expressions.Expression</span>):

                <label class="view-source-button" for="Offset-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Offset"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Offset-99"><a href="#Offset-99"><span class="linenos"> 99</span></a><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Offset-100"><a href="#Offset-100"><span class="linenos">100</span></a><span class="k">class</span> <span class="nc">Offset</span><span class="p">(</span><span class="n">Expression</span><span class="p">):</span>
</span><span id="Offset-101"><a href="#Offset-101"><span class="linenos">101</span></a>    <span class="n">offset</span><span class="p">:</span> <span class="nb">int</span>
</span><span id="Offset-102"><a href="#Offset-102"><span class="linenos">102</span></a>
</span><span id="Offset-103"><a href="#Offset-103"><span class="linenos">103</span></a>    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Offset-104"><a href="#Offset-104"><span class="linenos">104</span></a>        <span class="n">_validate_int_literal</span><span class="p">(</span><span class="s2">&quot;offset&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span></pre></div>


    

                            <div id="Offset.__init__" class="classattr">
                                <div class="attr function">
            
        <span class="name">Offset</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">offset</span><span class="p">:</span> <span class="nb">int</span></span>)</span>

        
    </div>
    <a class="headerlink" href="#Offset.__init__"></a>
    
    

                            </div>
                            <div id="Offset.offset" class="classattr">
                                <div class="attr variable">
            <span class="name">offset</span><span class="annotation">: int</span>

        
    </div>
    <a class="headerlink" href="#Offset.offset"></a>
    
    

                            </div>
                            <div id="Offset.validate" class="classattr">
                                        <input id="Offset.validate-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">validate</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="Offset.validate-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Offset.validate"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Offset.validate-103"><a href="#Offset.validate-103"><span class="linenos">103</span></a>    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Offset.validate-104"><a href="#Offset.validate-104"><span class="linenos">104</span></a>        <span class="n">_validate_int_literal</span><span class="p">(</span><span class="s2">&quot;offset&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                </section>
                <section id="Op">
                            <input id="Op-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Op</span><wbr>(<span class="base">enum.Enum</span>):

                <label class="view-source-button" for="Op-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Op"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Op-22"><a href="#Op-22"><span class="linenos">22</span></a><span class="k">class</span> <span class="nc">Op</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
</span><span id="Op-23"><a href="#Op-23"><span class="linenos">23</span></a>    <span class="n">GT</span> <span class="o">=</span> <span class="s2">&quot;&gt;&quot;</span>
</span><span id="Op-24"><a href="#Op-24"><span class="linenos">24</span></a>    <span class="n">LT</span> <span class="o">=</span> <span class="s2">&quot;&lt;&quot;</span>
</span><span id="Op-25"><a href="#Op-25"><span class="linenos">25</span></a>    <span class="n">GTE</span> <span class="o">=</span> <span class="s2">&quot;&gt;=&quot;</span>
</span><span id="Op-26"><a href="#Op-26"><span class="linenos">26</span></a>    <span class="n">LTE</span> <span class="o">=</span> <span class="s2">&quot;&lt;=&quot;</span>
</span><span id="Op-27"><a href="#Op-27"><span class="linenos">27</span></a>    <span class="n">EQ</span> <span class="o">=</span> <span class="s2">&quot;=&quot;</span>
</span><span id="Op-28"><a href="#Op-28"><span class="linenos">28</span></a>    <span class="n">NEQ</span> <span class="o">=</span> <span class="s2">&quot;!=&quot;</span>
</span><span id="Op-29"><a href="#Op-29"><span class="linenos">29</span></a>    <span class="n">IN</span> <span class="o">=</span> <span class="s2">&quot;IN&quot;</span>
</span><span id="Op-30"><a href="#Op-30"><span class="linenos">30</span></a>    <span class="n">NOT_IN</span> <span class="o">=</span> <span class="s2">&quot;NOT IN&quot;</span>
</span><span id="Op-31"><a href="#Op-31"><span class="linenos">31</span></a>    <span class="n">LIKE</span> <span class="o">=</span> <span class="s2">&quot;LIKE&quot;</span>
</span><span id="Op-32"><a href="#Op-32"><span class="linenos">32</span></a>    <span class="n">NOT_LIKE</span> <span class="o">=</span> <span class="s2">&quot;NOT LIKE&quot;</span>
</span><span id="Op-33"><a href="#Op-33"><span class="linenos">33</span></a>    <span class="n">IS_NULL</span> <span class="o">=</span> <span class="s2">&quot;IS NULL&quot;</span>
</span><span id="Op-34"><a href="#Op-34"><span class="linenos">34</span></a>    <span class="n">IS_NOT_NULL</span> <span class="o">=</span> <span class="s2">&quot;IS NOT NULL&quot;</span>
</span><span id="Op-35"><a href="#Op-35"><span class="linenos">35</span></a>    <span class="n">NOT</span> <span class="o">=</span> <span class="s2">&quot;!&quot;</span>
</span></pre></div>


            <div class="docstring"><p>Create a collection of name/value pairs.</p>

<p>Example enumeration:</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">Color</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">RED</span> <span class="o">=</span> <span class="mi">1</span>
<span class="gp">... </span>    <span class="n">BLUE</span> <span class="o">=</span> <span class="mi">2</span>
<span class="gp">... </span>    <span class="n">GREEN</span> <span class="o">=</span> <span class="mi">3</span>
</code></pre>
</div>

<p>Access them by:</p>

<ul>
<li>attribute access::</li>
</ul>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">Color</span><span class="o">.</span><span class="n">RED</span>
<span class="go">&lt;Color.RED: 1&gt;</span>
</code></pre>
</div>

<ul>
<li>value lookup:</li>
</ul>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">Color</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="go">&lt;Color.RED: 1&gt;</span>
</code></pre>
</div>

<ul>
<li>name lookup:</li>
</ul>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">Color</span><span class="p">[</span><span class="s1">&#39;RED&#39;</span><span class="p">]</span>
<span class="go">&lt;Color.RED: 1&gt;</span>
</code></pre>
</div>

<p>Enumerations can be iterated over, and know how many members they have:</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">Color</span><span class="p">)</span>
<span class="go">3</span>
</code></pre>
</div>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">Color</span><span class="p">)</span>
<span class="go">[&lt;Color.RED: 1&gt;, &lt;Color.BLUE: 2&gt;, &lt;Color.GREEN: 3&gt;]</span>
</code></pre>
</div>

<p>Methods can be added to enumerations, and members can have their own
attributes -- see the documentation for details.</p>
</div>


                            <div id="Op.GT" class="classattr">
                                <div class="attr variable">
            <span class="name">GT</span>        =
<span class="default_value">&lt;<a href="#Op.GT">Op.GT</a>: &#39;&gt;&#39;&gt;</span>

        
    </div>
    <a class="headerlink" href="#Op.GT"></a>
    
    

                            </div>
                            <div id="Op.LT" class="classattr">
                                <div class="attr variable">
            <span class="name">LT</span>        =
<span class="default_value">&lt;<a href="#Op.LT">Op.LT</a>: &#39;&lt;&#39;&gt;</span>

        
    </div>
    <a class="headerlink" href="#Op.LT"></a>
    
    

                            </div>
                            <div id="Op.GTE" class="classattr">
                                <div class="attr variable">
            <span class="name">GTE</span>        =
<span class="default_value">&lt;<a href="#Op.GTE">Op.GTE</a>: &#39;&gt;=&#39;&gt;</span>

        
    </div>
    <a class="headerlink" href="#Op.GTE"></a>
    
    

                            </div>
                            <div id="Op.LTE" class="classattr">
                                <div class="attr variable">
            <span class="name">LTE</span>        =
<span class="default_value">&lt;<a href="#Op.LTE">Op.LTE</a>: &#39;&lt;=&#39;&gt;</span>

        
    </div>
    <a class="headerlink" href="#Op.LTE"></a>
    
    

                            </div>
                            <div id="Op.EQ" class="classattr">
                                <div class="attr variable">
            <span class="name">EQ</span>        =
<span class="default_value">&lt;<a href="#Op.EQ">Op.EQ</a>: &#39;=&#39;&gt;</span>

        
    </div>
    <a class="headerlink" href="#Op.EQ"></a>
    
    

                            </div>
                            <div id="Op.NEQ" class="classattr">
                                <div class="attr variable">
            <span class="name">NEQ</span>        =
<span class="default_value">&lt;<a href="#Op.NEQ">Op.NEQ</a>: &#39;!=&#39;&gt;</span>

        
    </div>
    <a class="headerlink" href="#Op.NEQ"></a>
    
    

                            </div>
                            <div id="Op.IN" class="classattr">
                                <div class="attr variable">
            <span class="name">IN</span>        =
<span class="default_value">&lt;<a href="#Op.IN">Op.IN</a>: &#39;IN&#39;&gt;</span>

        
    </div>
    <a class="headerlink" href="#Op.IN"></a>
    
    

                            </div>
                            <div id="Op.NOT_IN" class="classattr">
                                <div class="attr variable">
            <span class="name">NOT_IN</span>        =
<span class="default_value">&lt;<a href="#Op.NOT_IN">Op.NOT_IN</a>: &#39;NOT IN&#39;&gt;</span>

        
    </div>
    <a class="headerlink" href="#Op.NOT_IN"></a>
    
    

                            </div>
                            <div id="Op.LIKE" class="classattr">
                                <div class="attr variable">
            <span class="name">LIKE</span>        =
<span class="default_value">&lt;<a href="#Op.LIKE">Op.LIKE</a>: &#39;LIKE&#39;&gt;</span>

        
    </div>
    <a class="headerlink" href="#Op.LIKE"></a>
    
    

                            </div>
                            <div id="Op.NOT_LIKE" class="classattr">
                                <div class="attr variable">
            <span class="name">NOT_LIKE</span>        =
<span class="default_value">&lt;<a href="#Op.NOT_LIKE">Op.NOT_LIKE</a>: &#39;NOT LIKE&#39;&gt;</span>

        
    </div>
    <a class="headerlink" href="#Op.NOT_LIKE"></a>
    
    

                            </div>
                            <div id="Op.IS_NULL" class="classattr">
                                <div class="attr variable">
            <span class="name">IS_NULL</span>        =
<span class="default_value">&lt;<a href="#Op.IS_NULL">Op.IS_NULL</a>: &#39;IS NULL&#39;&gt;</span>

        
    </div>
    <a class="headerlink" href="#Op.IS_NULL"></a>
    
    

                            </div>
                            <div id="Op.IS_NOT_NULL" class="classattr">
                                <div class="attr variable">
            <span class="name">IS_NOT_NULL</span>        =
<span class="default_value">&lt;<a href="#Op.IS_NOT_NULL">Op.IS_NOT_NULL</a>: &#39;IS NOT NULL&#39;&gt;</span>

        
    </div>
    <a class="headerlink" href="#Op.IS_NOT_NULL"></a>
    
    

                            </div>
                            <div id="Op.NOT" class="classattr">
                                <div class="attr variable">
            <span class="name">NOT</span>        =
<span class="default_value">&lt;<a href="#Op.NOT">Op.NOT</a>: &#39;!&#39;&gt;</span>

        
    </div>
    <a class="headerlink" href="#Op.NOT"></a>
    
    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>enum.Enum</dt>
                                <dd id="Op.name" class="variable">name</dd>
                <dd id="Op.value" class="variable">value</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="Or">
                            <input id="Or-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
                    <div class="decorator">@dataclass(frozen=True)</div>

    <span class="def">class</span>
    <span class="name">Or</span><wbr>(<span class="base"><a href="#BooleanCondition">snuba_sdk.BooleanCondition</a></span>):

                <label class="view-source-button" for="Or-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Or"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Or-141"><a href="#Or-141"><span class="linenos">141</span></a><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Or-142"><a href="#Or-142"><span class="linenos">142</span></a><span class="k">class</span> <span class="nc">Or</span><span class="p">(</span><span class="n">BooleanCondition</span><span class="p">):</span>
</span><span id="Or-143"><a href="#Or-143"><span class="linenos">143</span></a>    <span class="n">op</span><span class="p">:</span> <span class="n">BooleanOp</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">init</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">BooleanOp</span><span class="o">.</span><span class="n">OR</span><span class="p">)</span>
</span><span id="Or-144"><a href="#Or-144"><span class="linenos">144</span></a>    <span class="n">conditions</span><span class="p">:</span> <span class="n">ConditionGroup</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
</span></pre></div>


    

                            <div id="Or.__init__" class="classattr">
                                <div class="attr function">
            
        <span class="name">Or</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">conditions</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n"><a href="#BooleanCondition">BooleanCondition</a></span><span class="p">,</span> <span class="n"><a href="#Condition">Condition</a></span><span class="p">]]</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">factory</span><span class="o">&gt;</span></span>)</span>

        
    </div>
    <a class="headerlink" href="#Or.__init__"></a>
    
    

                            </div>
                            <div id="Or.op" class="classattr">
                                <div class="attr variable">
            <span class="name">op</span><span class="annotation">: <a href="#BooleanOp">BooleanOp</a></span>        =
<span class="default_value">&lt;<a href="#BooleanOp.OR">BooleanOp.OR</a>: &#39;OR&#39;&gt;</span>

        
    </div>
    <a class="headerlink" href="#Or.op"></a>
    
    

                            </div>
                            <div id="Or.conditions" class="classattr">
                                <div class="attr variable">
            <span class="name">conditions</span><span class="annotation">: Sequence[Union[<a href="#BooleanCondition">BooleanCondition</a>, <a href="#Condition">Condition</a>]]</span>

        
    </div>
    <a class="headerlink" href="#Or.conditions"></a>
    
    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#BooleanCondition">BooleanCondition</a></dt>
                                <dd id="Or.validate" class="function"><a href="#BooleanCondition.validate">validate</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="OrderBy">
                            <input id="OrderBy-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
                    <div class="decorator">@dataclass(frozen=True)</div>

    <span class="def">class</span>
    <span class="name">OrderBy</span><wbr>(<span class="base">snuba_sdk.expressions.Expression</span>):

                <label class="view-source-button" for="OrderBy-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#OrderBy"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="OrderBy-16"><a href="#OrderBy-16"><span class="linenos">16</span></a><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="OrderBy-17"><a href="#OrderBy-17"><span class="linenos">17</span></a><span class="k">class</span> <span class="nc">OrderBy</span><span class="p">(</span><span class="n">Expression</span><span class="p">):</span>
</span><span id="OrderBy-18"><a href="#OrderBy-18"><span class="linenos">18</span></a>    <span class="n">exp</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Column</span><span class="p">,</span> <span class="n">CurriedFunction</span><span class="p">,</span> <span class="n">Function</span><span class="p">]</span>
</span><span id="OrderBy-19"><a href="#OrderBy-19"><span class="linenos">19</span></a>    <span class="n">direction</span><span class="p">:</span> <span class="n">Direction</span>
</span><span id="OrderBy-20"><a href="#OrderBy-20"><span class="linenos">20</span></a>
</span><span id="OrderBy-21"><a href="#OrderBy-21"><span class="linenos">21</span></a>    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="OrderBy-22"><a href="#OrderBy-22"><span class="linenos">22</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exp</span><span class="p">,</span> <span class="p">(</span><span class="n">Column</span><span class="p">,</span> <span class="n">CurriedFunction</span><span class="p">,</span> <span class="n">Function</span><span class="p">)):</span>
</span><span id="OrderBy-23"><a href="#OrderBy-23"><span class="linenos">23</span></a>            <span class="k">raise</span> <span class="n">InvalidExpressionError</span><span class="p">(</span>
</span><span id="OrderBy-24"><a href="#OrderBy-24"><span class="linenos">24</span></a>                <span class="s2">&quot;OrderBy expression must be a Column, CurriedFunction or Function&quot;</span>
</span><span id="OrderBy-25"><a href="#OrderBy-25"><span class="linenos">25</span></a>            <span class="p">)</span>
</span><span id="OrderBy-26"><a href="#OrderBy-26"><span class="linenos">26</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">direction</span><span class="p">,</span> <span class="n">Direction</span><span class="p">):</span>
</span><span id="OrderBy-27"><a href="#OrderBy-27"><span class="linenos">27</span></a>            <span class="k">raise</span> <span class="n">InvalidExpressionError</span><span class="p">(</span><span class="s2">&quot;OrderBy direction must be a Direction&quot;</span><span class="p">)</span>
</span></pre></div>


    

                            <div id="OrderBy.__init__" class="classattr">
                                <div class="attr function">
            
        <span class="name">OrderBy</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">exp</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#Column">Column</a></span><span class="p">,</span> <span class="n"><a href="#CurriedFunction">CurriedFunction</a></span><span class="p">,</span> <span class="n"><a href="#Function">Function</a></span><span class="p">]</span>,</span><span class="param">	<span class="n">direction</span><span class="p">:</span> <span class="n"><a href="#Direction">Direction</a></span></span>)</span>

        
    </div>
    <a class="headerlink" href="#OrderBy.__init__"></a>
    
    

                            </div>
                            <div id="OrderBy.exp" class="classattr">
                                <div class="attr variable">
            <span class="name">exp</span><span class="annotation">: Union[<a href="#Column">Column</a>, <a href="#CurriedFunction">CurriedFunction</a>, <a href="#Function">Function</a>]</span>

        
    </div>
    <a class="headerlink" href="#OrderBy.exp"></a>
    
    

                            </div>
                            <div id="OrderBy.direction" class="classattr">
                                <div class="attr variable">
            <span class="name">direction</span><span class="annotation">: <a href="#Direction">Direction</a></span>

        
    </div>
    <a class="headerlink" href="#OrderBy.direction"></a>
    
    

                            </div>
                            <div id="OrderBy.validate" class="classattr">
                                        <input id="OrderBy.validate-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">validate</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="OrderBy.validate-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#OrderBy.validate"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="OrderBy.validate-21"><a href="#OrderBy.validate-21"><span class="linenos">21</span></a>    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="OrderBy.validate-22"><a href="#OrderBy.validate-22"><span class="linenos">22</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exp</span><span class="p">,</span> <span class="p">(</span><span class="n">Column</span><span class="p">,</span> <span class="n">CurriedFunction</span><span class="p">,</span> <span class="n">Function</span><span class="p">)):</span>
</span><span id="OrderBy.validate-23"><a href="#OrderBy.validate-23"><span class="linenos">23</span></a>            <span class="k">raise</span> <span class="n">InvalidExpressionError</span><span class="p">(</span>
</span><span id="OrderBy.validate-24"><a href="#OrderBy.validate-24"><span class="linenos">24</span></a>                <span class="s2">&quot;OrderBy expression must be a Column, CurriedFunction or Function&quot;</span>
</span><span id="OrderBy.validate-25"><a href="#OrderBy.validate-25"><span class="linenos">25</span></a>            <span class="p">)</span>
</span><span id="OrderBy.validate-26"><a href="#OrderBy.validate-26"><span class="linenos">26</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">direction</span><span class="p">,</span> <span class="n">Direction</span><span class="p">):</span>
</span><span id="OrderBy.validate-27"><a href="#OrderBy.validate-27"><span class="linenos">27</span></a>            <span class="k">raise</span> <span class="n">InvalidExpressionError</span><span class="p">(</span><span class="s2">&quot;OrderBy direction must be a Direction&quot;</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                </section>
                <section id="Query">
                            <input id="Query-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
                    <div class="decorator">@dataclass(frozen=True)</div>

    <span class="def">class</span>
    <span class="name">Query</span><wbr>(<span class="base">snuba_sdk.query.BaseQuery</span>):

                <label class="view-source-button" for="Query-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Query"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Query-56"><a href="#Query-56"><span class="linenos"> 56</span></a><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Query-57"><a href="#Query-57"><span class="linenos"> 57</span></a><span class="k">class</span> <span class="nc">Query</span><span class="p">(</span><span class="n">BaseQuery</span><span class="p">):</span>
</span><span id="Query-58"><a href="#Query-58"><span class="linenos"> 58</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Query-59"><a href="#Query-59"><span class="linenos"> 59</span></a><span class="sd">    A code representation of a SnQL query. It is immutable, so any set functions</span>
</span><span id="Query-60"><a href="#Query-60"><span class="linenos"> 60</span></a><span class="sd">    return a new copy of the query. Unlike Expressions it is possible to</span>
</span><span id="Query-61"><a href="#Query-61"><span class="linenos"> 61</span></a><span class="sd">    instantiate a Query that is invalid. Any of the translation functions will</span>
</span><span id="Query-62"><a href="#Query-62"><span class="linenos"> 62</span></a><span class="sd">    validate the query before translating them, so the query must be valid before</span>
</span><span id="Query-63"><a href="#Query-63"><span class="linenos"> 63</span></a><span class="sd">    they are called.</span>
</span><span id="Query-64"><a href="#Query-64"><span class="linenos"> 64</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="Query-65"><a href="#Query-65"><span class="linenos"> 65</span></a>
</span><span id="Query-66"><a href="#Query-66"><span class="linenos"> 66</span></a>    <span class="c1"># These must be listed in the order that they must appear in the SnQL query.</span>
</span><span id="Query-67"><a href="#Query-67"><span class="linenos"> 67</span></a>    <span class="n">match</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Entity</span><span class="p">,</span> <span class="n">Storage</span><span class="p">,</span> <span class="n">Join</span><span class="p">,</span> <span class="n">Query</span><span class="p">]</span>
</span><span id="Query-68"><a href="#Query-68"><span class="linenos"> 68</span></a>    <span class="n">select</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="n">SelectableExpression</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Query-69"><a href="#Query-69"><span class="linenos"> 69</span></a>    <span class="n">groupby</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="n">SelectableExpression</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Query-70"><a href="#Query-70"><span class="linenos"> 70</span></a>    <span class="n">array_join</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="n">Column</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Query-71"><a href="#Query-71"><span class="linenos"> 71</span></a>    <span class="n">where</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ConditionGroup</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Query-72"><a href="#Query-72"><span class="linenos"> 72</span></a>    <span class="n">having</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ConditionGroup</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Query-73"><a href="#Query-73"><span class="linenos"> 73</span></a>    <span class="n">orderby</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="n">OrderBy</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Query-74"><a href="#Query-74"><span class="linenos"> 74</span></a>    <span class="n">limitby</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">LimitBy</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Query-75"><a href="#Query-75"><span class="linenos"> 75</span></a>    <span class="n">limit</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Limit</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Query-76"><a href="#Query-76"><span class="linenos"> 76</span></a>    <span class="n">offset</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Offset</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Query-77"><a href="#Query-77"><span class="linenos"> 77</span></a>    <span class="n">granularity</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Granularity</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Query-78"><a href="#Query-78"><span class="linenos"> 78</span></a>    <span class="n">totals</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Totals</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Query-79"><a href="#Query-79"><span class="linenos"> 79</span></a>
</span><span id="Query-80"><a href="#Query-80"><span class="linenos"> 80</span></a>    <span class="k">def</span> <span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Query-81"><a href="#Query-81"><span class="linenos"> 81</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Query-82"><a href="#Query-82"><span class="linenos"> 82</span></a><span class="sd">        This has a different validation flow from normal expressions, since a query</span>
</span><span id="Query-83"><a href="#Query-83"><span class="linenos"> 83</span></a><span class="sd">        is not necessarily always correct. For example, you can create a Query with</span>
</span><span id="Query-84"><a href="#Query-84"><span class="linenos"> 84</span></a><span class="sd">        no select columns, which will fail in the validate. However it shouldn&#39;t fail</span>
</span><span id="Query-85"><a href="#Query-85"><span class="linenos"> 85</span></a><span class="sd">        right away since the select columns can be added later.</span>
</span><span id="Query-86"><a href="#Query-86"><span class="linenos"> 86</span></a>
</span><span id="Query-87"><a href="#Query-87"><span class="linenos"> 87</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Query-88"><a href="#Query-88"><span class="linenos"> 88</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">match</span><span class="p">,</span> <span class="p">(</span><span class="n">Query</span><span class="p">,</span> <span class="n">Join</span><span class="p">,</span> <span class="n">Entity</span><span class="p">,</span> <span class="n">Storage</span><span class="p">)):</span>
</span><span id="Query-89"><a href="#Query-89"><span class="linenos"> 89</span></a>            <span class="k">raise</span> <span class="n">InvalidQueryError</span><span class="p">(</span>
</span><span id="Query-90"><a href="#Query-90"><span class="linenos"> 90</span></a>                <span class="s2">&quot;queries must have a valid Entity, Storage, Join or Query&quot;</span>
</span><span id="Query-91"><a href="#Query-91"><span class="linenos"> 91</span></a>            <span class="p">)</span>
</span><span id="Query-92"><a href="#Query-92"><span class="linenos"> 92</span></a>
</span><span id="Query-93"><a href="#Query-93"><span class="linenos"> 93</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">match</span><span class="p">,</span> <span class="n">Query</span><span class="p">):</span>
</span><span id="Query-94"><a href="#Query-94"><span class="linenos"> 94</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="Query-95"><a href="#Query-95"><span class="linenos"> 95</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">match</span><span class="o">.</span><span class="n">validate</span><span class="p">()</span>
</span><span id="Query-96"><a href="#Query-96"><span class="linenos"> 96</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="Query-97"><a href="#Query-97"><span class="linenos"> 97</span></a>                <span class="k">raise</span> <span class="n">InvalidQueryError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;inner query is invalid: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>
</span><span id="Query-98"><a href="#Query-98"><span class="linenos"> 98</span></a>
</span><span id="Query-99"><a href="#Query-99"><span class="linenos"> 99</span></a>    <span class="k">def</span> <span class="nf">_replace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Query</span><span class="p">:</span>
</span><span id="Query-100"><a href="#Query-100"><span class="linenos">100</span></a>        <span class="n">new</span> <span class="o">=</span> <span class="n">replace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="p">{</span><span class="n">field</span><span class="p">:</span> <span class="n">value</span><span class="p">})</span>
</span><span id="Query-101"><a href="#Query-101"><span class="linenos">101</span></a>        <span class="k">return</span> <span class="n">new</span>
</span><span id="Query-102"><a href="#Query-102"><span class="linenos">102</span></a>
</span><span id="Query-103"><a href="#Query-103"><span class="linenos">103</span></a>    <span class="k">def</span> <span class="nf">set_match</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">match</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Entity</span><span class="p">,</span> <span class="n">Storage</span><span class="p">,</span> <span class="n">Join</span><span class="p">,</span> <span class="n">Query</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Query</span><span class="p">:</span>
</span><span id="Query-104"><a href="#Query-104"><span class="linenos">104</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">match</span><span class="p">,</span> <span class="p">(</span><span class="n">Entity</span><span class="p">,</span> <span class="n">Join</span><span class="p">,</span> <span class="n">Query</span><span class="p">)):</span>
</span><span id="Query-105"><a href="#Query-105"><span class="linenos">105</span></a>            <span class="k">raise</span> <span class="n">InvalidQueryError</span><span class="p">(</span>
</span><span id="Query-106"><a href="#Query-106"><span class="linenos">106</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">match</span><span class="si">}</span><span class="s2"> must be a valid Entity, Storage, Join or Query&quot;</span>
</span><span id="Query-107"><a href="#Query-107"><span class="linenos">107</span></a>            <span class="p">)</span>
</span><span id="Query-108"><a href="#Query-108"><span class="linenos">108</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">match</span><span class="p">,</span> <span class="n">Query</span><span class="p">):</span>
</span><span id="Query-109"><a href="#Query-109"><span class="linenos">109</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="Query-110"><a href="#Query-110"><span class="linenos">110</span></a>                <span class="k">match</span><span class="o">.</span><span class="n">validate</span><span class="p">()</span>
</span><span id="Query-111"><a href="#Query-111"><span class="linenos">111</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="Query-112"><a href="#Query-112"><span class="linenos">112</span></a>                <span class="k">raise</span> <span class="n">InvalidQueryError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;inner query is invalid: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>
</span><span id="Query-113"><a href="#Query-113"><span class="linenos">113</span></a>
</span><span id="Query-114"><a href="#Query-114"><span class="linenos">114</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="s2">&quot;match&quot;</span><span class="p">,</span> <span class="n">match</span><span class="p">)</span>
</span><span id="Query-115"><a href="#Query-115"><span class="linenos">115</span></a>
</span><span id="Query-116"><a href="#Query-116"><span class="linenos">116</span></a>    <span class="k">def</span> <span class="nf">set_select</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">select</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">SelectableExpression</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Query</span><span class="p">:</span>
</span><span id="Query-117"><a href="#Query-117"><span class="linenos">117</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">list_type</span><span class="p">(</span><span class="n">select</span><span class="p">,</span> <span class="n">SelectableExpressionType</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">select</span><span class="p">:</span>
</span><span id="Query-118"><a href="#Query-118"><span class="linenos">118</span></a>            <span class="k">raise</span> <span class="n">InvalidQueryError</span><span class="p">(</span>
</span><span id="Query-119"><a href="#Query-119"><span class="linenos">119</span></a>                <span class="s2">&quot;select clause must be a non-empty list of SelectableExpression&quot;</span>
</span><span id="Query-120"><a href="#Query-120"><span class="linenos">120</span></a>            <span class="p">)</span>
</span><span id="Query-121"><a href="#Query-121"><span class="linenos">121</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="s2">&quot;select&quot;</span><span class="p">,</span> <span class="n">select</span><span class="p">)</span>
</span><span id="Query-122"><a href="#Query-122"><span class="linenos">122</span></a>
</span><span id="Query-123"><a href="#Query-123"><span class="linenos">123</span></a>    <span class="k">def</span> <span class="nf">set_groupby</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">groupby</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">SelectableExpression</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Query</span><span class="p">:</span>
</span><span id="Query-124"><a href="#Query-124"><span class="linenos">124</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">list_type</span><span class="p">(</span><span class="n">groupby</span><span class="p">,</span> <span class="n">SelectableExpressionType</span><span class="p">):</span>
</span><span id="Query-125"><a href="#Query-125"><span class="linenos">125</span></a>            <span class="k">raise</span> <span class="n">InvalidQueryError</span><span class="p">(</span>
</span><span id="Query-126"><a href="#Query-126"><span class="linenos">126</span></a>                <span class="s2">&quot;groupby clause must be a list of SelectableExpression&quot;</span>
</span><span id="Query-127"><a href="#Query-127"><span class="linenos">127</span></a>            <span class="p">)</span>
</span><span id="Query-128"><a href="#Query-128"><span class="linenos">128</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="s2">&quot;groupby&quot;</span><span class="p">,</span> <span class="n">groupby</span><span class="p">)</span>
</span><span id="Query-129"><a href="#Query-129"><span class="linenos">129</span></a>
</span><span id="Query-130"><a href="#Query-130"><span class="linenos">130</span></a>    <span class="k">def</span> <span class="nf">set_array_join</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">array_join</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Column</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Query</span><span class="p">:</span>
</span><span id="Query-131"><a href="#Query-131"><span class="linenos">131</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">list_type</span><span class="p">(</span><span class="n">array_join</span><span class="p">,</span> <span class="p">[</span><span class="n">Column</span><span class="p">])</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">array_join</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Query-132"><a href="#Query-132"><span class="linenos">132</span></a>            <span class="k">raise</span> <span class="n">InvalidQueryError</span><span class="p">(</span><span class="s2">&quot;array join must be a non-empty list of Column&quot;</span><span class="p">)</span>
</span><span id="Query-133"><a href="#Query-133"><span class="linenos">133</span></a>
</span><span id="Query-134"><a href="#Query-134"><span class="linenos">134</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="s2">&quot;array_join&quot;</span><span class="p">,</span> <span class="n">array_join</span><span class="p">)</span>
</span><span id="Query-135"><a href="#Query-135"><span class="linenos">135</span></a>
</span><span id="Query-136"><a href="#Query-136"><span class="linenos">136</span></a>    <span class="k">def</span> <span class="nf">set_where</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">conditions</span><span class="p">:</span> <span class="n">ConditionGroup</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Query</span><span class="p">:</span>
</span><span id="Query-137"><a href="#Query-137"><span class="linenos">137</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">list_type</span><span class="p">(</span><span class="n">conditions</span><span class="p">,</span> <span class="p">(</span><span class="n">BooleanCondition</span><span class="p">,</span> <span class="n">Condition</span><span class="p">)):</span>
</span><span id="Query-138"><a href="#Query-138"><span class="linenos">138</span></a>            <span class="k">raise</span> <span class="n">InvalidQueryError</span><span class="p">(</span><span class="s2">&quot;where clause must be a list of conditions&quot;</span><span class="p">)</span>
</span><span id="Query-139"><a href="#Query-139"><span class="linenos">139</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="s2">&quot;where&quot;</span><span class="p">,</span> <span class="n">conditions</span><span class="p">)</span>
</span><span id="Query-140"><a href="#Query-140"><span class="linenos">140</span></a>
</span><span id="Query-141"><a href="#Query-141"><span class="linenos">141</span></a>    <span class="k">def</span> <span class="nf">set_having</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">conditions</span><span class="p">:</span> <span class="n">ConditionGroup</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Query</span><span class="p">:</span>
</span><span id="Query-142"><a href="#Query-142"><span class="linenos">142</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">list_type</span><span class="p">(</span><span class="n">conditions</span><span class="p">,</span> <span class="p">(</span><span class="n">BooleanCondition</span><span class="p">,</span> <span class="n">Condition</span><span class="p">)):</span>
</span><span id="Query-143"><a href="#Query-143"><span class="linenos">143</span></a>            <span class="k">raise</span> <span class="n">InvalidQueryError</span><span class="p">(</span><span class="s2">&quot;having clause must be a list of conditions&quot;</span><span class="p">)</span>
</span><span id="Query-144"><a href="#Query-144"><span class="linenos">144</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="s2">&quot;having&quot;</span><span class="p">,</span> <span class="n">conditions</span><span class="p">)</span>
</span><span id="Query-145"><a href="#Query-145"><span class="linenos">145</span></a>
</span><span id="Query-146"><a href="#Query-146"><span class="linenos">146</span></a>    <span class="k">def</span> <span class="nf">set_orderby</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">orderby</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">OrderBy</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Query</span><span class="p">:</span>
</span><span id="Query-147"><a href="#Query-147"><span class="linenos">147</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">list_type</span><span class="p">(</span><span class="n">orderby</span><span class="p">,</span> <span class="p">(</span><span class="n">OrderBy</span><span class="p">,)):</span>
</span><span id="Query-148"><a href="#Query-148"><span class="linenos">148</span></a>            <span class="k">raise</span> <span class="n">InvalidQueryError</span><span class="p">(</span><span class="s2">&quot;orderby clause must be a list of OrderBy&quot;</span><span class="p">)</span>
</span><span id="Query-149"><a href="#Query-149"><span class="linenos">149</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="s2">&quot;orderby&quot;</span><span class="p">,</span> <span class="n">orderby</span><span class="p">)</span>
</span><span id="Query-150"><a href="#Query-150"><span class="linenos">150</span></a>
</span><span id="Query-151"><a href="#Query-151"><span class="linenos">151</span></a>    <span class="k">def</span> <span class="nf">set_limitby</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">limitby</span><span class="p">:</span> <span class="n">LimitBy</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Query</span><span class="p">:</span>
</span><span id="Query-152"><a href="#Query-152"><span class="linenos">152</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">limitby</span><span class="p">,</span> <span class="n">LimitBy</span><span class="p">):</span>
</span><span id="Query-153"><a href="#Query-153"><span class="linenos">153</span></a>            <span class="k">raise</span> <span class="n">InvalidQueryError</span><span class="p">(</span><span class="s2">&quot;limitby clause must be a LimitBy&quot;</span><span class="p">)</span>
</span><span id="Query-154"><a href="#Query-154"><span class="linenos">154</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="s2">&quot;limitby&quot;</span><span class="p">,</span> <span class="n">limitby</span><span class="p">)</span>
</span><span id="Query-155"><a href="#Query-155"><span class="linenos">155</span></a>
</span><span id="Query-156"><a href="#Query-156"><span class="linenos">156</span></a>    <span class="k">def</span> <span class="nf">set_limit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Query</span><span class="p">:</span>
</span><span id="Query-157"><a href="#Query-157"><span class="linenos">157</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="s2">&quot;limit&quot;</span><span class="p">,</span> <span class="n">Limit</span><span class="p">(</span><span class="n">limit</span><span class="p">))</span>
</span><span id="Query-158"><a href="#Query-158"><span class="linenos">158</span></a>
</span><span id="Query-159"><a href="#Query-159"><span class="linenos">159</span></a>    <span class="k">def</span> <span class="nf">set_offset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">offset</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Query</span><span class="p">:</span>
</span><span id="Query-160"><a href="#Query-160"><span class="linenos">160</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="s2">&quot;offset&quot;</span><span class="p">,</span> <span class="n">Offset</span><span class="p">(</span><span class="n">offset</span><span class="p">))</span>
</span><span id="Query-161"><a href="#Query-161"><span class="linenos">161</span></a>
</span><span id="Query-162"><a href="#Query-162"><span class="linenos">162</span></a>    <span class="k">def</span> <span class="nf">set_granularity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">granularity</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Query</span><span class="p">:</span>
</span><span id="Query-163"><a href="#Query-163"><span class="linenos">163</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="s2">&quot;granularity&quot;</span><span class="p">,</span> <span class="n">Granularity</span><span class="p">(</span><span class="n">granularity</span><span class="p">))</span>
</span><span id="Query-164"><a href="#Query-164"><span class="linenos">164</span></a>
</span><span id="Query-165"><a href="#Query-165"><span class="linenos">165</span></a>    <span class="k">def</span> <span class="nf">set_totals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">totals</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Query</span><span class="p">:</span>
</span><span id="Query-166"><a href="#Query-166"><span class="linenos">166</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="s2">&quot;totals&quot;</span><span class="p">,</span> <span class="n">Totals</span><span class="p">(</span><span class="n">totals</span><span class="p">))</span>
</span><span id="Query-167"><a href="#Query-167"><span class="linenos">167</span></a>
</span><span id="Query-168"><a href="#Query-168"><span class="linenos">168</span></a>    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Query-169"><a href="#Query-169"><span class="linenos">169</span></a>        <span class="n">VALIDATOR</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="Query-170"><a href="#Query-170"><span class="linenos">170</span></a>
</span><span id="Query-171"><a href="#Query-171"><span class="linenos">171</span></a>    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="Query-172"><a href="#Query-172"><span class="linenos">172</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">serialize</span><span class="p">()</span>
</span><span id="Query-173"><a href="#Query-173"><span class="linenos">173</span></a>
</span><span id="Query-174"><a href="#Query-174"><span class="linenos">174</span></a>    <span class="k">def</span> <span class="nf">serialize</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="Query-175"><a href="#Query-175"><span class="linenos">175</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">validate</span><span class="p">()</span>
</span><span id="Query-176"><a href="#Query-176"><span class="linenos">176</span></a>        <span class="n">optimized</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_optimize</span><span class="p">()</span>
</span><span id="Query-177"><a href="#Query-177"><span class="linenos">177</span></a>        <span class="k">return</span> <span class="n">Printer</span><span class="p">()</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">optimized</span><span class="p">)</span>
</span><span id="Query-178"><a href="#Query-178"><span class="linenos">178</span></a>
</span><span id="Query-179"><a href="#Query-179"><span class="linenos">179</span></a>    <span class="k">def</span> <span class="nf">print</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="Query-180"><a href="#Query-180"><span class="linenos">180</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">validate</span><span class="p">()</span>
</span><span id="Query-181"><a href="#Query-181"><span class="linenos">181</span></a>        <span class="k">return</span> <span class="n">Printer</span><span class="p">(</span><span class="n">pretty</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="Query-182"><a href="#Query-182"><span class="linenos">182</span></a>
</span><span id="Query-183"><a href="#Query-183"><span class="linenos">183</span></a>    <span class="k">def</span> <span class="nf">_optimize</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Query</span><span class="p">:</span>
</span><span id="Query-184"><a href="#Query-184"><span class="linenos">184</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">where</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Query-185"><a href="#Query-185"><span class="linenos">185</span></a>            <span class="n">new_where</span> <span class="o">=</span> <span class="n">OrOptimizer</span><span class="p">()</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">where</span><span class="p">)</span>
</span><span id="Query-186"><a href="#Query-186"><span class="linenos">186</span></a>            <span class="k">if</span> <span class="n">new_where</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Query-187"><a href="#Query-187"><span class="linenos">187</span></a>                <span class="k">return</span> <span class="n">replace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="n">new_where</span><span class="p">)</span>
</span><span id="Query-188"><a href="#Query-188"><span class="linenos">188</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span></pre></div>


            <div class="docstring"><p>A code representation of a SnQL query. It is immutable, so any set functions
return a new copy of the query. Unlike Expressions it is possible to
instantiate a Query that is invalid. Any of the translation functions will
validate the query before translating them, so the query must be valid before
they are called.</p>
</div>


                            <div id="Query.__init__" class="classattr">
                                <div class="attr function">
            
        <span class="name">Query</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">match</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#Entity">Entity</a></span><span class="p">,</span> <span class="n"><a href="#Storage">Storage</a></span><span class="p">,</span> <span class="n"><a href="#Join">Join</a></span><span class="p">,</span> <span class="n"><a href="#Query">Query</a></span><span class="p">]</span>,</span><span class="param">	<span class="n">select</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n"><a href="#AliasedExpression">AliasedExpression</a></span><span class="p">,</span> <span class="n"><a href="#Column">Column</a></span><span class="p">,</span> <span class="n"><a href="#CurriedFunction">CurriedFunction</a></span><span class="p">,</span> <span class="n"><a href="#Function">Function</a></span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">groupby</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n"><a href="#AliasedExpression">AliasedExpression</a></span><span class="p">,</span> <span class="n"><a href="#Column">Column</a></span><span class="p">,</span> <span class="n"><a href="#CurriedFunction">CurriedFunction</a></span><span class="p">,</span> <span class="n"><a href="#Function">Function</a></span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">array_join</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="n"><a href="#Column">Column</a></span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">where</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n"><a href="#BooleanCondition">BooleanCondition</a></span><span class="p">,</span> <span class="n"><a href="#Condition">Condition</a></span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">having</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n"><a href="#BooleanCondition">BooleanCondition</a></span><span class="p">,</span> <span class="n"><a href="#Condition">Condition</a></span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">orderby</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="n"><a href="#OrderBy">OrderBy</a></span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">limitby</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n"><a href="#LimitBy">LimitBy</a></span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">limit</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n"><a href="#Limit">Limit</a></span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">offset</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n"><a href="#Offset">Offset</a></span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">granularity</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n"><a href="#Granularity">Granularity</a></span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">totals</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n"><a href="#Totals">Totals</a></span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span>)</span>

        
    </div>
    <a class="headerlink" href="#Query.__init__"></a>
    
    

                            </div>
                            <div id="Query.match" class="classattr">
                                <div class="attr variable">
            <span class="name">match</span><span class="annotation">: Union[<a href="#Entity">Entity</a>, <a href="#Storage">Storage</a>, <a href="#Join">Join</a>, <a href="#Query">Query</a>]</span>

        
    </div>
    <a class="headerlink" href="#Query.match"></a>
    
    

                            </div>
                            <div id="Query.select" class="classattr">
                                <div class="attr variable">
            <span class="name">select</span><span class="annotation">: Optional[Sequence[Union[<a href="#AliasedExpression">AliasedExpression</a>, <a href="#Column">Column</a>, <a href="#CurriedFunction">CurriedFunction</a>, <a href="#Function">Function</a>]]]</span>        =
<span class="default_value">None</span>

        
    </div>
    <a class="headerlink" href="#Query.select"></a>
    
    

                            </div>
                            <div id="Query.groupby" class="classattr">
                                <div class="attr variable">
            <span class="name">groupby</span><span class="annotation">: Optional[Sequence[Union[<a href="#AliasedExpression">AliasedExpression</a>, <a href="#Column">Column</a>, <a href="#CurriedFunction">CurriedFunction</a>, <a href="#Function">Function</a>]]]</span>        =
<span class="default_value">None</span>

        
    </div>
    <a class="headerlink" href="#Query.groupby"></a>
    
    

                            </div>
                            <div id="Query.array_join" class="classattr">
                                <div class="attr variable">
            <span class="name">array_join</span><span class="annotation">: Optional[Sequence[<a href="#Column">Column</a>]]</span>        =
<span class="default_value">None</span>

        
    </div>
    <a class="headerlink" href="#Query.array_join"></a>
    
    

                            </div>
                            <div id="Query.where" class="classattr">
                                <div class="attr variable">
            <span class="name">where</span><span class="annotation">: Optional[Sequence[Union[<a href="#BooleanCondition">BooleanCondition</a>, <a href="#Condition">Condition</a>]]]</span>        =
<span class="default_value">None</span>

        
    </div>
    <a class="headerlink" href="#Query.where"></a>
    
    

                            </div>
                            <div id="Query.having" class="classattr">
                                <div class="attr variable">
            <span class="name">having</span><span class="annotation">: Optional[Sequence[Union[<a href="#BooleanCondition">BooleanCondition</a>, <a href="#Condition">Condition</a>]]]</span>        =
<span class="default_value">None</span>

        
    </div>
    <a class="headerlink" href="#Query.having"></a>
    
    

                            </div>
                            <div id="Query.orderby" class="classattr">
                                <div class="attr variable">
            <span class="name">orderby</span><span class="annotation">: Optional[Sequence[<a href="#OrderBy">OrderBy</a>]]</span>        =
<span class="default_value">None</span>

        
    </div>
    <a class="headerlink" href="#Query.orderby"></a>
    
    

                            </div>
                            <div id="Query.limitby" class="classattr">
                                <div class="attr variable">
            <span class="name">limitby</span><span class="annotation">: Optional[<a href="#LimitBy">LimitBy</a>]</span>        =
<span class="default_value">None</span>

        
    </div>
    <a class="headerlink" href="#Query.limitby"></a>
    
    

                            </div>
                            <div id="Query.limit" class="classattr">
                                <div class="attr variable">
            <span class="name">limit</span><span class="annotation">: Optional[<a href="#Limit">Limit</a>]</span>        =
<span class="default_value">None</span>

        
    </div>
    <a class="headerlink" href="#Query.limit"></a>
    
    

                            </div>
                            <div id="Query.offset" class="classattr">
                                <div class="attr variable">
            <span class="name">offset</span><span class="annotation">: Optional[<a href="#Offset">Offset</a>]</span>        =
<span class="default_value">None</span>

        
    </div>
    <a class="headerlink" href="#Query.offset"></a>
    
    

                            </div>
                            <div id="Query.granularity" class="classattr">
                                <div class="attr variable">
            <span class="name">granularity</span><span class="annotation">: Optional[<a href="#Granularity">Granularity</a>]</span>        =
<span class="default_value">None</span>

        
    </div>
    <a class="headerlink" href="#Query.granularity"></a>
    
    

                            </div>
                            <div id="Query.totals" class="classattr">
                                <div class="attr variable">
            <span class="name">totals</span><span class="annotation">: Optional[<a href="#Totals">Totals</a>]</span>        =
<span class="default_value">None</span>

        
    </div>
    <a class="headerlink" href="#Query.totals"></a>
    
    

                            </div>
                            <div id="Query.set_match" class="classattr">
                                        <input id="Query.set_match-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_match</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">match</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#Entity">Entity</a></span><span class="p">,</span> <span class="n"><a href="#Storage">Storage</a></span><span class="p">,</span> <span class="n"><a href="#Join">Join</a></span><span class="p">,</span> <span class="n"><a href="#Query">Query</a></span><span class="p">]</span></span><span class="return-annotation">) -> <span class="n"><a href="#Query">Query</a></span>:</span></span>

                <label class="view-source-button" for="Query.set_match-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Query.set_match"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Query.set_match-103"><a href="#Query.set_match-103"><span class="linenos">103</span></a>    <span class="k">def</span> <span class="nf">set_match</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">match</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Entity</span><span class="p">,</span> <span class="n">Storage</span><span class="p">,</span> <span class="n">Join</span><span class="p">,</span> <span class="n">Query</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Query</span><span class="p">:</span>
</span><span id="Query.set_match-104"><a href="#Query.set_match-104"><span class="linenos">104</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">match</span><span class="p">,</span> <span class="p">(</span><span class="n">Entity</span><span class="p">,</span> <span class="n">Join</span><span class="p">,</span> <span class="n">Query</span><span class="p">)):</span>
</span><span id="Query.set_match-105"><a href="#Query.set_match-105"><span class="linenos">105</span></a>            <span class="k">raise</span> <span class="n">InvalidQueryError</span><span class="p">(</span>
</span><span id="Query.set_match-106"><a href="#Query.set_match-106"><span class="linenos">106</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">match</span><span class="si">}</span><span class="s2"> must be a valid Entity, Storage, Join or Query&quot;</span>
</span><span id="Query.set_match-107"><a href="#Query.set_match-107"><span class="linenos">107</span></a>            <span class="p">)</span>
</span><span id="Query.set_match-108"><a href="#Query.set_match-108"><span class="linenos">108</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">match</span><span class="p">,</span> <span class="n">Query</span><span class="p">):</span>
</span><span id="Query.set_match-109"><a href="#Query.set_match-109"><span class="linenos">109</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="Query.set_match-110"><a href="#Query.set_match-110"><span class="linenos">110</span></a>                <span class="k">match</span><span class="o">.</span><span class="n">validate</span><span class="p">()</span>
</span><span id="Query.set_match-111"><a href="#Query.set_match-111"><span class="linenos">111</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="Query.set_match-112"><a href="#Query.set_match-112"><span class="linenos">112</span></a>                <span class="k">raise</span> <span class="n">InvalidQueryError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;inner query is invalid: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>
</span><span id="Query.set_match-113"><a href="#Query.set_match-113"><span class="linenos">113</span></a>
</span><span id="Query.set_match-114"><a href="#Query.set_match-114"><span class="linenos">114</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="s2">&quot;match&quot;</span><span class="p">,</span> <span class="n">match</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="Query.set_select" class="classattr">
                                        <input id="Query.set_select-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_select</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">select</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n"><a href="#AliasedExpression">AliasedExpression</a></span><span class="p">,</span> <span class="n"><a href="#Column">Column</a></span><span class="p">,</span> <span class="n"><a href="#CurriedFunction">CurriedFunction</a></span><span class="p">,</span> <span class="n"><a href="#Function">Function</a></span><span class="p">]]</span></span><span class="return-annotation">) -> <span class="n"><a href="#Query">Query</a></span>:</span></span>

                <label class="view-source-button" for="Query.set_select-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Query.set_select"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Query.set_select-116"><a href="#Query.set_select-116"><span class="linenos">116</span></a>    <span class="k">def</span> <span class="nf">set_select</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">select</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">SelectableExpression</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Query</span><span class="p">:</span>
</span><span id="Query.set_select-117"><a href="#Query.set_select-117"><span class="linenos">117</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">list_type</span><span class="p">(</span><span class="n">select</span><span class="p">,</span> <span class="n">SelectableExpressionType</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">select</span><span class="p">:</span>
</span><span id="Query.set_select-118"><a href="#Query.set_select-118"><span class="linenos">118</span></a>            <span class="k">raise</span> <span class="n">InvalidQueryError</span><span class="p">(</span>
</span><span id="Query.set_select-119"><a href="#Query.set_select-119"><span class="linenos">119</span></a>                <span class="s2">&quot;select clause must be a non-empty list of SelectableExpression&quot;</span>
</span><span id="Query.set_select-120"><a href="#Query.set_select-120"><span class="linenos">120</span></a>            <span class="p">)</span>
</span><span id="Query.set_select-121"><a href="#Query.set_select-121"><span class="linenos">121</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="s2">&quot;select&quot;</span><span class="p">,</span> <span class="n">select</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="Query.set_groupby" class="classattr">
                                        <input id="Query.set_groupby-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_groupby</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">groupby</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n"><a href="#AliasedExpression">AliasedExpression</a></span><span class="p">,</span> <span class="n"><a href="#Column">Column</a></span><span class="p">,</span> <span class="n"><a href="#CurriedFunction">CurriedFunction</a></span><span class="p">,</span> <span class="n"><a href="#Function">Function</a></span><span class="p">]]</span></span><span class="return-annotation">) -> <span class="n"><a href="#Query">Query</a></span>:</span></span>

                <label class="view-source-button" for="Query.set_groupby-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Query.set_groupby"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Query.set_groupby-123"><a href="#Query.set_groupby-123"><span class="linenos">123</span></a>    <span class="k">def</span> <span class="nf">set_groupby</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">groupby</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">SelectableExpression</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Query</span><span class="p">:</span>
</span><span id="Query.set_groupby-124"><a href="#Query.set_groupby-124"><span class="linenos">124</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">list_type</span><span class="p">(</span><span class="n">groupby</span><span class="p">,</span> <span class="n">SelectableExpressionType</span><span class="p">):</span>
</span><span id="Query.set_groupby-125"><a href="#Query.set_groupby-125"><span class="linenos">125</span></a>            <span class="k">raise</span> <span class="n">InvalidQueryError</span><span class="p">(</span>
</span><span id="Query.set_groupby-126"><a href="#Query.set_groupby-126"><span class="linenos">126</span></a>                <span class="s2">&quot;groupby clause must be a list of SelectableExpression&quot;</span>
</span><span id="Query.set_groupby-127"><a href="#Query.set_groupby-127"><span class="linenos">127</span></a>            <span class="p">)</span>
</span><span id="Query.set_groupby-128"><a href="#Query.set_groupby-128"><span class="linenos">128</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="s2">&quot;groupby&quot;</span><span class="p">,</span> <span class="n">groupby</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="Query.set_array_join" class="classattr">
                                        <input id="Query.set_array_join-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_array_join</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">array_join</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n"><a href="#Column">Column</a></span><span class="p">]</span></span><span class="return-annotation">) -> <span class="n"><a href="#Query">Query</a></span>:</span></span>

                <label class="view-source-button" for="Query.set_array_join-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Query.set_array_join"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Query.set_array_join-130"><a href="#Query.set_array_join-130"><span class="linenos">130</span></a>    <span class="k">def</span> <span class="nf">set_array_join</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">array_join</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Column</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Query</span><span class="p">:</span>
</span><span id="Query.set_array_join-131"><a href="#Query.set_array_join-131"><span class="linenos">131</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">list_type</span><span class="p">(</span><span class="n">array_join</span><span class="p">,</span> <span class="p">[</span><span class="n">Column</span><span class="p">])</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">array_join</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Query.set_array_join-132"><a href="#Query.set_array_join-132"><span class="linenos">132</span></a>            <span class="k">raise</span> <span class="n">InvalidQueryError</span><span class="p">(</span><span class="s2">&quot;array join must be a non-empty list of Column&quot;</span><span class="p">)</span>
</span><span id="Query.set_array_join-133"><a href="#Query.set_array_join-133"><span class="linenos">133</span></a>
</span><span id="Query.set_array_join-134"><a href="#Query.set_array_join-134"><span class="linenos">134</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="s2">&quot;array_join&quot;</span><span class="p">,</span> <span class="n">array_join</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="Query.set_where" class="classattr">
                                        <input id="Query.set_where-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_where</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">conditions</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n"><a href="#BooleanCondition">BooleanCondition</a></span><span class="p">,</span> <span class="n"><a href="#Condition">Condition</a></span><span class="p">]]</span></span><span class="return-annotation">) -> <span class="n"><a href="#Query">Query</a></span>:</span></span>

                <label class="view-source-button" for="Query.set_where-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Query.set_where"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Query.set_where-136"><a href="#Query.set_where-136"><span class="linenos">136</span></a>    <span class="k">def</span> <span class="nf">set_where</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">conditions</span><span class="p">:</span> <span class="n">ConditionGroup</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Query</span><span class="p">:</span>
</span><span id="Query.set_where-137"><a href="#Query.set_where-137"><span class="linenos">137</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">list_type</span><span class="p">(</span><span class="n">conditions</span><span class="p">,</span> <span class="p">(</span><span class="n">BooleanCondition</span><span class="p">,</span> <span class="n">Condition</span><span class="p">)):</span>
</span><span id="Query.set_where-138"><a href="#Query.set_where-138"><span class="linenos">138</span></a>            <span class="k">raise</span> <span class="n">InvalidQueryError</span><span class="p">(</span><span class="s2">&quot;where clause must be a list of conditions&quot;</span><span class="p">)</span>
</span><span id="Query.set_where-139"><a href="#Query.set_where-139"><span class="linenos">139</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="s2">&quot;where&quot;</span><span class="p">,</span> <span class="n">conditions</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="Query.set_having" class="classattr">
                                        <input id="Query.set_having-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_having</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">conditions</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n"><a href="#BooleanCondition">BooleanCondition</a></span><span class="p">,</span> <span class="n"><a href="#Condition">Condition</a></span><span class="p">]]</span></span><span class="return-annotation">) -> <span class="n"><a href="#Query">Query</a></span>:</span></span>

                <label class="view-source-button" for="Query.set_having-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Query.set_having"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Query.set_having-141"><a href="#Query.set_having-141"><span class="linenos">141</span></a>    <span class="k">def</span> <span class="nf">set_having</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">conditions</span><span class="p">:</span> <span class="n">ConditionGroup</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Query</span><span class="p">:</span>
</span><span id="Query.set_having-142"><a href="#Query.set_having-142"><span class="linenos">142</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">list_type</span><span class="p">(</span><span class="n">conditions</span><span class="p">,</span> <span class="p">(</span><span class="n">BooleanCondition</span><span class="p">,</span> <span class="n">Condition</span><span class="p">)):</span>
</span><span id="Query.set_having-143"><a href="#Query.set_having-143"><span class="linenos">143</span></a>            <span class="k">raise</span> <span class="n">InvalidQueryError</span><span class="p">(</span><span class="s2">&quot;having clause must be a list of conditions&quot;</span><span class="p">)</span>
</span><span id="Query.set_having-144"><a href="#Query.set_having-144"><span class="linenos">144</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="s2">&quot;having&quot;</span><span class="p">,</span> <span class="n">conditions</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="Query.set_orderby" class="classattr">
                                        <input id="Query.set_orderby-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_orderby</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">orderby</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n"><a href="#OrderBy">OrderBy</a></span><span class="p">]</span></span><span class="return-annotation">) -> <span class="n"><a href="#Query">Query</a></span>:</span></span>

                <label class="view-source-button" for="Query.set_orderby-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Query.set_orderby"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Query.set_orderby-146"><a href="#Query.set_orderby-146"><span class="linenos">146</span></a>    <span class="k">def</span> <span class="nf">set_orderby</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">orderby</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">OrderBy</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Query</span><span class="p">:</span>
</span><span id="Query.set_orderby-147"><a href="#Query.set_orderby-147"><span class="linenos">147</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">list_type</span><span class="p">(</span><span class="n">orderby</span><span class="p">,</span> <span class="p">(</span><span class="n">OrderBy</span><span class="p">,)):</span>
</span><span id="Query.set_orderby-148"><a href="#Query.set_orderby-148"><span class="linenos">148</span></a>            <span class="k">raise</span> <span class="n">InvalidQueryError</span><span class="p">(</span><span class="s2">&quot;orderby clause must be a list of OrderBy&quot;</span><span class="p">)</span>
</span><span id="Query.set_orderby-149"><a href="#Query.set_orderby-149"><span class="linenos">149</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="s2">&quot;orderby&quot;</span><span class="p">,</span> <span class="n">orderby</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="Query.set_limitby" class="classattr">
                                        <input id="Query.set_limitby-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_limitby</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">limitby</span><span class="p">:</span> <span class="n"><a href="#LimitBy">LimitBy</a></span></span><span class="return-annotation">) -> <span class="n"><a href="#Query">Query</a></span>:</span></span>

                <label class="view-source-button" for="Query.set_limitby-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Query.set_limitby"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Query.set_limitby-151"><a href="#Query.set_limitby-151"><span class="linenos">151</span></a>    <span class="k">def</span> <span class="nf">set_limitby</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">limitby</span><span class="p">:</span> <span class="n">LimitBy</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Query</span><span class="p">:</span>
</span><span id="Query.set_limitby-152"><a href="#Query.set_limitby-152"><span class="linenos">152</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">limitby</span><span class="p">,</span> <span class="n">LimitBy</span><span class="p">):</span>
</span><span id="Query.set_limitby-153"><a href="#Query.set_limitby-153"><span class="linenos">153</span></a>            <span class="k">raise</span> <span class="n">InvalidQueryError</span><span class="p">(</span><span class="s2">&quot;limitby clause must be a LimitBy&quot;</span><span class="p">)</span>
</span><span id="Query.set_limitby-154"><a href="#Query.set_limitby-154"><span class="linenos">154</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="s2">&quot;limitby&quot;</span><span class="p">,</span> <span class="n">limitby</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="Query.set_limit" class="classattr">
                                        <input id="Query.set_limit-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_limit</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">limit</span><span class="p">:</span> <span class="nb">int</span></span><span class="return-annotation">) -> <span class="n"><a href="#Query">Query</a></span>:</span></span>

                <label class="view-source-button" for="Query.set_limit-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Query.set_limit"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Query.set_limit-156"><a href="#Query.set_limit-156"><span class="linenos">156</span></a>    <span class="k">def</span> <span class="nf">set_limit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Query</span><span class="p">:</span>
</span><span id="Query.set_limit-157"><a href="#Query.set_limit-157"><span class="linenos">157</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="s2">&quot;limit&quot;</span><span class="p">,</span> <span class="n">Limit</span><span class="p">(</span><span class="n">limit</span><span class="p">))</span>
</span></pre></div>


    

                            </div>
                            <div id="Query.set_offset" class="classattr">
                                        <input id="Query.set_offset-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_offset</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">offset</span><span class="p">:</span> <span class="nb">int</span></span><span class="return-annotation">) -> <span class="n"><a href="#Query">Query</a></span>:</span></span>

                <label class="view-source-button" for="Query.set_offset-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Query.set_offset"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Query.set_offset-159"><a href="#Query.set_offset-159"><span class="linenos">159</span></a>    <span class="k">def</span> <span class="nf">set_offset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">offset</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Query</span><span class="p">:</span>
</span><span id="Query.set_offset-160"><a href="#Query.set_offset-160"><span class="linenos">160</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="s2">&quot;offset&quot;</span><span class="p">,</span> <span class="n">Offset</span><span class="p">(</span><span class="n">offset</span><span class="p">))</span>
</span></pre></div>


    

                            </div>
                            <div id="Query.set_granularity" class="classattr">
                                        <input id="Query.set_granularity-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_granularity</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">granularity</span><span class="p">:</span> <span class="nb">int</span></span><span class="return-annotation">) -> <span class="n"><a href="#Query">Query</a></span>:</span></span>

                <label class="view-source-button" for="Query.set_granularity-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Query.set_granularity"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Query.set_granularity-162"><a href="#Query.set_granularity-162"><span class="linenos">162</span></a>    <span class="k">def</span> <span class="nf">set_granularity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">granularity</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Query</span><span class="p">:</span>
</span><span id="Query.set_granularity-163"><a href="#Query.set_granularity-163"><span class="linenos">163</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="s2">&quot;granularity&quot;</span><span class="p">,</span> <span class="n">Granularity</span><span class="p">(</span><span class="n">granularity</span><span class="p">))</span>
</span></pre></div>


    

                            </div>
                            <div id="Query.set_totals" class="classattr">
                                        <input id="Query.set_totals-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_totals</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">totals</span><span class="p">:</span> <span class="nb">bool</span></span><span class="return-annotation">) -> <span class="n"><a href="#Query">Query</a></span>:</span></span>

                <label class="view-source-button" for="Query.set_totals-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Query.set_totals"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Query.set_totals-165"><a href="#Query.set_totals-165"><span class="linenos">165</span></a>    <span class="k">def</span> <span class="nf">set_totals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">totals</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Query</span><span class="p">:</span>
</span><span id="Query.set_totals-166"><a href="#Query.set_totals-166"><span class="linenos">166</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="s2">&quot;totals&quot;</span><span class="p">,</span> <span class="n">Totals</span><span class="p">(</span><span class="n">totals</span><span class="p">))</span>
</span></pre></div>


    

                            </div>
                            <div id="Query.validate" class="classattr">
                                        <input id="Query.validate-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">validate</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="Query.validate-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Query.validate"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Query.validate-168"><a href="#Query.validate-168"><span class="linenos">168</span></a>    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Query.validate-169"><a href="#Query.validate-169"><span class="linenos">169</span></a>        <span class="n">VALIDATOR</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="Query.serialize" class="classattr">
                                        <input id="Query.serialize-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">serialize</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="Query.serialize-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Query.serialize"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Query.serialize-174"><a href="#Query.serialize-174"><span class="linenos">174</span></a>    <span class="k">def</span> <span class="nf">serialize</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="Query.serialize-175"><a href="#Query.serialize-175"><span class="linenos">175</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">validate</span><span class="p">()</span>
</span><span id="Query.serialize-176"><a href="#Query.serialize-176"><span class="linenos">176</span></a>        <span class="n">optimized</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_optimize</span><span class="p">()</span>
</span><span id="Query.serialize-177"><a href="#Query.serialize-177"><span class="linenos">177</span></a>        <span class="k">return</span> <span class="n">Printer</span><span class="p">()</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">optimized</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="Query.print" class="classattr">
                                        <input id="Query.print-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">print</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="Query.print-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Query.print"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Query.print-179"><a href="#Query.print-179"><span class="linenos">179</span></a>    <span class="k">def</span> <span class="nf">print</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="Query.print-180"><a href="#Query.print-180"><span class="linenos">180</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">validate</span><span class="p">()</span>
</span><span id="Query.print-181"><a href="#Query.print-181"><span class="linenos">181</span></a>        <span class="k">return</span> <span class="n">Printer</span><span class="p">(</span><span class="n">pretty</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>snuba_sdk.query.BaseQuery</dt>
                                <dd id="Query.get_fields" class="function">get_fields</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="Relationship">
                            <input id="Relationship-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
                    <div class="decorator">@dataclass(frozen=True)</div>

    <span class="def">class</span>
    <span class="name">Relationship</span><wbr>(<span class="base">snuba_sdk.expressions.Expression</span>):

                <label class="view-source-button" for="Relationship-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Relationship"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Relationship-11"><a href="#Relationship-11"><span class="linenos">11</span></a><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Relationship-12"><a href="#Relationship-12"><span class="linenos">12</span></a><span class="k">class</span> <span class="nc">Relationship</span><span class="p">(</span><span class="n">Expression</span><span class="p">):</span>
</span><span id="Relationship-13"><a href="#Relationship-13"><span class="linenos">13</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Relationship-14"><a href="#Relationship-14"><span class="linenos">14</span></a><span class="sd">    A representation of a relationship between two Entities. The relationship</span>
</span><span id="Relationship-15"><a href="#Relationship-15"><span class="linenos">15</span></a><span class="sd">    name should be defined in the data model of the LHS and entity in Snuba.</span>
</span><span id="Relationship-16"><a href="#Relationship-16"><span class="linenos">16</span></a><span class="sd">    Both Entities must have a valid alias, which will be used to qualify the</span>
</span><span id="Relationship-17"><a href="#Relationship-17"><span class="linenos">17</span></a><span class="sd">    columns in the SnQL query.</span>
</span><span id="Relationship-18"><a href="#Relationship-18"><span class="linenos">18</span></a>
</span><span id="Relationship-19"><a href="#Relationship-19"><span class="linenos">19</span></a><span class="sd">    :param lhs: The Entity that owns the relationship.</span>
</span><span id="Relationship-20"><a href="#Relationship-20"><span class="linenos">20</span></a><span class="sd">    :type name: Entity</span>
</span><span id="Relationship-21"><a href="#Relationship-21"><span class="linenos">21</span></a><span class="sd">    :param name: The name of the relationship on the LHS Entity.</span>
</span><span id="Relationship-22"><a href="#Relationship-22"><span class="linenos">22</span></a><span class="sd">    :type name: str</span>
</span><span id="Relationship-23"><a href="#Relationship-23"><span class="linenos">23</span></a><span class="sd">    :param rhs: The Entity connected to the LHS using the relationship.</span>
</span><span id="Relationship-24"><a href="#Relationship-24"><span class="linenos">24</span></a><span class="sd">    :type name: Entity</span>
</span><span id="Relationship-25"><a href="#Relationship-25"><span class="linenos">25</span></a>
</span><span id="Relationship-26"><a href="#Relationship-26"><span class="linenos">26</span></a><span class="sd">    :raises InvalidExpressionError: If the incorrect types are used or if either</span>
</span><span id="Relationship-27"><a href="#Relationship-27"><span class="linenos">27</span></a><span class="sd">        of the Entities does not have an alias.</span>
</span><span id="Relationship-28"><a href="#Relationship-28"><span class="linenos">28</span></a>
</span><span id="Relationship-29"><a href="#Relationship-29"><span class="linenos">29</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="Relationship-30"><a href="#Relationship-30"><span class="linenos">30</span></a>
</span><span id="Relationship-31"><a href="#Relationship-31"><span class="linenos">31</span></a>    <span class="n">lhs</span><span class="p">:</span> <span class="n">Entity</span>
</span><span id="Relationship-32"><a href="#Relationship-32"><span class="linenos">32</span></a>    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="Relationship-33"><a href="#Relationship-33"><span class="linenos">33</span></a>    <span class="n">rhs</span><span class="p">:</span> <span class="n">Entity</span>
</span><span id="Relationship-34"><a href="#Relationship-34"><span class="linenos">34</span></a>
</span><span id="Relationship-35"><a href="#Relationship-35"><span class="linenos">35</span></a>    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Relationship-36"><a href="#Relationship-36"><span class="linenos">36</span></a>        <span class="k">def</span> <span class="nf">valid_entity</span><span class="p">(</span><span class="n">e</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Relationship-37"><a href="#Relationship-37"><span class="linenos">37</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">Entity</span><span class="p">):</span>
</span><span id="Relationship-38"><a href="#Relationship-38"><span class="linenos">38</span></a>                <span class="k">raise</span> <span class="n">InvalidExpressionError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&#39; must be an Entity&quot;</span><span class="p">)</span>
</span><span id="Relationship-39"><a href="#Relationship-39"><span class="linenos">39</span></a>            <span class="k">elif</span> <span class="n">e</span><span class="o">.</span><span class="n">alias</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Relationship-40"><a href="#Relationship-40"><span class="linenos">40</span></a>                <span class="k">raise</span> <span class="n">InvalidExpressionError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2"> must have a valid alias&quot;</span><span class="p">)</span>
</span><span id="Relationship-41"><a href="#Relationship-41"><span class="linenos">41</span></a>
</span><span id="Relationship-42"><a href="#Relationship-42"><span class="linenos">42</span></a>        <span class="n">valid_entity</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lhs</span><span class="p">)</span>
</span><span id="Relationship-43"><a href="#Relationship-43"><span class="linenos">43</span></a>        <span class="n">valid_entity</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rhs</span><span class="p">)</span>
</span><span id="Relationship-44"><a href="#Relationship-44"><span class="linenos">44</span></a>
</span><span id="Relationship-45"><a href="#Relationship-45"><span class="linenos">45</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
</span><span id="Relationship-46"><a href="#Relationship-46"><span class="linenos">46</span></a>            <span class="k">raise</span> <span class="n">InvalidExpressionError</span><span class="p">(</span>
</span><span id="Relationship-47"><a href="#Relationship-47"><span class="linenos">47</span></a>                <span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; is not a valid relationship name&quot;</span>
</span><span id="Relationship-48"><a href="#Relationship-48"><span class="linenos">48</span></a>            <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>A representation of a relationship between two Entities. The relationship
name should be defined in the data model of the LHS and entity in Snuba.
Both Entities must have a valid alias, which will be used to qualify the
columns in the SnQL query.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>lhs</strong>:  The Entity that owns the relationship.</li>
<li><strong>name</strong>:  The name of the relationship on the LHS Entity.</li>
<li><strong>rhs</strong>:  The Entity connected to the LHS using the relationship.</li>
</ul>

<h6 id="raises">Raises</h6>

<ul>
<li><strong>InvalidExpressionError</strong>:  If the incorrect types are used or if either
of the Entities does not have an alias.</li>
</ul>
</div>


                            <div id="Relationship.__init__" class="classattr">
                                <div class="attr function">
            
        <span class="name">Relationship</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">lhs</span><span class="p">:</span> <span class="n"><a href="#Entity">Entity</a></span>,</span><span class="param">	<span class="n">name</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">rhs</span><span class="p">:</span> <span class="n"><a href="#Entity">Entity</a></span></span>)</span>

        
    </div>
    <a class="headerlink" href="#Relationship.__init__"></a>
    
    

                            </div>
                            <div id="Relationship.lhs" class="classattr">
                                <div class="attr variable">
            <span class="name">lhs</span><span class="annotation">: <a href="#Entity">Entity</a></span>

        
    </div>
    <a class="headerlink" href="#Relationship.lhs"></a>
    
    

                            </div>
                            <div id="Relationship.name" class="classattr">
                                <div class="attr variable">
            <span class="name">name</span><span class="annotation">: str</span>

        
    </div>
    <a class="headerlink" href="#Relationship.name"></a>
    
    

                            </div>
                            <div id="Relationship.rhs" class="classattr">
                                <div class="attr variable">
            <span class="name">rhs</span><span class="annotation">: <a href="#Entity">Entity</a></span>

        
    </div>
    <a class="headerlink" href="#Relationship.rhs"></a>
    
    

                            </div>
                            <div id="Relationship.validate" class="classattr">
                                        <input id="Relationship.validate-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">validate</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="Relationship.validate-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Relationship.validate"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Relationship.validate-35"><a href="#Relationship.validate-35"><span class="linenos">35</span></a>    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Relationship.validate-36"><a href="#Relationship.validate-36"><span class="linenos">36</span></a>        <span class="k">def</span> <span class="nf">valid_entity</span><span class="p">(</span><span class="n">e</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Relationship.validate-37"><a href="#Relationship.validate-37"><span class="linenos">37</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">Entity</span><span class="p">):</span>
</span><span id="Relationship.validate-38"><a href="#Relationship.validate-38"><span class="linenos">38</span></a>                <span class="k">raise</span> <span class="n">InvalidExpressionError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&#39; must be an Entity&quot;</span><span class="p">)</span>
</span><span id="Relationship.validate-39"><a href="#Relationship.validate-39"><span class="linenos">39</span></a>            <span class="k">elif</span> <span class="n">e</span><span class="o">.</span><span class="n">alias</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Relationship.validate-40"><a href="#Relationship.validate-40"><span class="linenos">40</span></a>                <span class="k">raise</span> <span class="n">InvalidExpressionError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2"> must have a valid alias&quot;</span><span class="p">)</span>
</span><span id="Relationship.validate-41"><a href="#Relationship.validate-41"><span class="linenos">41</span></a>
</span><span id="Relationship.validate-42"><a href="#Relationship.validate-42"><span class="linenos">42</span></a>        <span class="n">valid_entity</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lhs</span><span class="p">)</span>
</span><span id="Relationship.validate-43"><a href="#Relationship.validate-43"><span class="linenos">43</span></a>        <span class="n">valid_entity</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rhs</span><span class="p">)</span>
</span><span id="Relationship.validate-44"><a href="#Relationship.validate-44"><span class="linenos">44</span></a>
</span><span id="Relationship.validate-45"><a href="#Relationship.validate-45"><span class="linenos">45</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
</span><span id="Relationship.validate-46"><a href="#Relationship.validate-46"><span class="linenos">46</span></a>            <span class="k">raise</span> <span class="n">InvalidExpressionError</span><span class="p">(</span>
</span><span id="Relationship.validate-47"><a href="#Relationship.validate-47"><span class="linenos">47</span></a>                <span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; is not a valid relationship name&quot;</span>
</span><span id="Relationship.validate-48"><a href="#Relationship.validate-48"><span class="linenos">48</span></a>            <span class="p">)</span>
</span></pre></div>


    

                            </div>
                </section>
                <section id="Request">
                            <input id="Request-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
                    <div class="decorator">@dataclass</div>

    <span class="def">class</span>
    <span class="name">Request</span>:

                <label class="view-source-button" for="Request-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Request"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Request-47"><a href="#Request-47"><span class="linenos"> 47</span></a><span class="nd">@dataclass</span>
</span><span id="Request-48"><a href="#Request-48"><span class="linenos"> 48</span></a><span class="k">class</span> <span class="nc">Request</span><span class="p">:</span>
</span><span id="Request-49"><a href="#Request-49"><span class="linenos"> 49</span></a>    <span class="n">dataset</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="Request-50"><a href="#Request-50"><span class="linenos"> 50</span></a>    <span class="n">app_id</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="Request-51"><a href="#Request-51"><span class="linenos"> 51</span></a>    <span class="n">query</span><span class="p">:</span> <span class="n">BaseQuery</span>
</span><span id="Request-52"><a href="#Request-52"><span class="linenos"> 52</span></a>    <span class="n">flags</span><span class="p">:</span> <span class="n">Flags</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">Flags</span><span class="p">)</span>
</span><span id="Request-53"><a href="#Request-53"><span class="linenos"> 53</span></a>    <span class="n">parent_api</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&lt;unknown&gt;&quot;</span>
</span><span id="Request-54"><a href="#Request-54"><span class="linenos"> 54</span></a>    <span class="n">tenant_ids</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>
</span><span id="Request-55"><a href="#Request-55"><span class="linenos"> 55</span></a>
</span><span id="Request-56"><a href="#Request-56"><span class="linenos"> 56</span></a>    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Request-57"><a href="#Request-57"><span class="linenos"> 57</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="Request-58"><a href="#Request-58"><span class="linenos"> 58</span></a>            <span class="k">raise</span> <span class="n">InvalidRequestError</span><span class="p">(</span><span class="s2">&quot;Request must have a valid dataset&quot;</span><span class="p">)</span>
</span><span id="Request-59"><a href="#Request-59"><span class="linenos"> 59</span></a>        <span class="k">elif</span> <span class="ow">not</span> <span class="n">FLAG_RE</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">):</span>
</span><span id="Request-60"><a href="#Request-60"><span class="linenos"> 60</span></a>            <span class="k">raise</span> <span class="n">InvalidRequestError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="si">}</span><span class="s2">&#39; is not a valid dataset&quot;</span><span class="p">)</span>
</span><span id="Request-61"><a href="#Request-61"><span class="linenos"> 61</span></a>
</span><span id="Request-62"><a href="#Request-62"><span class="linenos"> 62</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">app_id</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">app_id</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="Request-63"><a href="#Request-63"><span class="linenos"> 63</span></a>            <span class="k">raise</span> <span class="n">InvalidRequestError</span><span class="p">(</span><span class="s2">&quot;Request must have a valid app_id&quot;</span><span class="p">)</span>
</span><span id="Request-64"><a href="#Request-64"><span class="linenos"> 64</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">FLAG_RE</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">app_id</span><span class="p">):</span>
</span><span id="Request-65"><a href="#Request-65"><span class="linenos"> 65</span></a>            <span class="k">raise</span> <span class="n">InvalidRequestError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">app_id</span><span class="si">}</span><span class="s2">&#39; is not a valid app_id&quot;</span><span class="p">)</span>
</span><span id="Request-66"><a href="#Request-66"><span class="linenos"> 66</span></a>
</span><span id="Request-67"><a href="#Request-67"><span class="linenos"> 67</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent_api</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent_api</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="Request-68"><a href="#Request-68"><span class="linenos"> 68</span></a>            <span class="k">raise</span> <span class="n">InvalidRequestError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;`</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">parent_api</span><span class="si">}</span><span class="s2">` is not a valid parent_api&quot;</span><span class="p">)</span>
</span><span id="Request-69"><a href="#Request-69"><span class="linenos"> 69</span></a>
</span><span id="Request-70"><a href="#Request-70"><span class="linenos"> 70</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tenant_ids</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="Request-71"><a href="#Request-71"><span class="linenos"> 71</span></a>            <span class="k">raise</span> <span class="n">InvalidRequestError</span><span class="p">(</span><span class="s2">&quot;Request must have a `tenant_ids` dictionary&quot;</span><span class="p">)</span>
</span><span id="Request-72"><a href="#Request-72"><span class="linenos"> 72</span></a>
</span><span id="Request-73"><a href="#Request-73"><span class="linenos"> 73</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">validate</span><span class="p">()</span>
</span><span id="Request-74"><a href="#Request-74"><span class="linenos"> 74</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">flags</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Request-75"><a href="#Request-75"><span class="linenos"> 75</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">flags</span><span class="o">.</span><span class="n">validate</span><span class="p">()</span>
</span><span id="Request-76"><a href="#Request-76"><span class="linenos"> 76</span></a>
</span><span id="Request-77"><a href="#Request-77"><span class="linenos"> 77</span></a>    <span class="k">def</span> <span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">object</span><span class="p">]:</span>
</span><span id="Request-78"><a href="#Request-78"><span class="linenos"> 78</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">validate</span><span class="p">()</span>
</span><span id="Request-79"><a href="#Request-79"><span class="linenos"> 79</span></a>        <span class="n">flags</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flags</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">flags</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">{}</span>
</span><span id="Request-80"><a href="#Request-80"><span class="linenos"> 80</span></a>
</span><span id="Request-81"><a href="#Request-81"><span class="linenos"> 81</span></a>        <span class="n">mql_context</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Request-82"><a href="#Request-82"><span class="linenos"> 82</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">,</span> <span class="n">MetricsQuery</span><span class="p">):</span>
</span><span id="Request-83"><a href="#Request-83"><span class="linenos"> 83</span></a>            <span class="n">serialized_mql</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">serialize</span><span class="p">()</span>
</span><span id="Request-84"><a href="#Request-84"><span class="linenos"> 84</span></a>            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">serialized_mql</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span>  <span class="c1"># mypy</span>
</span><span id="Request-85"><a href="#Request-85"><span class="linenos"> 85</span></a>            <span class="n">mql_context</span> <span class="o">=</span> <span class="n">serialized_mql</span><span class="p">[</span><span class="s2">&quot;mql_context&quot;</span><span class="p">]</span>
</span><span id="Request-86"><a href="#Request-86"><span class="linenos"> 86</span></a>            <span class="n">query</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">serialized_mql</span><span class="p">[</span><span class="s2">&quot;mql&quot;</span><span class="p">])</span>
</span><span id="Request-87"><a href="#Request-87"><span class="linenos"> 87</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">,</span> <span class="n">DeleteQuery</span><span class="p">):</span>
</span><span id="Request-88"><a href="#Request-88"><span class="linenos"> 88</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Request-89"><a href="#Request-89"><span class="linenos"> 89</span></a><span class="sd">            for a DeleteQuery, the query is not a snql/mql string,</span>
</span><span id="Request-90"><a href="#Request-90"><span class="linenos"> 90</span></a><span class="sd">            it is a dict</span>
</span><span id="Request-91"><a href="#Request-91"><span class="linenos"> 91</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="Request-92"><a href="#Request-92"><span class="linenos"> 92</span></a>            <span class="k">return</span> <span class="p">{</span>
</span><span id="Request-93"><a href="#Request-93"><span class="linenos"> 93</span></a>                <span class="o">**</span><span class="n">flags</span><span class="p">,</span>
</span><span id="Request-94"><a href="#Request-94"><span class="linenos"> 94</span></a>                <span class="s2">&quot;query&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">serialize</span><span class="p">(),</span>
</span><span id="Request-95"><a href="#Request-95"><span class="linenos"> 95</span></a>                <span class="s2">&quot;app_id&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">app_id</span><span class="p">,</span>
</span><span id="Request-96"><a href="#Request-96"><span class="linenos"> 96</span></a>                <span class="s2">&quot;tenant_ids&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">tenant_ids</span><span class="p">,</span>
</span><span id="Request-97"><a href="#Request-97"><span class="linenos"> 97</span></a>                <span class="s2">&quot;parent_api&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent_api</span><span class="p">,</span>
</span><span id="Request-98"><a href="#Request-98"><span class="linenos"> 98</span></a>            <span class="p">}</span>
</span><span id="Request-99"><a href="#Request-99"><span class="linenos"> 99</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Request-100"><a href="#Request-100"><span class="linenos">100</span></a>            <span class="n">query</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">serialize</span><span class="p">())</span>
</span><span id="Request-101"><a href="#Request-101"><span class="linenos">101</span></a>
</span><span id="Request-102"><a href="#Request-102"><span class="linenos">102</span></a>        <span class="n">ret</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">object</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="Request-103"><a href="#Request-103"><span class="linenos">103</span></a>            <span class="o">**</span><span class="n">flags</span><span class="p">,</span>
</span><span id="Request-104"><a href="#Request-104"><span class="linenos">104</span></a>            <span class="s2">&quot;query&quot;</span><span class="p">:</span> <span class="n">query</span><span class="p">,</span>
</span><span id="Request-105"><a href="#Request-105"><span class="linenos">105</span></a>            <span class="s2">&quot;dataset&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">,</span>
</span><span id="Request-106"><a href="#Request-106"><span class="linenos">106</span></a>            <span class="s2">&quot;app_id&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">app_id</span><span class="p">,</span>
</span><span id="Request-107"><a href="#Request-107"><span class="linenos">107</span></a>            <span class="s2">&quot;tenant_ids&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">tenant_ids</span><span class="p">,</span>
</span><span id="Request-108"><a href="#Request-108"><span class="linenos">108</span></a>            <span class="s2">&quot;parent_api&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent_api</span><span class="p">,</span>
</span><span id="Request-109"><a href="#Request-109"><span class="linenos">109</span></a>        <span class="p">}</span>
</span><span id="Request-110"><a href="#Request-110"><span class="linenos">110</span></a>        <span class="k">if</span> <span class="n">mql_context</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Request-111"><a href="#Request-111"><span class="linenos">111</span></a>            <span class="n">ret</span><span class="p">[</span><span class="s2">&quot;mql_context&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mql_context</span>
</span><span id="Request-112"><a href="#Request-112"><span class="linenos">112</span></a>        <span class="k">return</span> <span class="n">ret</span>
</span><span id="Request-113"><a href="#Request-113"><span class="linenos">113</span></a>
</span><span id="Request-114"><a href="#Request-114"><span class="linenos">114</span></a>    <span class="k">def</span> <span class="nf">serialize</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="Request-115"><a href="#Request-115"><span class="linenos">115</span></a>        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">to_dict</span><span class="p">())</span>
</span><span id="Request-116"><a href="#Request-116"><span class="linenos">116</span></a>
</span><span id="Request-117"><a href="#Request-117"><span class="linenos">117</span></a>    <span class="k">def</span> <span class="nf">serialize_mql</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="Request-118"><a href="#Request-118"><span class="linenos">118</span></a>        <span class="c1"># NOTE: This function is temporary, just to help with a cutover in the Sentry codebase.</span>
</span><span id="Request-119"><a href="#Request-119"><span class="linenos">119</span></a>        <span class="c1"># It will be removed in a future version.</span>
</span><span id="Request-120"><a href="#Request-120"><span class="linenos">120</span></a>        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">to_dict</span><span class="p">())</span>
</span><span id="Request-121"><a href="#Request-121"><span class="linenos">121</span></a>
</span><span id="Request-122"><a href="#Request-122"><span class="linenos">122</span></a>    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="Request-123"><a href="#Request-123"><span class="linenos">123</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">serialize</span><span class="p">()</span>
</span><span id="Request-124"><a href="#Request-124"><span class="linenos">124</span></a>
</span><span id="Request-125"><a href="#Request-125"><span class="linenos">125</span></a>    <span class="k">def</span> <span class="nf">print</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="Request-126"><a href="#Request-126"><span class="linenos">126</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">validate</span><span class="p">()</span>
</span><span id="Request-127"><a href="#Request-127"><span class="linenos">127</span></a>        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
</span><span id="Request-128"><a href="#Request-128"><span class="linenos">128</span></a>        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span> <span class="o">*</span> <span class="s2">&quot; &quot;</span><span class="p">)</span>
</span></pre></div>


    

                            <div id="Request.__init__" class="classattr">
                                <div class="attr function">
            
        <span class="name">Request</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">dataset</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">app_id</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">query</span><span class="p">:</span> <span class="n">snuba_sdk</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">BaseQuery</span>,</span><span class="param">	<span class="n">flags</span><span class="p">:</span> <span class="n"><a href="#Flags">Flags</a></span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">factory</span><span class="o">&gt;</span>,</span><span class="param">	<span class="n">parent_api</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&lt;unknown&gt;&#39;</span>,</span><span class="param">	<span class="n">tenant_ids</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">factory</span><span class="o">&gt;</span></span>)</span>

        
    </div>
    <a class="headerlink" href="#Request.__init__"></a>
    
    

                            </div>
                            <div id="Request.dataset" class="classattr">
                                <div class="attr variable">
            <span class="name">dataset</span><span class="annotation">: str</span>

        
    </div>
    <a class="headerlink" href="#Request.dataset"></a>
    
    

                            </div>
                            <div id="Request.app_id" class="classattr">
                                <div class="attr variable">
            <span class="name">app_id</span><span class="annotation">: str</span>

        
    </div>
    <a class="headerlink" href="#Request.app_id"></a>
    
    

                            </div>
                            <div id="Request.query" class="classattr">
                                <div class="attr variable">
            <span class="name">query</span><span class="annotation">: snuba_sdk.query.BaseQuery</span>

        
    </div>
    <a class="headerlink" href="#Request.query"></a>
    
    

                            </div>
                            <div id="Request.flags" class="classattr">
                                <div class="attr variable">
            <span class="name">flags</span><span class="annotation">: <a href="#Flags">Flags</a></span>

        
    </div>
    <a class="headerlink" href="#Request.flags"></a>
    
    

                            </div>
                            <div id="Request.parent_api" class="classattr">
                                <div class="attr variable">
            <span class="name">parent_api</span><span class="annotation">: str</span>        =
<span class="default_value">&#39;&lt;unknown&gt;&#39;</span>

        
    </div>
    <a class="headerlink" href="#Request.parent_api"></a>
    
    

                            </div>
                            <div id="Request.tenant_ids" class="classattr">
                                <div class="attr variable">
            <span class="name">tenant_ids</span><span class="annotation">: Mapping[str, str | int]</span>

        
    </div>
    <a class="headerlink" href="#Request.tenant_ids"></a>
    
    

                            </div>
                            <div id="Request.validate" class="classattr">
                                        <input id="Request.validate-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">validate</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="Request.validate-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Request.validate"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Request.validate-56"><a href="#Request.validate-56"><span class="linenos">56</span></a>    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Request.validate-57"><a href="#Request.validate-57"><span class="linenos">57</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="Request.validate-58"><a href="#Request.validate-58"><span class="linenos">58</span></a>            <span class="k">raise</span> <span class="n">InvalidRequestError</span><span class="p">(</span><span class="s2">&quot;Request must have a valid dataset&quot;</span><span class="p">)</span>
</span><span id="Request.validate-59"><a href="#Request.validate-59"><span class="linenos">59</span></a>        <span class="k">elif</span> <span class="ow">not</span> <span class="n">FLAG_RE</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">):</span>
</span><span id="Request.validate-60"><a href="#Request.validate-60"><span class="linenos">60</span></a>            <span class="k">raise</span> <span class="n">InvalidRequestError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="si">}</span><span class="s2">&#39; is not a valid dataset&quot;</span><span class="p">)</span>
</span><span id="Request.validate-61"><a href="#Request.validate-61"><span class="linenos">61</span></a>
</span><span id="Request.validate-62"><a href="#Request.validate-62"><span class="linenos">62</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">app_id</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">app_id</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="Request.validate-63"><a href="#Request.validate-63"><span class="linenos">63</span></a>            <span class="k">raise</span> <span class="n">InvalidRequestError</span><span class="p">(</span><span class="s2">&quot;Request must have a valid app_id&quot;</span><span class="p">)</span>
</span><span id="Request.validate-64"><a href="#Request.validate-64"><span class="linenos">64</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">FLAG_RE</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">app_id</span><span class="p">):</span>
</span><span id="Request.validate-65"><a href="#Request.validate-65"><span class="linenos">65</span></a>            <span class="k">raise</span> <span class="n">InvalidRequestError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">app_id</span><span class="si">}</span><span class="s2">&#39; is not a valid app_id&quot;</span><span class="p">)</span>
</span><span id="Request.validate-66"><a href="#Request.validate-66"><span class="linenos">66</span></a>
</span><span id="Request.validate-67"><a href="#Request.validate-67"><span class="linenos">67</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent_api</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent_api</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="Request.validate-68"><a href="#Request.validate-68"><span class="linenos">68</span></a>            <span class="k">raise</span> <span class="n">InvalidRequestError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;`</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">parent_api</span><span class="si">}</span><span class="s2">` is not a valid parent_api&quot;</span><span class="p">)</span>
</span><span id="Request.validate-69"><a href="#Request.validate-69"><span class="linenos">69</span></a>
</span><span id="Request.validate-70"><a href="#Request.validate-70"><span class="linenos">70</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tenant_ids</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="Request.validate-71"><a href="#Request.validate-71"><span class="linenos">71</span></a>            <span class="k">raise</span> <span class="n">InvalidRequestError</span><span class="p">(</span><span class="s2">&quot;Request must have a `tenant_ids` dictionary&quot;</span><span class="p">)</span>
</span><span id="Request.validate-72"><a href="#Request.validate-72"><span class="linenos">72</span></a>
</span><span id="Request.validate-73"><a href="#Request.validate-73"><span class="linenos">73</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">validate</span><span class="p">()</span>
</span><span id="Request.validate-74"><a href="#Request.validate-74"><span class="linenos">74</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">flags</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Request.validate-75"><a href="#Request.validate-75"><span class="linenos">75</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">flags</span><span class="o">.</span><span class="n">validate</span><span class="p">()</span>
</span></pre></div>


    

                            </div>
                            <div id="Request.to_dict" class="classattr">
                                        <input id="Request.to_dict-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">to_dict</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">object</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="Request.to_dict-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Request.to_dict"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Request.to_dict-77"><a href="#Request.to_dict-77"><span class="linenos"> 77</span></a>    <span class="k">def</span> <span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">object</span><span class="p">]:</span>
</span><span id="Request.to_dict-78"><a href="#Request.to_dict-78"><span class="linenos"> 78</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">validate</span><span class="p">()</span>
</span><span id="Request.to_dict-79"><a href="#Request.to_dict-79"><span class="linenos"> 79</span></a>        <span class="n">flags</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flags</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">flags</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">{}</span>
</span><span id="Request.to_dict-80"><a href="#Request.to_dict-80"><span class="linenos"> 80</span></a>
</span><span id="Request.to_dict-81"><a href="#Request.to_dict-81"><span class="linenos"> 81</span></a>        <span class="n">mql_context</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Request.to_dict-82"><a href="#Request.to_dict-82"><span class="linenos"> 82</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">,</span> <span class="n">MetricsQuery</span><span class="p">):</span>
</span><span id="Request.to_dict-83"><a href="#Request.to_dict-83"><span class="linenos"> 83</span></a>            <span class="n">serialized_mql</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">serialize</span><span class="p">()</span>
</span><span id="Request.to_dict-84"><a href="#Request.to_dict-84"><span class="linenos"> 84</span></a>            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">serialized_mql</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span>  <span class="c1"># mypy</span>
</span><span id="Request.to_dict-85"><a href="#Request.to_dict-85"><span class="linenos"> 85</span></a>            <span class="n">mql_context</span> <span class="o">=</span> <span class="n">serialized_mql</span><span class="p">[</span><span class="s2">&quot;mql_context&quot;</span><span class="p">]</span>
</span><span id="Request.to_dict-86"><a href="#Request.to_dict-86"><span class="linenos"> 86</span></a>            <span class="n">query</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">serialized_mql</span><span class="p">[</span><span class="s2">&quot;mql&quot;</span><span class="p">])</span>
</span><span id="Request.to_dict-87"><a href="#Request.to_dict-87"><span class="linenos"> 87</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">,</span> <span class="n">DeleteQuery</span><span class="p">):</span>
</span><span id="Request.to_dict-88"><a href="#Request.to_dict-88"><span class="linenos"> 88</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Request.to_dict-89"><a href="#Request.to_dict-89"><span class="linenos"> 89</span></a><span class="sd">            for a DeleteQuery, the query is not a snql/mql string,</span>
</span><span id="Request.to_dict-90"><a href="#Request.to_dict-90"><span class="linenos"> 90</span></a><span class="sd">            it is a dict</span>
</span><span id="Request.to_dict-91"><a href="#Request.to_dict-91"><span class="linenos"> 91</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="Request.to_dict-92"><a href="#Request.to_dict-92"><span class="linenos"> 92</span></a>            <span class="k">return</span> <span class="p">{</span>
</span><span id="Request.to_dict-93"><a href="#Request.to_dict-93"><span class="linenos"> 93</span></a>                <span class="o">**</span><span class="n">flags</span><span class="p">,</span>
</span><span id="Request.to_dict-94"><a href="#Request.to_dict-94"><span class="linenos"> 94</span></a>                <span class="s2">&quot;query&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">serialize</span><span class="p">(),</span>
</span><span id="Request.to_dict-95"><a href="#Request.to_dict-95"><span class="linenos"> 95</span></a>                <span class="s2">&quot;app_id&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">app_id</span><span class="p">,</span>
</span><span id="Request.to_dict-96"><a href="#Request.to_dict-96"><span class="linenos"> 96</span></a>                <span class="s2">&quot;tenant_ids&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">tenant_ids</span><span class="p">,</span>
</span><span id="Request.to_dict-97"><a href="#Request.to_dict-97"><span class="linenos"> 97</span></a>                <span class="s2">&quot;parent_api&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent_api</span><span class="p">,</span>
</span><span id="Request.to_dict-98"><a href="#Request.to_dict-98"><span class="linenos"> 98</span></a>            <span class="p">}</span>
</span><span id="Request.to_dict-99"><a href="#Request.to_dict-99"><span class="linenos"> 99</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Request.to_dict-100"><a href="#Request.to_dict-100"><span class="linenos">100</span></a>            <span class="n">query</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">serialize</span><span class="p">())</span>
</span><span id="Request.to_dict-101"><a href="#Request.to_dict-101"><span class="linenos">101</span></a>
</span><span id="Request.to_dict-102"><a href="#Request.to_dict-102"><span class="linenos">102</span></a>        <span class="n">ret</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">object</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="Request.to_dict-103"><a href="#Request.to_dict-103"><span class="linenos">103</span></a>            <span class="o">**</span><span class="n">flags</span><span class="p">,</span>
</span><span id="Request.to_dict-104"><a href="#Request.to_dict-104"><span class="linenos">104</span></a>            <span class="s2">&quot;query&quot;</span><span class="p">:</span> <span class="n">query</span><span class="p">,</span>
</span><span id="Request.to_dict-105"><a href="#Request.to_dict-105"><span class="linenos">105</span></a>            <span class="s2">&quot;dataset&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">,</span>
</span><span id="Request.to_dict-106"><a href="#Request.to_dict-106"><span class="linenos">106</span></a>            <span class="s2">&quot;app_id&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">app_id</span><span class="p">,</span>
</span><span id="Request.to_dict-107"><a href="#Request.to_dict-107"><span class="linenos">107</span></a>            <span class="s2">&quot;tenant_ids&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">tenant_ids</span><span class="p">,</span>
</span><span id="Request.to_dict-108"><a href="#Request.to_dict-108"><span class="linenos">108</span></a>            <span class="s2">&quot;parent_api&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent_api</span><span class="p">,</span>
</span><span id="Request.to_dict-109"><a href="#Request.to_dict-109"><span class="linenos">109</span></a>        <span class="p">}</span>
</span><span id="Request.to_dict-110"><a href="#Request.to_dict-110"><span class="linenos">110</span></a>        <span class="k">if</span> <span class="n">mql_context</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Request.to_dict-111"><a href="#Request.to_dict-111"><span class="linenos">111</span></a>            <span class="n">ret</span><span class="p">[</span><span class="s2">&quot;mql_context&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mql_context</span>
</span><span id="Request.to_dict-112"><a href="#Request.to_dict-112"><span class="linenos">112</span></a>        <span class="k">return</span> <span class="n">ret</span>
</span></pre></div>


    

                            </div>
                            <div id="Request.serialize" class="classattr">
                                        <input id="Request.serialize-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">serialize</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="Request.serialize-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Request.serialize"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Request.serialize-114"><a href="#Request.serialize-114"><span class="linenos">114</span></a>    <span class="k">def</span> <span class="nf">serialize</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="Request.serialize-115"><a href="#Request.serialize-115"><span class="linenos">115</span></a>        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">to_dict</span><span class="p">())</span>
</span></pre></div>


    

                            </div>
                            <div id="Request.serialize_mql" class="classattr">
                                        <input id="Request.serialize_mql-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">serialize_mql</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="Request.serialize_mql-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Request.serialize_mql"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Request.serialize_mql-117"><a href="#Request.serialize_mql-117"><span class="linenos">117</span></a>    <span class="k">def</span> <span class="nf">serialize_mql</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="Request.serialize_mql-118"><a href="#Request.serialize_mql-118"><span class="linenos">118</span></a>        <span class="c1"># NOTE: This function is temporary, just to help with a cutover in the Sentry codebase.</span>
</span><span id="Request.serialize_mql-119"><a href="#Request.serialize_mql-119"><span class="linenos">119</span></a>        <span class="c1"># It will be removed in a future version.</span>
</span><span id="Request.serialize_mql-120"><a href="#Request.serialize_mql-120"><span class="linenos">120</span></a>        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">to_dict</span><span class="p">())</span>
</span></pre></div>


    

                            </div>
                            <div id="Request.print" class="classattr">
                                        <input id="Request.print-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">print</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="Request.print-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Request.print"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Request.print-125"><a href="#Request.print-125"><span class="linenos">125</span></a>    <span class="k">def</span> <span class="nf">print</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="Request.print-126"><a href="#Request.print-126"><span class="linenos">126</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">validate</span><span class="p">()</span>
</span><span id="Request.print-127"><a href="#Request.print-127"><span class="linenos">127</span></a>        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
</span><span id="Request.print-128"><a href="#Request.print-128"><span class="linenos">128</span></a>        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span> <span class="o">*</span> <span class="s2">&quot; &quot;</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                </section>
                <section id="Rollup">
                            <input id="Rollup-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
                    <div class="decorator">@dataclass(frozen=True)</div>

    <span class="def">class</span>
    <span class="name">Rollup</span>:

                <label class="view-source-button" for="Rollup-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Rollup"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Rollup-164"><a href="#Rollup-164"><span class="linenos">164</span></a><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Rollup-165"><a href="#Rollup-165"><span class="linenos">165</span></a><span class="k">class</span> <span class="nc">Rollup</span><span class="p">:</span>
</span><span id="Rollup-166"><a href="#Rollup-166"><span class="linenos">166</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Rollup-167"><a href="#Rollup-167"><span class="linenos">167</span></a><span class="sd">    Rollup instructs how the timeseries queries should be grouped on time. If the query is for a set of timeseries, then</span>
</span><span id="Rollup-168"><a href="#Rollup-168"><span class="linenos">168</span></a><span class="sd">    the interval field should be specified. It is the number of seconds to group the timeseries by.</span>
</span><span id="Rollup-169"><a href="#Rollup-169"><span class="linenos">169</span></a><span class="sd">    For a query that returns only the totals, specify Totals(True). A totals query can be ordered using the orderby field.</span>
</span><span id="Rollup-170"><a href="#Rollup-170"><span class="linenos">170</span></a><span class="sd">    If totals is set to True and the interval is specified, then an extra row will be returned in the result with the totals</span>
</span><span id="Rollup-171"><a href="#Rollup-171"><span class="linenos">171</span></a><span class="sd">    for the timeseries.</span>
</span><span id="Rollup-172"><a href="#Rollup-172"><span class="linenos">172</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="Rollup-173"><a href="#Rollup-173"><span class="linenos">173</span></a>
</span><span id="Rollup-174"><a href="#Rollup-174"><span class="linenos">174</span></a>    <span class="n">interval</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Rollup-175"><a href="#Rollup-175"><span class="linenos">175</span></a>    <span class="n">totals</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Rollup-176"><a href="#Rollup-176"><span class="linenos">176</span></a>    <span class="n">orderby</span><span class="p">:</span> <span class="n">Direction</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># TODO: This doesn&#39;t make sense: ordered by what?</span>
</span><span id="Rollup-177"><a href="#Rollup-177"><span class="linenos">177</span></a>    <span class="n">granularity</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Rollup-178"><a href="#Rollup-178"><span class="linenos">178</span></a>
</span><span id="Rollup-179"><a href="#Rollup-179"><span class="linenos">179</span></a>    <span class="k">def</span> <span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Rollup-180"><a href="#Rollup-180"><span class="linenos">180</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">validate</span><span class="p">()</span>
</span><span id="Rollup-181"><a href="#Rollup-181"><span class="linenos">181</span></a>
</span><span id="Rollup-182"><a href="#Rollup-182"><span class="linenos">182</span></a>    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Rollup-183"><a href="#Rollup-183"><span class="linenos">183</span></a>        <span class="c1"># The interval is used to determine how the timestamp is rolled up in the group by of the query.</span>
</span><span id="Rollup-184"><a href="#Rollup-184"><span class="linenos">184</span></a>        <span class="c1"># The granularity is separate since it ultimately determines which data we retrieve.</span>
</span><span id="Rollup-185"><a href="#Rollup-185"><span class="linenos">185</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">granularity</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">granularity</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ALLOWED_GRANULARITIES</span><span class="p">:</span>
</span><span id="Rollup-186"><a href="#Rollup-186"><span class="linenos">186</span></a>            <span class="k">raise</span> <span class="n">InvalidExpressionError</span><span class="p">(</span>
</span><span id="Rollup-187"><a href="#Rollup-187"><span class="linenos">187</span></a>                <span class="sa">f</span><span class="s2">&quot;granularity must be an integer and one of </span><span class="si">{</span><span class="n">ALLOWED_GRANULARITIES</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Rollup-188"><a href="#Rollup-188"><span class="linenos">188</span></a>            <span class="p">)</span>
</span><span id="Rollup-189"><a href="#Rollup-189"><span class="linenos">189</span></a>
</span><span id="Rollup-190"><a href="#Rollup-190"><span class="linenos">190</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">interval</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Rollup-191"><a href="#Rollup-191"><span class="linenos">191</span></a>            <span class="n">_validate_int_literal</span><span class="p">(</span>
</span><span id="Rollup-192"><a href="#Rollup-192"><span class="linenos">192</span></a>                <span class="s2">&quot;interval&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">interval</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="Rollup-193"><a href="#Rollup-193"><span class="linenos">193</span></a>            <span class="p">)</span>  <span class="c1"># Minimum 10 seconds</span>
</span><span id="Rollup-194"><a href="#Rollup-194"><span class="linenos">194</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">granularity</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">interval</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">granularity</span><span class="p">:</span>
</span><span id="Rollup-195"><a href="#Rollup-195"><span class="linenos">195</span></a>                <span class="k">raise</span> <span class="n">InvalidExpressionError</span><span class="p">(</span>
</span><span id="Rollup-196"><a href="#Rollup-196"><span class="linenos">196</span></a>                    <span class="s2">&quot;interval must be greater than or equal to granularity&quot;</span>
</span><span id="Rollup-197"><a href="#Rollup-197"><span class="linenos">197</span></a>                <span class="p">)</span>
</span><span id="Rollup-198"><a href="#Rollup-198"><span class="linenos">198</span></a>
</span><span id="Rollup-199"><a href="#Rollup-199"><span class="linenos">199</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">totals</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Rollup-200"><a href="#Rollup-200"><span class="linenos">200</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">totals</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
</span><span id="Rollup-201"><a href="#Rollup-201"><span class="linenos">201</span></a>                <span class="k">raise</span> <span class="n">InvalidExpressionError</span><span class="p">(</span><span class="s2">&quot;totals must be a boolean&quot;</span><span class="p">)</span>
</span><span id="Rollup-202"><a href="#Rollup-202"><span class="linenos">202</span></a>
</span><span id="Rollup-203"><a href="#Rollup-203"><span class="linenos">203</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">interval</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">totals</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Rollup-204"><a href="#Rollup-204"><span class="linenos">204</span></a>            <span class="k">raise</span> <span class="n">InvalidExpressionError</span><span class="p">(</span>
</span><span id="Rollup-205"><a href="#Rollup-205"><span class="linenos">205</span></a>                <span class="s2">&quot;Rollup must have at least one of interval or totals&quot;</span>
</span><span id="Rollup-206"><a href="#Rollup-206"><span class="linenos">206</span></a>            <span class="p">)</span>
</span><span id="Rollup-207"><a href="#Rollup-207"><span class="linenos">207</span></a>
</span><span id="Rollup-208"><a href="#Rollup-208"><span class="linenos">208</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">orderby</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Rollup-209"><a href="#Rollup-209"><span class="linenos">209</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">orderby</span><span class="p">,</span> <span class="n">Direction</span><span class="p">):</span>
</span><span id="Rollup-210"><a href="#Rollup-210"><span class="linenos">210</span></a>                <span class="k">raise</span> <span class="n">InvalidExpressionError</span><span class="p">(</span><span class="s2">&quot;orderby must be a Direction object&quot;</span><span class="p">)</span>
</span><span id="Rollup-211"><a href="#Rollup-211"><span class="linenos">211</span></a>
</span><span id="Rollup-212"><a href="#Rollup-212"><span class="linenos">212</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">interval</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">orderby</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Rollup-213"><a href="#Rollup-213"><span class="linenos">213</span></a>            <span class="k">raise</span> <span class="n">InvalidExpressionError</span><span class="p">(</span>
</span><span id="Rollup-214"><a href="#Rollup-214"><span class="linenos">214</span></a>                <span class="s2">&quot;Timeseries queries can&#39;t be ordered when using interval&quot;</span>
</span><span id="Rollup-215"><a href="#Rollup-215"><span class="linenos">215</span></a>            <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Rollup instructs how the timeseries queries should be grouped on time. If the query is for a set of timeseries, then
the interval field should be specified. It is the number of seconds to group the timeseries by.
For a query that returns only the totals, specify Totals(True). A totals query can be ordered using the orderby field.
If totals is set to True and the interval is specified, then an extra row will be returned in the result with the totals
for the timeseries.</p>
</div>


                            <div id="Rollup.__init__" class="classattr">
                                <div class="attr function">
            
        <span class="name">Rollup</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">interval</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">totals</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">orderby</span><span class="p">:</span> <span class="n"><a href="#Direction">Direction</a></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">granularity</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></span>)</span>

        
    </div>
    <a class="headerlink" href="#Rollup.__init__"></a>
    
    

                            </div>
                            <div id="Rollup.interval" class="classattr">
                                <div class="attr variable">
            <span class="name">interval</span><span class="annotation">: int | None</span>        =
<span class="default_value">None</span>

        
    </div>
    <a class="headerlink" href="#Rollup.interval"></a>
    
    

                            </div>
                            <div id="Rollup.totals" class="classattr">
                                <div class="attr variable">
            <span class="name">totals</span><span class="annotation">: bool | None</span>        =
<span class="default_value">None</span>

        
    </div>
    <a class="headerlink" href="#Rollup.totals"></a>
    
    

                            </div>
                            <div id="Rollup.orderby" class="classattr">
                                <div class="attr variable">
            <span class="name">orderby</span><span class="annotation">: <a href="#Direction">Direction</a> | None</span>        =
<span class="default_value">None</span>

        
    </div>
    <a class="headerlink" href="#Rollup.orderby"></a>
    
    

                            </div>
                            <div id="Rollup.granularity" class="classattr">
                                <div class="attr variable">
            <span class="name">granularity</span><span class="annotation">: int | None</span>        =
<span class="default_value">None</span>

        
    </div>
    <a class="headerlink" href="#Rollup.granularity"></a>
    
    

                            </div>
                            <div id="Rollup.validate" class="classattr">
                                        <input id="Rollup.validate-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">validate</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="Rollup.validate-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Rollup.validate"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Rollup.validate-182"><a href="#Rollup.validate-182"><span class="linenos">182</span></a>    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Rollup.validate-183"><a href="#Rollup.validate-183"><span class="linenos">183</span></a>        <span class="c1"># The interval is used to determine how the timestamp is rolled up in the group by of the query.</span>
</span><span id="Rollup.validate-184"><a href="#Rollup.validate-184"><span class="linenos">184</span></a>        <span class="c1"># The granularity is separate since it ultimately determines which data we retrieve.</span>
</span><span id="Rollup.validate-185"><a href="#Rollup.validate-185"><span class="linenos">185</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">granularity</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">granularity</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ALLOWED_GRANULARITIES</span><span class="p">:</span>
</span><span id="Rollup.validate-186"><a href="#Rollup.validate-186"><span class="linenos">186</span></a>            <span class="k">raise</span> <span class="n">InvalidExpressionError</span><span class="p">(</span>
</span><span id="Rollup.validate-187"><a href="#Rollup.validate-187"><span class="linenos">187</span></a>                <span class="sa">f</span><span class="s2">&quot;granularity must be an integer and one of </span><span class="si">{</span><span class="n">ALLOWED_GRANULARITIES</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Rollup.validate-188"><a href="#Rollup.validate-188"><span class="linenos">188</span></a>            <span class="p">)</span>
</span><span id="Rollup.validate-189"><a href="#Rollup.validate-189"><span class="linenos">189</span></a>
</span><span id="Rollup.validate-190"><a href="#Rollup.validate-190"><span class="linenos">190</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">interval</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Rollup.validate-191"><a href="#Rollup.validate-191"><span class="linenos">191</span></a>            <span class="n">_validate_int_literal</span><span class="p">(</span>
</span><span id="Rollup.validate-192"><a href="#Rollup.validate-192"><span class="linenos">192</span></a>                <span class="s2">&quot;interval&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">interval</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="Rollup.validate-193"><a href="#Rollup.validate-193"><span class="linenos">193</span></a>            <span class="p">)</span>  <span class="c1"># Minimum 10 seconds</span>
</span><span id="Rollup.validate-194"><a href="#Rollup.validate-194"><span class="linenos">194</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">granularity</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">interval</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">granularity</span><span class="p">:</span>
</span><span id="Rollup.validate-195"><a href="#Rollup.validate-195"><span class="linenos">195</span></a>                <span class="k">raise</span> <span class="n">InvalidExpressionError</span><span class="p">(</span>
</span><span id="Rollup.validate-196"><a href="#Rollup.validate-196"><span class="linenos">196</span></a>                    <span class="s2">&quot;interval must be greater than or equal to granularity&quot;</span>
</span><span id="Rollup.validate-197"><a href="#Rollup.validate-197"><span class="linenos">197</span></a>                <span class="p">)</span>
</span><span id="Rollup.validate-198"><a href="#Rollup.validate-198"><span class="linenos">198</span></a>
</span><span id="Rollup.validate-199"><a href="#Rollup.validate-199"><span class="linenos">199</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">totals</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Rollup.validate-200"><a href="#Rollup.validate-200"><span class="linenos">200</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">totals</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
</span><span id="Rollup.validate-201"><a href="#Rollup.validate-201"><span class="linenos">201</span></a>                <span class="k">raise</span> <span class="n">InvalidExpressionError</span><span class="p">(</span><span class="s2">&quot;totals must be a boolean&quot;</span><span class="p">)</span>
</span><span id="Rollup.validate-202"><a href="#Rollup.validate-202"><span class="linenos">202</span></a>
</span><span id="Rollup.validate-203"><a href="#Rollup.validate-203"><span class="linenos">203</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">interval</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">totals</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Rollup.validate-204"><a href="#Rollup.validate-204"><span class="linenos">204</span></a>            <span class="k">raise</span> <span class="n">InvalidExpressionError</span><span class="p">(</span>
</span><span id="Rollup.validate-205"><a href="#Rollup.validate-205"><span class="linenos">205</span></a>                <span class="s2">&quot;Rollup must have at least one of interval or totals&quot;</span>
</span><span id="Rollup.validate-206"><a href="#Rollup.validate-206"><span class="linenos">206</span></a>            <span class="p">)</span>
</span><span id="Rollup.validate-207"><a href="#Rollup.validate-207"><span class="linenos">207</span></a>
</span><span id="Rollup.validate-208"><a href="#Rollup.validate-208"><span class="linenos">208</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">orderby</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Rollup.validate-209"><a href="#Rollup.validate-209"><span class="linenos">209</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">orderby</span><span class="p">,</span> <span class="n">Direction</span><span class="p">):</span>
</span><span id="Rollup.validate-210"><a href="#Rollup.validate-210"><span class="linenos">210</span></a>                <span class="k">raise</span> <span class="n">InvalidExpressionError</span><span class="p">(</span><span class="s2">&quot;orderby must be a Direction object&quot;</span><span class="p">)</span>
</span><span id="Rollup.validate-211"><a href="#Rollup.validate-211"><span class="linenos">211</span></a>
</span><span id="Rollup.validate-212"><a href="#Rollup.validate-212"><span class="linenos">212</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">interval</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">orderby</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Rollup.validate-213"><a href="#Rollup.validate-213"><span class="linenos">213</span></a>            <span class="k">raise</span> <span class="n">InvalidExpressionError</span><span class="p">(</span>
</span><span id="Rollup.validate-214"><a href="#Rollup.validate-214"><span class="linenos">214</span></a>                <span class="s2">&quot;Timeseries queries can&#39;t be ordered when using interval&quot;</span>
</span><span id="Rollup.validate-215"><a href="#Rollup.validate-215"><span class="linenos">215</span></a>            <span class="p">)</span>
</span></pre></div>


    

                            </div>
                </section>
                <section id="Storage">
                            <input id="Storage-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
                    <div class="decorator">@dataclass(frozen=True, repr=False)</div>

    <span class="def">class</span>
    <span class="name">Storage</span><wbr>(<span class="base">snuba_sdk.expressions.Expression</span>):

                <label class="view-source-button" for="Storage-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Storage"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Storage-16"><a href="#Storage-16"><span class="linenos">16</span></a><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="nb">repr</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="Storage-17"><a href="#Storage-17"><span class="linenos">17</span></a><span class="k">class</span> <span class="nc">Storage</span><span class="p">(</span><span class="n">Expression</span><span class="p">):</span>
</span><span id="Storage-18"><a href="#Storage-18"><span class="linenos">18</span></a>    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="Storage-19"><a href="#Storage-19"><span class="linenos">19</span></a>    <span class="n">sample</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Storage-20"><a href="#Storage-20"><span class="linenos">20</span></a>    <span class="n">data_model</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">DataModel</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="nb">hash</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</span><span id="Storage-21"><a href="#Storage-21"><span class="linenos">21</span></a>
</span><span id="Storage-22"><a href="#Storage-22"><span class="linenos">22</span></a>    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Storage-23"><a href="#Storage-23"><span class="linenos">23</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">storage_name_re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">):</span>
</span><span id="Storage-24"><a href="#Storage-24"><span class="linenos">24</span></a>            <span class="k">raise</span> <span class="n">InvalidStorageError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; is not a valid storage name&quot;</span><span class="p">)</span>
</span><span id="Storage-25"><a href="#Storage-25"><span class="linenos">25</span></a>
</span><span id="Storage-26"><a href="#Storage-26"><span class="linenos">26</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Storage-27"><a href="#Storage-27"><span class="linenos">27</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sample</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
</span><span id="Storage-28"><a href="#Storage-28"><span class="linenos">28</span></a>                <span class="k">raise</span> <span class="n">InvalidStorageError</span><span class="p">(</span><span class="s2">&quot;sample must be a float&quot;</span><span class="p">)</span>
</span><span id="Storage-29"><a href="#Storage-29"><span class="linenos">29</span></a>            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">:</span>
</span><span id="Storage-30"><a href="#Storage-30"><span class="linenos">30</span></a>                <span class="k">raise</span> <span class="n">InvalidStorageError</span><span class="p">(</span><span class="s2">&quot;samples must be greater than 0.0&quot;</span><span class="p">)</span>
</span><span id="Storage-31"><a href="#Storage-31"><span class="linenos">31</span></a>
</span><span id="Storage-32"><a href="#Storage-32"><span class="linenos">32</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_model</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Storage-33"><a href="#Storage-33"><span class="linenos">33</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_model</span><span class="p">,</span> <span class="n">DataModel</span><span class="p">):</span>
</span><span id="Storage-34"><a href="#Storage-34"><span class="linenos">34</span></a>                <span class="k">raise</span> <span class="n">InvalidStorageError</span><span class="p">(</span><span class="s2">&quot;data_model must be an instance of DataModel&quot;</span><span class="p">)</span>
</span><span id="Storage-35"><a href="#Storage-35"><span class="linenos">35</span></a>
</span><span id="Storage-36"><a href="#Storage-36"><span class="linenos">36</span></a>    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="Storage-37"><a href="#Storage-37"><span class="linenos">37</span></a>        <span class="n">sample</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;, sample=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">sample</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
</span><span id="Storage-38"><a href="#Storage-38"><span class="linenos">38</span></a>        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;STORAGE(&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39;</span><span class="si">{</span><span class="n">sample</span><span class="si">}</span><span class="s2">)&quot;</span>
</span></pre></div>


    

                            <div id="Storage.__init__" class="classattr">
                                <div class="attr function">
            
        <span class="name">Storage</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">name</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">sample</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">data_model</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">snuba_sdk</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">DataModel</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span>)</span>

        
    </div>
    <a class="headerlink" href="#Storage.__init__"></a>
    
    

                            </div>
                            <div id="Storage.name" class="classattr">
                                <div class="attr variable">
            <span class="name">name</span><span class="annotation">: str</span>

        
    </div>
    <a class="headerlink" href="#Storage.name"></a>
    
    

                            </div>
                            <div id="Storage.sample" class="classattr">
                                <div class="attr variable">
            <span class="name">sample</span><span class="annotation">: Optional[float]</span>        =
<span class="default_value">None</span>

        
    </div>
    <a class="headerlink" href="#Storage.sample"></a>
    
    

                            </div>
                            <div id="Storage.data_model" class="classattr">
                                <div class="attr variable">
            <span class="name">data_model</span><span class="annotation">: Optional[snuba_sdk.schema.DataModel]</span>        =
<span class="default_value">None</span>

        
    </div>
    <a class="headerlink" href="#Storage.data_model"></a>
    
    

                            </div>
                            <div id="Storage.validate" class="classattr">
                                        <input id="Storage.validate-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">validate</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="Storage.validate-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Storage.validate"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Storage.validate-22"><a href="#Storage.validate-22"><span class="linenos">22</span></a>    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Storage.validate-23"><a href="#Storage.validate-23"><span class="linenos">23</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">storage_name_re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">):</span>
</span><span id="Storage.validate-24"><a href="#Storage.validate-24"><span class="linenos">24</span></a>            <span class="k">raise</span> <span class="n">InvalidStorageError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; is not a valid storage name&quot;</span><span class="p">)</span>
</span><span id="Storage.validate-25"><a href="#Storage.validate-25"><span class="linenos">25</span></a>
</span><span id="Storage.validate-26"><a href="#Storage.validate-26"><span class="linenos">26</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Storage.validate-27"><a href="#Storage.validate-27"><span class="linenos">27</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sample</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
</span><span id="Storage.validate-28"><a href="#Storage.validate-28"><span class="linenos">28</span></a>                <span class="k">raise</span> <span class="n">InvalidStorageError</span><span class="p">(</span><span class="s2">&quot;sample must be a float&quot;</span><span class="p">)</span>
</span><span id="Storage.validate-29"><a href="#Storage.validate-29"><span class="linenos">29</span></a>            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">:</span>
</span><span id="Storage.validate-30"><a href="#Storage.validate-30"><span class="linenos">30</span></a>                <span class="k">raise</span> <span class="n">InvalidStorageError</span><span class="p">(</span><span class="s2">&quot;samples must be greater than 0.0&quot;</span><span class="p">)</span>
</span><span id="Storage.validate-31"><a href="#Storage.validate-31"><span class="linenos">31</span></a>
</span><span id="Storage.validate-32"><a href="#Storage.validate-32"><span class="linenos">32</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_model</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Storage.validate-33"><a href="#Storage.validate-33"><span class="linenos">33</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_model</span><span class="p">,</span> <span class="n">DataModel</span><span class="p">):</span>
</span><span id="Storage.validate-34"><a href="#Storage.validate-34"><span class="linenos">34</span></a>                <span class="k">raise</span> <span class="n">InvalidStorageError</span><span class="p">(</span><span class="s2">&quot;data_model must be an instance of DataModel&quot;</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                </section>
                <section id="Timeseries">
                            <input id="Timeseries-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
                    <div class="decorator">@dataclass</div>

    <span class="def">class</span>
    <span class="name">Timeseries</span>:

                <label class="view-source-button" for="Timeseries-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Timeseries"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Timeseries-70"><a href="#Timeseries-70"><span class="linenos"> 70</span></a><span class="nd">@dataclass</span>
</span><span id="Timeseries-71"><a href="#Timeseries-71"><span class="linenos"> 71</span></a><span class="k">class</span> <span class="nc">Timeseries</span><span class="p">:</span>
</span><span id="Timeseries-72"><a href="#Timeseries-72"><span class="linenos"> 72</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Timeseries-73"><a href="#Timeseries-73"><span class="linenos"> 73</span></a><span class="sd">    A code representation of a single timeseries. This is the basic unit of a metrics query.</span>
</span><span id="Timeseries-74"><a href="#Timeseries-74"><span class="linenos"> 74</span></a><span class="sd">    A raw metric, aggregated by an aggregate function. It can be filtered by tag conditions.</span>
</span><span id="Timeseries-75"><a href="#Timeseries-75"><span class="linenos"> 75</span></a><span class="sd">    It can also grouped by a set of tag values, which will return one timeseries for each unique</span>
</span><span id="Timeseries-76"><a href="#Timeseries-76"><span class="linenos"> 76</span></a><span class="sd">    grouping of tag values.</span>
</span><span id="Timeseries-77"><a href="#Timeseries-77"><span class="linenos"> 77</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="Timeseries-78"><a href="#Timeseries-78"><span class="linenos"> 78</span></a>
</span><span id="Timeseries-79"><a href="#Timeseries-79"><span class="linenos"> 79</span></a>    <span class="n">metric</span><span class="p">:</span> <span class="n">Metric</span>
</span><span id="Timeseries-80"><a href="#Timeseries-80"><span class="linenos"> 80</span></a>    <span class="n">aggregate</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="Timeseries-81"><a href="#Timeseries-81"><span class="linenos"> 81</span></a>    <span class="n">aggregate_params</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Timeseries-82"><a href="#Timeseries-82"><span class="linenos"> 82</span></a>    <span class="n">filters</span><span class="p">:</span> <span class="n">ConditionGroup</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Timeseries-83"><a href="#Timeseries-83"><span class="linenos"> 83</span></a>    <span class="n">groupby</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Column</span> <span class="o">|</span> <span class="n">AliasedExpression</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Timeseries-84"><a href="#Timeseries-84"><span class="linenos"> 84</span></a>
</span><span id="Timeseries-85"><a href="#Timeseries-85"><span class="linenos"> 85</span></a>    <span class="k">def</span> <span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Timeseries-86"><a href="#Timeseries-86"><span class="linenos"> 86</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">validate</span><span class="p">()</span>
</span><span id="Timeseries-87"><a href="#Timeseries-87"><span class="linenos"> 87</span></a>
</span><span id="Timeseries-88"><a href="#Timeseries-88"><span class="linenos"> 88</span></a>    <span class="k">def</span> <span class="nf">get_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="Timeseries-89"><a href="#Timeseries-89"><span class="linenos"> 89</span></a>        <span class="n">self_fields</span> <span class="o">=</span> <span class="n">fields</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>  <span class="c1"># Verified the order in the Python source</span>
</span><span id="Timeseries-90"><a href="#Timeseries-90"><span class="linenos"> 90</span></a>        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">self_fields</span><span class="p">)</span>
</span><span id="Timeseries-91"><a href="#Timeseries-91"><span class="linenos"> 91</span></a>
</span><span id="Timeseries-92"><a href="#Timeseries-92"><span class="linenos"> 92</span></a>    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Timeseries-93"><a href="#Timeseries-93"><span class="linenos"> 93</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metric</span><span class="p">,</span> <span class="n">Metric</span><span class="p">):</span>
</span><span id="Timeseries-94"><a href="#Timeseries-94"><span class="linenos"> 94</span></a>            <span class="k">raise</span> <span class="n">InvalidTimeseriesError</span><span class="p">(</span><span class="s2">&quot;metric must be an instance of a Metric&quot;</span><span class="p">)</span>
</span><span id="Timeseries-95"><a href="#Timeseries-95"><span class="linenos"> 95</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">metric</span><span class="o">.</span><span class="n">validate</span><span class="p">()</span>
</span><span id="Timeseries-96"><a href="#Timeseries-96"><span class="linenos"> 96</span></a>
</span><span id="Timeseries-97"><a href="#Timeseries-97"><span class="linenos"> 97</span></a>        <span class="c1"># TODO: Restrict which specific aggregates are allowed</span>
</span><span id="Timeseries-98"><a href="#Timeseries-98"><span class="linenos"> 98</span></a>        <span class="c1"># TODO: Validate aggregate_params based on the aggregate supplied e.g. quantile needs a float</span>
</span><span id="Timeseries-99"><a href="#Timeseries-99"><span class="linenos"> 99</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">aggregate</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="Timeseries-100"><a href="#Timeseries-100"><span class="linenos">100</span></a>            <span class="k">raise</span> <span class="n">InvalidTimeseriesError</span><span class="p">(</span><span class="s2">&quot;aggregate must be a string&quot;</span><span class="p">)</span>
</span><span id="Timeseries-101"><a href="#Timeseries-101"><span class="linenos">101</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">aggregate_params</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Timeseries-102"><a href="#Timeseries-102"><span class="linenos">102</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">aggregate_params</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="Timeseries-103"><a href="#Timeseries-103"><span class="linenos">103</span></a>                <span class="k">raise</span> <span class="n">InvalidTimeseriesError</span><span class="p">(</span><span class="s2">&quot;aggregate_params must be a list&quot;</span><span class="p">)</span>
</span><span id="Timeseries-104"><a href="#Timeseries-104"><span class="linenos">104</span></a>            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">aggregate_params</span><span class="p">:</span>
</span><span id="Timeseries-105"><a href="#Timeseries-105"><span class="linenos">105</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">is_literal</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
</span><span id="Timeseries-106"><a href="#Timeseries-106"><span class="linenos">106</span></a>                    <span class="k">raise</span> <span class="n">InvalidTimeseriesError</span><span class="p">(</span>
</span><span id="Timeseries-107"><a href="#Timeseries-107"><span class="linenos">107</span></a>                        <span class="s2">&quot;aggregate_params can only be literal types&quot;</span>
</span><span id="Timeseries-108"><a href="#Timeseries-108"><span class="linenos">108</span></a>                    <span class="p">)</span>
</span><span id="Timeseries-109"><a href="#Timeseries-109"><span class="linenos">109</span></a>
</span><span id="Timeseries-110"><a href="#Timeseries-110"><span class="linenos">110</span></a>        <span class="c1"># TODO: Validate these are tag conditions only</span>
</span><span id="Timeseries-111"><a href="#Timeseries-111"><span class="linenos">111</span></a>        <span class="c1"># TODO: Validate these are simple conditions e.g. tag[x] op literal</span>
</span><span id="Timeseries-112"><a href="#Timeseries-112"><span class="linenos">112</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">filters</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Timeseries-113"><a href="#Timeseries-113"><span class="linenos">113</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="Timeseries-114"><a href="#Timeseries-114"><span class="linenos">114</span></a>                <span class="k">raise</span> <span class="n">InvalidTimeseriesError</span><span class="p">(</span><span class="s2">&quot;filters must be a list&quot;</span><span class="p">)</span>
</span><span id="Timeseries-115"><a href="#Timeseries-115"><span class="linenos">115</span></a>            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="p">:</span>
</span><span id="Timeseries-116"><a href="#Timeseries-116"><span class="linenos">116</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="p">(</span><span class="n">Condition</span><span class="p">,</span> <span class="n">BooleanCondition</span><span class="p">)):</span>
</span><span id="Timeseries-117"><a href="#Timeseries-117"><span class="linenos">117</span></a>                    <span class="k">raise</span> <span class="n">InvalidTimeseriesError</span><span class="p">(</span><span class="s2">&quot;filters must be a list of Conditions&quot;</span><span class="p">)</span>
</span><span id="Timeseries-118"><a href="#Timeseries-118"><span class="linenos">118</span></a>
</span><span id="Timeseries-119"><a href="#Timeseries-119"><span class="linenos">119</span></a>        <span class="c1"># TODO: Can you group by meta information like project_id?</span>
</span><span id="Timeseries-120"><a href="#Timeseries-120"><span class="linenos">120</span></a>        <span class="c1"># TODO: Validate these are appropriate columns for grouping</span>
</span><span id="Timeseries-121"><a href="#Timeseries-121"><span class="linenos">121</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">groupby</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Timeseries-122"><a href="#Timeseries-122"><span class="linenos">122</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">groupby</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="Timeseries-123"><a href="#Timeseries-123"><span class="linenos">123</span></a>                <span class="k">raise</span> <span class="n">InvalidTimeseriesError</span><span class="p">(</span><span class="s2">&quot;groupby must be a list&quot;</span><span class="p">)</span>
</span><span id="Timeseries-124"><a href="#Timeseries-124"><span class="linenos">124</span></a>            <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">groupby</span><span class="p">:</span>
</span><span id="Timeseries-125"><a href="#Timeseries-125"><span class="linenos">125</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="p">(</span><span class="n">Column</span><span class="p">,</span> <span class="n">AliasedExpression</span><span class="p">)):</span>
</span><span id="Timeseries-126"><a href="#Timeseries-126"><span class="linenos">126</span></a>                    <span class="k">raise</span> <span class="n">InvalidTimeseriesError</span><span class="p">(</span>
</span><span id="Timeseries-127"><a href="#Timeseries-127"><span class="linenos">127</span></a>                        <span class="s2">&quot;groupby must be a list of Columns or AliasedExpression&quot;</span>
</span><span id="Timeseries-128"><a href="#Timeseries-128"><span class="linenos">128</span></a>                    <span class="p">)</span>
</span><span id="Timeseries-129"><a href="#Timeseries-129"><span class="linenos">129</span></a>
</span><span id="Timeseries-130"><a href="#Timeseries-130"><span class="linenos">130</span></a>    <span class="k">def</span> <span class="nf">set_metric</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">metric</span><span class="p">:</span> <span class="n">Metric</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Timeseries</span><span class="p">:</span>
</span><span id="Timeseries-131"><a href="#Timeseries-131"><span class="linenos">131</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">metric</span><span class="p">,</span> <span class="n">Metric</span><span class="p">):</span>
</span><span id="Timeseries-132"><a href="#Timeseries-132"><span class="linenos">132</span></a>            <span class="k">raise</span> <span class="n">InvalidTimeseriesError</span><span class="p">(</span><span class="s2">&quot;metric must be a Metric&quot;</span><span class="p">)</span>
</span><span id="Timeseries-133"><a href="#Timeseries-133"><span class="linenos">133</span></a>        <span class="k">return</span> <span class="n">replace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="n">metric</span><span class="p">)</span>
</span><span id="Timeseries-134"><a href="#Timeseries-134"><span class="linenos">134</span></a>
</span><span id="Timeseries-135"><a href="#Timeseries-135"><span class="linenos">135</span></a>    <span class="k">def</span> <span class="nf">set_aggregate</span><span class="p">(</span>
</span><span id="Timeseries-136"><a href="#Timeseries-136"><span class="linenos">136</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">aggregate</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">aggregate_params</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Timeseries-137"><a href="#Timeseries-137"><span class="linenos">137</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Timeseries</span><span class="p">:</span>
</span><span id="Timeseries-138"><a href="#Timeseries-138"><span class="linenos">138</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">aggregate</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="Timeseries-139"><a href="#Timeseries-139"><span class="linenos">139</span></a>            <span class="k">raise</span> <span class="n">InvalidTimeseriesError</span><span class="p">(</span><span class="s2">&quot;aggregate must be a str&quot;</span><span class="p">)</span>
</span><span id="Timeseries-140"><a href="#Timeseries-140"><span class="linenos">140</span></a>        <span class="k">if</span> <span class="n">aggregate_params</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">aggregate_params</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="Timeseries-141"><a href="#Timeseries-141"><span class="linenos">141</span></a>            <span class="k">raise</span> <span class="n">InvalidTimeseriesError</span><span class="p">(</span><span class="s2">&quot;aggregate_params must be a list&quot;</span><span class="p">)</span>
</span><span id="Timeseries-142"><a href="#Timeseries-142"><span class="linenos">142</span></a>        <span class="k">return</span> <span class="n">replace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">aggregate</span><span class="o">=</span><span class="n">aggregate</span><span class="p">,</span> <span class="n">aggregate_params</span><span class="o">=</span><span class="n">aggregate_params</span><span class="p">)</span>
</span><span id="Timeseries-143"><a href="#Timeseries-143"><span class="linenos">143</span></a>
</span><span id="Timeseries-144"><a href="#Timeseries-144"><span class="linenos">144</span></a>    <span class="k">def</span> <span class="nf">set_filters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filters</span><span class="p">:</span> <span class="n">ConditionGroup</span> <span class="o">|</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Timeseries</span><span class="p">:</span>
</span><span id="Timeseries-145"><a href="#Timeseries-145"><span class="linenos">145</span></a>        <span class="k">if</span> <span class="n">filters</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">list_type</span><span class="p">(</span>
</span><span id="Timeseries-146"><a href="#Timeseries-146"><span class="linenos">146</span></a>            <span class="n">filters</span><span class="p">,</span> <span class="p">(</span><span class="n">BooleanCondition</span><span class="p">,</span> <span class="n">Condition</span><span class="p">)</span>
</span><span id="Timeseries-147"><a href="#Timeseries-147"><span class="linenos">147</span></a>        <span class="p">):</span>
</span><span id="Timeseries-148"><a href="#Timeseries-148"><span class="linenos">148</span></a>            <span class="k">raise</span> <span class="n">InvalidTimeseriesError</span><span class="p">(</span><span class="s2">&quot;filters must be a list of Conditions&quot;</span><span class="p">)</span>
</span><span id="Timeseries-149"><a href="#Timeseries-149"><span class="linenos">149</span></a>        <span class="k">return</span> <span class="n">replace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filters</span><span class="o">=</span><span class="n">filters</span><span class="p">)</span>
</span><span id="Timeseries-150"><a href="#Timeseries-150"><span class="linenos">150</span></a>
</span><span id="Timeseries-151"><a href="#Timeseries-151"><span class="linenos">151</span></a>    <span class="k">def</span> <span class="nf">set_groupby</span><span class="p">(</span>
</span><span id="Timeseries-152"><a href="#Timeseries-152"><span class="linenos">152</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">groupby</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Column</span> <span class="o">|</span> <span class="n">AliasedExpression</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span>
</span><span id="Timeseries-153"><a href="#Timeseries-153"><span class="linenos">153</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Timeseries</span><span class="p">:</span>
</span><span id="Timeseries-154"><a href="#Timeseries-154"><span class="linenos">154</span></a>        <span class="k">if</span> <span class="n">groupby</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">list_type</span><span class="p">(</span><span class="n">groupby</span><span class="p">,</span> <span class="p">(</span><span class="n">Column</span><span class="p">,</span> <span class="n">AliasedExpression</span><span class="p">)):</span>
</span><span id="Timeseries-155"><a href="#Timeseries-155"><span class="linenos">155</span></a>            <span class="k">raise</span> <span class="n">InvalidTimeseriesError</span><span class="p">(</span>
</span><span id="Timeseries-156"><a href="#Timeseries-156"><span class="linenos">156</span></a>                <span class="s2">&quot;groupby must be a list of Columns or AliasedExpression&quot;</span>
</span><span id="Timeseries-157"><a href="#Timeseries-157"><span class="linenos">157</span></a>            <span class="p">)</span>
</span><span id="Timeseries-158"><a href="#Timeseries-158"><span class="linenos">158</span></a>        <span class="k">return</span> <span class="n">replace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">groupby</span><span class="o">=</span><span class="n">groupby</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>A code representation of a single timeseries. This is the basic unit of a metrics query.
A raw metric, aggregated by an aggregate function. It can be filtered by tag conditions.
It can also grouped by a set of tag values, which will return one timeseries for each unique
grouping of tag values.</p>
</div>


                            <div id="Timeseries.__init__" class="classattr">
                                <div class="attr function">
            
        <span class="name">Timeseries</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">metric</span><span class="p">:</span> <span class="n"><a href="#Metric">Metric</a></span>,</span><span class="param">	<span class="n">aggregate</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">aggregate_params</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">filters</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n"><a href="#BooleanCondition">BooleanCondition</a></span><span class="p">,</span> <span class="n"><a href="#Condition">Condition</a></span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">groupby</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n"><a href="#Column">Column</a></span> <span class="o">|</span> <span class="n"><a href="#AliasedExpression">AliasedExpression</a></span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></span>)</span>

        
    </div>
    <a class="headerlink" href="#Timeseries.__init__"></a>
    
    

                            </div>
                            <div id="Timeseries.metric" class="classattr">
                                <div class="attr variable">
            <span class="name">metric</span><span class="annotation">: <a href="#Metric">Metric</a></span>

        
    </div>
    <a class="headerlink" href="#Timeseries.metric"></a>
    
    

                            </div>
                            <div id="Timeseries.aggregate" class="classattr">
                                <div class="attr variable">
            <span class="name">aggregate</span><span class="annotation">: str</span>

        
    </div>
    <a class="headerlink" href="#Timeseries.aggregate"></a>
    
    

                            </div>
                            <div id="Timeseries.aggregate_params" class="classattr">
                                <div class="attr variable">
            <span class="name">aggregate_params</span><span class="annotation">: list[typing.Any] | None</span>        =
<span class="default_value">None</span>

        
    </div>
    <a class="headerlink" href="#Timeseries.aggregate_params"></a>
    
    

                            </div>
                            <div id="Timeseries.filters" class="classattr">
                                <div class="attr variable">
            <span class="name">filters</span><span class="annotation">: Optional[Sequence[Union[<a href="#BooleanCondition">BooleanCondition</a>, <a href="#Condition">Condition</a>]]]</span>        =
<span class="default_value">None</span>

        
    </div>
    <a class="headerlink" href="#Timeseries.filters"></a>
    
    

                            </div>
                            <div id="Timeseries.groupby" class="classattr">
                                <div class="attr variable">
            <span class="name">groupby</span><span class="annotation">: list[<a href="#Column">Column</a> | <a href="#AliasedExpression">AliasedExpression</a>] | None</span>        =
<span class="default_value">None</span>

        
    </div>
    <a class="headerlink" href="#Timeseries.groupby"></a>
    
    

                            </div>
                            <div id="Timeseries.get_fields" class="classattr">
                                        <input id="Timeseries.get_fields-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_fields</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="Timeseries.get_fields-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Timeseries.get_fields"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Timeseries.get_fields-88"><a href="#Timeseries.get_fields-88"><span class="linenos">88</span></a>    <span class="k">def</span> <span class="nf">get_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="Timeseries.get_fields-89"><a href="#Timeseries.get_fields-89"><span class="linenos">89</span></a>        <span class="n">self_fields</span> <span class="o">=</span> <span class="n">fields</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>  <span class="c1"># Verified the order in the Python source</span>
</span><span id="Timeseries.get_fields-90"><a href="#Timeseries.get_fields-90"><span class="linenos">90</span></a>        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">self_fields</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="Timeseries.validate" class="classattr">
                                        <input id="Timeseries.validate-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">validate</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="Timeseries.validate-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Timeseries.validate"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Timeseries.validate-92"><a href="#Timeseries.validate-92"><span class="linenos"> 92</span></a>    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Timeseries.validate-93"><a href="#Timeseries.validate-93"><span class="linenos"> 93</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metric</span><span class="p">,</span> <span class="n">Metric</span><span class="p">):</span>
</span><span id="Timeseries.validate-94"><a href="#Timeseries.validate-94"><span class="linenos"> 94</span></a>            <span class="k">raise</span> <span class="n">InvalidTimeseriesError</span><span class="p">(</span><span class="s2">&quot;metric must be an instance of a Metric&quot;</span><span class="p">)</span>
</span><span id="Timeseries.validate-95"><a href="#Timeseries.validate-95"><span class="linenos"> 95</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">metric</span><span class="o">.</span><span class="n">validate</span><span class="p">()</span>
</span><span id="Timeseries.validate-96"><a href="#Timeseries.validate-96"><span class="linenos"> 96</span></a>
</span><span id="Timeseries.validate-97"><a href="#Timeseries.validate-97"><span class="linenos"> 97</span></a>        <span class="c1"># TODO: Restrict which specific aggregates are allowed</span>
</span><span id="Timeseries.validate-98"><a href="#Timeseries.validate-98"><span class="linenos"> 98</span></a>        <span class="c1"># TODO: Validate aggregate_params based on the aggregate supplied e.g. quantile needs a float</span>
</span><span id="Timeseries.validate-99"><a href="#Timeseries.validate-99"><span class="linenos"> 99</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">aggregate</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="Timeseries.validate-100"><a href="#Timeseries.validate-100"><span class="linenos">100</span></a>            <span class="k">raise</span> <span class="n">InvalidTimeseriesError</span><span class="p">(</span><span class="s2">&quot;aggregate must be a string&quot;</span><span class="p">)</span>
</span><span id="Timeseries.validate-101"><a href="#Timeseries.validate-101"><span class="linenos">101</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">aggregate_params</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Timeseries.validate-102"><a href="#Timeseries.validate-102"><span class="linenos">102</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">aggregate_params</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="Timeseries.validate-103"><a href="#Timeseries.validate-103"><span class="linenos">103</span></a>                <span class="k">raise</span> <span class="n">InvalidTimeseriesError</span><span class="p">(</span><span class="s2">&quot;aggregate_params must be a list&quot;</span><span class="p">)</span>
</span><span id="Timeseries.validate-104"><a href="#Timeseries.validate-104"><span class="linenos">104</span></a>            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">aggregate_params</span><span class="p">:</span>
</span><span id="Timeseries.validate-105"><a href="#Timeseries.validate-105"><span class="linenos">105</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">is_literal</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
</span><span id="Timeseries.validate-106"><a href="#Timeseries.validate-106"><span class="linenos">106</span></a>                    <span class="k">raise</span> <span class="n">InvalidTimeseriesError</span><span class="p">(</span>
</span><span id="Timeseries.validate-107"><a href="#Timeseries.validate-107"><span class="linenos">107</span></a>                        <span class="s2">&quot;aggregate_params can only be literal types&quot;</span>
</span><span id="Timeseries.validate-108"><a href="#Timeseries.validate-108"><span class="linenos">108</span></a>                    <span class="p">)</span>
</span><span id="Timeseries.validate-109"><a href="#Timeseries.validate-109"><span class="linenos">109</span></a>
</span><span id="Timeseries.validate-110"><a href="#Timeseries.validate-110"><span class="linenos">110</span></a>        <span class="c1"># TODO: Validate these are tag conditions only</span>
</span><span id="Timeseries.validate-111"><a href="#Timeseries.validate-111"><span class="linenos">111</span></a>        <span class="c1"># TODO: Validate these are simple conditions e.g. tag[x] op literal</span>
</span><span id="Timeseries.validate-112"><a href="#Timeseries.validate-112"><span class="linenos">112</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">filters</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Timeseries.validate-113"><a href="#Timeseries.validate-113"><span class="linenos">113</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="Timeseries.validate-114"><a href="#Timeseries.validate-114"><span class="linenos">114</span></a>                <span class="k">raise</span> <span class="n">InvalidTimeseriesError</span><span class="p">(</span><span class="s2">&quot;filters must be a list&quot;</span><span class="p">)</span>
</span><span id="Timeseries.validate-115"><a href="#Timeseries.validate-115"><span class="linenos">115</span></a>            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="p">:</span>
</span><span id="Timeseries.validate-116"><a href="#Timeseries.validate-116"><span class="linenos">116</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="p">(</span><span class="n">Condition</span><span class="p">,</span> <span class="n">BooleanCondition</span><span class="p">)):</span>
</span><span id="Timeseries.validate-117"><a href="#Timeseries.validate-117"><span class="linenos">117</span></a>                    <span class="k">raise</span> <span class="n">InvalidTimeseriesError</span><span class="p">(</span><span class="s2">&quot;filters must be a list of Conditions&quot;</span><span class="p">)</span>
</span><span id="Timeseries.validate-118"><a href="#Timeseries.validate-118"><span class="linenos">118</span></a>
</span><span id="Timeseries.validate-119"><a href="#Timeseries.validate-119"><span class="linenos">119</span></a>        <span class="c1"># TODO: Can you group by meta information like project_id?</span>
</span><span id="Timeseries.validate-120"><a href="#Timeseries.validate-120"><span class="linenos">120</span></a>        <span class="c1"># TODO: Validate these are appropriate columns for grouping</span>
</span><span id="Timeseries.validate-121"><a href="#Timeseries.validate-121"><span class="linenos">121</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">groupby</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Timeseries.validate-122"><a href="#Timeseries.validate-122"><span class="linenos">122</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">groupby</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="Timeseries.validate-123"><a href="#Timeseries.validate-123"><span class="linenos">123</span></a>                <span class="k">raise</span> <span class="n">InvalidTimeseriesError</span><span class="p">(</span><span class="s2">&quot;groupby must be a list&quot;</span><span class="p">)</span>
</span><span id="Timeseries.validate-124"><a href="#Timeseries.validate-124"><span class="linenos">124</span></a>            <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">groupby</span><span class="p">:</span>
</span><span id="Timeseries.validate-125"><a href="#Timeseries.validate-125"><span class="linenos">125</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="p">(</span><span class="n">Column</span><span class="p">,</span> <span class="n">AliasedExpression</span><span class="p">)):</span>
</span><span id="Timeseries.validate-126"><a href="#Timeseries.validate-126"><span class="linenos">126</span></a>                    <span class="k">raise</span> <span class="n">InvalidTimeseriesError</span><span class="p">(</span>
</span><span id="Timeseries.validate-127"><a href="#Timeseries.validate-127"><span class="linenos">127</span></a>                        <span class="s2">&quot;groupby must be a list of Columns or AliasedExpression&quot;</span>
</span><span id="Timeseries.validate-128"><a href="#Timeseries.validate-128"><span class="linenos">128</span></a>                    <span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="Timeseries.set_metric" class="classattr">
                                        <input id="Timeseries.set_metric-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_metric</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">metric</span><span class="p">:</span> <span class="n"><a href="#Metric">Metric</a></span></span><span class="return-annotation">) -> <span class="n"><a href="#Timeseries">Timeseries</a></span>:</span></span>

                <label class="view-source-button" for="Timeseries.set_metric-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Timeseries.set_metric"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Timeseries.set_metric-130"><a href="#Timeseries.set_metric-130"><span class="linenos">130</span></a>    <span class="k">def</span> <span class="nf">set_metric</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">metric</span><span class="p">:</span> <span class="n">Metric</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Timeseries</span><span class="p">:</span>
</span><span id="Timeseries.set_metric-131"><a href="#Timeseries.set_metric-131"><span class="linenos">131</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">metric</span><span class="p">,</span> <span class="n">Metric</span><span class="p">):</span>
</span><span id="Timeseries.set_metric-132"><a href="#Timeseries.set_metric-132"><span class="linenos">132</span></a>            <span class="k">raise</span> <span class="n">InvalidTimeseriesError</span><span class="p">(</span><span class="s2">&quot;metric must be a Metric&quot;</span><span class="p">)</span>
</span><span id="Timeseries.set_metric-133"><a href="#Timeseries.set_metric-133"><span class="linenos">133</span></a>        <span class="k">return</span> <span class="n">replace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="n">metric</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="Timeseries.set_aggregate" class="classattr">
                                        <input id="Timeseries.set_aggregate-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_aggregate</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">aggregate</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">aggregate_params</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n"><a href="#Timeseries">Timeseries</a></span>:</span></span>

                <label class="view-source-button" for="Timeseries.set_aggregate-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Timeseries.set_aggregate"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Timeseries.set_aggregate-135"><a href="#Timeseries.set_aggregate-135"><span class="linenos">135</span></a>    <span class="k">def</span> <span class="nf">set_aggregate</span><span class="p">(</span>
</span><span id="Timeseries.set_aggregate-136"><a href="#Timeseries.set_aggregate-136"><span class="linenos">136</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">aggregate</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">aggregate_params</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Timeseries.set_aggregate-137"><a href="#Timeseries.set_aggregate-137"><span class="linenos">137</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Timeseries</span><span class="p">:</span>
</span><span id="Timeseries.set_aggregate-138"><a href="#Timeseries.set_aggregate-138"><span class="linenos">138</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">aggregate</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="Timeseries.set_aggregate-139"><a href="#Timeseries.set_aggregate-139"><span class="linenos">139</span></a>            <span class="k">raise</span> <span class="n">InvalidTimeseriesError</span><span class="p">(</span><span class="s2">&quot;aggregate must be a str&quot;</span><span class="p">)</span>
</span><span id="Timeseries.set_aggregate-140"><a href="#Timeseries.set_aggregate-140"><span class="linenos">140</span></a>        <span class="k">if</span> <span class="n">aggregate_params</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">aggregate_params</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="Timeseries.set_aggregate-141"><a href="#Timeseries.set_aggregate-141"><span class="linenos">141</span></a>            <span class="k">raise</span> <span class="n">InvalidTimeseriesError</span><span class="p">(</span><span class="s2">&quot;aggregate_params must be a list&quot;</span><span class="p">)</span>
</span><span id="Timeseries.set_aggregate-142"><a href="#Timeseries.set_aggregate-142"><span class="linenos">142</span></a>        <span class="k">return</span> <span class="n">replace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">aggregate</span><span class="o">=</span><span class="n">aggregate</span><span class="p">,</span> <span class="n">aggregate_params</span><span class="o">=</span><span class="n">aggregate_params</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="Timeseries.set_filters" class="classattr">
                                        <input id="Timeseries.set_filters-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_filters</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">filters</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n"><a href="#BooleanCondition">BooleanCondition</a></span><span class="p">,</span> <span class="n"><a href="#Condition">Condition</a></span><span class="p">]]]</span></span><span class="return-annotation">) -> <span class="n"><a href="#Timeseries">Timeseries</a></span>:</span></span>

                <label class="view-source-button" for="Timeseries.set_filters-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Timeseries.set_filters"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Timeseries.set_filters-144"><a href="#Timeseries.set_filters-144"><span class="linenos">144</span></a>    <span class="k">def</span> <span class="nf">set_filters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filters</span><span class="p">:</span> <span class="n">ConditionGroup</span> <span class="o">|</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Timeseries</span><span class="p">:</span>
</span><span id="Timeseries.set_filters-145"><a href="#Timeseries.set_filters-145"><span class="linenos">145</span></a>        <span class="k">if</span> <span class="n">filters</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">list_type</span><span class="p">(</span>
</span><span id="Timeseries.set_filters-146"><a href="#Timeseries.set_filters-146"><span class="linenos">146</span></a>            <span class="n">filters</span><span class="p">,</span> <span class="p">(</span><span class="n">BooleanCondition</span><span class="p">,</span> <span class="n">Condition</span><span class="p">)</span>
</span><span id="Timeseries.set_filters-147"><a href="#Timeseries.set_filters-147"><span class="linenos">147</span></a>        <span class="p">):</span>
</span><span id="Timeseries.set_filters-148"><a href="#Timeseries.set_filters-148"><span class="linenos">148</span></a>            <span class="k">raise</span> <span class="n">InvalidTimeseriesError</span><span class="p">(</span><span class="s2">&quot;filters must be a list of Conditions&quot;</span><span class="p">)</span>
</span><span id="Timeseries.set_filters-149"><a href="#Timeseries.set_filters-149"><span class="linenos">149</span></a>        <span class="k">return</span> <span class="n">replace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filters</span><span class="o">=</span><span class="n">filters</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="Timeseries.set_groupby" class="classattr">
                                        <input id="Timeseries.set_groupby-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_groupby</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">groupby</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n"><a href="#Column">Column</a></span> <span class="o">|</span> <span class="n"><a href="#AliasedExpression">AliasedExpression</a></span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n"><a href="#Timeseries">Timeseries</a></span>:</span></span>

                <label class="view-source-button" for="Timeseries.set_groupby-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Timeseries.set_groupby"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Timeseries.set_groupby-151"><a href="#Timeseries.set_groupby-151"><span class="linenos">151</span></a>    <span class="k">def</span> <span class="nf">set_groupby</span><span class="p">(</span>
</span><span id="Timeseries.set_groupby-152"><a href="#Timeseries.set_groupby-152"><span class="linenos">152</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">groupby</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Column</span> <span class="o">|</span> <span class="n">AliasedExpression</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span>
</span><span id="Timeseries.set_groupby-153"><a href="#Timeseries.set_groupby-153"><span class="linenos">153</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Timeseries</span><span class="p">:</span>
</span><span id="Timeseries.set_groupby-154"><a href="#Timeseries.set_groupby-154"><span class="linenos">154</span></a>        <span class="k">if</span> <span class="n">groupby</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">list_type</span><span class="p">(</span><span class="n">groupby</span><span class="p">,</span> <span class="p">(</span><span class="n">Column</span><span class="p">,</span> <span class="n">AliasedExpression</span><span class="p">)):</span>
</span><span id="Timeseries.set_groupby-155"><a href="#Timeseries.set_groupby-155"><span class="linenos">155</span></a>            <span class="k">raise</span> <span class="n">InvalidTimeseriesError</span><span class="p">(</span>
</span><span id="Timeseries.set_groupby-156"><a href="#Timeseries.set_groupby-156"><span class="linenos">156</span></a>                <span class="s2">&quot;groupby must be a list of Columns or AliasedExpression&quot;</span>
</span><span id="Timeseries.set_groupby-157"><a href="#Timeseries.set_groupby-157"><span class="linenos">157</span></a>            <span class="p">)</span>
</span><span id="Timeseries.set_groupby-158"><a href="#Timeseries.set_groupby-158"><span class="linenos">158</span></a>        <span class="k">return</span> <span class="n">replace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">groupby</span><span class="o">=</span><span class="n">groupby</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                </section>
                <section id="Totals">
                            <input id="Totals-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
                    <div class="decorator">@dataclass(frozen=True)</div>

    <span class="def">class</span>
    <span class="name">Totals</span><wbr>(<span class="base">snuba_sdk.expressions.Expression</span>):

                <label class="view-source-button" for="Totals-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Totals"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Totals-115"><a href="#Totals-115"><span class="linenos">115</span></a><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Totals-116"><a href="#Totals-116"><span class="linenos">116</span></a><span class="k">class</span> <span class="nc">Totals</span><span class="p">(</span><span class="n">Expression</span><span class="p">):</span>
</span><span id="Totals-117"><a href="#Totals-117"><span class="linenos">117</span></a>    <span class="n">totals</span><span class="p">:</span> <span class="nb">bool</span>
</span><span id="Totals-118"><a href="#Totals-118"><span class="linenos">118</span></a>
</span><span id="Totals-119"><a href="#Totals-119"><span class="linenos">119</span></a>    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Totals-120"><a href="#Totals-120"><span class="linenos">120</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">totals</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
</span><span id="Totals-121"><a href="#Totals-121"><span class="linenos">121</span></a>            <span class="k">raise</span> <span class="n">InvalidExpressionError</span><span class="p">(</span><span class="s2">&quot;totals must be a boolean&quot;</span><span class="p">)</span>
</span></pre></div>


    

                            <div id="Totals.__init__" class="classattr">
                                <div class="attr function">
            
        <span class="name">Totals</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">totals</span><span class="p">:</span> <span class="nb">bool</span></span>)</span>

        
    </div>
    <a class="headerlink" href="#Totals.__init__"></a>
    
    

                            </div>
                            <div id="Totals.totals" class="classattr">
                                <div class="attr variable">
            <span class="name">totals</span><span class="annotation">: bool</span>

        
    </div>
    <a class="headerlink" href="#Totals.totals"></a>
    
    

                            </div>
                            <div id="Totals.validate" class="classattr">
                                        <input id="Totals.validate-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">validate</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="Totals.validate-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Totals.validate"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Totals.validate-119"><a href="#Totals.validate-119"><span class="linenos">119</span></a>    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Totals.validate-120"><a href="#Totals.validate-120"><span class="linenos">120</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">totals</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
</span><span id="Totals.validate-121"><a href="#Totals.validate-121"><span class="linenos">121</span></a>            <span class="k">raise</span> <span class="n">InvalidExpressionError</span><span class="p">(</span><span class="s2">&quot;totals must be a boolean&quot;</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                </section>
                <section id="DeleteQuery">
                            <input id="DeleteQuery-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
                    <div class="decorator">@dataclass(frozen=True)</div>

    <span class="def">class</span>
    <span class="name">DeleteQuery</span><wbr>(<span class="base">snuba_sdk.query.BaseQuery</span>):

                <label class="view-source-button" for="DeleteQuery-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DeleteQuery"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DeleteQuery-12"><a href="#DeleteQuery-12"><span class="linenos">12</span></a><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="DeleteQuery-13"><a href="#DeleteQuery-13"><span class="linenos">13</span></a><span class="k">class</span> <span class="nc">DeleteQuery</span><span class="p">(</span><span class="n">BaseQuery</span><span class="p">):</span>
</span><span id="DeleteQuery-14"><a href="#DeleteQuery-14"><span class="linenos">14</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DeleteQuery-15"><a href="#DeleteQuery-15"><span class="linenos">15</span></a><span class="sd">    This represents a snuba delete query.</span>
</span><span id="DeleteQuery-16"><a href="#DeleteQuery-16"><span class="linenos">16</span></a><span class="sd">    Inputs:</span>
</span><span id="DeleteQuery-17"><a href="#DeleteQuery-17"><span class="linenos">17</span></a><span class="sd">        storage - the storage to delete from</span>
</span><span id="DeleteQuery-18"><a href="#DeleteQuery-18"><span class="linenos">18</span></a><span class="sd">        columnConditions - a mapping from column-name to a list of column values</span>
</span><span id="DeleteQuery-19"><a href="#DeleteQuery-19"><span class="linenos">19</span></a><span class="sd">            that defines the delete conditions. ex:</span>
</span><span id="DeleteQuery-20"><a href="#DeleteQuery-20"><span class="linenos">20</span></a><span class="sd">            {</span>
</span><span id="DeleteQuery-21"><a href="#DeleteQuery-21"><span class="linenos">21</span></a><span class="sd">                &quot;id&quot;: [1, 2, 3]</span>
</span><span id="DeleteQuery-22"><a href="#DeleteQuery-22"><span class="linenos">22</span></a><span class="sd">                &quot;status&quot;: [&quot;failed&quot;]</span>
</span><span id="DeleteQuery-23"><a href="#DeleteQuery-23"><span class="linenos">23</span></a><span class="sd">            }</span>
</span><span id="DeleteQuery-24"><a href="#DeleteQuery-24"><span class="linenos">24</span></a><span class="sd">            represents</span>
</span><span id="DeleteQuery-25"><a href="#DeleteQuery-25"><span class="linenos">25</span></a><span class="sd">            DELETE FROM ... WHERE id in (1,2,3) AND status=&#39;failed&#39;</span>
</span><span id="DeleteQuery-26"><a href="#DeleteQuery-26"><span class="linenos">26</span></a><span class="sd">    Deletes all rows in the given storage, that satisfy the conditions</span>
</span><span id="DeleteQuery-27"><a href="#DeleteQuery-27"><span class="linenos">27</span></a><span class="sd">    defined in &#39;columnConditions&#39;.</span>
</span><span id="DeleteQuery-28"><a href="#DeleteQuery-28"><span class="linenos">28</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="DeleteQuery-29"><a href="#DeleteQuery-29"><span class="linenos">29</span></a>
</span><span id="DeleteQuery-30"><a href="#DeleteQuery-30"><span class="linenos">30</span></a>    <span class="n">storage_name</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="DeleteQuery-31"><a href="#DeleteQuery-31"><span class="linenos">31</span></a>    <span class="n">column_conditions</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]]</span>
</span><span id="DeleteQuery-32"><a href="#DeleteQuery-32"><span class="linenos">32</span></a>
</span><span id="DeleteQuery-33"><a href="#DeleteQuery-33"><span class="linenos">33</span></a>    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DeleteQuery-34"><a href="#DeleteQuery-34"><span class="linenos">34</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">column_conditions</span> <span class="o">==</span> <span class="p">{}:</span>
</span><span id="DeleteQuery-35"><a href="#DeleteQuery-35"><span class="linenos">35</span></a>            <span class="k">raise</span> <span class="n">InvalidDeleteQueryError</span><span class="p">(</span><span class="s2">&quot;column conditions cannot be empty&quot;</span><span class="p">)</span>
</span><span id="DeleteQuery-36"><a href="#DeleteQuery-36"><span class="linenos">36</span></a>
</span><span id="DeleteQuery-37"><a href="#DeleteQuery-37"><span class="linenos">37</span></a>        <span class="k">for</span> <span class="n">col</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">column_conditions</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="DeleteQuery-38"><a href="#DeleteQuery-38"><span class="linenos">38</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="DeleteQuery-39"><a href="#DeleteQuery-39"><span class="linenos">39</span></a>                <span class="k">raise</span> <span class="n">InvalidDeleteQueryError</span><span class="p">(</span>
</span><span id="DeleteQuery-40"><a href="#DeleteQuery-40"><span class="linenos">40</span></a>                    <span class="sa">f</span><span class="s2">&quot;column condition &#39;</span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s2">&#39; cannot be empty&quot;</span>
</span><span id="DeleteQuery-41"><a href="#DeleteQuery-41"><span class="linenos">41</span></a>                <span class="p">)</span>
</span><span id="DeleteQuery-42"><a href="#DeleteQuery-42"><span class="linenos">42</span></a>
</span><span id="DeleteQuery-43"><a href="#DeleteQuery-43"><span class="linenos">43</span></a>    <span class="k">def</span> <span class="nf">serialize</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
</span><span id="DeleteQuery-44"><a href="#DeleteQuery-44"><span class="linenos">44</span></a>        <span class="c1"># the body of the request</span>
</span><span id="DeleteQuery-45"><a href="#DeleteQuery-45"><span class="linenos">45</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">validate</span><span class="p">()</span>
</span><span id="DeleteQuery-46"><a href="#DeleteQuery-46"><span class="linenos">46</span></a>        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;columns&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">column_conditions</span><span class="p">}</span>
</span><span id="DeleteQuery-47"><a href="#DeleteQuery-47"><span class="linenos">47</span></a>
</span><span id="DeleteQuery-48"><a href="#DeleteQuery-48"><span class="linenos">48</span></a>    <span class="k">def</span> <span class="nf">print</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="DeleteQuery-49"><a href="#DeleteQuery-49"><span class="linenos">49</span></a>        <span class="k">return</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="DeleteQuery-50"><a href="#DeleteQuery-50"><span class="linenos">50</span></a>
</span><span id="DeleteQuery-51"><a href="#DeleteQuery-51"><span class="linenos">51</span></a>    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="DeleteQuery-52"><a href="#DeleteQuery-52"><span class="linenos">52</span></a>        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;DeleteQuery(storage_name=</span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">storage_name</span><span class="p">)</span><span class="si">}</span><span class="s2">, columnsConditions=</span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">column_conditions</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span>
</span></pre></div>


            <div class="docstring"><p>This represents a snuba delete query.
Inputs:
    storage - the storage to delete from
    columnConditions - a mapping from column-name to a list of column values
        that defines the delete conditions. ex:
        {
            "id": [1, 2, 3]
            "status": ["failed"]
        }
        represents
        DELETE FROM ... WHERE id in (1,2,3) AND status='failed'
Deletes all rows in the given storage, that satisfy the conditions
defined in 'columnConditions'.</p>
</div>


                            <div id="DeleteQuery.__init__" class="classattr">
                                <div class="attr function">
            
        <span class="name">DeleteQuery</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">storage_name</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">column_conditions</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]]</span></span>)</span>

        
    </div>
    <a class="headerlink" href="#DeleteQuery.__init__"></a>
    
    

                            </div>
                            <div id="DeleteQuery.storage_name" class="classattr">
                                <div class="attr variable">
            <span class="name">storage_name</span><span class="annotation">: str</span>

        
    </div>
    <a class="headerlink" href="#DeleteQuery.storage_name"></a>
    
    

                            </div>
                            <div id="DeleteQuery.column_conditions" class="classattr">
                                <div class="attr variable">
            <span class="name">column_conditions</span><span class="annotation">: Dict[str, List[Union[str, int]]]</span>

        
    </div>
    <a class="headerlink" href="#DeleteQuery.column_conditions"></a>
    
    

                            </div>
                            <div id="DeleteQuery.validate" class="classattr">
                                        <input id="DeleteQuery.validate-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">validate</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="DeleteQuery.validate-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DeleteQuery.validate"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DeleteQuery.validate-33"><a href="#DeleteQuery.validate-33"><span class="linenos">33</span></a>    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DeleteQuery.validate-34"><a href="#DeleteQuery.validate-34"><span class="linenos">34</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">column_conditions</span> <span class="o">==</span> <span class="p">{}:</span>
</span><span id="DeleteQuery.validate-35"><a href="#DeleteQuery.validate-35"><span class="linenos">35</span></a>            <span class="k">raise</span> <span class="n">InvalidDeleteQueryError</span><span class="p">(</span><span class="s2">&quot;column conditions cannot be empty&quot;</span><span class="p">)</span>
</span><span id="DeleteQuery.validate-36"><a href="#DeleteQuery.validate-36"><span class="linenos">36</span></a>
</span><span id="DeleteQuery.validate-37"><a href="#DeleteQuery.validate-37"><span class="linenos">37</span></a>        <span class="k">for</span> <span class="n">col</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">column_conditions</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="DeleteQuery.validate-38"><a href="#DeleteQuery.validate-38"><span class="linenos">38</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="DeleteQuery.validate-39"><a href="#DeleteQuery.validate-39"><span class="linenos">39</span></a>                <span class="k">raise</span> <span class="n">InvalidDeleteQueryError</span><span class="p">(</span>
</span><span id="DeleteQuery.validate-40"><a href="#DeleteQuery.validate-40"><span class="linenos">40</span></a>                    <span class="sa">f</span><span class="s2">&quot;column condition &#39;</span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s2">&#39; cannot be empty&quot;</span>
</span><span id="DeleteQuery.validate-41"><a href="#DeleteQuery.validate-41"><span class="linenos">41</span></a>                <span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="DeleteQuery.serialize" class="classattr">
                                        <input id="DeleteQuery.serialize-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">serialize</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span>:</span></span>

                <label class="view-source-button" for="DeleteQuery.serialize-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DeleteQuery.serialize"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DeleteQuery.serialize-43"><a href="#DeleteQuery.serialize-43"><span class="linenos">43</span></a>    <span class="k">def</span> <span class="nf">serialize</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
</span><span id="DeleteQuery.serialize-44"><a href="#DeleteQuery.serialize-44"><span class="linenos">44</span></a>        <span class="c1"># the body of the request</span>
</span><span id="DeleteQuery.serialize-45"><a href="#DeleteQuery.serialize-45"><span class="linenos">45</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">validate</span><span class="p">()</span>
</span><span id="DeleteQuery.serialize-46"><a href="#DeleteQuery.serialize-46"><span class="linenos">46</span></a>        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;columns&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">column_conditions</span><span class="p">}</span>
</span></pre></div>


    

                            </div>
                            <div id="DeleteQuery.print" class="classattr">
                                        <input id="DeleteQuery.print-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">print</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="DeleteQuery.print-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DeleteQuery.print"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DeleteQuery.print-48"><a href="#DeleteQuery.print-48"><span class="linenos">48</span></a>    <span class="k">def</span> <span class="nf">print</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="DeleteQuery.print-49"><a href="#DeleteQuery.print-49"><span class="linenos">49</span></a>        <span class="k">return</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>snuba_sdk.query.BaseQuery</dt>
                                <dd id="DeleteQuery.get_fields" class="function">get_fields</dd>

            </div>
                                </dl>
                            </div>
                </section>
    </main>
</body>
</html>